!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(cp){"use strict";try{(function(){cp=cp&&Object.prototype.hasOwnProperty.call(cp,"default")?cp.default:cp;var t,l,e,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,t,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function i(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}(e=l=l||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT";l.DEBUG,l.VERBOSE,l.INFO,l.WARN,l.ERROR,l.SILENT;function o(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=a[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}var u=l.INFO,a=((t={})[l.DEBUG]="log",t[l.VERBOSE]="log",t[l.INFO]="info",t[l.WARN]="warn",t[l.ERROR]="error",t),h=(Object.defineProperty(c.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!0,configurable:!0}),c.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.DEBUG],t)),this._logHandler.apply(this,s([this,l.DEBUG],t))},c.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.VERBOSE],t)),this._logHandler.apply(this,s([this,l.VERBOSE],t))},c.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.INFO],t)),this._logHandler.apply(this,s([this,l.INFO],t))},c.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.WARN],t)),this._logHandler.apply(this,s([this,l.WARN],t))},c.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.ERROR],t)),this._logHandler.apply(this,s([this,l.ERROR],t))},c);function c(t){this.name=t,this._logLevel=u,this._logHandler=o,this._userLogHandler=null}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var f,d=(n(m,f=Error),m);function m(t,e){var n=f.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,m.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,g.prototype.create),n}var g=(w.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(b,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})):"Error",a=this.serviceName+": "+u+" ("+o+").",h=new d(o,a),c=0,f=Object.keys(i);c<f.length;c++){var l=f[c];"_"!==l.slice(-1)&&(l in h&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),h[l]=i[l])}return h},w);function w(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var b=/\{\$([^}]+)}/g,E=(T.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},T.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},T.prototype.setServiceProps=function(t){return this.serviceProps=t,this},T);function T(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}function I(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var N,_="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},A=A||{},S=_||self;function D(){}function x(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function k(t){var e=x(t);return"array"==e||"object"==e&&"number"==typeof t.length}function O(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var R="closure_uid_"+(1e9*Math.random()>>>0),L=0;function P(t,e,n){return t.call.apply(t.bind,arguments)}function V(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function M(t,e,n){return(M=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?P:V).apply(null,arguments)}function C(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var q=Date.now||function(){return+new Date};function U(t,e){function n(){}n.prototype=e.prototype,t.M=e.prototype,t.prototype=new n,t.prototype.constructor=t}function j(){this.j=this.j,this.i=this.i}j.prototype.j=!1,j.prototype.da=function(){if(!this.j&&(this.j=!0,this.C(),0))t=this,Object.prototype.hasOwnProperty.call(t,R)&&t[R]||(t[R]=++L);var t},j.prototype.C=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var B=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},F=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function z(t){return Array.prototype.concat.apply([],arguments)}function G(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function H(t){return/^[\s\xa0]*$/.test(t)}var Q,W=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function K(t,e){return-1!=t.indexOf(e)}function Y(t,e){return t<e?-1:e<t?1:0}t:{var X=S.navigator;if(X){var J=X.userAgent;if(J){Q=J;break t}}Q=""}function $(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Z(t){var e={};for(var n in t)e[n]=t[n];return e}var tt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function et(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<tt.length;o++)n=tt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function nt(t){return nt[" "](t),t}nt[" "]=D;var rt,it,ot=K(Q,"Opera"),st=K(Q,"Trident")||K(Q,"MSIE"),ut=K(Q,"Edge"),at=ut||st,ht=K(Q,"Gecko")&&!(K(Q.toLowerCase(),"webkit")&&!K(Q,"Edge"))&&!(K(Q,"Trident")||K(Q,"MSIE"))&&!K(Q,"Edge"),ct=K(Q.toLowerCase(),"webkit")&&!K(Q,"Edge");function ft(){var t=S.document;return t?t.documentMode:void 0}t:{var lt="",pt=(it=Q,ht?/rv:([^\);]+)(\)|;)/.exec(it):ut?/Edge\/([\d\.]+)/.exec(it):st?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(it):ct?/WebKit\/(\S+)/.exec(it):ot?/(?:Version)[ \/]?(\S+)/.exec(it):void 0);if(pt&&(lt=pt?pt[1]:""),st){var dt=ft();if(null!=dt&&dt>parseFloat(lt)){rt=String(dt);break t}}rt=lt}var yt,vt={};function mt(u){return t=u,e=function(){for(var t=0,e=W(String(rt)).split("."),n=W(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=Y(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||Y(0==o[2].length,0==s[2].length)||Y(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=vt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}if(S.document&&st){var gt=ft();yt=gt||(parseInt(rt,10)||void 0)}else yt=void 0;var wt=yt,bt=!st||9<=Number(wt),Et=st&&!mt("9"),Tt=function(){if(!S.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{S.addEventListener("test",D,e),S.removeEventListener("test",D,e)}catch(t){}return t}();function It(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Nt(t,e){if(It.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ht){t:{try{nt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:_t[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}It.prototype.b=function(){this.defaultPrevented=!0},U(Nt,It);var _t={2:"touch",3:"pen",4:"mouse"};Nt.prototype.b=function(){Nt.M.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Et)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var At="closure_listenable_"+(1e6*Math.random()|0),St=0;function Dt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.aa=i,this.key=++St,this.V=this.X=!1}function xt(t){t.V=!0,t.listener=null,t.proxy=null,t.src=null,t.aa=null}function kt(t){this.src=t,this.a={},this.b=0}function Ot(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=B(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(xt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Rt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.V&&o.listener==e&&o.capture==!!n&&o.aa==r)return i}return-1}kt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Rt(t,e,r,i);return-1<s?(e=t[s],n||(e.X=!1)):((e=new Dt(e,this.src,o,!!r,i)).X=n,t.push(e)),e};var Lt="closure_lm_"+(1e6*Math.random()|0),Pt={};function Vt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=zt(r);return e&&e[At]?e.sa(n,r,O(i)?!!i.capture:!!i,o):Mt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Vt(t,e[o],n,r,i);return null}return n=zt(n),t&&t[At]?t.ra(e,n,O(r)?!!r.capture:!!r,i):Mt(t,e,n,!1,r,i)}function Mt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=O(i)?!!i.capture:!!i;if(s&&!bt)return null;var u,a,h=Bt(t);if(h||(t[Lt]=h=new kt(t)),(n=h.add(e,n,r,s,o)).proxy)return n;if(u=jt,r=a=bt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)Tt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(qt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ct(t){if("number"!=typeof t&&t&&!t.V){var e=t.src;if(e&&e[At])Ot(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(qt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Bt(e))?(Ot(n,t),0==n.b&&(n.src=null,e[Lt]=null)):xt(t)}}}function qt(t){return t in Pt?Pt[t]:Pt[t]="on"+t}function Ut(t,e){var n=t.listener,r=t.aa||t.src;return t.X&&Ct(t),n.call(r,e)}function jt(t,e){if(t.V)return!0;if(bt)return Ut(t,new Nt(e,this));if(!e)t:{e=["window","event"];for(var n=S,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Ut(t,e=new Nt(e,this))}function Bt(t){return(t=t[Lt])instanceof kt?t:null}var Ft="__closure_events_fn_"+(1e9*Math.random()>>>0);function zt(e){return"function"==x(e)?e:(e[Ft]||(e[Ft]=function(t){return e.handleEvent(t)}),e[Ft])}function Gt(){j.call(this),this.c=new kt(this),(this.J=this).A=null}function Ht(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.V&&s.capture==n){var u=s.listener,a=s.aa||s.src;s.X&&Ot(t.c,s),i=!1!==u.call(a,r)&&i}}return i&&!r.defaultPrevented}U(Gt,j),Gt.prototype[At]=!0,(N=Gt.prototype).addEventListener=function(t,e,n,r){Vt(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=O(i)?!!i.capture:!!i,r=zt(r),e&&e[At]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Rt(s=e.a[n],r,i,o))&&(xt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Bt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Rt(n,r,i,o)),(r=-1<e?n[e]:null)&&Ct(r))}(this,t,e,n,r)},N.dispatchEvent=function(t){var e,n=this.A;if(n)for(e=[];n;n=n.A)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t)t=new It(t,n);else if(t instanceof It)t.target=t.target||n;else{var i=t;et(t=new It(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];i=Ht(s,r,!0,t)&&i}if(i=Ht(s=t.a=n,r,!0,t)&&i,i=Ht(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Ht(s=t.a=e[o],r,!1,t)&&i;return i},N.C=function(){if(Gt.M.C.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)xt(n[r]);delete e.a[t],e.b--}}this.A=null},N.ra=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},N.sa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Qt=S.JSON.stringify;function Wt(){this.b=this.a=null}var Kt,Yt=(Xt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Xt(function(){return new Jt},function(t){t.reset()},100));function Xt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function Jt(){this.next=this.b=this.a=null}function $t(t){S.setTimeout(function(){throw t},0)}function Zt(t,e){var n;Kt||(n=S.Promise.resolve(void 0),Kt=function(){n.then(ne)}),te||(Kt(),te=!0),ee.add(t,e)}Wt.prototype.add=function(t,e){var n=Yt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Jt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var te=!(Jt.prototype.reset=function(){this.next=this.b=this.a=null}),ee=new Wt;function ne(){for(var t;r=n=void 0,r=null,(n=ee).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){$t(t)}var e=Yt;e.g(t),e.b<e.f&&(e.b++,t.next=e.a,e.a=t)}var n,r;te=!1}function re(t,e){Gt.call(this),this.b=t||1,this.a=e||S,this.f=M(this.Ua,this),this.g=q()}function ie(t){t.Z=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function oe(t,e,n){if("function"==x(t))n&&(t=M(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=M(t.handleEvent,t)}return 2147483647<Number(e)?-1:S.setTimeout(t,e||0)}function se(t,e,n){j.call(this),this.f=null!=n?M(t,n):t,this.c=e,this.b=M(this.Pa,this),this.a=[]}function ue(t){t.T=oe(t.b,t.c),t.f.apply(null,t.a)}function ae(t){j.call(this),this.b=t,this.a={}}U(re,Gt),(N=re.prototype).Z=!1,N.L=null,N.Ua=function(){if(this.Z){var t=q()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.Z&&(ie(this),this.start()))}},N.start=function(){this.Z=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=q())},N.C=function(){re.M.C.call(this),ie(this),delete this.a},U(se,j),(N=se.prototype).ba=!1,N.T=null,N.Ia=function(t){this.a=arguments,this.T?this.ba=!0:ue(this)},N.C=function(){se.M.C.call(this),this.T&&(S.clearTimeout(this.T),this.T=null,this.ba=!1,this.a=[])},N.Pa=function(){this.T=null,this.ba&&(this.ba=!1,ue(this))},U(ae,j);var he=[];function ce(t,e,n,r){Array.isArray(n)||(n&&(he[0]=n.toString()),n=he);for(var i=0;i<n.length;i++){var o=Vt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function fe(t){$(t.a,function(t,e){this.a.hasOwnProperty(e)&&Ct(t)},t),t.a={}}function le(){}ae.prototype.C=function(){ae.M.C.call(this),fe(this)},ae.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var pe=null;function de(){return pe=pe||new Gt}function ye(t){It.call(this,"serverreachability",t)}function ve(t){var e=de();e.dispatchEvent(new ye(e))}function me(t){It.call(this,"statevent",t)}function ge(t){var e=de();e.dispatchEvent(new me(e))}function we(t){It.call(this,"timingevent",t)}function be(t,e){if("function"!=x(t))throw Error("Fn must not be null and must be a function");return S.setTimeout(function(){t()},e)}U(ye,It),U(me,It),U(we,It);var Ee={NO_ERROR:0,Va:1,bb:2,ab:3,Ya:4,$a:5,cb:6,za:7,TIMEOUT:8,gb:9},Te={Xa:"complete",kb:"success",Aa:"error",za:"abort",ib:"ready",jb:"readystatechange",TIMEOUT:"timeout",eb:"incrementaldata",hb:"progress",Za:"downloadprogress",lb:"uploadprogress"};function Ie(){}function Ne(t){var e;return(e=t.a)||(e=t.a={}),e}function _e(){}Ie.prototype.a=null;var Ae,Se={OPEN:"a",Wa:"b",Aa:"c",fb:"d"};function De(){It.call(this,"d")}function xe(){It.call(this,"c")}function ke(){}function Oe(t,e,n){this.g=t,this.W=e,this.U=n||1,this.G=new ae(this),this.N=Re,t=at?125:void 0,this.O=new re(t),this.m=null,this.b=!1,this.j=this.A=this.f=this.B=this.s=this.P=this.h=null,this.i=[],this.a=null,this.w=0,this.c=this.v=null,this.H=-1,this.l=!1,this.J=0,this.D=null,this.o=this.R=this.F=!1}U(De,It),U(xe,It),U(ke,Ie),Ae=new ke;var Re=45e3,Le={},Pe={};function Ve(t,e,n){t.B=1,t.f=rn(Je(e)),t.j=n,t.F=!0,Me(t,null)}function Me(t,e){t.s=q(),Ue(t),t.A=Je(t.f);var n=t.A,r=t.U;Array.isArray(r)||(r=[String(r)]),mn(n.b,"t",r),t.w=0,t.a=ar(t.g,t.g.w?e:null),0<t.J&&(t.D=new se(M(t.ya,t,t.a),t.J)),ce(t.G,t.a,"readystatechange",t.Sa),e=t.m?Z(t.m):{},t.j?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.$(t.A,t.v,t.j,e)):(t.v="GET",t.a.$(t.A,t.v,null,e)),ve(1)}function Ce(t,e,n){for(var r=!0;!t.l&&t.w<n.length;){var i=qe(t,n);if(i==Pe){4==e&&(t.c=4,ge(14),r=!1);break}if(i==Le){t.c=4,ge(15),r=!1;break}Ge(t,i)}4==e&&0==n.length&&(t.c=1,ge(16),r=!1),t.b=t.b&&r,r||(ze(t),Fe(t))}function qe(t,e){var n=t.w,r=e.indexOf("\n",n);return-1==r?Pe:(n=Number(e.substring(n,r)),isNaN(n)?Le:(r+=1)+n>e.length?Pe:(e=e.substr(r,n),t.w=r+n,e))}function Ue(t){t.P=q()+t.N,je(t,t.N)}function je(t,e){if(null!=t.h)throw Error("WatchDog timer not null");t.h=be(M(t.Qa,t),e)}function Be(t){t.h&&(S.clearTimeout(t.h),t.h=null)}function Fe(t){0==t.g.u||t.l||rr(t.g,t)}function ze(t){Be(t);var e=t.D;e&&"function"==typeof e.da&&e.da(),t.D=null,ie(t.O),fe(t.G),t.a&&(e=t.a,t.a=null,e.abort(),e.da())}function Ge(t,e){try{var n=t.g;if(0!=n.u&&(n.a==t||Nn(n.b,t)))if(n.A=t.H,!t.o&&Nn(n.b,t)&&3==n.u){try{var r=n.ja.a.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.i){if(n.a){if(!(n.a.s+3e3<t.s))break t;nr(n),n.a.cancel(),n.a=null}er(n),ge(18)}}else n.ia=i[1],0<n.ia-n.G&&i[2]<37500&&n.U&&0==n.m&&!n.l&&(n.l=be(M(n.Na,n),6e3));if(In(n.b)<=1&&n.O){try{n.O()}catch(t){}n.O=void 0}}else or(n,11)}else if(!t.o&&n.a!=t||nr(n),!H(e))for(e=r=n.ja.a.parse(e),r=0;r<e.length;r++)if(i=e[r],n.G=i[0],i=i[1],2==n.u)if("c"==i[0]){n.B=i[1],n.R=i[2];var o=i[3];null!=o&&(n.oa=o);var s=i[5];null!=s&&"number"==typeof s&&0<s&&(n.D=1.5*s);var u=n,a=t.a;if(a){var h=a.a?a.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var c=u.b;!c.a&&(K(h,"spdy")||K(h,"quic")||K(h,"h2"))&&(c.f=c.g,c.a=new Set,c.b&&(_n(c,c.b),c.b=null))}if(u.s){var f=a.a?a.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.ha=f,nn(u.v,u.s,f))}}n.u=3,n.c&&n.c.na();var l=t;if((u=n).ea=ur(u,u.w?u.R:null,u.P),l.o){An(u.b,l);var p=l,d=u.D;d&&p.setTimeout(d),p.h&&(Be(p),Ue(p)),u.a=l}else tr(u);0<n.f.length&&Xn(n)}else"stop"!=i[0]&&"close"!=i[0]||or(n,7);else 3==n.u&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?or(n,7):Wn(n):"noop"!=i[0]&&n.c&&n.c.ma(i),n.m=0);ve(4)}catch(t){}}function He(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(k(t)||"string"==typeof t)F(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.I&&"function"==typeof t.I)n=void 0;else if(k(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.I&&"function"==typeof t.I)return t.I();if("string"==typeof t)return t.split("");if(k(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Qe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Qe)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function We(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ke(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Ke(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Ke(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(N=Oe.prototype).setTimeout=function(t){this.N=t},N.Sa=function(t){t=t.target;var e=this.D;e&&3==zn(t)?e.Ia():this.ya(t)},N.ya=function(t){try{if(t==this.a)t:{var e=zn(this.a),n=this.a.qa(),r=this.a.S();if(!(e<3||3==e&&!at&&!this.a.Y())){this.l||4!=e||7==n||ve(8==n||r<=0?3:2),Be(this);var i=this.a.S();this.H=i;var o=this.a.Y();if(this.b=200==i){if(this.R&&!this.o){e:{if(this.a){var s,u=this.a;if((s=u.a?u.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!H(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.c=3,ge(12),ze(this),Fe(this);break t}this.o=!0,Ge(this,a)}this.F?(Ce(this,e,o),at&&this.b&&3==e&&(ce(this.G,this.O,"tick",this.Ra),this.O.start())):Ge(this,o),4==e&&ze(this),this.b&&!this.l&&(4==e?rr(this.g,this):(this.b=!1,Ue(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,ge(12)):(this.c=0,ge(13)),ze(this),Fe(this)}}}catch(t){}},N.Ra=function(){if(this.a){var t=zn(this.a),e=this.a.Y();this.w<e.length&&(Be(this),Ce(this,t,e),this.b&&4!=t&&Ue(this))}},N.cancel=function(){this.l=!0,ze(this)},N.Qa=function(){this.h=null;var t=q();0<=t-this.P?(2!=this.B&&(ve(3),ge(17)),ze(this),this.c=2,Fe(this)):je(this,this.P-t)},(N=Qe.prototype).I=function(){We(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},N.K=function(){return We(this),this.a.concat()},N.get=function(t,e){return Ke(this.b,t)?this.b[t]:e},N.set=function(t,e){Ke(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},N.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Ye=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Xe(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Xe){this.a=void 0!==e?e:t.a,$e(this,t.f),this.j=t.j,Ze(this,t.c),tn(this,t.h),this.g=t.g,e=t.b;var n=new pn;n.c=e.c,e.a&&(n.a=new Qe(e.a),n.b=e.b),en(this,n),this.i=t.i}else t&&(n=String(t).match(Ye))?(this.a=!!e,$e(this,n[1]||"",!0),this.j=on(n[2]||""),Ze(this,n[3]||"",!0),tn(this,n[4]),this.g=on(n[5]||"",!0),en(this,n[6]||"",!0),this.i=on(n[7]||"")):(this.a=!!e,this.b=new pn(null,this.a))}function Je(t){return new Xe(t)}function $e(t,e,n){t.f=n?on(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Ze(t,e,n){t.c=n?on(e,!0):e}function tn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function en(t,e,n){var r,i;e instanceof pn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(dn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(yn(this,e),mn(this,n,t))},r)),r.f=i):(n||(e=sn(e,fn)),t.b=new pn(e,t.a))}function nn(t,e,n){t.b.set(e,n)}function rn(t){return nn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)),t}function on(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function sn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,un),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function un(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Xe.prototype.toString=function(){var t=[],e=this.f;e&&t.push(sn(e,an,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(sn(e,an,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(sn(n,"/"==n.charAt(0)?cn:hn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",sn(n,ln)),t.join("")};var an=/[#\/\?@]/g,hn=/[#\?:]/g,cn=/[#\?]/g,fn=/[#\?@]/g,ln=/#/g;function pn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function dn(n){n.a||(n.a=new Qe,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function yn(t,e){dn(t),e=gn(t,e),Ke(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ke((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&We(t)))}function vn(t,e){return dn(t),e=gn(t,e),Ke(t.a.b,e)}function mn(t,e,n){yn(t,e),0<n.length&&(t.c=null,t.a.set(gn(t,e),G(n)),t.b+=n.length)}function gn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function wn(t,e){this.b=t,this.a=e}function bn(t){this.g=t||En,t=S.PerformanceNavigationTiming?0<(t=S.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(S.ca&&S.ca.ua&&S.ca.ua()&&S.ca.ua().mb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(N=pn.prototype).add=function(t,e){dn(this),this.c=null,t=gn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},N.forEach=function(n,r){dn(this),this.a.forEach(function(t,e){F(t,function(t){n.call(r,t,e,this)},this)},this)},N.K=function(){dn(this);for(var t=this.a.I(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},N.I=function(t){dn(this);var e=[];if("string"==typeof t)vn(this,t)&&(e=z(e,this.a.get(gn(this,t))));else{t=this.a.I();for(var n=0;n<t.length;n++)e=z(e,t[n])}return e},N.set=function(t,e){return dn(this),this.c=null,vn(this,t=gn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},N.get=function(t,e){return t&&0<(t=this.I(t)).length?String(t[0]):e},N.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.I(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var En=10;function Tn(t){return t.b||t.a&&t.a.size>=t.f}function In(t){return t.b?1:t.a?t.a.size:0}function Nn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function _n(t,e){t.a?t.a.add(e):t.b=e}function An(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Sn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.i);if(null==t.a||0===t.a.size)return G(t.c);var r=t.c;try{for(var i=I(t.a.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Dn(){}function xn(){this.a=new Dn}function kn(t,r,e){var i=e||"";try{He(t,function(t,e){var n=t;O(t)&&(n=Qt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function On(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}bn.prototype.cancel=function(){var e,t;if(this.c=Sn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=I(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},Dn.prototype.stringify=function(t){return S.JSON.stringify(t,void 0)},Dn.prototype.parse=function(t){return S.JSON.parse(t,void 0)};var Rn=S.JSON.parse;function Ln(t){Gt.call(this),this.headers=new Qe,this.G=t||null,this.b=!1,this.s=this.a=null,this.D="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.H=Pn,this.B=this.F=!1}U(Ln,Gt);var Pn="",Vn=/^https?$/i,Mn=["POST","PUT"];function Cn(t){return"content-type"==t.toLowerCase()}function qn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Un(t),Bn(t)}function Un(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function jn(t){if(t.b&&void 0!==A&&(!t.s[1]||4!=zn(t)||2!=t.S()))if(t.l&&4==zn(t))oe(t.va,0,t);else if(t.dispatchEvent("readystatechange"),4==zn(t)){t.b=!1;try{var e,n=t.S();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.D).match(Ye)[1]||null;if(!o&&S.self&&S.self.location){var s=S.self.location.protocol;o=s.substr(0,s.length-1)}i=!Vn.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<zn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.S()+"]",Un(t)}}finally{Bn(t)}}}function Bn(t,e){if(t.a){Fn(t);var n=t.a,r=t.s[0]?D:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Fn(t){t.a&&t.B&&(t.a.ontimeout=null),t.m&&(S.clearTimeout(t.m),t.m=null)}function zn(t){return t.a?t.a.readyState:0}function Gn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",$(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):nn(t,e,n))}function Hn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Qn(t){this.f=[],this.R=this.ea=this.v=this.P=this.a=this.ha=this.s=this.N=this.h=this.F=this.j=null,this.Fa=this.H=0,this.Ca=Hn("failFast",!1,t),this.U=this.l=this.i=this.g=this.c=null,this.W=!0,this.A=this.ia=this.G=-1,this.J=this.m=this.o=0,this.Ba=Hn("baseRetryDelayMs",5e3,t),this.Ga=Hn("retryDelaySeedMs",1e4,t),this.Da=Hn("forwardChannelMaxRetries",2,t),this.ga=Hn("forwardChannelRequestTimeoutMs",2e4,t),this.Ea=t&&t.nb||void 0,this.D=void 0,this.w=t&&t.supportsCrossDomainXhr||!1,this.B="",this.b=new bn(t&&t.concurrentRequestLimit),this.ja=new xn,this.fa=t&&t.fastHandshake||!1,t&&t.forceLongPolling&&(this.W=!1),this.O=void 0}function Wn(t){if(Kn(t),3==t.u){var e=t.H++,n=Je(t.v);nn(n,"SID",t.B),nn(n,"RID",e),nn(n,"TYPE","terminate"),$n(t,n),(e=new Oe(t,e,void 0)).B=2,e.f=rn(Je(n)),n=!1,S.navigator&&S.navigator.sendBeacon&&(n=S.navigator.sendBeacon(e.f.toString(),"")),!n&&S.Image&&((new Image).src=e.f,n=!0),n||(e.a=ar(e.g,null),e.a.$(e.f)),e.s=q(),Ue(e)}sr(t)}function Kn(t){t.a&&(t.a.cancel(),t.a=null),t.i&&(S.clearTimeout(t.i),t.i=null),nr(t),t.b.cancel(),t.g&&("number"==typeof t.g&&S.clearTimeout(t.g),t.g=null)}function Yn(t,e){t.f.push(new wn(t.Fa++,e)),3==t.u&&Xn(t)}function Xn(t){Tn(t.b)||t.g||(t.g=!0,Zt(t.xa,t),t.o=0)}function Jn(t,e){var n;n=e?e.W:t.H++;var r=Je(t.v);nn(r,"SID",t.B),nn(r,"RID",n),nn(r,"AID",t.G),$n(t,r),t.h&&t.j&&Gn(r,t.h,t.j),n=new Oe(t,n,t.o+1),null===t.h&&(n.m=t.j),e&&(t.f=e.i.concat(t.f)),e=Zn(t,n,1e3),n.setTimeout(Math.round(.5*t.ga)+Math.round(.5*t.ga*Math.random())),_n(t.b,n),Ve(n,r,e)}function $n(t,n){t.c&&He({},function(t,e){nn(n,e,t)})}function Zn(t,e,n){n=Math.min(t.f.length,n);var r=t.c?M(t.c.Ha,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var h=i[a].b,c=i[a].a;if((h-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{kn(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(u){r=s.join("&");break t}}return t=t.f.splice(0,n),e.i=t,r}function tr(t){t.a||t.i||(t.J=1,Zt(t.wa,t),t.m=0)}function er(t){return!(t.a||t.i||3<=t.m)&&(t.J++,t.i=be(M(t.wa,t),ir(t,t.m)),t.m++,1)}function nr(t){null!=t.l&&(S.clearTimeout(t.l),t.l=null)}function rr(t,e){var n=null;if(t.a==e){nr(t),t.a=null;var r=2}else{if(!Nn(t.b,e))return;n=e.i,An(t.b,e),r=1}if(t.A=e.H,0!=t.u)if(e.b)if(1==r){n=e.j?e.j.length:0,e=q()-e.s;var i=t.o;(r=de()).dispatchEvent(new we(r)),Xn(t)}else tr(t);else if(3==(i=e.c)||0==i&&0<t.A||!(1==r&&function(t,e){if(!(In(t.b)>=t.b.f-(t.g?1:0))){if(t.g)return t.f=e.i.concat(t.f),1;if(!(1==t.u||2==t.u||t.o>=(t.Ca?0:t.Da)))return t.g=be(M(t.xa,t,e),ir(t,t.o)),t.o++,1}}(t,e)||2==r&&er(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:or(t,5);break;case 4:or(t,10);break;case 3:or(t,6);break;default:or(t,2)}}function ir(t,e){var n=t.Ba+Math.floor(Math.random()*t.Ga);return t.c||(n*=2),n*e}function or(t,e){if(2==e){var n=null;t.c&&(n=null);var r=M(t.Ta,t);n||(n=new Xe("//www.google.com/images/cleardot.gif"),S.location&&"http"==S.location.protocol||$e(n,"https"),rn(n)),function(t,e){var n=new le;if(S.Image){var r=new Image;r.onload=C(On,n,r,"TestLoadImage: loaded",!0,e),r.onerror=C(On,n,r,"TestLoadImage: error",!1,e),r.onabort=C(On,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=C(On,n,r,"TestLoadImage: timeout",!1,e),S.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else ge(2);t.u=0,t.c&&t.c.la(e),sr(t),Kn(t)}function sr(t){t.u=0,t.A=-1,t.c&&(0==Sn(t.b).length&&0==t.f.length||(t.b.c.length=0,G(t.f),t.f.length=0),t.c.ka())}function ur(t,e,n){var r,i,o,s,u,a,h=(r=n)instanceof Xe?Je(r):new Xe(r,void 0);if(""!=h.c)e&&Ze(h,e+"."+h.c),tn(h,h.h);else{var c=S.location;i=c.protocol,o=e?e+"."+c.hostname:c.hostname,s=+c.port,u=n,a=new Xe(null,void 0),i&&$e(a,i),o&&Ze(a,o),s&&tn(a,s),u&&(a.g=u),h=a}return t.N&&$(t.N,function(t,e){nn(h,e,t)}),e=t.s,n=t.ha,e&&n&&nn(h,e,n),nn(h,"VER",t.oa),$n(t,h),h}function ar(t,e){if(e&&!t.w)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Ln(t.Ea)).F=t.w,e}function hr(){}function cr(){if(st&&!(10<=Number(wt)))throw Error("Environmental error: no available transport.")}function fr(t,e){Gt.call(this),this.a=new Qn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.j=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.pa&&(t?t["X-WebChannel-Client-Profile"]=e.pa:t={"X-WebChannel-Client-Profile":e.pa}),this.a.F=t,(t=e&&e.httpHeadersOverwriteParam)&&!H(t)&&(this.a.h=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!H(e)&&(this.a.s=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new dr(this)}function lr(t){De.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function pr(){xe.call(this),this.status=1}function dr(t){this.a=t}(N=Ln.prototype).$=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.G?Ne(this.G):Ne(Ae),this.a.onreadystatechange=M(this.va,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void qn(this,t)}t=n||"";var i,o=new Qe(this.headers);r&&He(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Cn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.K()),n=S.FormData&&t instanceof S.FormData,0<=B(Mn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.H&&(this.a.responseType=this.H),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Fn(this),0<this.o&&((this.B=(i=this.a,st&&mt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=M(this.ta,this)):this.m=oe(this.ta,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){qn(this,t)}},N.ta=function(){void 0!==A&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},N.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Bn(this))},N.C=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Bn(this,!0)),Ln.M.C.call(this)},N.va=function(){this.j||(this.w||this.l||this.g?jn(this):this.Oa())},N.Oa=function(){jn(this)},N.S=function(){try{return 2<zn(this)?this.a.status:-1}catch(t){return-1}},N.Y=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},N.Ja=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Rn(e)}},N.qa=function(){return this.h},N.Ma=function(){return"string"==typeof this.f?this.f:String(this.f)},(N=Qn.prototype).oa=8,N.u=1,N.xa=function(t){if(this.g)if(this.g=null,1==this.u){if(!t){this.H=Math.floor(1e5*Math.random()),t=this.H++;var e,n=new Oe(this,t,void 0),r=this.j;if(this.F&&(r?et(r=Z(r),this.F):r=this.F),null===this.h&&(n.m=r),this.fa)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Zn(this,n,e),nn(i=Je(this.v),"RID",t),nn(i,"CVER",22),this.s&&nn(i,"X-HTTP-Session-Id",this.s),$n(this,i),this.h&&r&&Gn(i,this.h,r),_n(this.b,n),this.fa?(nn(i,"$req",e),nn(i,"SID","null"),n.R=!0,Ve(n,i,null)):Ve(n,i,e),this.u=2}}else 3==this.u&&(t?Jn(this,t):0==this.f.length||Tn(this.b)||Jn(this))},N.wa=function(){this.i=null,this.a=new Oe(this,"rpc",this.J),null===this.h&&(this.a.m=this.j),this.a.J=0;var t=Je(this.ea);nn(t,"RID","rpc"),nn(t,"SID",this.B),nn(t,"CI",this.U?"0":"1"),nn(t,"AID",this.G),$n(this,t),nn(t,"TYPE","xmlhttp"),this.h&&this.j&&Gn(t,this.h,this.j),this.D&&this.a.setTimeout(this.D);var e=this.a,n=this.R;e.B=1,e.f=rn(Je(t)),e.j=null,e.F=!0,Me(e,n)},N.Na=function(){null!=this.l&&(this.l=null,this.a.cancel(),this.a=null,er(this),ge(19))},N.Ta=function(t){ge(t?2:1)},(N=hr.prototype).na=function(){},N.ma=function(){},N.la=function(){},N.ka=function(){},N.Ha=function(){},cr.prototype.a=function(t,e){return new fr(t,e)},U(fr,Gt),(N=fr.prototype).addEventListener=function(t,e,n,r){fr.M.addEventListener.call(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){fr.M.removeEventListener.call(this,t,e,n,r)},N.Ka=function(){this.a.c=this.f,this.h&&(this.a.w=!0);var t=this.a,e=this.l,n=this.b||void 0;ge(0),t.P=e,t.N=n||{},t.U=t.W,t.v=ur(t,null,t.P),Xn(t)},N.close=function(){Wn(this.a)},N.La=function(t){if("string"==typeof t){var e={};e.__data__=t,Yn(this.a,e)}else this.g?((e={}).__data__=Qt(t),Yn(this.a,e)):Yn(this.a,t)},N.C=function(){this.a.c=null,delete this.f,Wn(this.a),delete this.a,fr.M.C.call(this)},U(lr,De),U(pr,xe),U(dr,hr),dr.prototype.na=function(){this.a.dispatchEvent("a")},dr.prototype.ma=function(t){this.a.dispatchEvent(new lr(t))},dr.prototype.la=function(t){this.a.dispatchEvent(new pr)},dr.prototype.ka=function(){this.a.dispatchEvent("b")},cr.prototype.createWebChannel=cr.prototype.a,fr.prototype.send=fr.prototype.La,fr.prototype.open=fr.prototype.Ka,fr.prototype.close=fr.prototype.close,Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,Te.COMPLETE="complete",(_e.EventType=Se).OPEN="a",Se.CLOSE="b",Se.ERROR="c",Se.MESSAGE="d",Gt.prototype.listen=Gt.prototype.ra,Ln.prototype.listenOnce=Ln.prototype.sa,Ln.prototype.getLastError=Ln.prototype.Ma,Ln.prototype.getLastErrorCode=Ln.prototype.qa,Ln.prototype.getStatus=Ln.prototype.S,Ln.prototype.getResponseJson=Ln.prototype.Ja,Ln.prototype.getResponseText=Ln.prototype.Y,Ln.prototype.send=Ln.prototype.$;var yr={createWebChannelTransport:function(){return new cr},ErrorCode:Ee,EventType:Te,WebChannel:_e,XhrIo:Ln},vr=yr.createWebChannelTransport,mr=yr.ErrorCode,gr=yr.EventType,wr=yr.WebChannel,br=yr.XhrIo,Er=cp.SDK_VERSION,Tr=(Ir.prototype.t=function(){return null!=this.uid},Ir.prototype.s=function(){return this.t()?"uid:"+this.uid:"anonymous-user"},Ir.prototype.isEqual=function(t){return t.uid===this.uid},Ir);function Ir(t){this.uid=t}Tr.UNAUTHENTICATED=new Tr(null),Tr.i=new Tr("google-credentials-uid"),Tr.h=new Tr("first-party-uid");function Nr(t,e){this.user=e,this.type="OAuth",this.o={},this.o.Authorization="Bearer "+t}var _r,Ar,Sr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Dr=(n(Hr,Ar=Error),Hr),xr=(Gr.prototype.getToken=function(){return Promise.resolve(null)},Gr.prototype._=function(){},Gr.prototype.l=function(t){(this.u=t)(Tr.UNAUTHENTICATED)},Gr.prototype.T=function(){this.u=null},Gr),kr=(zr.prototype.getToken=function(){var e=this,n=this.m,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){if(e.m!==n)throw new Dr(Sr.ABORTED,"getToken aborted due to token change.");return t?(Zs("string"==typeof t.accessToken),new Nr(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},zr.prototype._=function(){this.forceRefresh=!0},zr.prototype.l=function(t){this.u=t,this.R&&t(this.currentUser)},zr.prototype.T=function(){this.auth&&this.auth.removeAuthTokenListener(this.I),this.I=null,this.u=null},zr.prototype.A=function(){var t=this.auth&&this.auth.getUid();return Zs(null===t||"string"==typeof t),new Tr(t)},zr),Or=(Object.defineProperty(Fr.prototype,"o",{get:function(){var t={"X-Goog-AuthUser":this.V},e=this.P.auth.g([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),Fr),Rr=(Br.prototype.getToken=function(){return Promise.resolve(new Or(this.P,this.V))},Br.prototype.l=function(t){t(Tr.h)},Br.prototype.T=function(){},Br.prototype._=function(){},Br),Lr=(jr.now=function(){return jr.fromMillis(Date.now())},jr.fromDate=function(t){return jr.fromMillis(t.getTime())},jr.fromMillis=function(t){var e=Math.floor(t/1e3);return new jr(e,1e6*(t-1e3*e))},jr.prototype.toDate=function(){return new Date(this.toMillis())},jr.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},jr.prototype.p=function(t){return this.seconds===t.seconds?ru(this.nanoseconds,t.nanoseconds):ru(this.seconds,t.seconds)},jr.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},jr.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},jr.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},jr),Pr=(Ur.v=function(t){return new Ur(t)},Ur.min=function(){return new Ur(new Lr(0,0))},Ur.prototype.S=function(t){return this.timestamp.p(t.timestamp)},Ur.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Ur.prototype.D=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Ur.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Ur.prototype.C=function(){return this.timestamp},Ur),Vr=(Object.defineProperty(qr.prototype,"length",{get:function(){return this.F},enumerable:!0,configurable:!0}),qr.prototype.isEqual=function(t){return 0===qr.N(this,t)},qr.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof qr?t.forEach(function(t){e.push(t)}):e.push(t),this.k(e)},qr.prototype.limit=function(){return this.offset+this.length},qr.prototype.$=function(t){return t=void 0===t?1:t,this.k(this.segments,this.offset+t,this.length-t)},qr.prototype.M=function(){return this.k(this.segments,this.offset,this.length-1)},qr.prototype.L=function(){return this.segments[this.offset]},qr.prototype.O=function(){return this.get(this.length-1)},qr.prototype.get=function(t){return this.segments[this.offset+t]},qr.prototype.B=function(){return 0===this.length},qr.prototype.q=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},qr.prototype.U=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},qr.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},qr.prototype.W=function(){return this.segments.slice(this.offset,this.limit())},qr.N=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},qr),Mr=(n(Cr,_r=Vr),Cr.prototype.k=function(t,e,n){return new Cr(t,e,n)},Cr.prototype.j=function(){return this.W().join("/")},Cr.prototype.toString=function(){return this.j()},Cr.K=function(t){if(0<=t.indexOf("//"))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new Cr(t.split("/").filter(function(t){return 0<t.length}))},Cr);function Cr(){return null!==_r&&_r.apply(this,arguments)||this}function qr(t,e,n){void 0===e?e=0:e>t.length&&$s(),void 0===n?n=t.length-e:n>t.length-e&&$s(),this.segments=t,this.offset=e,this.F=n}function Ur(t){this.timestamp=t}function jr(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function Br(t,e){this.P=t,this.V=e}function Fr(t,e){this.P=t,this.V=e,this.type="FirstParty",this.user=Tr.h}function zr(t){var e=this;this.I=null,this.currentUser=Tr.UNAUTHENTICATED,this.R=!1,this.m=0,this.u=null,this.forceRefresh=!1,this.I=function(){e.m++,e.currentUser=e.A(),e.R=!0,e.u&&e.u(e.currentUser)},this.m=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.I):(this.I(null),t.get().then(function(t){e.auth=t,e.I&&e.auth.addAuthTokenListener(e.I)},function(){}))}function Gr(){this.u=null}function Hr(t,e){var n=this;return(n=Ar.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}Mr.G=new Mr([]);var Qr,Wr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Kr=(n(Yr,Qr=Vr),Yr.prototype.k=function(t,e,n){return new Yr(t,e,n)},Yr.H=function(t){return Wr.test(t)},Yr.prototype.j=function(){return this.W().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Yr.H(t)||(t="`"+t+"`"),t}).join(".")},Yr.prototype.toString=function(){return this.j()},Yr.prototype.Y=function(){return 1===this.length&&"__name__"===this.get(0)},Yr.J=function(){return new Yr(["__name__"])},Yr.X=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Dr(Sr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Dr(Sr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Dr(Sr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Yr(e)},Yr);function Yr(){return null!==Qr&&Qr.apply(this,arguments)||this}Kr.G=new Kr([]);var Xr=(Jr.Z=function(t){return new Jr(Mr.K(t).$(5))},Jr.prototype.tt=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Jr.prototype.isEqual=function(t){return null!==t&&0===Mr.N(this.path,t.path)},Jr.prototype.toString=function(){return this.path.toString()},Jr.N=function(t,e){return Mr.N(t.path,e.path)},Jr.et=function(t){return t.length%2==0},Jr.st=function(t){return new Jr(new Mr(t.slice()))},Jr);function Jr(t){this.path=t}function $r(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Zr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ti(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}Xr.EMPTY=new Xr(new Mr([]));var ei=(ni.fromBase64String=function(t){return new ni(Gs.nt().atob(t))},ni.fromUint8Array=function(t){return new ni(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},ni.prototype.toBase64=function(){return Gs.nt().btoa(this.it)},ni.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.it)},ni.prototype.rt=function(){return 2*this.it.length},ni.prototype.S=function(t){return ru(this.it,t.it)},ni.prototype.isEqual=function(t){return this.it===t.it},ni);function ni(t){this.it=t}function ri(t){return null==t}function ii(t){return-0===t&&1/t==-1/0}function oi(t){return"number"==typeof t&&Number.isInteger(t)&&!ii(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function si(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ui(t){var e=yi(t.mapValue.fields.__local_write_time__.timestampValue);return new Lr(e.seconds,e.nanos)}ei.ht=new ei("");var ai=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function hi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?si(t)?4:10:$s()}function ci(i,t){var e,n,r,o=hi(i);if(o!==hi(t))return!1;switch(o){case 0:return!0;case 1:return i.booleanValue===t.booleanValue;case 4:return ui(i).isEqual(ui(t));case 3:return function(t){if("string"==typeof i.timestampValue&&"string"==typeof t.timestampValue&&i.timestampValue.length===t.timestampValue.length)return i.timestampValue===t.timestampValue;var e=yi(i.timestampValue),n=yi(t.timestampValue);return e.seconds===n.seconds&&e.nanos===n.nanos}(t);case 5:return i.stringValue===t.stringValue;case 6:return r=t,mi(i.bytesValue).isEqual(mi(r.bytesValue));case 7:return i.referenceValue===t.referenceValue;case 8:return n=t,vi((e=i).geoPointValue.latitude)===vi(n.geoPointValue.latitude)&&vi(e.geoPointValue.longitude)===vi(n.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return vi(t.integerValue)===vi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=vi(t.doubleValue),r=vi(e.doubleValue);return n===r?ii(n)===ii(r):isNaN(n)&&isNaN(r)}return!1}(i,t);case 9:return iu(i.arrayValue.values||[],t.arrayValue.values||[],ci);case 10:return function(t){var e=i.mapValue.fields||{},n=t.mapValue.fields||{};if($r(e)!==$r(n))return!1;for(var r in e)if(e.hasOwnProperty(r)&&(void 0===n[r]||!ci(e[r],n[r])))return!1;return!0}(t);default:return $s()}}function fi(t,e){return void 0!==(t.values||[]).find(function(t){return ci(t,e)})}function li(t,e){var n,r,i,o,s,u,a,h,c,f,l=hi(t),p=hi(e);if(l!==p)return ru(l,p);switch(l){case 0:return 0;case 1:return ru(t.booleanValue,e.booleanValue);case 2:return h=e,c=vi(t.integerValue||t.doubleValue),f=vi(h.integerValue||h.doubleValue),c<f?-1:f<c?1:c===f?0:isNaN(c)?isNaN(f)?0:-1:1;case 3:return pi(t.timestampValue,e.timestampValue);case 4:return pi(ui(t),ui(e));case 5:return ru(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=mi(o),a=mi(s),u.S(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=ru(n[i],r[i]);if(0!==o)return o}return ru(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=ru(vi(n.latitude),vi(r.latitude)))?i:ru(vi(n.longitude),vi(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=li(n[i],r[i]);if(o)return o}return ru(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=ru(r[s],o[s]);if(0!==u)return u;var a=li(n[r[s]],i[o[s]]);if(0!==a)return a}return ru(r.length,o.length)}(t.mapValue,e.mapValue);default:throw $s()}}function pi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ru(t,e);var n=yi(t),r=yi(e),i=ru(n.seconds,r.seconds);return 0!==i?i:ru(n.nanos,r.nanos)}function di(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=yi(i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?mi(i.bytesValue).toBase64():"referenceValue"in i?(n=i.referenceValue,Xr.Z(n).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++){e?e=!1:t+=",",t+=s(r[n])}return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):$s();var t,e,n}(t)}function yi(t){if(Zs(!!t),"string"!=typeof t)return{seconds:vi(t.seconds),nanos:vi(t.nanos)};var e=0,n=ai.exec(t);if(Zs(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}function vi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function mi(t){return"string"==typeof t?ei.fromBase64String(t):ei.fromUint8Array(t)}function gi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.j()}}function wi(t){return t&&"integerValue"in t}function bi(t){return!!t&&"arrayValue"in t}function Ei(t){return t&&"nullValue"in t}function Ti(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ii(t){return t&&"mapValue"in t}var Ni=(_i.prototype.ot=function(t,e){return n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}},t&&(n.fields.__previous_value__=t),{mapValue:n};var n},_i.prototype.at=function(t,e){return e},_i.prototype.ut=function(t){return null},_i.prototype.isEqual=function(t){return t instanceof _i},_i);function _i(){}Ni.instance=new Ni;var Ai=(Oi.prototype.ot=function(t,e){return this.apply(t)},Oi.prototype.at=function(t,e){return this.apply(t)},Oi.prototype.apply=function(t){for(var n=Ri(t),e=function(e){n.some(function(t){return ci(t,e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return{arrayValue:{values:n}}},Oi.prototype.ut=function(t){return null},Oi.prototype.isEqual=function(t){return t instanceof Oi&&iu(this.elements,t.elements,ci)},Oi),Si=(ki.prototype.ot=function(t,e){return this.apply(t)},ki.prototype.at=function(t,e){return this.apply(t)},ki.prototype.apply=function(t){for(var n=Ri(t),e=function(e){n=n.filter(function(t){return!ci(t,e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return{arrayValue:{values:n}}},ki.prototype.ut=function(t){return null},ki.prototype.isEqual=function(t){return t instanceof ki&&iu(this.elements,t.elements,ci)},ki),Di=(xi.prototype.ot=function(t,e){var n=this.ut(t),r=this.asNumber(n)+this.asNumber(this.ct);return wi(n)&&wi(this.ct)?this.serializer._t(r):this.serializer.lt(r)},xi.prototype.at=function(t,e){return e},xi.prototype.ut=function(t){return wi(e=t)||e&&"doubleValue"in e?t:{integerValue:0};var e},xi.prototype.isEqual=function(t){return t instanceof xi&&ci(this.ct,t.ct)},xi.prototype.asNumber=function(t){return vi(t.integerValue||t.doubleValue)},xi);function xi(t,e){this.serializer=t,this.ct=e}function ki(t){this.elements=t}function Oi(t){this.elements=t}function Ri(t){return bi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function Li(t,e){this.version=t,this.transformResults=e}var Pi,Vi,Mi,Ci,qi,Ui=(so.prototype.dt=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].q(t))return!0;return!1},so.prototype.isEqual=function(t){return iu(this.fields,t.fields,function(t,e){return t.isEqual(e)})},so),ji=(oo.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},oo),Bi=(io.ft=function(){return new io},io.exists=function(t){return new io(void 0,t)},io.updateTime=function(t){return new io(t)},Object.defineProperty(io.prototype,"Tt",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),io.prototype.Et=function(t){return void 0!==this.updateTime?t instanceof To&&t.version.isEqual(this.updateTime):void 0===this.exists||this.exists===t instanceof To},io.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},io),Fi=(ro.prototype.It=function(t){},ro.wt=function(t){return t instanceof To?t.version:Pr.min()},ro),zi=(n(no,qi=Fi),no.prototype.at=function(t,e){this.It(t);var n=e.version;return new To(this.key,n,this.value,{hasCommittedMutations:!0})},no.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=Fi.wt(t);return new To(this.key,r,this.value,{At:!0})},no.prototype.Pt=function(t){return null},no.prototype.isEqual=function(t){return t instanceof no&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.Rt.isEqual(t.Rt)},no),Gi=(n(eo,Ci=Fi),eo.prototype.at=function(t,e){if(this.It(t),!this.Rt.Et(t))return new No(this.key,e.version);var n=this.gt(t);return new To(this.key,e.version,n,{hasCommittedMutations:!0})},eo.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=Fi.wt(t),i=this.gt(t);return new To(this.key,r,i,{At:!0})},eo.prototype.Pt=function(t){return null},eo.prototype.isEqual=function(t){return t instanceof eo&&this.key.isEqual(t.key)&&this.Vt.isEqual(t.Vt)&&this.Rt.isEqual(t.Rt)},eo.prototype.gt=function(t){var e;return e=t instanceof To?t.data():Ki.empty(),this.pt(e)},eo.prototype.pt=function(t){var n=this,r=new Yi(t);return this.Vt.fields.forEach(function(t){if(!t.B()){var e=n.data.field(t);null!==e?r.set(t,e):r.delete(t)}}),r.yt()},eo),Hi=(n(to,Mi=Fi),to.prototype.at=function(t,e){if(this.It(t),Zs(null!=e.transformResults),!this.Rt.Et(t))return new No(this.key,e.version);var n=this.bt(t),r=this.vt(t,e.transformResults),i=e.version,o=this.St(n.data(),r);return new To(this.key,i,o,{hasCommittedMutations:!0})},to.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=this.bt(t),i=this.Dt(n,t,e),o=this.St(r.data(),i);return new To(this.key,r.version,o,{At:!0})},to.prototype.Pt=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof To?t.field(i.field):void 0,s=i.transform.ut(o||null);null!=s&&(e=null==e?(new Yi).set(i.field,s):e.set(i.field,s))}return e?e.yt():null},to.prototype.isEqual=function(t){return t instanceof to&&this.key.isEqual(t.key)&&iu(this.fieldTransforms,t.fieldTransforms,function(t,e){return t.isEqual(e)})&&this.Rt.isEqual(t.Rt)},to.prototype.bt=function(t){return t},to.prototype.vt=function(t,e){var n=[];Zs(this.fieldTransforms.length===e.length);for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof To&&(s=t.field(i.field)),n.push(o.at(s,e[r]))}return n},to.prototype.Dt=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var s=o[i],u=s.transform,a=null;e instanceof To&&(a=e.field(s.field)),null===a&&n instanceof To&&(a=n.field(s.field)),r.push(u.ot(a,t))}return r},to.prototype.St=function(t,e){for(var n=new Yi(t),r=0;r<this.fieldTransforms.length;r++){var i=this.fieldTransforms[r].field;n.set(i,e[r])}return n.yt()},to),Qi=(n(Zi,Vi=Fi),Zi.prototype.at=function(t,e){return this.It(t),new Io(this.key,e.version,{hasCommittedMutations:!0})},Zi.prototype.ot=function(t,e,n){return this.It(t),this.Rt.Et(t)?new Io(this.key,Pr.min()):t},Zi.prototype.Pt=function(t){return null},Zi.prototype.isEqual=function(t){return t instanceof Zi&&this.key.isEqual(t.key)&&this.Rt.isEqual(t.Rt)},Zi),Wi=(n($i,Pi=Fi),$i.prototype.at=function(t,e){$s()},$i.prototype.ot=function(t,e,n){$s()},$i.prototype.Pt=function(t){$s()},$i.prototype.isEqual=function(t){return t instanceof $i&&this.key.isEqual(t.key)&&this.Rt.isEqual(t.Rt)},$i),Ki=(Ji.empty=function(){return new Ji({mapValue:{}})},Ji.prototype.field=function(t){if(t.B())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Ii(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.O()])||null},Ji.prototype.isEqual=function(t){return ci(this.proto,t.proto)},Ji),Yi=(Xi.prototype.set=function(t,e){return this.Nt(t,e),this},Xi.prototype.delete=function(t){return this.Nt(t,null),this},Xi.prototype.Nt=function(t,e){for(var n=this.Ft,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map||(o=o&&10===hi(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),n=o}n.set(t.O(),e)},Xi.prototype.yt=function(){var t=this.kt(Kr.G,this.Ft);return null!=t?new Ki(t):this.Ct},Xi.prototype.kt=function(r,t){var i=this,o=!1,e=this.Ct.field(r),s=Ii(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){if(t instanceof Map){var n=i.kt(r.child(e),t);null!=n&&(s[e]=n,o=!0)}else null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Xi);function Xi(t){void 0===t&&(t=Ki.empty()),this.Ct=t,this.Ft=new Map}function Ji(t){this.proto=t}function $i(t,e){var n=this;return(n=Pi.call(this)||this).key=t,n.Rt=e,n.type=4,n}function Zi(t,e){var n=this;return(n=Vi.call(this)||this).key=t,n.Rt=e,n.type=3,n}function to(t,e){var n=this;return(n=Mi.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Rt=Bi.exists(!0),n}function eo(t,e,n,r){var i=this;return(i=Ci.call(this)||this).key=t,i.data=e,i.Vt=n,i.Rt=r,i.type=1,i}function no(t,e,n){var r=this;return(r=qi.call(this)||this).key=t,r.value=e,r.Rt=n,r.type=0,r}function ro(){}function io(t,e){this.updateTime=t,this.exists=e}function oo(t,e){this.field=t,this.transform=e}function so(t){(this.fields=t).sort(Kr.N)}function uo(t){var u=[];return Zr(t.fields||{},function(t,e){var n=new Kr([t]);if(Ii(e)){var r=uo(e.mapValue).fields;if(0===r.length)u.push(n);else for(var i=0,o=r;i<o.length;i++){var s=o[i];u.push(n.child(s))}}else u.push(n)}),new Ui(u)}function ao(t,e){this.key=t,this.version=e}function ho(t){this.count=t}var co,fo,lo,po,yo,vo,mo,go,wo,bo,Eo,To=(n(Yo,Eo=ao),Yo.prototype.field=function(t){return this.$t.field(t)},Yo.prototype.data=function(){return this.$t},Yo.prototype.Mt=function(){return this.$t.proto},Yo.prototype.isEqual=function(t){return t instanceof Yo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.At===t.At&&this.hasCommittedMutations===t.hasCommittedMutations&&this.$t.isEqual(t.$t)},Yo.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.$t.toString()+", {hasLocalMutations: "+this.At+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Yo.prototype,"hasPendingWrites",{get:function(){return this.At||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Yo),Io=(n(Ko,bo=ao),Ko.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ko.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Ko.prototype.isEqual=function(t){return t instanceof Ko&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Ko),No=(n(Wo,wo=ao),Wo.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Wo.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),Wo.prototype.isEqual=function(t){return t instanceof Wo&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Wo),_o=(Qo.prototype.canonicalId=function(){if(null===this.Lt){var t=this.path.j();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:",t+=this.filters.map(function(t){return t.canonicalId()}).join(","),t+="|ob:",t+=this.orderBy.map(function(t){return t.canonicalId()}).join(","),ri(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.Lt=t}return this.Lt},Qo.prototype.toString=function(){var t=this.path.j();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),ri(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},Qo.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(var n=0;n<this.filters.length;n++)if(!this.filters[n].isEqual(t.filters[n]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!!(null!==this.startAt?this.startAt.isEqual(t.startAt):null===t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},Qo.prototype.xt=function(){return Xr.et(this.path)&&null===this.collectionGroup&&0===this.filters.length},Qo),Ao=(Ho.Wt=function(t){return new Ho(t)},Object.defineProperty(Ho.prototype,"orderBy",{get:function(){if(null===this.qt){this.qt=[];var t=this.jt(),e=this.Kt();if(null!==t&&null===e)t.Y()||this.qt.push(new Po(t)),this.qt.push(new Po(Kr.J(),"asc"));else{for(var n=!1,r=0,i=this.Ot;r<i.length;r++){var o=i[r];this.qt.push(o),o.field.Y()&&(n=!0)}if(!n){var s=0<this.Ot.length?this.Ot[this.Ot.length-1].dir:"asc";this.qt.push(new Po(Kr.J(),s))}}}return this.qt},enumerable:!0,configurable:!0}),Ho.prototype.Gt=function(t){var e=this.filters.concat([t]);return new Ho(this.path,this.collectionGroup,this.Ot.slice(),e,this.limit,this.Bt,this.startAt,this.endAt)},Ho.prototype.zt=function(t){var e=this.Ot.concat([t]);return new Ho(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.Bt,this.startAt,this.endAt)},Ho.prototype.Ht=function(t){return new Ho(this.path,this.collectionGroup,this.Ot.slice(),this.filters.slice(),t,"F",this.startAt,this.endAt)},Ho.prototype.Yt=function(t){return new Ho(this.path,this.collectionGroup,this.Ot.slice(),this.filters.slice(),t,"L",this.startAt,this.endAt)},Ho.prototype.Jt=function(t){return new Ho(this.path,this.collectionGroup,this.Ot.slice(),this.filters.slice(),this.limit,this.Bt,t,this.endAt)},Ho.prototype.Xt=function(t){return new Ho(this.path,this.collectionGroup,this.Ot.slice(),this.filters.slice(),this.limit,this.Bt,this.startAt,t)},Ho.prototype.Zt=function(t){return new Ho(t,null,this.Ot.slice(),this.filters.slice(),this.limit,this.Bt,this.startAt,this.endAt)},Ho.prototype.te=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.Ot.length||1===this.Ot.length&&this.Ot[0].field.Y())},Ho.prototype.canonicalId=function(){return this.ee().canonicalId()+"|lt:"+this.Bt},Ho.prototype.toString=function(){return"Query(target="+this.ee().toString()+"; limitType="+this.Bt+")"},Ho.prototype.isEqual=function(t){return this.ee().isEqual(t.ee())&&this.Bt===t.Bt},Ho.prototype.se=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.Y()}return 0},Ho.prototype.matches=function(t){return this.ie(t)&&this.ne(t)&&this.re(t)&&this.he(t)},Ho.prototype.oe=function(){return!ri(this.limit)&&"F"===this.Bt},Ho.prototype.ae=function(){return!ri(this.limit)&&"L"===this.Bt},Ho.prototype.Kt=function(){return 0<this.Ot.length?this.Ot[0].field:null},Ho.prototype.jt=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof So&&n.ue())return n.field}return null},Ho.prototype.ce=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof So&&0<=t.indexOf(r.op))return r.op}return null},Ho.prototype.xt=function(){return this.ee().xt()},Ho.prototype._e=function(){return null!==this.collectionGroup},Ho.prototype.ee=function(){if(!this.Ut)if("F"===this.Bt)this.Ut=new _o(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i="desc"===r.dir?"asc":"desc";t.push(new Po(r.field,i))}var o=this.endAt?new Lo(this.endAt.position,!this.endAt.before):null,s=this.startAt?new Lo(this.startAt.position,!this.startAt.before):null;this.Ut=new _o(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.Ut},Ho.prototype.ie=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.tt(this.collectionGroup)&&this.path.q(e):Xr.et(this.path)?this.path.isEqual(e):this.path.U(e)},Ho.prototype.ne=function(t){for(var e=0,n=this.Ot;e<n.length;e++){var r=n[e];if(!r.field.Y()&&null===t.field(r.field))return!1}return!0},Ho.prototype.re=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},Ho.prototype.he=function(t){return!(this.startAt&&!this.startAt.le(this.orderBy,t)||this.endAt&&this.endAt.le(this.orderBy,t))},Ho.prototype.Qt=function(t){},Ho),So=(n(Go,go=function(){}),Go.create=function(t,e,n){if(t.Y())return"in"===e?new xo(t,n):new Do(t,e,n);if(Ei(n)){if("=="!==e)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Go(t,e,n)}if(Ti(n)){if("=="!==e)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Go(t,e,n)}return"array-contains"===e?new ko(t,n):"in"===e?new Oo(t,n):"array-contains-any"===e?new Ro(t,n):new Go(t,e,n)},Go.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&hi(this.value)===hi(e)&&this.de(li(e,this.value))},Go.prototype.de=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case">":return 0<t;case">=":return 0<=t;default:return $s()}},Go.prototype.ue=function(){return 0<=["<","<=",">",">="].indexOf(this.op)},Go.prototype.canonicalId=function(){return this.field.j()+this.op.toString()+di(this.value)},Go.prototype.isEqual=function(t){return t instanceof Go&&this.op===t.op&&this.field.isEqual(t.field)&&ci(this.value,t.value)},Go.prototype.toString=function(){return this.field.j()+" "+this.op+" "+di(this.value)},Go),Do=(n(zo,mo=So),zo.prototype.matches=function(t){var e=Xr.N(t.key,this.key);return this.de(e)},zo),xo=(n(Fo,vo=So),Fo.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},Fo),ko=(n(Bo,yo=So),Bo.prototype.matches=function(t){var e=t.field(this.field);return bi(e)&&fi(e.arrayValue,this.value)},Bo),Oo=(n(jo,po=So),jo.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&fi(this.value.arrayValue,e)},jo),Ro=(n(Uo,lo=So),Uo.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!bi(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return fi(e.value.arrayValue,t)})},Uo),Lo=(qo.prototype.canonicalId=function(){return(this.before?"b":"a")+":"+this.position.map(function(t){return di(t)}).join(",")},qo.prototype.le=function(t,e){for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(n=i.field.Y()?Xr.N(Xr.Z(o.referenceValue),e.key):li(o,e.field(i.field)),"desc"===i.dir&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},qo.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++)if(!ci(this.position[e],t.position[e]))return!1;return!0},qo),Po=(Co.prototype.compare=function(t,e){var n,r,i,o,s=this.fe?Xr.N(t.key,e.key):(n=this.field,r=e,i=t.field(n),o=r.field(n),null!==i&&null!==o?li(i,o):$s());switch(this.dir){case"asc":return s;case"desc":return-1*s;default:return $s()}},Co.prototype.canonicalId=function(){return this.field.j()+this.dir.toString()},Co.prototype.toString=function(){return this.field.j()+" ("+this.dir+")"},Co.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},Co),Vo=(Mo.prototype.Ie=function(t){return new Mo(this.target,this.targetId,this.Te,t,this.Ee,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Mo.prototype.we=function(t,e){return new Mo(this.target,this.targetId,this.Te,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Mo.prototype.Re=function(t){return new Mo(this.target,this.targetId,this.Te,this.sequenceNumber,this.Ee,t,this.resumeToken)},Mo);function Mo(t,e,n,r,i,o,s){void 0===i&&(i=Pr.min()),void 0===o&&(o=Pr.min()),void 0===s&&(s=ei.ht),this.target=t,this.targetId=e,this.Te=n,this.sequenceNumber=r,this.Ee=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Co(t,e){this.field=t,void 0===e&&(e="asc"),this.dir=e,this.fe=t.Y()}function qo(t,e){this.position=t,this.before=e}function Uo(t,e){return lo.call(this,t,"array-contains-any",e)||this}function jo(t,e){return po.call(this,t,"in",e)||this}function Bo(t,e){return yo.call(this,t,"array-contains",e)||this}function Fo(t,e){var n=this;return(n=vo.call(this,t,"in",e)||this).keys=(e.arrayValue.values||[]).map(function(t){return Xr.Z(t.referenceValue)}),n}function zo(t,e,n){var r=this;return(r=mo.call(this,t,e,n)||this).key=Xr.Z(n.referenceValue),r}function Go(t,e,n){var r=this;return(r=go.call(this)||this).field=t,r.op=e,r.value=n,r}function Ho(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.Ot=n,this.filters=r,this.limit=i,this.Bt=o,this.startAt=s,this.endAt=u,this.qt=null,this.Ut=null,this.startAt&&this.Qt(this.startAt),this.endAt&&this.Qt(this.endAt)}function Qo(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Lt=null}function Wo(){return null!==wo&&wo.apply(this,arguments)||this}function Ko(t,e,n){var r=this;return(r=bo.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Yo(t,e,n,r){var i=this;return(i=Eo.call(this,t,e)||this).$t=n,i.At=!!r.At,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function Xo(t){switch(t){case Sr.OK:return $s();case Sr.CANCELLED:case Sr.UNKNOWN:case Sr.DEADLINE_EXCEEDED:case Sr.RESOURCE_EXHAUSTED:case Sr.INTERNAL:case Sr.UNAVAILABLE:case Sr.UNAUTHENTICATED:return;case Sr.INVALID_ARGUMENT:case Sr.NOT_FOUND:case Sr.ALREADY_EXISTS:case Sr.PERMISSION_DENIED:case Sr.FAILED_PRECONDITION:case Sr.ABORTED:case Sr.OUT_OF_RANGE:case Sr.UNIMPLEMENTED:case Sr.DATA_LOSS:return 1;default:return $s()}}function Jo(t){if(void 0===t)return Xs("GRPC error has no .code"),Sr.UNKNOWN;switch(t){case co.OK:return Sr.OK;case co.CANCELLED:return Sr.CANCELLED;case co.UNKNOWN:return Sr.UNKNOWN;case co.DEADLINE_EXCEEDED:return Sr.DEADLINE_EXCEEDED;case co.RESOURCE_EXHAUSTED:return Sr.RESOURCE_EXHAUSTED;case co.INTERNAL:return Sr.INTERNAL;case co.UNAVAILABLE:return Sr.UNAVAILABLE;case co.UNAUTHENTICATED:return Sr.UNAUTHENTICATED;case co.INVALID_ARGUMENT:return Sr.INVALID_ARGUMENT;case co.NOT_FOUND:return Sr.NOT_FOUND;case co.ALREADY_EXISTS:return Sr.ALREADY_EXISTS;case co.PERMISSION_DENIED:return Sr.PERMISSION_DENIED;case co.FAILED_PRECONDITION:return Sr.FAILED_PRECONDITION;case co.ABORTED:return Sr.ABORTED;case co.OUT_OF_RANGE:return Sr.OUT_OF_RANGE;case co.UNIMPLEMENTED:return Sr.UNIMPLEMENTED;case co.DATA_LOSS:return Sr.DATA_LOSS;default:return $s()}}(fo=co=co||{})[fo.OK=0]="OK",fo[fo.CANCELLED=1]="CANCELLED",fo[fo.UNKNOWN=2]="UNKNOWN",fo[fo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",fo[fo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",fo[fo.NOT_FOUND=5]="NOT_FOUND",fo[fo.ALREADY_EXISTS=6]="ALREADY_EXISTS",fo[fo.PERMISSION_DENIED=7]="PERMISSION_DENIED",fo[fo.UNAUTHENTICATED=16]="UNAUTHENTICATED",fo[fo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",fo[fo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",fo[fo.ABORTED=10]="ABORTED",fo[fo.OUT_OF_RANGE=11]="OUT_OF_RANGE",fo[fo.UNIMPLEMENTED=12]="UNIMPLEMENTED",fo[fo.INTERNAL=13]="INTERNAL",fo[fo.UNAVAILABLE=14]="UNAVAILABLE",fo[fo.DATA_LOSS=15]="DATA_LOSS";var $o=(rs.prototype.me=function(t,e){return new rs(this.N,this.root.me(t,e,this.N).Ae(null,null,ts.Pe,null,null))},rs.prototype.remove=function(t){return new rs(this.N,this.root.remove(t,this.N).Ae(null,null,ts.Pe,null,null))},rs.prototype.get=function(t){for(var e=this.root;!e.B();){var n=this.N(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},rs.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.B();){var r=this.N(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},rs.prototype.B=function(){return this.root.B()},Object.defineProperty(rs.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),rs.prototype.Ve=function(){return this.root.Ve()},rs.prototype.ge=function(){return this.root.ge()},rs.prototype.pe=function(t){return this.root.pe(t)},rs.prototype.forEach=function(n){this.pe(function(t,e){return n(t,e),!1})},rs.prototype.toString=function(){var n=[];return this.pe(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},rs.prototype.ye=function(t){return this.root.ye(t)},rs.prototype.be=function(){return new Zo(this.root,null,this.N,!1)},rs.prototype.ve=function(t){return new Zo(this.root,t,this.N,!1)},rs.prototype.Se=function(){return new Zo(this.root,null,this.N,!0)},rs.prototype.De=function(t){return new Zo(this.root,t,this.N,!0)},rs),Zo=(ns.prototype.Ne=function(){var t=this.Fe.pop(),e={key:t.key,value:t.value};if(this.Ce)for(t=t.left;!t.B();)this.Fe.push(t),t=t.right;else for(t=t.right;!t.B();)this.Fe.push(t),t=t.left;return e},ns.prototype.ke=function(){return 0<this.Fe.length},ns.prototype.$e=function(){if(0===this.Fe.length)return null;var t=this.Fe[this.Fe.length-1];return{key:t.key,value:t.value}},ns),ts=(es.prototype.Ae=function(t,e,n,r,i){return new es(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},es.prototype.B=function(){return!1},es.prototype.pe=function(t){return this.left.pe(t)||t(this.key,this.value)||this.right.pe(t)},es.prototype.ye=function(t){return this.right.ye(t)||t(this.key,this.value)||this.left.ye(t)},es.prototype.min=function(){return this.left.B()?this:this.left.min()},es.prototype.Ve=function(){return this.min().key},es.prototype.ge=function(){return this.right.B()?this.key:this.right.ge()},es.prototype.me=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.Ae(null,null,null,r.left.me(t,e,n),null):0===i?r.Ae(null,e,null,null,null):r.Ae(null,null,null,null,r.right.me(t,e,n))).Me()},es.prototype.Le=function(){if(this.left.B())return es.EMPTY;var t=this;return t.left.xe()||t.left.left.xe()||(t=t.Oe()),(t=t.Ae(null,null,null,t.left.Le(),null)).Me()},es.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.B()||r.left.xe()||r.left.left.xe()||(r=r.Oe()),r=r.Ae(null,null,null,r.left.remove(t,e),null);else{if(r.left.xe()&&(r=r.Be()),r.right.B()||r.right.xe()||r.right.left.xe()||(r=r.qe()),0===e(t,r.key)){if(r.right.B())return es.EMPTY;n=r.right.min(),r=r.Ae(n.key,n.value,null,null,r.right.Le())}r=r.Ae(null,null,null,null,r.right.remove(t,e))}return r.Me()},es.prototype.xe=function(){return this.color},es.prototype.Me=function(){var t=this;return t.right.xe()&&!t.left.xe()&&(t=t.Ue()),t.left.xe()&&t.left.left.xe()&&(t=t.Be()),t.left.xe()&&t.right.xe()&&(t=t.Qe()),t},es.prototype.Oe=function(){var t=this.Qe();return t.right.left.xe()&&(t=(t=(t=t.Ae(null,null,null,null,t.right.Be())).Ue()).Qe()),t},es.prototype.qe=function(){var t=this.Qe();return t.left.left.xe()&&(t=(t=t.Be()).Qe()),t},es.prototype.Ue=function(){var t=this.Ae(null,null,es.RED,null,this.right.left);return this.right.Ae(null,null,this.color,t,null)},es.prototype.Be=function(){var t=this.Ae(null,null,es.RED,this.left.right,null);return this.left.Ae(null,null,this.color,null,t)},es.prototype.Qe=function(){var t=this.left.Ae(null,null,!this.left.color,null,null),e=this.right.Ae(null,null,!this.right.color,null,null);return this.Ae(null,null,!this.color,t,e)},es.prototype.We=function(){var t=this.je();return Math.pow(2,t)<=this.size+1},es.prototype.je=function(){if(this.xe()&&this.left.xe())throw $s();if(this.right.xe())throw $s();var t=this.left.je();if(t!==this.right.je())throw $s();return t+(this.xe()?0:1)},es);function es(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:es.RED,this.left=null!=r?r:es.EMPTY,this.right=null!=i?i:es.EMPTY,this.size=this.left.size+1+this.right.size}function ns(t,e,n,r){this.Ce=r,this.Fe=[];for(var i=1;!t.B();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Ce?t.left:t.right;else{if(0===i){this.Fe.push(t);break}this.Fe.push(t),t=this.Ce?t.right:t.left}}function rs(t,e){this.N=t,this.root=e||ts.EMPTY}function is(){this.size=0}ts.EMPTY=null,ts.RED=!0,ts.Pe=!1,ts.EMPTY=(Object.defineProperty(is.prototype,"key",{get:function(){throw $s()},enumerable:!0,configurable:!0}),Object.defineProperty(is.prototype,"value",{get:function(){throw $s()},enumerable:!0,configurable:!0}),Object.defineProperty(is.prototype,"color",{get:function(){throw $s()},enumerable:!0,configurable:!0}),Object.defineProperty(is.prototype,"left",{get:function(){throw $s()},enumerable:!0,configurable:!0}),Object.defineProperty(is.prototype,"right",{get:function(){throw $s()},enumerable:!0,configurable:!0}),is.prototype.Ae=function(t,e,n,r,i){return this},is.prototype.me=function(t,e,n){return new ts(t,e)},is.prototype.remove=function(t,e){return this},is.prototype.B=function(){return!0},is.prototype.pe=function(t){return!1},is.prototype.ye=function(t){return!1},is.prototype.Ve=function(){return null},is.prototype.ge=function(){return null},is.prototype.xe=function(){return!1},is.prototype.We=function(){return!0},is.prototype.je=function(){return 0},new is);var os=(hs.prototype.has=function(t){return null!==this.data.get(t)},hs.prototype.first=function(){return this.data.Ve()},hs.prototype.last=function(){return this.data.ge()},Object.defineProperty(hs.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),hs.prototype.indexOf=function(t){return this.data.indexOf(t)},hs.prototype.forEach=function(n){this.data.pe(function(t,e){return n(t),!1})},hs.prototype.Ke=function(t,e){for(var n=this.data.ve(t[0]);n.ke();){var r=n.Ne();if(0<=this.N(r.key,t[1]))return;e(r.key)}},hs.prototype.Ge=function(t,e){var n;for(n=void 0!==e?this.data.ve(e):this.data.be();n.ke();)if(!t(n.Ne().key))return},hs.prototype.ze=function(t){var e=this.data.ve(t);return e.ke()?e.Ne().key:null},hs.prototype.be=function(){return new ss(this.data.be())},hs.prototype.ve=function(t){return new ss(this.data.ve(t))},hs.prototype.add=function(t){return this.Ae(this.data.remove(t).me(t,!0))},hs.prototype.delete=function(t){return this.has(t)?this.Ae(this.data.remove(t)):this},hs.prototype.B=function(){return this.data.B()},hs.prototype.He=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},hs.prototype.isEqual=function(t){if(!(t instanceof hs))return!1;if(this.size!==t.size)return!1;for(var e=this.data.be(),n=t.data.be();e.ke();){var r=e.Ne().key,i=n.Ne().key;if(0!==this.N(r,i))return!1}return!0},hs.prototype.W=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},hs.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},hs.prototype.Ae=function(t){var e=new hs(this.N);return e.data=t,e},hs),ss=(as.prototype.Ne=function(){return this.Ye.Ne().key},as.prototype.ke=function(){return this.Ye.ke()},as),us=new $o(Xr.N);function as(t){this.Ye=t}function hs(t){this.N=t,this.data=new $o(this.N)}function cs(){return us}function fs(){return cs()}var ls=new $o(Xr.N);function ps(){return ls}var ds=new $o(Xr.N);function ys(){return ds}var vs=new os(Xr.N);function ms(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=vs,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var gs=new os(ru);function ws(){return gs}function bs(t,e,n,r){this.ws=t,this.removedTargetIds=e,this.key=n,this.Rs=r}function Es(t,e){this.targetId=t,this.ms=e}function Ts(t,e,n,r){void 0===n&&(n=ei.ht),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var Is=(Ms.Ze=function(t){return new Ms(t.N)},Ms.prototype.has=function(t){return null!=this.Je.get(t)},Ms.prototype.get=function(t){return this.Je.get(t)},Ms.prototype.first=function(){return this.Xe.Ve()},Ms.prototype.last=function(){return this.Xe.ge()},Ms.prototype.B=function(){return this.Xe.B()},Ms.prototype.indexOf=function(t){var e=this.Je.get(t);return e?this.Xe.indexOf(e):-1},Object.defineProperty(Ms.prototype,"size",{get:function(){return this.Xe.size},enumerable:!0,configurable:!0}),Ms.prototype.forEach=function(n){this.Xe.pe(function(t,e){return n(t),!1})},Ms.prototype.add=function(t){var e=this.delete(t.key);return e.Ae(e.Je.me(t.key,t),e.Xe.me(t,null))},Ms.prototype.delete=function(t){var e=this.get(t);return e?this.Ae(this.Je.remove(t),this.Xe.remove(e)):this},Ms.prototype.isEqual=function(t){if(!(t instanceof Ms))return!1;if(this.size!==t.size)return!1;for(var e=this.Xe.be(),n=t.Xe.be();e.ke();){var r=e.Ne().key,i=n.Ne().key;if(!r.isEqual(i))return!1}return!0},Ms.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},Ms.prototype.Ae=function(t,e){var n=new Ms;return n.N=this.N,n.Je=t,n.Xe=e,n},Ms),Ns=(Vs.prototype.track=function(t){var e=t.doc.key,n=this.ts.get(e);!n||0!==t.type&&3===n.type?this.ts=this.ts.me(e,t):3===t.type&&1!==n.type?this.ts=this.ts.me(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ts=this.ts.me(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ts=this.ts.me(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ts=this.ts.remove(e):1===t.type&&2===n.type?this.ts=this.ts.me(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ts=this.ts.me(e,{type:2,doc:t.doc}):$s()},Vs.prototype.es=function(){var n=[];return this.ts.pe(function(t,e){n.push(e)}),n},Vs),_s=(Ps.os=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new Ps(t,e,Is.Ze(e),i,n,r,!0,!1)},Object.defineProperty(Ps.prototype,"hasPendingWrites",{get:function(){return!this.ns.B()},enumerable:!0,configurable:!0}),Ps.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.rs===t.rs&&this.ns.isEqual(t.ns)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.ss.isEqual(t.ss)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Ps),As=(Ls.ls=function(t,e){var n=new Map;return n.set(t,Ss.ds(t,e)),new Ls(Pr.min(),n,ws(),cs(),ms())},Ls),Ss=(Rs.ds=function(t,e){return new Rs(ei.ht,e,ms(),ms(),ms())},Rs),Ds=(Object.defineProperty(Os.prototype,"fs",{get:function(){return this.gs},enumerable:!0,configurable:!0}),Object.defineProperty(Os.prototype,"resumeToken",{get:function(){return this.Vs},enumerable:!0,configurable:!0}),Object.defineProperty(Os.prototype,"ys",{get:function(){return 0!==this.As},enumerable:!0,configurable:!0}),Object.defineProperty(Os.prototype,"bs",{get:function(){return this.ps},enumerable:!0,configurable:!0}),Os.prototype.vs=function(t){0<t.rt()&&(this.ps=!0,this.Vs=t)},Os.prototype.Ss=function(){var n=ms(),r=ms(),i=ms();return this.Ps.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:$s()}}),new Ss(this.Vs,this.gs,n,r,i)},Os.prototype.Ds=function(){this.ps=!1,this.Ps=qs()},Os.prototype.Cs=function(t,e){this.ps=!0,this.Ps=this.Ps.me(t,e)},Os.prototype.Fs=function(t){this.ps=!0,this.Ps=this.Ps.remove(t)},Os.prototype.Ns=function(){this.As+=1},Os.prototype.ks=function(){--this.As},Os.prototype.$s=function(){this.ps=!0,this.gs=!0},Os),xs=(ks.prototype.qs=function(t){for(var e=0,n=t.ws;e<n.length;e++){var r=n[e];t.Rs instanceof To?this.Us(r,t.Rs):t.Rs instanceof Io&&this.Qs(r,t.key,t.Rs)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.Qs(s,t.key,t.Rs)}},ks.prototype.Ws=function(n){var r=this;this.js(n,function(t){var e=r.Ks(t);switch(n.state){case 0:r.Gs(t)&&e.vs(n.resumeToken);break;case 1:e.ks(),e.ys||e.Ds(),e.vs(n.resumeToken);break;case 2:e.ks(),e.ys||r.removeTarget(t);break;case 3:r.Gs(t)&&(e.$s(),e.vs(n.resumeToken));break;case 4:r.Gs(t)&&(r.zs(t),e.vs(n.resumeToken));break;default:$s()}})},ks.prototype.js=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Ls.forEach(function(t,e){r.Gs(e)&&n(e)})},ks.prototype.Hs=function(t){var e=t.targetId,n=t.ms.count,r=this.Ys(e);if(r){var i=r.target;if(i.xt())if(0===n){var o=new Xr(i.path);this.Qs(e,o,new Io(o,Pr.min()))}else Zs(1===n);else this.Js(e)!==n&&(this.zs(e),this.Bs=this.Bs.add(e))}},ks.prototype.Xs=function(i){var o=this,s=new Map;this.Ls.forEach(function(t,e){var n=o.Ys(e);if(n){if(t.fs&&n.target.xt()){var r=new Xr(n.target.path);null!==o.xs.get(r)||o.Zs(e,r)||o.Qs(e,r,new Io(r,i))}t.bs&&(s.set(e,t.Ss()),t.Ds())}});var r=ms();this.Os.forEach(function(t,e){var n=!0;e.Ge(function(t){var e=o.Ys(t);return!e||2===e.Te||(n=!1)}),n&&(r=r.add(t))});var t=new As(i,s,this.Bs,this.xs,r);return this.xs=cs(),this.Os=Cs(),this.Bs=new os(ru),t},ks.prototype.Us=function(t,e){if(this.Gs(t)){var n=this.Zs(t,e.key)?2:0;this.Ks(t).Cs(e.key,n),this.xs=this.xs.me(e.key,e),this.Os=this.Os.me(e.key,this.ti(e.key).add(t))}},ks.prototype.Qs=function(t,e,n){if(this.Gs(t)){var r=this.Ks(t);this.Zs(t,e)?r.Cs(e,1):r.Fs(e),this.Os=this.Os.me(e,this.ti(e).delete(t)),n&&(this.xs=this.xs.me(e,n))}},ks.prototype.removeTarget=function(t){this.Ls.delete(t)},ks.prototype.Js=function(t){var e=this.Ks(t).Ss();return this.Ms.ei(t).size+e.Ts.size-e.Is.size},ks.prototype.Ns=function(t){this.Ks(t).Ns()},ks.prototype.Ks=function(t){var e=this.Ls.get(t);return e||(e=new Ds,this.Ls.set(t,e)),e},ks.prototype.ti=function(t){var e=this.Os.get(t);return e||(e=new os(ru),this.Os=this.Os.me(t,e)),e},ks.prototype.Gs=function(t){var e=null!==this.Ys(t);return e||Ys("WatchChangeAggregator","Detected inactive target",t),e},ks.prototype.Ys=function(t){var e=this.Ls.get(t);return e&&e.ys?null:this.Ms.si(t)},ks.prototype.zs=function(e){var n=this;this.Ls.set(e,new Ds),this.Ms.ei(e).forEach(function(t){n.Qs(e,t,null)})},ks.prototype.Zs=function(t,e){return this.Ms.ei(t).has(e)},ks);function ks(t){this.Ms=t,this.Ls=new Map,this.xs=cs(),this.Os=Cs(),this.Bs=new os(ru)}function Os(){this.As=0,this.Ps=qs(),this.Vs=ei.ht,this.gs=!1,this.ps=!0}function Rs(t,e,n,r,i){this.resumeToken=t,this.fs=e,this.Ts=n,this.Es=r,this.Is=i}function Ls(t,e,n,r,i){this.Ee=t,this.as=e,this.us=n,this.cs=r,this._s=i}function Ps(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.ss=n,this.docChanges=r,this.ns=i,this.fromCache=o,this.rs=s,this.hs=u}function Vs(){this.ts=new $o(Xr.N)}function Ms(n){this.N=n?function(t,e){return n(t,e)||Xr.N(t.key,e.key)}:function(t,e){return Xr.N(t.key,e.key)},this.Je=ps(),this.Xe=new $o(this.N)}function Cs(){return new $o(Xr.N)}function qs(){return new $o(Xr.N)}var Us={asc:"ASCENDING",desc:"DESCENDING"},js={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Bs=(Fs.prototype.ni=function(t){var e=void 0===t.code?Sr.UNKNOWN:Jo(t.code);return new Dr(e,t.message||"")},Fs.prototype.ri=function(t){return this.options.hi||ri(t)?t:{value:t}},Fs.prototype.oi=function(t){var e;return ri(e="object"==typeof t?t.value:t)?null:e},Fs.prototype._t=function(t){return{integerValue:""+t}},Fs.prototype.lt=function(t){if(this.options.hi){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ii(t)?"-0":t}},Fs.prototype.ai=function(t){return oi(t)?this._t(t):this.lt(t)},Fs.prototype.C=function(t){return this.options.hi?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},Fs.prototype.v=function(t){var e=yi(t);return new Lr(e.seconds,e.nanos)},Fs.prototype.ui=function(t){return this.options.hi?t.toBase64():t.toUint8Array()},Fs.prototype.ci=function(t){return this.options.hi?(Zs(void 0===t||"string"==typeof t),ei.fromBase64String(t||"")):(Zs(void 0===t||t instanceof Uint8Array),ei.fromUint8Array(t||new Uint8Array))},Fs.prototype.toVersion=function(t){return this.C(t.C())},Fs.prototype.fromVersion=function(t){return Zs(!!t),Pr.v(this.v(t))},Fs.prototype._i=function(t,e){return this.li(e||this.ii).child("documents").child(t).j()},Fs.prototype.di=function(t){var e=Mr.K(t);return Zs(zs(e)),e},Fs.prototype.fi=function(t){return this._i(t.path)},Fs.prototype.Z=function(t){var e=this.di(t);return Zs(e.get(1)===this.ii.projectId),Zs(!e.get(3)&&!this.ii.database||e.get(3)===this.ii.database),new Xr(this.Ti(e))},Fs.prototype.Ei=function(t){return this._i(t)},Fs.prototype.Ii=function(t){var e=this.di(t);return 4===e.length?Mr.G:this.Ti(e)},Object.defineProperty(Fs.prototype,"wi",{get:function(){return new Mr(["projects",this.ii.projectId,"databases",this.ii.database]).j()},enumerable:!0,configurable:!0}),Fs.prototype.li=function(t){return new Mr(["projects",t.projectId,"databases",t.database])},Fs.prototype.Ti=function(t){return Zs(4<t.length&&"documents"===t.get(4)),t.$(5)},Fs.prototype.Ri=function(t,e){return{name:this.fi(t),fields:e.proto.mapValue.fields}},Fs.prototype.mi=function(t){return{name:this.fi(t.key),fields:t.Mt().mapValue.fields,updateTime:this.C(t.version.C())}},Fs.prototype.Ai=function(t,e){var n=this.Z(t.name),r=this.fromVersion(t.updateTime),i=new Ki({mapValue:{fields:t.fields}});return new To(n,r,i,{hasCommittedMutations:!!e})},Fs.prototype.Pi=function(t){Zs(!!t.found),t.found.name,t.found.updateTime;var e=this.Z(t.found.name),n=this.fromVersion(t.found.updateTime),r=new Ki({mapValue:{fields:t.found.fields}});return new To(e,n,r,{})},Fs.prototype.Vi=function(t){Zs(!!t.missing),Zs(!!t.readTime);var e=this.Z(t.missing),n=this.fromVersion(t.readTime);return new Io(e,n)},Fs.prototype.gi=function(t){return"found"in t?this.Pi(t):"missing"in t?this.Vi(t):$s()},Fs.prototype.pi=function(t){var e;if("targetChange"in t){t.targetChange;var n=this.yi(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],i=this.ci(t.targetChange.resumeToken),o=t.targetChange.cause,s=o&&this.ni(o);e=new Ts(n,r,i,s||null)}else if("documentChange"in t){t.documentChange;var u=t.documentChange;u.document,u.document.name,u.document.updateTime;var a=this.Z(u.document.name),h=this.fromVersion(u.document.updateTime),c=new Ki({mapValue:{fields:u.document.fields}}),f=new To(a,h,c,{}),l=u.targetIds||[],p=u.removedTargetIds||[];e=new bs(l,p,f.key,f)}else if("documentDelete"in t){t.documentDelete;var d=t.documentDelete;d.document;var y=this.Z(d.document),v=d.readTime?this.fromVersion(d.readTime):Pr.min(),m=new Io(y,v),g=d.removedTargetIds||[];e=new bs([],g,m.key,m)}else if("documentRemove"in t){t.documentRemove;var w=t.documentRemove;w.document;var b=this.Z(w.document),E=w.removedTargetIds||[];e=new bs([],E,b,null)}else{if(!("filter"in t))return $s();t.filter;var T=t.filter;T.targetId;var I=T.count||0,N=new ho(I),_=T.targetId;e=new Es(_,N)}return e},Fs.prototype.yi=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:$s()},Fs.prototype.bi=function(t){if(!("targetChange"in t))return Pr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Pr.min():this.fromVersion(e.readTime)},Fs.prototype.vi=function(t){var e,n=this;if(t instanceof zi)e={update:this.Ri(t.key,t.value)};else if(t instanceof Qi)e={delete:this.fi(t.key)};else if(t instanceof Gi)e={update:this.Ri(t.key,t.data),updateMask:this.Si(t.Vt)};else if(t instanceof Hi)e={transform:{document:this.fi(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.Di(t)})}};else{if(!(t instanceof Wi))return $s();e={verify:this.fi(t.key)}}return t.Rt.Tt||(e.currentDocument=this.Ci(t.Rt)),e},Fs.prototype.Fi=function(t){var e=this,n=t.currentDocument?this.Ni(t.currentDocument):Bi.ft();if(t.update){t.update.name;var r=this.Z(t.update.name),i=new Ki({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=this.ki(t.updateMask);return new Gi(r,i,o,n)}return new zi(r,i,n)}if(t.delete){var s=this.Z(t.delete);return new Qi(s,n)}if(t.transform){var u=this.Z(t.transform.document),a=t.transform.fieldTransforms.map(function(t){return e.$i(t)});return Zs(!0===n.exists),new Hi(u,a)}if(t.verify){var h=this.Z(t.verify);return new Wi(h,n)}return $s()},Fs.prototype.Ci=function(t){return void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:$s()},Fs.prototype.Ni=function(t){return void 0!==t.updateTime?Bi.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Bi.exists(t.exists):Bi.ft()},Fs.prototype.Mi=function(t,e){var n=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);n.isEqual(Pr.min())&&(n=this.fromVersion(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new Li(n,r)},Fs.prototype.Li=function(t,e){var n=this;return t&&0<t.length?(Zs(void 0!==e),t.map(function(t){return n.Mi(t,e)})):[]},Fs.prototype.Di=function(t){var e=t.transform;if(e instanceof Ni)return{fieldPath:t.field.j(),setToServerValue:"REQUEST_TIME"};if(e instanceof Ai)return{fieldPath:t.field.j(),appendMissingElements:{values:e.elements}};if(e instanceof Si)return{fieldPath:t.field.j(),removeAllFromArray:{values:e.elements}};if(e instanceof Di)return{fieldPath:t.field.j(),increment:e.ct};throw $s()},Fs.prototype.$i=function(t){var e=null;if("setToServerValue"in t)Zs("REQUEST_TIME"===t.setToServerValue),e=Ni.instance;else if("appendMissingElements"in t){var n=t.appendMissingElements.values||[];e=new Ai(n)}else if("removeAllFromArray"in t){var r=t.removeAllFromArray.values||[];e=new Si(r)}else"increment"in t?e=new Di(this,t.increment):$s();var i=Kr.X(t.fieldPath);return new ji(i,e)},Fs.prototype.xi=function(t){return{documents:[this.Ei(t.path)]}},Fs.prototype.Oi=function(t){Zs(1===t.documents.length);var e=t.documents[0];return Ao.Wt(this.Ii(e)).ee()},Fs.prototype.Bi=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(e.parent=this.Ei(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(e.parent=this.Ei(n.M()),e.structuredQuery.from=[{collectionId:n.O()}]);var r=this.qi(t.filters);r&&(e.structuredQuery.where=r);var i=this.Ui(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.ri(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.Qi(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.Qi(t.endAt)),e},Fs.prototype.Wi=function(t){var e=this.Ii(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Zs(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=this.ji(n.where));var u=[];n.orderBy&&(u=this.Ki(n.orderBy));var a=null;n.limit&&(a=this.oi(n.limit));var h=null;n.startAt&&(h=this.Gi(n.startAt));var c=null;return n.endAt&&(c=this.Gi(n.endAt)),new Ao(e,i,u,s,a,"F",h,c).ee()},Fs.prototype.zi=function(t){var e=this.Hi(t.Te);return null==e?null:{"goog-listen-tags":e}},Fs.prototype.Hi=function(t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return $s()}},Fs.prototype.ee=function(t){var e,n=t.target;return(e=n.xt()?{documents:this.xi(n)}:{query:this.Bi(n)}).targetId=t.targetId,0<t.resumeToken.rt()&&(e.resumeToken=this.ui(t.resumeToken)),e},Fs.prototype.qi=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof So?e.Yi(t):$s()});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},Fs.prototype.ji=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.Ji(t)]:void 0!==t.fieldFilter?[this.Xi(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.ji(t)}).reduce(function(t,e){return t.concat(e)}):$s():[]},Fs.prototype.Ui=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.Zi(t)})},Fs.prototype.Ki=function(t){var e=this;return t.map(function(t){return e.tn(t)})},Fs.prototype.Qi=function(t){return{before:t.before,values:t.position}},Fs.prototype.Gi=function(t){var e=!!t.before,n=t.values||[];return new Lo(n,e)},Fs.prototype.en=function(t){return Us[t]},Fs.prototype.sn=function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}},Fs.prototype.nn=function(t){return js[t]},Fs.prototype.rn=function(t){switch(t){case"EQUAL":return"==";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return $s()}},Fs.prototype.hn=function(t){return{fieldPath:t.j()}},Fs.prototype.on=function(t){return Kr.X(t.fieldPath)},Fs.prototype.Zi=function(t){return{field:this.hn(t.field),direction:this.en(t.dir)}},Fs.prototype.tn=function(t){return new Po(this.on(t.field),this.sn(t.direction))},Fs.prototype.Xi=function(t){return So.create(this.on(t.fieldFilter.field),this.rn(t.fieldFilter.op),t.fieldFilter.value)},Fs.prototype.Yi=function(t){if("=="===t.op){if(Ti(t.value))return{unaryFilter:{field:this.hn(t.field),op:"IS_NAN"}};if(Ei(t.value))return{unaryFilter:{field:this.hn(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.hn(t.field),op:this.nn(t.op),value:t.value}}},Fs.prototype.Ji=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.on(t.unaryFilter.field);return So.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=this.on(t.unaryFilter.field);return So.create(n,"==",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return $s()}},Fs.prototype.Si=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.j())}),{fieldPaths:e}},Fs.prototype.ki=function(t){var e=t.fieldPaths||[];return new Ui(e.map(function(t){return Kr.X(t)}))},Fs);function Fs(t,e){this.ii=t,this.options=e}function zs(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}var Gs=(Qs.an=function(t){Qs.platform&&$s(),Qs.platform=t},Qs.nt=function(){return Qs.platform||$s(),Qs.platform},Qs),Hs=new h("@firebase/firestore");function Qs(){}function Ws(){return Hs.logLevel}function Ks(t){Hs.logLevel=t}function Ys(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Hs.logLevel<=l.DEBUG){var r=e.map(Js);Hs.debug.apply(Hs,i(["Firestore ("+Er+"): "+t],r))}}function Xs(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Hs.logLevel<=l.ERROR){var r=e.map(Js);Hs.error.apply(Hs,i(["Firestore ("+Er+"): "+t],r))}}function Js(t){if("string"==typeof t)return t;var e=Gs.nt();try{return e.un(t)}catch(e){return t}}function $s(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE ("+Er+") INTERNAL ASSERTION FAILED: "+t;throw Xs(e),new Error(e)}function Zs(t){t||$s()}function tu(t){return t}var eu=(nu.cn=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},nu);function nu(){}function ru(t,e){return t<e?-1:e<t?1:0}function iu(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function ou(t){return t+"\0"}function su(t,e,n,r,i){this.ii=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var uu=(Object.defineProperty(Ou.prototype,"_n",{get:function(){return"(default)"===this.database},enumerable:!0,configurable:!0}),Ou.prototype.isEqual=function(t){return t instanceof Ou&&t.projectId===this.projectId&&t.database===this.database},Ou.prototype.S=function(t){return ru(this.projectId,t.projectId)||ru(this.database,t.database)},Ou),au=(ku.prototype.get=function(t){var e=this.ln(t),n=this.dn[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(s.isEqual(t))return u}},ku.prototype.has=function(t){return void 0!==this.get(t)},ku.prototype.set=function(t,e){var n=this.ln(t),r=this.dn[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.dn[n]=[[t,e]]},ku.prototype.delete=function(t){var e=this.ln(t),n=this.dn[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.dn[e]:n.splice(r,1),!0;return!1},ku.prototype.forEach=function(u){Zr(this.dn,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];u(o,s)}})},ku.prototype.B=function(){return ti(this.dn)},ku),hu=(xu.prototype.at=function(t,e,n){for(var r=n.Tn,i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var s=r[i];e=o.at(e,s)}}return e},xu.prototype.ot=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=i.ot(e,e,this.fn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=a.ot(e,o,this.fn))}return e},xu.prototype.En=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.ot(t.key,n.get(t.key));e&&(i=i.me(t.key,e))}),i},xu.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},ms())},xu.prototype.isEqual=function(t){return this.batchId===t.batchId&&iu(this.mutations,t.mutations,function(t,e){return t.isEqual(e)})&&iu(this.baseMutations,t.baseMutations,function(t,e){return t.isEqual(e)})},xu),cu=(Du.from=function(t,e,n,r){Zs(t.mutations.length===n.length);for(var i=ys(),o=t.mutations,s=0;s<o.length;s++)i=i.me(o[s].key,n[s].version);return new Du(t,e,n,r,i)},Du),fu=(Su.prototype.B=function(){return this.Rn.B()},Su.prototype.Vn=function(t,e){var n=new lu(t,e);this.Rn=this.Rn.add(n),this.An=this.An.add(n)},Su.prototype.gn=function(t,e){var n=this;t.forEach(function(t){return n.Vn(t,e)})},Su.prototype.pn=function(t,e){this.yn(new lu(t,e))},Su.prototype.bn=function(t,e){var n=this;t.forEach(function(t){return n.pn(t,e)})},Su.prototype.vn=function(t){var e=this,n=Xr.EMPTY,r=new lu(n,t),i=new lu(n,t+1),o=[];return this.An.Ke([r,i],function(t){e.yn(t),o.push(t.key)}),o},Su.prototype.Sn=function(){var e=this;this.Rn.forEach(function(t){return e.yn(t)})},Su.prototype.yn=function(t){this.Rn=this.Rn.delete(t),this.An=this.An.delete(t)},Su.prototype.Dn=function(t){var e=Xr.EMPTY,n=new lu(e,t),r=new lu(e,t+1),i=ms();return this.An.Ke([n,r],function(t){i=i.add(t.key)}),i},Su.prototype.Cn=function(t){var e=new lu(t,0),n=this.Rn.ze(e);return null!==n&&t.isEqual(n.key)},Su),lu=(Au.mn=function(t,e){return Xr.N(t.key,e.key)||ru(t.Fn,e.Fn)},Au.Pn=function(t,e){return ru(t.Fn,e.Fn)||Xr.N(t.key,e.key)},Au),pu=(_u.prototype.catch=function(t){return this.next(void 0,t)},_u.prototype.next=function(r,i){var o=this;return this.Mn&&$s(),this.Mn=!0,this.$n?this.error?this.Ln(i,this.error):this.xn(r,this.result):new _u(function(e,n){o.Nn=function(t){o.xn(r,t).next(e,n)},o.kn=function(t){o.Ln(i,t).next(e,n)}})},_u.prototype.On=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},_u.prototype.Bn=function(t){try{var e=t();return e instanceof _u?e:_u.resolve(e)}catch(t){return _u.reject(t)}},_u.prototype.xn=function(t,e){return t?this.Bn(function(){return t(e)}):_u.resolve(e)},_u.prototype.Ln=function(t,e){return t?this.Bn(function(){return t(e)}):_u.reject(e)},_u.resolve=function(n){return new _u(function(t,e){t(n)})},_u.reject=function(n){return new _u(function(t,e){e(n)})},_u.qn=function(t){return new _u(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},_u.Un=function(t){for(var n=_u.resolve(!1),e=function(e){n=n.next(function(t){return t?_u.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},_u.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.qn(i)},_u),du=(Object.defineProperty(Nu.prototype,"readTime",{get:function(){return this.jn},set:function(t){this.jn=t},enumerable:!0,configurable:!0}),Nu.prototype.Kn=function(t,e){this.Gn(),this.readTime=e,this.Qn.set(t.key,t)},Nu.prototype.zn=function(t,e){this.Gn(),e&&(this.readTime=e),this.Qn.set(t,null)},Nu.prototype.Hn=function(t,e){this.Gn();var n=this.Qn.get(e);return void 0!==n?pu.resolve(n):this.Yn(t,e)},Nu.prototype.getEntries=function(t,e){return this.Jn(t,e)},Nu.prototype.apply=function(t){return this.Gn(),this.Wn=!0,this.Xn(t)},Nu.prototype.Gn=function(){},Nu),yu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",vu=(Iu.prototype.tr=function(t){this.Zn.push(t)},Iu.prototype.er=function(){this.Zn.forEach(function(t){return t()})},Iu),mu=(Tu.prototype.rr=function(e,n){var r=this;return this.ir.hr(e,n).next(function(t){return r.or(e,n,t)})},Tu.prototype.or=function(t,r,i){return this.sr.Hn(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].ot(r,t);return t})},Tu.prototype.ar=function(t,e,i){var o=fs();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].ot(t,e);o=o.me(t,e)}),o},Tu.prototype.ur=function(e,t){var n=this;return this.sr.getEntries(e,t).next(function(t){return n.cr(e,t)})},Tu.prototype.cr=function(r,i){var o=this;return this.ir._r(r,i).next(function(t){var e=o.ar(r,i,t),n=cs();return e.forEach(function(t,e){e=e||new Io(t,Pr.min()),n=n.me(t,e)}),n})},Tu.prototype.lr=function(t,e,n){return e.xt()?this.dr(t,e.path):e._e()?this.Tr(t,e,n):this.Er(t,e,n)},Tu.prototype.dr=function(t,e){return this.rr(t,new Xr(e)).next(function(t){var e=ps();return t instanceof To&&(e=e.me(t.key,t)),e})},Tu.prototype.Tr=function(n,r,i){var o=this,s=r.collectionGroup,u=ps();return this.nr.Ir(n,s).next(function(t){return pu.forEach(t,function(t){var e=r.Zt(t.child(s));return o.Er(n,e,i).next(function(t){t.forEach(function(t,e){u=u.me(t,e)})})}).next(function(){return u})})},Tu.prototype.Er=function(e,n,t){var c,f,r=this;return this.sr.lr(e,n,t).next(function(t){return c=t,r.ir.wr(e,n)}).next(function(t){return f=t,r.Rr(e,f,c).next(function(t){c=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=c.get(u),h=s.ot(a,a,r.fn);c=h instanceof To?c.me(u,h):c.remove(u)}})}).next(function(){return c.forEach(function(t,e){n.matches(e)||(c=c.remove(t))}),c})},Tu.prototype.Rr=function(t,e,n){for(var r=ms(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Gi&&null===n.get(a.key)&&(r=r.add(a.key))}var h=n;return this.sr.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof To&&(h=h.me(t,e))}),h})},Tu),gu=(Eu.Pr=function(t,e){for(var n=ms(),r=ms(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new Eu(t,e.fromCache,n,r)},Eu),wu=(bu.prototype.gr=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},bu.prototype.next=function(){var t=++this.previousValue;return this.pr&&this.pr(t),t},bu);function bu(t,e){var n=this;this.previousValue=t,e&&(e.Vr=function(t){return n.gr(t)},this.pr=function(t){return e.yr(t)})}function Eu(t,e,n,r){this.targetId=t,this.fromCache=e,this.mr=n,this.Ar=r}function Tu(t,e,n){this.sr=t,this.ir=e,this.nr=n}function Iu(){this.Zn=[]}function Nu(){this.Qn=new au(function(t){return t.toString()}),this.Wn=!1}function _u(t){var e=this;this.Nn=null,this.kn=null,this.result=void 0,this.error=void 0,this.$n=!1,this.Mn=!1,t(function(t){e.$n=!0,e.result=t,e.Nn&&e.Nn(t)},function(t){e.$n=!0,e.error=t,e.kn&&e.kn(t)})}function Au(t,e){this.key=t,this.Fn=e}function Su(){this.Rn=new os(lu.mn),this.An=new os(lu.Pn)}function Du(t,e,n,r,i){this.batch=t,this.In=e,this.Tn=n,this.streamToken=r,this.wn=i}function xu(t,e,n,r){this.batchId=t,this.fn=e,this.baseMutations=n,this.mutations=r}function ku(t){this.ln=t,this.dn={}}function Ou(t,e){this.projectId=t,this.database=e||"(default)"}wu.br=-1;function Ru(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var Lu=(qu.prototype.reset=function(){this.Nr=0},qu.prototype.Mr=function(){this.Nr=this.Fr},qu.prototype.Lr=function(t){var e=this;this.cancel();var n=Math.floor(this.Nr+this.xr()),r=Math.max(0,Date.now()-this.$r),i=Math.max(0,n-r);0<i&&Ys("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Nr+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.kr=this.vr.Or(this.Sr,i,function(){return e.$r=Date.now(),t()}),this.Nr*=this.Cr,this.Nr<this.Dr&&(this.Nr=this.Dr),this.Nr>this.Fr&&(this.Nr=this.Fr)},qu.prototype.cancel=function(){null!==this.kr&&(this.kr.cancel(),this.kr=null)},qu.prototype.xr=function(){return(Math.random()-.5)*this.Nr},qu),Pu=(Cu.Wr=function(t,e,n,r,i){var o=new Cu(t,e,Date.now()+n,r,i);return o.start(n),o},Cu.prototype.start=function(t){var e=this;this.jr=setTimeout(function(){return e.Kr()},t)},Cu.prototype.Gr=function(){return this.Kr()},Cu.prototype.cancel=function(t){null!==this.jr&&(this.clearTimeout(),this.Qr.reject(new Dr(Sr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Cu.prototype.Kr=function(){var e=this;this.Br.zr(function(){return null!==e.jr?(e.clearTimeout(),e.op().then(function(t){return e.Qr.resolve(t)})):Promise.resolve()})},Cu.prototype.clearTimeout=function(){null!==this.jr&&(this.Ur(this),clearTimeout(this.jr),this.jr=null)},Cu),Vu=(Object.defineProperty(Mu.prototype,"rh",{get:function(){return this.Jr},enumerable:!0,configurable:!0}),Mu.prototype.zr=function(t){this.enqueue(t)},Mu.prototype.hh=function(t){this.oh(),this.ah(t)},Mu.prototype.uh=function(t){return this.oh(),this.ah(t)},Mu.prototype._h=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.oh(),this.Jr?[3,2]:(this.Jr=!0,(e=Gs.nt().window)&&e.removeEventListener("visibilitychange",this.ih),[4,this.uh(n)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Mu.prototype.enqueue=function(t){return this.oh(),this.Jr?new Promise(function(t){}):this.ah(t)},Mu.prototype.lh=function(i){var t=this;this.oh(),this.Jr||(this.Yr=this.Yr.then(function(){var n=new Ru,r=function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,i()];case 1:return t.sent(),n.resolve(),this.sh.reset(),[3,3];case 2:if("IndexedDbTransactionError"!==(e=t.sent()).name)throw n.resolve(),e;return Ys("AsyncQueue","Operation failed with retryable error: "+e),this.sh.Lr(r),[3,3];case 3:return[2]}})})};return t.zr(r),n.promise}))},Mu.prototype.ah=function(t){var e=this,n=this.Hr.then(function(){return e.th=!0,t().catch(function(t){throw e.Zr=t,e.th=!1,Xs("INTERNAL UNHANDLED ERROR: ",t.stack||t.message||""),t}).then(function(t){return e.th=!1,t})});return this.Hr=n},Mu.prototype.Or=function(t,e,n){var r=this;this.oh(),-1<this.eh.indexOf(t)&&(e=0);var i=Pu.Wr(this,t,e,n,function(t){return r.dh(t)});return this.Xr.push(i),i},Mu.prototype.oh=function(){this.Zr&&$s()},Mu.prototype.fh=function(){},Mu.prototype.Th=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.Hr];case 1:t.sent(),t.label=2;case 2:if(e!==this.Hr)return[3,0];t.label=3;case 3:return[2]}})})},Mu.prototype.Eh=function(t){for(var e=0,n=this.Xr;e<n.length;e++)if(n[e].Sr===t)return!0;return!1},Mu.prototype.nh=function(r){var i=this;return this.Th().then(function(){i.Xr.sort(function(t,e){return t.qr-e.qr});for(var t=0,e=i.Xr;t<e.length;t++){var n=e[t];if(n.Gr(),"all"!==r&&n.Sr===r)break}return i.Th()})},Mu.prototype.Ih=function(t){this.eh.push(t)},Mu.prototype.dh=function(t){var e=this.Xr.indexOf(t);this.Xr.splice(e,1)},Mu);function Mu(){var t=this;this.Hr=Promise.resolve(),this.Yr=Promise.resolve(),this.Jr=!1,this.Xr=[],this.Zr=null,this.th=!1,this.eh=[],this.sh=new Lu(this,"async_queue_retry"),this.ih=function(){t.nh("async_queue_retry")};var e=Gs.nt().window;e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.ih)}function Cu(t,e,n,r,i){this.Br=t,this.Sr=e,this.qr=n,this.op=r,this.Ur=i,this.Qr=new Ru,this.then=this.Qr.promise.then.bind(this.Qr.promise),this.catch=this.Qr.promise.catch.bind(this.Qr.promise),this.Qr.promise.catch(function(t){})}function qu(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.vr=t,this.Sr=e,this.Dr=n,this.Cr=r,this.Fr=i,this.Nr=0,this.kr=null,this.$r=Date.now(),this.reset()}function Uu(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=ru(n,i);return 0===s?ru(r,o):s}var ju=(Gu.prototype.mh=function(){return++this.Rh},Gu.prototype.Ah=function(t){var e=[t,this.mh()];if(this.buffer.size<this.wh)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Uu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(Gu.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),Gu),Bu={Ph:!1,Vh:0,gh:0,ph:0},Fu=(zu.Sh=function(t){return new zu(t,zu.Dh,zu.Ch)},zu);function zu(t,e,n){this.yh=t,this.bh=e,this.vh=n}function Gu(t){this.wh=t,this.buffer=new os(Uu),this.Rh=0}Fu.Fh=-1,Fu.Nh=1048576,Fu.kh=41943040,Fu.Dh=10,Fu.Ch=1e3,Fu.$h=new Fu(Fu.kh,Fu.Dh,Fu.Ch),Fu.DISABLED=new Fu(Fu.Fh,0,0);var Hu=(Ku.prototype.start=function(t){this.Mh.Oh.yh!==Fu.Fh&&this.Bh(t)},Ku.prototype.stop=function(){this.xh&&(this.xh.cancel(),this.xh=null)},Object.defineProperty(Ku.prototype,"qh",{get:function(){return null!==this.xh},enumerable:!0,configurable:!0}),Ku.prototype.Bh=function(n){var t=this,e=this.Lh?3e5:6e4;Ys("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.xh=this.Br.Or("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.xh=null,this.Lh=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.Uh(this.Mh)];case 2:return t.sent(),[3,7];case 3:return"IndexedDbTransactionError"!==(e=t.sent()).name?[3,4]:(Ys("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]);case 4:return[4,Sh(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.Bh(n)];case 8:return t.sent(),[2]}})})})},Ku),Qu=(Wu.prototype.Wh=function(t,e){return this.Qh.jh(t).next(function(t){return Math.floor(e/100*t)})},Wu.prototype.Kh=function(t,e){var n=this;if(0===e)return pu.resolve(wu.br);var r=new ju(e);return this.Qh.js(t,function(t){return r.Ah(t.sequenceNumber)}).next(function(){return n.Qh.Gh(t,function(t){return r.Ah(t)})}).next(function(){return r.maxValue})},Wu.prototype.zh=function(t,e,n){return this.Qh.zh(t,e,n)},Wu.prototype.Hh=function(t,e){return this.Qh.Hh(t,e)},Wu.prototype.Yh=function(e,n){var r=this;return this.Oh.yh===Fu.Fh?(Ys("LruGarbageCollector","Garbage collection skipped; disabled"),pu.resolve(Bu)):this.Jh(e).next(function(t){return t<r.Oh.yh?(Ys("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.Oh.yh),Bu):r.Xh(e,n)})},Wu.prototype.Jh=function(t){return this.Qh.Jh(t)},Wu.prototype.Xh=function(e,n){var r,i,o,s,u,a,h,c=this,f=Date.now();return this.Wh(e,this.Oh.bh).next(function(t){return i=t>c.Oh.vh?(Ys("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.Oh.vh+" from "+t),c.Oh.vh):t,s=Date.now(),c.Kh(e,i)}).next(function(t){return r=t,u=Date.now(),c.zh(e,r,n)}).next(function(t){return o=t,a=Date.now(),c.Hh(e,r)}).next(function(t){return h=Date.now(),Ws()<=l.DEBUG&&Ys("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(h-a)+"ms\nTotal Duration: "+(h-f)+"ms"),pu.resolve({Ph:!0,Vh:i,gh:o,ph:t})})},Wu);function Wu(t,e){this.Qh=t,this.Oh=e}function Ku(t,e){this.Mh=t,this.Br=e,this.Lh=!1,this.xh=null}function Yu(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Ju(e)),e=Xu(t.get(n),e);return Ju(e)}function Xu(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Ju(t){return t+""}function $u(t){var e=t.length;if(Zs(2<=e),2===e)return Zs(""===t.charAt(0)&&""===t.charAt(1)),Mr.G;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&$s(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:$s()}o=s+2}return new Mr(r)}var Zu,ta=(ha.to=function(o,t,s){return Ys("SimpleDb","Opening database:",o),new pu(function(n,r){var i;(i="undefined"!=typeof indexedDB?indexedDB.open(o,t):window.indexedDB.open(o,t)).onsuccess=function(t){var e=t.target.result;n(new ha(e))},i.onblocked=function(){r(new Dr(Sr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Dr(Sr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Ys("SimpleDb",'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;s.createOrUpgrade(e,i.transaction,t.oldVersion,Ua).next(function(){Ys("SimpleDb","Database upgrade to version "+Ua+" complete")})}}).On()},ha.delete=function(t){return Ys("SimpleDb","Removing database:",t),ca(window.indexedDB.deleteDatabase(t)).On()},ha.eo=function(){if("undefined"!=typeof indexedDB)return Xs("IndexedDB available"),!0;if("undefined"==typeof window||null==window.indexedDB)return Xs("window undefined"),!1;if(ha.so())return!0;if(void 0===window.navigator)return!1;var t=p(),e=ha.Zh(t),n=0<e&&e<10,r=ha.io(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},ha.so=function(){var t;return"undefined"!=typeof __PRIVATE_process&&"YES"===(null===(t=__PRIVATE_process.__PRIVATE_env)||void 0===t?void 0:t.no)},ha.ro=function(t,e){return t.store(e)},ha.Zh=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},ha.io=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},ha.prototype.ho=function(e){this.db.onversionchange=function(t){return e(t)}},ha.prototype.runTransaction=function(r,h,c){return y(this,void 0,void 0,function(){var s,u,e,a,n;return v(this,function(t){switch(t.label){case 0:s="readonly"===r,u=0,e=function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:++u,e=ra.open(a.db,s?"readonly":"readwrite",h),t.label=1;case 1:return t.trys.push([1,3,,4]),n=c(e).catch(function(t){return e.abort(t),pu.reject(t)}).On(),r={},n.catch(function(){}),[4,e.oo];case 2:return[2,(r.value=(t.sent(),n),r)];case 3:return i=t.sent(),o="FirebaseError"!==i.name&&u<3,Ys("SimpleDb","Transaction failed with error: %s. Retrying: %s.",i.message,o),o?[3,4]:[2,{value:Promise.reject(i)}];case 4:return[2]}})},a=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(n=t.sent()))return[2,n.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},ha.prototype.close=function(){this.db.close()},ha),ea=(Object.defineProperty(aa.prototype,"$n",{get:function(){return this.uo},enumerable:!0,configurable:!0}),Object.defineProperty(aa.prototype,"_o",{get:function(){return this.co},enumerable:!0,configurable:!0}),Object.defineProperty(aa.prototype,"cursor",{set:function(t){this.ao=t},enumerable:!0,configurable:!0}),aa.prototype.done=function(){this.uo=!0},aa.prototype.lo=function(t){this.co=t},aa.prototype.delete=function(){return ca(this.ao.delete())},aa),na=(n(ua,Zu=Dr),ua),ra=(sa.open=function(t,e,n){return new sa(t.transaction(n,e))},Object.defineProperty(sa.prototype,"oo",{get:function(){return this.do.promise},enumerable:!0,configurable:!0}),sa.prototype.abort=function(t){t&&this.do.reject(t),this.aborted||(Ys("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},sa.prototype.store=function(t){var e=this.transaction.objectStore(t);return new ia(e)},sa),ia=(oa.prototype.put=function(t,e){return ca(void 0!==e?(Ys("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Ys("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},oa.prototype.add=function(t){return Ys("SimpleDb","ADD",this.store.name,t,t),ca(this.store.add(t))},oa.prototype.get=function(e){var n=this;return ca(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Ys("SimpleDb","GET",n.store.name,e,t),t})},oa.prototype.delete=function(t){return Ys("SimpleDb","DELETE",this.store.name,t),ca(this.store.delete(t))},oa.prototype.count=function(){return Ys("SimpleDb","COUNT",this.store.name),ca(this.store.count())},oa.prototype.fo=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.To(n,function(t,e){r.push(e)}).next(function(){return r})},oa.prototype.Eo=function(t,e){Ys("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Io=!1;var r=this.cursor(n);return this.To(r,function(t,e,n){return n.delete()})},oa.prototype.wo=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.To(r,e)},oa.prototype.Ro=function(i){var t=this.cursor({});return new pu(function(n,r){t.onerror=function(t){var e=la(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},oa.prototype.To=function(t,s){var u=[];return new pu(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new ea(e),r=s(e.primaryKey,e.value,n);if(r instanceof pu){var i=r.catch(function(t){return n.done(),pu.reject(t)});u.push(i)}n.$n?o():null===n._o?e.continue():e.continue(n._o)}else o()}}).next(function(){return pu.qn(u)})},oa.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},oa.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Io?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},oa);function oa(t){this.store=t}function sa(t){var n=this;this.transaction=t,this.aborted=!1,this.do=new Ru,this.transaction.oncomplete=function(){n.do.resolve()},this.transaction.onabort=function(){t.error?n.do.reject(new na(t.error)):n.do.resolve()},this.transaction.onerror=function(t){var e=la(t.target.error);n.do.reject(new na(e))}}function ua(t){var e=this;return(e=Zu.call(this,Sr.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",e}function aa(t){this.ao=t,this.uo=!1,this.co=null}function ha(t){this.db=t,12.2===ha.Zh(p())&&Xs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function ca(t){return new pu(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=la(t.target.error);r(e)}})}var fa=!1;function la(t){var e=ta.Zh(p());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Dr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return fa||(fa=!0,setTimeout(function(){throw r},0)),r}}return t}var pa=(da.Po=function(t,e,n,r){return Zs(""!==t.uid),new da(t.t()?t.uid:"",e,n,r)},da.prototype.Vo=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ma(t).wo({index:Qa.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},da.prototype.po=function(e,t,n){return this.yo(e).next(function(t){return t.lastStreamToken=n.toBase64(),wa(e).put(t)})},da.prototype.bo=function(t){return this.yo(t).next(function(t){return ei.fromBase64String(t.lastStreamToken)})},da.prototype.vo=function(e,n){return this.yo(e).next(function(t){return t.lastStreamToken=n.toBase64(),wa(e).put(t)})},da.prototype.So=function(h,c,f,l){var p=this,d=ga(h),y=ma(h);return y.add({}).next(function(t){Zs("number"==typeof t);for(var e=new hu(t,c,f,l),n=p.serializer.Do(p.userId,e),r=[],i=new os(function(t,e){return ru(t.j(),e.j())}),o=0,s=l;o<s.length;o++){var u=s[o],a=Wa.key(p.userId,u.key.path,t);i=i.add(u.key.path.M()),r.push(y.put(n)),r.push(d.put(a,Wa.PLACEHOLDER))}return i.forEach(function(t){r.push(p.nr.Co(h,t))}),h.tr(function(){p.Ao[t]=e.keys()}),pu.qn(r).next(function(){return e})})},da.prototype.Fo=function(t,e){var n=this;return ma(t).get(e).next(function(t){return t?(Zs(t.userId===n.userId),n.serializer.No(t)):null})},da.prototype.ko=function(t,n){var r=this;return this.Ao[n]?pu.resolve(this.Ao[n]):this.Fo(t,n).next(function(t){if(t){var e=t.keys();return r.Ao[n]=e}return null})},da.prototype.$o=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return ma(t).wo({index:Qa.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Zs(e.batchId>=i),o=r.serializer.No(e)),n.done()}).next(function(){return o})},da.prototype.Mo=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return ma(t).wo({index:Qa.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},da.prototype.Lo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ma(t).fo(Qa.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.No(t)})})},da.prototype.hr=function(u,a){var h=this,t=Wa.prefixForPath(this.userId,a.path),e=IDBKeyRange.lowerBound(t),c=[];return ga(u).wo({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=$u(i);if(r===h.userId&&a.path.isEqual(s))return ma(u).get(o).next(function(t){if(!t)throw $s();Zs(t.userId===h.userId),c.push(h.serializer.No(t))});n.done()}).next(function(){return c})},da.prototype._r=function(r,t){var a=this,h=new os(ru),i=[];return t.forEach(function(u){var t=Wa.prefixForPath(a.userId,u.path),e=IDBKeyRange.lowerBound(t),n=ga(r).wo({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=$u(i);r===a.userId&&u.path.isEqual(s)?h=h.add(o):n.done()});i.push(n)}),pu.qn(i).next(function(){return a.xo(r,h)})},da.prototype.wr=function(t,e){var u=this,a=e.path,h=a.length+1,n=Wa.prefixForPath(this.userId,a),r=IDBKeyRange.lowerBound(n),c=new os(ru);return ga(t).wo({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=$u(i);r===u.userId&&a.q(s)?s.length===h&&(c=c.add(o)):n.done()}).next(function(){return u.xo(t,c)})},da.prototype.xo=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(ma(e).get(t).next(function(t){if(null===t)throw $s();Zs(t.userId===n.userId),r.push(n.serializer.No(t))}))}),pu.qn(i).next(function(){return r})},da.prototype.Oo=function(e,n){var r=this;return va(e.Bo,this.userId,n).next(function(t){return e.tr(function(){r.qo(n.batchId)}),pu.forEach(t,function(t){return r.mo.Uo(e,t)})})},da.prototype.qo=function(t){delete this.Ao[t]},da.prototype.Qo=function(n){var o=this;return this.Vo(n).next(function(t){if(!t)return pu.resolve();var e=IDBKeyRange.lowerBound(Wa.prefixForUser(o.userId)),i=[];return ga(n).wo({range:e},function(t,e,n){if(t[0]===o.userId){var r=$u(t[1]);i.push(r)}else n.done()}).next(function(){Zs(0===i.length)})})},da.prototype.Cn=function(t,e){return ya(t,this.userId,e)},da.prototype.yo=function(t){var e=this;return wa(t).get(this.userId).next(function(t){return t||new Ha(e.userId,-1,"")})},da);function da(t,e,n,r){this.userId=t,this.serializer=e,this.nr=n,this.mo=r,this.Ao={}}function ya(t,o,e){var n=Wa.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return ga(t).wo({range:r,Io:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function va(t,e,n){var r=t.store(Qa.store),i=t.store(Wa.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.wo({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){Zs(1===u)}));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=Wa.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return pu.qn(o).next(function(){return h})}function ma(t){return ph.ro(t,Qa.store)}function ga(t){return ph.ro(t,Wa.store)}function wa(t){return ph.ro(t,Ha.store)}var ba=(Ia.prototype.next=function(){return this.Wo+=2,this.Wo},Ia.jo=function(){return new Ia(0)},Ia.Ko=function(){return new Ia(-1)},Ia),Ea=(Ta.prototype.Go=function(n){var r=this;return this.zo(n).next(function(t){var e=new ba(t.highestTargetId);return t.highestTargetId=e.next(),r.Ho(n,t).next(function(){return t.highestTargetId})})},Ta.prototype.Yo=function(t){return this.zo(t).next(function(t){return Pr.v(new Lr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},Ta.prototype.Jo=function(t){return Aa(t.Bo)},Ta.prototype.Xo=function(e,n,r){var i=this;return this.zo(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.C()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Ho(e,t)})},Ta.prototype.Zo=function(e,n){var r=this;return this.ta(e,n).next(function(){return r.zo(e).next(function(t){return t.targetCount+=1,r.ea(n,t),r.Ho(e,t)})})},Ta.prototype.sa=function(t,e){return this.ta(t,e)},Ta.prototype.ia=function(e,t){var n=this;return this.na(e,t.targetId).next(function(){return Na(e).delete(t.targetId)}).next(function(){return n.zo(e)}).next(function(t){return Zs(0<t.targetCount),--t.targetCount,n.Ho(e,t)})},Ta.prototype.zh=function(r,i,o){var s=this,u=0,a=[];return Na(r).wo(function(t,e){var n=s.serializer.ra(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(u++,a.push(s.ia(r,n)))}).next(function(){return pu.qn(a)}).next(function(){return u})},Ta.prototype.js=function(t,r){var i=this;return Na(t).wo(function(t,e){var n=i.serializer.ra(e);r(n)})},Ta.prototype.zo=function(t){return _a(t.Bo)},Ta.prototype.Ho=function(t,e){return ph.ro(t,eh.store).put(eh.key,e)},Ta.prototype.ta=function(t,e){return Na(t).put(this.serializer.ha(e))},Ta.prototype.ea=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Ta.prototype.oa=function(t){return this.zo(t).next(function(t){return t.targetCount})},Ta.prototype.aa=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),s=null;return Na(t).wo({range:n,index:Za.queryTargetsIndexName},function(t,e,n){var r=o.serializer.ra(e);i.isEqual(r.target)&&(s=r,n.done())}).next(function(){return s})},Ta.prototype.ua=function(n,t,r){var i=this,o=[],s=Sa(n);return t.forEach(function(t){var e=Yu(t.path);o.push(s.put(new th(r,e))),o.push(i.mo.Vn(n,t))}),pu.qn(o)},Ta.prototype.ca=function(n,t,r){var i=this,o=Sa(n);return pu.forEach(t,function(t){var e=Yu(t.path);return pu.qn([o.delete([r,e]),i.mo.pn(n,t)])})},Ta.prototype.na=function(t,e){var n=Sa(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},Ta.prototype._a=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Sa(t),o=ms();return r.wo({range:n,Io:!0},function(t,e,n){var r=$u(t[1]),i=new Xr(r);o=o.add(i)}).next(function(){return o})},Ta.prototype.Cn=function(t,e){var n=Yu(e.path),r=IDBKeyRange.bound([n],[ou(n)],!1,!0),i=0;return Sa(t).wo({index:th.documentTargetsIndex,Io:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Ta.prototype.si=function(t,e){var n=this;return Na(t).get(e).next(function(t){return t?n.serializer.ra(t):null})},Ta);function Ta(t,e){this.mo=t,this.serializer=e}function Ia(t){this.Wo=t}function Na(t){return ph.ro(t,Za.store)}function _a(t){return ta.ro(t,eh.store).get(eh.key).next(function(t){return Zs(null!==t),t})}function Aa(t){return _a(t).next(function(t){return t.highestListenSequenceNumber})}function Sa(t){return ph.ro(t,th.store)}var Da,xa=(ka.prototype.Kn=function(t,e,n){return Ra(t).put(La(e),n)},ka.prototype.zn=function(t,e){var n=Ra(t),r=La(e);return n.delete(r)},ka.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.la(e,t)})},ka.prototype.Hn=function(t,e){var n=this;return Ra(t).get(La(e)).next(function(t){return n.da(t)})},ka.prototype.fa=function(t,e){var n=this;return Ra(t).get(La(e)).next(function(t){var e=n.da(t);return e?{Ta:e,size:Pa(t)}:null})},ka.prototype.getEntries=function(t,e){var r=this,i=fs();return this.Ea(t,e,function(t,e){var n=r.da(e);i=i.me(t,n)}).next(function(){return i})},ka.prototype.Ia=function(t,e){var r=this,i=fs(),o=new $o(Xr.N);return this.Ea(t,e,function(t,e){var n=r.da(e);o=n?(i=i.me(t,n),o.me(t,Pa(e))):(i=i.me(t,null),o.me(t,0))}).next(function(){return{wa:i,Ra:o}})},ka.prototype.Ea=function(t,e,i){if(e.B())return pu.resolve();var n=IDBKeyRange.bound(e.first().path.W(),e.last().path.W()),o=e.be(),s=o.Ne();return Ra(t).wo({range:n},function(t,e,n){for(var r=Xr.st(t);s&&Xr.N(s,r)<0;)i(s,null),s=o.Ne();s&&s.isEqual(r)&&(i(s,e),s=o.ke()?o.Ne():null),s?n.lo(s.path.W()):n.done()}).next(function(){for(;s;)i(s,null),s=o.ke()?o.Ne():null})},ka.prototype.lr=function(t,i,e){var o=this,s=ps(),u=i.path.length+1,n={};if(e.isEqual(Pr.min())){var r=i.path.W();n.range=IDBKeyRange.lowerBound(r)}else{var a=i.path.W(),h=this.serializer.ma(e);n.range=IDBKeyRange.lowerBound([a,h],!0),n.index=Ja.collectionReadTimeIndex}return Ra(t).wo(n,function(t,e,n){if(t.length===u){var r=o.serializer.Aa(e);i.path.q(r.key.path)?r instanceof To&&i.matches(r)&&(s=s.me(r.key,r)):n.done()}}).next(function(){return s})},ka.prototype.Pa=function(t,e){var r=this,i=cs(),o=this.serializer.ma(e),n=Ra(t),s=IDBKeyRange.lowerBound(o,!0);return n.wo({index:Ja.readTimeIndex,range:s},function(t,e){var n=r.serializer.Aa(e);i=i.me(n.key,n),o=e.readTime}).next(function(){return{Va:i,readTime:r.serializer.ga(o)}})},ka.prototype.pa=function(t){var r=this,e=Ra(t),i=Pr.min();return e.wo({index:Ja.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(i=r.serializer.ga(e.readTime)),n.done()}).next(function(){return i})},ka.prototype.ya=function(t){return new ka.ba(this,!!t&&t.va)},ka.prototype.Sa=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},ka.prototype.getMetadata=function(t){return Oa(t).get($a.key).next(function(t){return Zs(!!t),t})},ka.prototype.la=function(t,e){return Oa(t).put($a.key,e)},ka.prototype.da=function(t){if(t){var e=this.serializer.Aa(t);return e instanceof Io&&e.version.isEqual(Pr.min())?null:e}return null},ka);function ka(t,e){this.serializer=t,this.nr=e}function Oa(t){return ph.ro(t,$a.store)}function Ra(t){return ph.ro(t,Ja.store)}function La(t){return t.path.W()}function Pa(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw $s();e=t.noDocument}return JSON.stringify(e).length}function Va(t,e){var n=this;return(n=Da.call(this)||this).Da=t,n.va=e,n.Ca=new au(function(t){return t.toString()}),n}xa.ba=(n(Va,Da=du),Va.prototype.Xn=function(s){var u=this,a=[],h=0,c=new os(function(t,e){return ru(t.j(),e.j())});return this.Qn.forEach(function(t,e){var n=u.Ca.get(t);if(e){var r=u.Da.serializer.Fa(e,u.readTime);c=c.add(t.path.M());var i=Pa(r);h+=i-n,a.push(u.Da.Kn(s,t,r))}else if(h-=n,u.va){var o=u.Da.serializer.Fa(new Io(t,Pr.min()),u.readTime);a.push(u.Da.Kn(s,t,o))}else a.push(u.Da.zn(s,t))}),c.forEach(function(t){a.push(u.Da.nr.Co(s,t))}),a.push(this.Da.updateMetadata(s,h)),pu.qn(a)},Va.prototype.Yn=function(t,e){var n=this;return this.Da.fa(t,e).next(function(t){return null===t?(n.Ca.set(e,0),null):(n.Ca.set(e,t.size),t.Ta)})},Va.prototype.Jn=function(t,e){var n=this;return this.Da.Ia(t,e).next(function(t){var e=t.wa;return t.Ra.forEach(function(t,e){n.Ca.set(t,e)}),e})},Va);function Ma(t,e){this.seconds=t,this.nanoseconds=e}var Ca=(Ga.prototype.Co=function(t,e){return this.Na.add(e),pu.resolve()},Ga.prototype.Ir=function(t,e){return pu.resolve(this.Na.getEntries(e))},Ga),qa=(za.prototype.add=function(t){var e=t.O(),n=t.M(),r=this.index[e]||new os(Mr.N),i=!r.has(n);return this.index[e]=r.add(n),i},za.prototype.has=function(t){var e=t.O(),n=t.M(),r=this.index[e];return r&&r.has(n)},za.prototype.getEntries=function(t){return(this.index[t]||new os(Mr.N)).W()},za),Ua=10,ja=(Fa.prototype.createOrUpgrade=function(n,r,t,e){var i=this;Zs(t<e&&0<=t&&e<=Ua);var o,s=new ra(r);t<1&&1<=e&&(n.createObjectStore(Ba.store),(o=n).createObjectStore(Ha.store,{keyPath:Ha.keyPath}),o.createObjectStore(Qa.store,{keyPath:Qa.keyPath,autoIncrement:!0}).createIndex(Qa.userMutationsIndex,Qa.userMutationsKeyPath,{unique:!0}),o.createObjectStore(Wa.store),rh(n),n.createObjectStore(Ja.store));var u,a=pu.resolve();return t<3&&3<=e&&(0!==t&&((u=n).deleteObjectStore(th.store),u.deleteObjectStore(Za.store),u.deleteObjectStore(eh.store),rh(n)),a=a.next(function(){return t=s.store(eh.store),e=new eh(0,0,Pr.min().C(),0),t.put(eh.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(a=a.next(function(){return r=n,(i=s).store(Qa.store).fo().next(function(t){r.deleteObjectStore(Qa.store),r.createObjectStore(Qa.store,{keyPath:Qa.keyPath,autoIncrement:!0}).createIndex(Qa.userMutationsIndex,Qa.userMutationsKeyPath,{unique:!0});var e=i.store(Qa.store),n=t.map(function(t){return e.put(t)});return pu.qn(n)});var r,i})),a=a.next(function(){n.createObjectStore(ih.store,{keyPath:ih.keyPath})})),t<5&&5<=e&&(a=a.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(a=a.next(function(){return n.createObjectStore($a.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(a=a.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(a=a.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(a=a.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(Ja.store)).createIndex(Ja.readTimeIndex,Ja.readTimeIndexPath,{unique:!1}),t.createIndex(Ja.collectionReadTimeIndex,Ja.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=e&&(a=a.next(function(){return i.rewriteCanonicalIds(s)})),a},Fa.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Ja.store).wo(function(t,e){n+=Pa(e)}).next(function(){var t=new $a(n);return e.store($a.store).put($a.key,t)})},Fa.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(Ha.store),e=r.store(Qa.store);return t.fo().next(function(t){return pu.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.fo(Qa.userMutationsIndex,t).next(function(t){return pu.forEach(t,function(t){Zs(t.userId===n.userId);var e=i.serializer.No(t);return va(r,n.userId,e).next(function(){})})})})})},Fa.prototype.ensureSequenceNumbers=function(t){var s=t.store(th.store),e=t.store(Ja.store);return Aa(t).next(function(i){var o=[];return e.wo(function(t,e){var n=new Mr(t),r=[0,Yu(n)];o.push(s.get(r).next(function(t){return t?pu.resolve():(e=n,s.put(new th(0,Yu(e),i)));var e}))}).next(function(){return pu.qn(o)})})},Fa.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.O(),n=t.M();return r.put({collectionId:e,parent:Yu(n)})}}t.createObjectStore(nh.store,{keyPath:nh.keyPath});var r=e.store(nh.store),o=new qa;return e.store(Ja.store).wo({Io:!0},function(t,e){var n=new Mr(t);return i(n.M())}).next(function(){return e.store(Wa.store).wo({Io:!0},function(t,e){t[0];var n=t[1],r=(t[2],$u(n));return i(r.M())})})},Fa.prototype.rewriteCanonicalIds=function(t){var i=this,o=t.store(Za.store);return o.wo(function(t,e){var n=i.serializer.ra(e),r=i.serializer.ha(n);return o.put(r)})},Fa),Ba=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function Fa(t){this.serializer=t}function za(){this.index={}}function Ga(){this.Na=new qa}Ba.store="owner",Ba.key="owner";var Ha=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Ha.store="mutationQueues",Ha.keyPath="userId";var Qa=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Qa.store="mutations",Qa.keyPath="batchId",Qa.userMutationsIndex="userMutationsIndex",Qa.userMutationsKeyPath=["userId","batchId"];var Wa=(Ka.prefixForUser=function(t){return[t]},Ka.prefixForPath=function(t,e){return[t,Yu(e)]},Ka.key=function(t,e,n){return[t,Yu(e),n]},Ka);function Ka(){}Wa.store="documentMutations",Wa.PLACEHOLDER=new Wa;function Ya(t,e){this.path=t,this.readTime=e}function Xa(t,e){this.path=t,this.version=e}var Ja=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Ja.store="remoteDocuments",Ja.readTimeIndex="readTimeIndex",Ja.readTimeIndexPath="readTime",Ja.collectionReadTimeIndex="collectionReadTimeIndex",Ja.collectionReadTimeIndexPath=["parentPath","readTime"];var $a=function(t){this.byteSize=t};$a.store="remoteDocumentGlobal",$a.key="remoteDocumentGlobalKey";var Za=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Za.store="targets",Za.keyPath="targetId",Za.queryTargetsIndexName="queryTargetsIndex",Za.queryTargetsKeyPath=["canonicalId","targetId"];var th=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};th.store="targetDocuments",th.keyPath=["targetId","path"],th.documentTargetsIndex="documentTargetsIndex",th.documentTargetsKeyPath=["path","targetId"];var eh=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};eh.key="targetGlobalKey",eh.store="targetGlobal";var nh=function(t,e){this.collectionId=t,this.parent=e};function rh(t){t.createObjectStore(th.store,{keyPath:th.keyPath}).createIndex(th.documentTargetsIndex,th.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Za.store,{keyPath:Za.keyPath}).createIndex(Za.queryTargetsIndexName,Za.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(eh.store)}nh.store="collectionParents",nh.keyPath=["collectionId","parent"];var ih=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};ih.store="clientMetadata",ih.keyPath="clientId";var oh=i(i(i([Ha.store,Qa.store,Wa.store,Ja.store,Za.store,Ba.store,eh.store,th.store],[ih.store]),[$a.store]),[nh.store]),sh=(uh.prototype.Co=function(t,e){var n=this;if(this.ka.has(e))return pu.resolve();var r=e.O(),i=e.M();t.tr(function(){n.ka.add(e)});var o={collectionId:r,parent:Yu(i)};return ah(t).put(o)},uh.prototype.Ir=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[ou(i),""],!1,!0);return ah(t).fo(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push($u(r.parent))}return o})},uh);function uh(){this.ka=new qa}function ah(t){return ph.ro(t,nh.store)}var hh,ch=(vh.prototype.Aa=function(t){if(t.document)return this.$a.Ai(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Xr.st(t.noDocument.path),n=this.Ma(t.noDocument.readTime);return new Io(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){var r=Xr.st(t.unknownDocument.path),i=this.Ma(t.unknownDocument.version);return new No(r,i)}return $s()},vh.prototype.Fa=function(t,e){var n=this.ma(e),r=t.key.path.M().W();if(t instanceof To){var i=this.$a.mi(t),o=t.hasCommittedMutations;return new Ja(null,null,i,o,n,r)}if(t instanceof Io){var s=t.key.path.W(),u=this.La(t.version),a=t.hasCommittedMutations;return new Ja(null,new Ya(s,u),null,a,n,r)}if(t instanceof No){var h=t.key.path.W(),c=this.La(t.version);return new Ja(new Xa(h,c),null,null,!0,n,r)}return $s()},vh.prototype.ma=function(t){var e=t.C();return[e.seconds,e.nanoseconds]},vh.prototype.ga=function(t){var e=new Lr(t[0],t[1]);return Pr.v(e)},vh.prototype.La=function(t){var e=t.C();return new Ma(e.seconds,e.nanoseconds)},vh.prototype.Ma=function(t){var e=new Lr(t.seconds,t.nanoseconds);return Pr.v(e)},vh.prototype.Do=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.$a.vi(t)}),i=e.mutations.map(function(t){return n.$a.vi(t)});return new Qa(t,e.batchId,e.fn.toMillis(),r,i)},vh.prototype.No=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.$a.Fi(t)}),r=t.mutations.map(function(t){return e.$a.Fi(t)}),i=Lr.fromMillis(t.localWriteTimeMs);return new hu(t.batchId,i,n,r)},vh.prototype.ra=function(t){var e,n=this.Ma(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.Ma(t.lastLimboFreeSnapshotVersion):Pr.min();return e=void 0!==t.query.documents?this.$a.Oi(t.query):this.$a.Wi(t.query),new Vo(e,t.targetId,0,t.lastListenSequenceNumber,n,r,ei.fromBase64String(t.resumeToken))},vh.prototype.ha=function(t){var e,n=this.La(t.Ee),r=this.La(t.lastLimboFreeSnapshotVersion);e=t.target.xt()?this.$a.xi(t.target):this.$a.Bi(t.target);var i=t.resumeToken.toBase64();return new Za(t.targetId,t.target.canonicalId(),n,i,t.sequenceNumber,r,e)},vh),fh="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",lh=(n(yh,hh=vu),yh),ph=(dh.ro=function(t,e){if(t instanceof lh)return ta.ro(t.Bo,e);throw $s()},dh.prototype.start=function(){var e=this;return ta.to(this.Ka,Ua,new ja(this.serializer)).then(function(t){return e.Ya=t,e.Ja(e.force)}).then(function(){return e.Xa(),e.Za(),e.tu(),e.Ya.runTransaction("readonly",[eh.store],function(t){return Aa(t)})}).then(function(t){e.eu=new wu(t,e.Oa)}).then(function(){e.Ba=!0}).catch(function(t){return e.Ya&&e.Ya.close(),Promise.reject(t)})},dh.prototype.su=function(n){var t=this;return this.ja=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.qh?[2,n(e)]:[2]})})},n(this.isPrimary)},dh.prototype.iu=function(n){var t=this;this.Ya.ho(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},dh.prototype.nu=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.vr.zr(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.qh?[4,this.Ja()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},dh.prototype.Ja=function(t){var n=this;return void 0===t&&(t=!1),this.Ya.runTransaction("readwrite",oh,function(e){return gh(e).put(new ih(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.ru(e).next(function(t){t||(n.isPrimary=!1,n.vr.zr(function(){return n.ja(!1)}))})}).next(function(){return!!t||n.hu(e)}).next(function(t){return n.isPrimary&&!t?n.ou(e).next(function(){return!1}):!!t&&n.au(e).next(function(){return!0})})}).catch(function(t){if(!n.allowTabSynchronization)throw t;return Ys("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.vr.zr(function(){return n.ja(t)}),n.isPrimary=t})},dh.prototype.ru=function(t){var e=this;return mh(t).get(Ba.key).next(function(t){return pu.resolve(e.uu(t))})},dh.prototype.cu=function(t){return gh(t).delete(this.clientId)},dh.prototype._u=function(){return y(this,void 0,void 0,function(){var e,i=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.lu(this.Wa,18e5)?[3,2]:(this.Wa=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=dh.ro(t,ih.store);return r.fo().next(function(t){var e=i.du(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return pu.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:e=t.sent(),this.Ha&&e.forEach(function(t){i.Ha.removeItem(i.fu(t.clientId))}),t.label=2;case 2:return[2]}})})},dh.prototype.tu=function(){var t=this;this.Qa=this.vr.Or("client_metadata_refresh",4e3,function(){return t.Ja().then(function(){return t._u()}).then(function(){return t.tu()})})},dh.prototype.uu=function(t){return!!t&&t.ownerId===this.clientId},dh.prototype.hu=function(e){var i=this;return mh(e).get(Ba.key).next(function(t){if(null!==t&&i.lu(t.leaseTimestampMs,5e3)&&!i.Tu(t.ownerId)){if(i.uu(t)&&i.networkEnabled)return!0;if(!i.uu(t)){if(i.force)return!0;if(!t.allowTabSynchronization)throw new Dr(Sr.FAILED_PRECONDITION,fh);return!1}}return!(!i.networkEnabled||!i.inForeground)||gh(e).fo().next(function(t){return void 0===i.du(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Ys("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},dh.prototype.Eu=function(){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.Ba=!1,this.Iu(),this.Qa&&(this.Qa.cancel(),this.Qa=null),this.wu(),this.Ru(),[4,this.Ya.runTransaction("readwrite",[Ba.store,ih.store],function(t){return e.ou(t).next(function(){return e.cu(t)})})];case 1:return t.sent(),this.Ya.close(),this.mu(),[2]}})})},dh.prototype.du=function(t,e){var n=this;return t.filter(function(t){return n.lu(t.updateTimeMs,e)&&!n.Tu(t.clientId)})},dh.prototype.Au=function(){var e=this;return this.Ya.runTransaction("readonly",[ih.store],function(t){return gh(t).fo().next(function(t){return e.du(t,18e5).map(function(t){return t.clientId})})})},dh.clearPersistence=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return dh.eo()?(e=n+dh.Ga,[4,ta.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(dh.prototype,"qh",{get:function(){return this.Ba},enumerable:!0,configurable:!0}),dh.prototype.Pu=function(t){return pa.Po(t,this.serializer,this.nr,this.mo)},dh.prototype.Vu=function(){return this.za},dh.prototype.gu=function(){return this.sr},dh.prototype.pu=function(){return this.nr},dh.prototype.runTransaction=function(n,t,r){var i=this;Ys("IndexedDbPersistence","Starting transaction:",n);var o,e="readonly"===t?"readonly":"readwrite";return this.Ya.runTransaction(e,oh,function(e){return o=new lh(e,i.eu.next()),"readwrite-primary"===t?i.ru(e).next(function(t){return!!t||i.hu(e)}).next(function(t){if(!t)throw Xs("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.vr.zr(function(){return i.ja(!1)}),new Dr(Sr.FAILED_PRECONDITION,yu);return r(o)}).next(function(t){return i.au(e).next(function(){return t})}):i.yu(e).next(function(){return r(o)})}).then(function(t){return o.er(),t})},dh.prototype.yu=function(t){var e=this;return mh(t).get(Ba.key).next(function(t){if(null!==t&&e.lu(t.leaseTimestampMs,5e3)&&!e.Tu(t.ownerId)&&!e.uu(t)&&!t.allowTabSynchronization)throw new Dr(Sr.FAILED_PRECONDITION,fh)})},dh.prototype.au=function(t){var e=new Ba(this.clientId,this.allowTabSynchronization,Date.now());return mh(t).put(Ba.key,e)},dh.eo=function(){return ta.eo()},dh.bu=function(t){var e=t.ii.projectId;return t.ii._n||(e+="."+t.ii.database),"firestore/"+t.persistenceKey+"/"+e+"/"},dh.prototype.ou=function(t){var e=this,n=mh(t);return n.get(Ba.key).next(function(t){return e.uu(t)?(Ys("IndexedDbPersistence","Releasing primary lease."),n.delete(Ba.key)):pu.resolve()})},dh.prototype.lu=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Xs("Detected an update time that is in the future: "+t+" > "+n),1))},dh.prototype.Xa=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ua=function(){t.vr.zr(function(){return t.inForeground="visible"===t.document.visibilityState,t.Ja()})},this.document.addEventListener("visibilitychange",this.Ua),this.inForeground="visible"===this.document.visibilityState)},dh.prototype.wu=function(){this.Ua&&(this.document.removeEventListener("visibilitychange",this.Ua),this.Ua=null)},dh.prototype.Za=function(){var t=this;this.window&&"function"==typeof this.window.addEventListener&&(this.qa=function(){t.Iu(),t.vr.zr(function(){return t.Eu()})},this.window.addEventListener("unload",this.qa))},dh.prototype.Ru=function(){this.window&&this.qa&&(this.window.removeEventListener("unload",this.qa),this.qa=null)},dh.prototype.Tu=function(t){if(!this.Ha)return!1;try{var e=null!==this.Ha.getItem(this.fu(t));return Ys("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Xs("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},dh.prototype.Iu=function(){if(this.Ha)try{this.Ha.setItem(this.fu(this.clientId),String(Date.now()))}catch(t){Xs("Failed to set zombie client id.",t)}},dh.prototype.mu=function(){if(this.Ha)try{this.Ha.removeItem(this.fu(this.clientId))}catch(t){}},dh.prototype.fu=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},dh);function dh(t,e,n,r,i,o,s,u,a){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.vr=o,this.Oa=u,this.force=a,this.Ba=!1,this.isPrimary=!1,this.networkEnabled=!0,this.qa=null,this.inForeground=!1,this.Ua=null,this.Qa=null,this.Wa=Number.NEGATIVE_INFINITY,this.ja=function(t){return Promise.resolve()},!dh.eo())throw new Dr(Sr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.mo=new wh(this,i),this.Ka=e+dh.Ga,this.serializer=new ch(s),this.document=r.document,this.za=new Ea(this.mo,this.serializer),this.nr=new sh,this.sr=new xa(this.serializer,this.nr),this.window=r.window,r.window&&r.window.localStorage?this.Ha=r.window.localStorage:(this.Ha=null,!1===a&&Xs("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function yh(t,e){var n=this;return(n=hh.call(this)||this).Bo=t,n.xa=e,n}function vh(t){this.$a=t}function mh(t){return t.store(Ba.store)}function gh(t){return t.store(ih.store)}ph.Ga="main";var wh=(bh.prototype.jh=function(t){var n=this.Su(t);return this.db.Vu().oa(t).next(function(e){return n.next(function(t){return e+t})})},bh.prototype.Su=function(t){var e=0;return this.Gh(t,function(t){e++}).next(function(){return e})},bh.prototype.js=function(t,e){return this.db.Vu().js(t,e)},bh.prototype.Gh=function(t,n){return this.Du(t,function(t,e){return n(e)})},bh.prototype.Cu=function(t){this.vu=t},bh.prototype.Vn=function(t,e){return Eh(t,e)},bh.prototype.pn=function(t,e){return Eh(t,e)},bh.prototype.zh=function(t,e,n){return this.db.Vu().zh(t,e,n)},bh.prototype.Uo=function(t,e){return Eh(t,e)},bh.prototype.Fu=function(t,e){return this.vu.Cn(e)?pu.resolve(!0):(r=e,i=!1,wa(n=t).Ro(function(t){return ya(n,t,r).next(function(t){return t&&(i=!0),pu.resolve(!t)})}).next(function(){return i}));var n,r,i},bh.prototype.Hh=function(r,i){var o=this,s=this.db.gu().ya(),u=[],a=0;return this.Du(r,function(e,t){if(t<=i){var n=o.Fu(r,e).next(function(t){if(!t)return a++,s.Hn(r,e).next(function(){return s.zn(e),Sa(r).delete([0,Yu(e.path)])})});u.push(n)}}).next(function(){return pu.qn(u)}).next(function(){return s.apply(r)}).next(function(){return a})},bh.prototype.removeTarget=function(t,e){var n=e.Ie(t.xa);return this.db.Vu().sa(t,n)},bh.prototype.Nu=function(t,e){return Eh(t,e)},bh.prototype.Du=function(t,o){var s,e=Sa(t),u=wu.br;return e.wo({index:th.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(u!==wu.br&&o(new Xr($u(s)),u),u=i,s=r):u=wu.br}).next(function(){u!==wu.br&&o(new Xr($u(s)),u)})},bh.prototype.Jh=function(t){return this.db.gu().Sa(t)},bh);function bh(t,e){this.db=t,this.vu=null,this.Mh=new Qu(this,e)}function Eh(t,e){return Sa(t).put((n=e,r=t.xa,new th(0,Yu(n.path),r)));var n,r}var Th=(Ih.prototype.start=function(){return Promise.resolve()},Ih.prototype.Uu=function(i){return y(this,void 0,void 0,function(){var e,g,n,r=this;return v(this,function(t){switch(t.label){case 0:return e=this.ir,g=this.Bu,[4,this.persistence.runTransaction("Handle user change","readonly",function(v){var m;return r.ir.Lo(v).next(function(t){return m=t,e=r.persistence.Pu(i),g=new mu(r.Ou,e,r.persistence.pu()),e.Lo(v)}).next(function(t){for(var e=[],n=[],r=ms(),i=0,o=m;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++){var h=a[u];r=r.add(h.key)}}for(var c=0,f=t;c<f.length;c++){var l=f[c];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return g.ur(v,r).next(function(t){return{Qu:t,Wu:e,ju:n}})})})];case 1:return n=t.sent(),[2,(this.ir=e,this.Bu=g,this.ku.qu(this.Bu),n)]}})})},Ih.prototype.Ku=function(u){var a,h=this,c=Lr.now(),t=u.reduce(function(t,e){return t.add(e.key)},ms());return this.persistence.runTransaction("Locally write mutations","readwrite",function(s){return h.Bu.ur(s,t).next(function(t){a=t;for(var e=[],n=0,r=u;n<r.length;n++){var i=r[n],o=i.Pt(a.get(i.key));null!=o&&e.push(new Gi(i.key,o,uo(o.proto.mapValue),Bi.exists(!0)))}return h.ir.So(s,c,e,u)})}).then(function(t){var e=t.En(a);return{batchId:t.batchId,Qn:e}})},Ih.prototype.po=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.Ou.ya({va:!0});return i.ir.po(t,r.batch,r.streamToken).next(function(){return i.Gu(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.ir.Qo(t)}).next(function(){return i.Bu.ur(t,e)})})},Ih.prototype.zu=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.ir.Fo(e,t).next(function(t){return Zs(null!==t),n=t.keys(),r.ir.Oo(e,t)}).next(function(){return r.ir.Qo(e)}).next(function(){return r.Bu.ur(e,n)})})},Ih.prototype.Mo=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.ir.Mo(t)})},Ih.prototype.bo=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly",function(t){return e.ir.bo(t)})},Ih.prototype.vo=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(t){return n.ir.vo(t,e)})},Ih.prototype.Yo=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.za.Yo(t)})},Ih.prototype.Hu=function(a){var h=this,c=a.Ee,f=this.Mu;return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var i=h.Ou.ya({va:!0});f=h.Mu;var s=[];a.as.forEach(function(t,e){var n=f.get(e);if(n){s.push(h.za.ca(o,t.Is,e).next(function(){return h.za.ua(o,t.Ts,e)}));var r=t.resumeToken;if(0<r.rt()){var i=n.we(r,c).Ie(o.xa);f=f.me(e,i),Ih.Yu(n,i,t)&&s.push(h.za.sa(o,i))}}});var u=cs(),n=ms();if(a.cs.forEach(function(t,e){n=n.add(t)}),s.push(i.getEntries(o,n).next(function(r){a.cs.forEach(function(t,e){var n=r.get(t);e instanceof Io&&e.version.isEqual(Pr.min())?(i.zn(t,c),u=u.me(t,e)):null==n||0<e.version.S(n.version)||0===e.version.S(n.version)&&n.hasPendingWrites?(i.Kn(e,c),u=u.me(t,e)):Ys("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),a._s.has(t)&&s.push(h.persistence.mo.Nu(o,t))})})),!c.isEqual(Pr.min())){var t=h.za.Yo(o).next(function(t){return h.za.Xo(o,o.xa,c)});s.push(t)}return pu.qn(s).next(function(){return i.apply(o)}).next(function(){return h.Bu.cr(o,u)})}).then(function(t){return h.Mu=f,t})},Ih.Yu=function(t,e,n){return Zs(0<e.resumeToken.rt()),0===t.resumeToken.rt()||e.Ee.D()-t.Ee.D()>=this.Ju||0<n.Ts.size+n.Es.size+n.Is.size},Ih.prototype.Xu=function(t){for(var n=this,e=0,r=t;e<r.length;e++){var i=r[e],o=i.targetId;if(this.$u.gn(i.mr,o),this.$u.bn(i.Ar,o),!i.fromCache){var s=this.Mu.get(o),u=s.Ee,a=s.Re(u);this.Mu=this.Mu.me(o,a)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(e){return pu.forEach(t,function(t){return pu.forEach(t.Ar,function(t){return n.persistence.mo.pn(e,t)})})})},Ih.prototype.Zu=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.ir.$o(t,e)})},Ih.prototype.tc=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.Bu.rr(t,e)})},Ih.prototype.ec=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.za.aa(e,r).next(function(t){return t?(n=t,pu.resolve(n)):i.za.Go(e).next(function(t){return n=new Vo(r,t,0,e.xa),i.za.Zo(e,n).next(function(){return n})})})}).then(function(t){return null===i.Mu.get(t.targetId)&&(i.Mu=i.Mu.me(t.targetId,t),i.Lu.set(r,t.targetId)),t})},Ih.prototype.aa=function(t,e){var n=this.Lu.get(e);return void 0!==n?pu.resolve(this.Mu.get(n)):this.za.aa(t,e)},Ih.prototype.sc=function(n,r){var i=this,o=this.Mu.get(n),t=r?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release target",t,function(e){var t=i.$u.vn(n);return r?pu.resolve():pu.forEach(t,function(t){return i.persistence.mo.pn(e,t)}).next(function(){i.persistence.mo.removeTarget(e,o)})}).then(function(){i.Mu=i.Mu.remove(n),i.Lu.delete(o.target)})},Ih.prototype.ic=function(t,n){var r=this,i=Pr.min(),o=ms();return this.persistence.runTransaction("Execute query","readonly",function(e){return r.aa(e,t.ee()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.za._a(e,t.targetId).next(function(t){o=t})}).next(function(){return r.ku.lr(e,t,n?i:Pr.min(),n?o:ms())}).next(function(t){return{documents:t,nc:o}})})},Ih.prototype.rc=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly",function(t){return n.za._a(t,e)})},Ih.prototype.Gu=function(t,i,o){var e=this,s=i.batch,n=s.keys(),u=pu.resolve();return n.forEach(function(r){u=u.next(function(){return o.Hn(t,r)}).next(function(t){var e=t,n=i.wn.get(r);Zs(null!==n),(!e||e.version.S(n)<0)&&(e=s.at(r,e,i))&&o.Kn(e,i.In)})}),u.next(function(){return e.ir.Oo(t,s)})},Ih.prototype.Uh=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.Yh(t,n.Mu)})},Ih);function Ih(t,e,n){this.persistence=t,this.ku=e,this.$u=new fu,this.Mu=new $o(ru),this.Lu=new au(function(t){return t.canonicalId()}),this.xu=Pr.min(),this.persistence.mo.Cu(this.$u),this.ir=t.Pu(n),this.Ou=t.gu(),this.za=t.Vu(),this.Bu=new mu(this.Ou,this.ir,this.persistence.pu()),this.ku.qu(this.Bu)}Th.Ju=3e8;var Nh,_h=(n(Ah,Nh=Th),Ah.prototype.start=function(){return this.hc()},Ah.prototype.oc=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return n.ir.ko(e,t).next(function(t){return t?n.Bu.ur(e,t):pu.resolve(null)})})},Ah.prototype.ac=function(t){this.ir.qo(t)},Ah.prototype.nu=function(t){this.persistence.nu(t)},Ah.prototype.Au=function(){return this.persistence.Au()},Ah.prototype.uc=function(e){var n=this,t=this.Mu.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly",function(t){return n.za.si(t,e).next(function(t){return t?t.target:null})})},Ah.prototype.Pa=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return r.Ou.Pa(t,r.xu)}).then(function(t){var e=t.Va,n=t.readTime;return r.xu=n,e})},Ah.prototype.hc=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,(e=this).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return n.Ou.pa(t)})];case 1:return e.xu=t.sent(),[2]}})})},Ah);function Ah(t,e,n){var r=this;return(r=Nh.call(this,t,e,n)||this).persistence=t,r.ir=t.Pu(n),r.Ou=t.gu(),r.za=t.Vu(),r}function Sh(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==Sr.FAILED_PRECONDITION||e.message!==yu)throw e;return Ys("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Dh(t,e){if(0!==e.length)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Hh(e.length,"argument")+".")}function xh(t,e,n){if(e.length!==n)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires "+Hh(n,"argument")+", but was called with "+Hh(e.length,"argument")+".")}function kh(t,e,n){if(e.length<n)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Hh(n,"argument")+", but was called with "+Hh(e.length,"argument")+".")}function Oh(t,e,n,r){if(e.length<n||e.length>r)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Hh(e.length,"argument")+".")}function Rh(t,e,n,r){Ch(t,e,Gh(n)+" argument",r)}function Lh(t,e,n,r){void 0!==r&&Rh(t,e,n,r)}function Ph(t,e,n,r){Ch(t,e,n+" option",r)}function Vh(t,e,n,r){void 0!==r&&Ph(t,e,n,r)}function Mh(t,e,n,r,a){void 0!==r&&function(t,e,n){for(var r=[],i=0,o=a;i<o.length;i++){var s=o[i];if(s===n)return;r.push(Uh(s))}var u=Uh(n);throw new Dr(Sr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function Ch(t,e,n,r){if(!("object"===e?qh(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Uh(r);throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function qh(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Uh(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":$s();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function jh(t,e,n){if(void 0===n)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Gh(e)+" argument, but it was undefined.")}function Bh(n,t,r){Zr(t,function(t,e){if(r.indexOf(t)<0)throw new Dr(Sr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function Fh(t,e,n,r){var i=Uh(r);return new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Gh(n)+" argument to be a "+e+", but it was: "+i)}function zh(t,e,n){if(n<=0)throw new Dr(Sr.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+Gh(e)+" argument to be a positive number, but it was: "+n+".")}function Gh(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Hh(t,e){return t+" "+e+(1===t?"":"s")}function Qh(){if("undefined"==typeof Uint8Array)throw new Dr(Sr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Wh(){if(!Gs.nt().cc)throw new Dr(Sr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Kh=(Jh.fromBase64String=function(t){xh("Blob.fromBase64String",arguments,1),Rh("Blob.fromBase64String","string",1,t),Wh();try{return new Jh(ei.fromBase64String(t))}catch(t){throw new Dr(Sr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Jh.fromUint8Array=function(t){if(xh("Blob.fromUint8Array",arguments,1),Qh(),!(t instanceof Uint8Array))throw Fh("Blob.fromUint8Array","Uint8Array",1,t);return new Jh(ei.fromUint8Array(t))},Jh.prototype.toBase64=function(){return xh("Blob.toBase64",arguments,0),Wh(),this._c.toBase64()},Jh.prototype.toUint8Array=function(){return xh("Blob.toUint8Array",arguments,0),Qh(),this._c.toUint8Array()},Jh.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Jh.prototype.isEqual=function(t){return this._c.isEqual(t._c)},Jh),Yh=(Xh.documentId=function(){return Xh.dc},Xh.prototype.isEqual=function(t){if(!(t instanceof Xh))throw Fh("isEqual","FieldPath",1,t);return this.lc.isEqual(t.lc)},Xh);function Xh(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(){if(!(t instanceof Array)||t.length<1)throw new Dr(Sr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var n=0;n<t.length;++n)if(Rh("FieldPath","string",n,t[n]),0===t[n].length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.lc=new Kr(t)}function Jh(t){Wh(),this._c=t}Yh.dc=new Yh(Kr.J().j());var $h,Zh,tc,ec,nc,rc=new RegExp("[~\\*/\\[\\]]"),ic=function(t){this.fc=t},oc=(n(Ec,nc=ic),Ec.prototype.Di=function(t){if(2!==t.Tc)throw 1===t.Tc?t.Ec("FieldValue.delete() can only appear at the top level of your update data"):t.Ec("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");return t.Vt.push(t.path),null},Ec.prototype.isEqual=function(t){return t instanceof Ec},Ec),sc=(n(bc,ec=ic),bc.prototype.Di=function(t){return new ji(t.path,Ni.instance)},bc.prototype.isEqual=function(t){return t instanceof bc},bc),uc=(n(wc,tc=ic),wc.prototype.Di=function(t){var n=t.wc({Tc:3,methodName:this.fc}),e=this.Ic.map(function(t,e){return Sc(t,n.Rc(e))}),r=new Ai(e);return new ji(t.path,r)},wc.prototype.isEqual=function(t){return this===t},wc),ac=(n(gc,Zh=ic),gc.prototype.Di=function(t){var n=t.wc({Tc:3,methodName:this.fc}),e=this.Ic.map(function(t,e){return Sc(t,n.Rc(e))}),r=new Si(e);return new ji(t.path,r)},gc.prototype.isEqual=function(t){return this===t},gc),hc=(n(mc,$h=ic),mc.prototype.Di=function(t){t.wc({methodName:this.fc});var e=Sc(this.mc,t),n=new Di(t.serializer,e);return new ji(t.path,n)},mc.prototype.isEqual=function(t){return this===t},mc),cc=(Object.defineProperty(vc.prototype,"latitude",{get:function(){return this.Ac},enumerable:!0,configurable:!0}),Object.defineProperty(vc.prototype,"longitude",{get:function(){return this.Pc},enumerable:!0,configurable:!0}),vc.prototype.isEqual=function(t){return this.Ac===t.Ac&&this.Pc===t.Pc},vc.prototype.p=function(t){return ru(this.Ac,t.Ac)||ru(this.Pc,t.Pc)},vc),fc=/^__.*__$/,lc=(yc.prototype.Vc=function(t,e){var n=[];return null!==this.Vt?n.push(new Gi(t,this.data,this.Vt,e)):n.push(new zi(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Hi(t,this.fieldTransforms)),n},yc),pc=(dc.prototype.Vc=function(t,e){var n=[new Gi(t,this.data,this.Vt,e)];return 0<this.fieldTransforms.length&&n.push(new Hi(t,this.fieldTransforms)),n},dc);function dc(t,e,n){this.data=t,this.Vt=e,this.fieldTransforms=n}function yc(t,e,n){this.data=t,this.Vt=e,this.fieldTransforms=n}function vc(t,e){if(xh("GeoPoint",arguments,2),Rh("GeoPoint","number",1,t),Rh("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Dr(Sr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Dr(Sr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.Ac=t,this.Pc=e}function mc(t){var e=this;return(e=$h.call(this,"FieldValue.increment")||this).mc=t,e}function gc(t){var e=this;return(e=Zh.call(this,"FieldValue.arrayRemove")||this).Ic=t,e}function wc(t){var e=this;return(e=tc.call(this,"FieldValue.arrayUnion")||this).Ic=t,e}function bc(){return ec.call(this,"FieldValue.serverTimestamp")||this}function Ec(){return nc.call(this,"FieldValue.delete")||this}function Tc(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw $s()}}var Ic=(Object.defineProperty(Ac.prototype,"path",{get:function(){return this.settings.path},enumerable:!0,configurable:!0}),Object.defineProperty(Ac.prototype,"Tc",{get:function(){return this.settings.Tc},enumerable:!0,configurable:!0}),Ac.prototype.wc=function(t){return new Ac(Object.assign(Object.assign({},this.settings),t),this.ii,this.serializer,this.fieldTransforms,this.Vt)},Ac.prototype.pc=function(t){var e=null==this.path?null:this.path.child(t),n=this.wc({path:e,yc:!1});return n.bc(t),n},Ac.prototype.vc=function(t){var e=null==this.path?null:this.path.child(t),n=this.wc({path:e,yc:!1});return n.gc(),n},Ac.prototype.Rc=function(t){return this.wc({path:null,yc:!0})},Ac.prototype.Ec=function(t){var e=null===this.path||this.path.B()?"":" (found in field "+this.path.toString()+")";return new Dr(Sr.INVALID_ARGUMENT,"Function "+this.settings.methodName+"() called with invalid data. "+t+e)},Ac.prototype.contains=function(e){return void 0!==this.Vt.find(function(t){return e.q(t)})||void 0!==this.fieldTransforms.find(function(t){return e.q(t.field)})},Ac.prototype.gc=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.bc(this.path.get(t))},Ac.prototype.bc=function(t){if(0===t.length)throw this.Ec("Document fields must not be empty");if(Tc(this.Tc)&&fc.test(t))throw this.Ec('Document fields cannot begin and end with "__"')},Ac),Nc=(_c.prototype.Dc=function(t,e){var n=this.Cc(0,t);kc("Data must be an object, but it was:",n,e);var r=Dc(e,n);return new lc(new Ki(r),null,n.fieldTransforms)},_c.prototype.Fc=function(t,e,n){var r=this.Cc(2,t);kc("Data must be an object, but it was:",r,e);var i,o,s=Dc(e,r);if(n){for(var u=[],a=0,h=n;a<h.length;a++){var c=h[a],f=void 0;if(c instanceof Yh)f=c.lc;else{if("string"!=typeof c)throw $s();f=Rc(t,c)}if(!r.contains(f))throw new Dr(Sr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");Lc(u,f)||u.push(f)}i=new Ui(u),o=r.fieldTransforms.filter(function(t){return i.dt(t.field)})}else i=new Ui(r.Vt),o=r.fieldTransforms;return new lc(new Ki(s),i,o)},_c.prototype.Nc=function(o,t){var s=this.Cc(1,o);kc("Data must be an object, but it was:",s,t);var u=[],a=new Yi;Zr(t,function(t,e){var n=Rc(o,t),r=s.vc(n);if(e instanceof oc)u.push(n);else{var i=Sc(e,r);null!=i&&(u.push(n),a.set(n,i))}});var e=new Ui(u);return new pc(a.yt(),e,s.fieldTransforms)},_c.prototype.kc=function(t,e,n,r){var i=this.Cc(1,t),o=[Oc(t,e)],s=[n];if(r.length%2!=0)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var u=0;u<r.length;u+=2)o.push(Oc(t,r[u])),s.push(r[u+1]);for(var a=[],h=new Yi,c=o.length-1;0<=c;--c)if(!Lc(a,o[c])){var f=o[c],l=s[c],p=i.vc(f);if(l instanceof oc)a.push(f);else{var d=Sc(l,p);null!=d&&(a.push(f),h.set(f,d))}}var y=new Ui(a);return new pc(h.yt(),y,i.fieldTransforms)},_c.prototype.Cc=function(t,e){return new Ic({Tc:t,methodName:e,path:Kr.G,yc:!1},this.ii,this.serializer)},_c.prototype.$c=function(t,e,n){return void 0===n&&(n=!1),Sc(e,this.Cc(n?4:3,t))},_c);function _c(t,e){this.ii=t,this.serializer=e||Gs.nt().Sc(t)}function Ac(t,e,n,r,i){this.settings=t,this.ii=e,this.serializer=n,void 0===r&&this.gc(),this.fieldTransforms=r||[],this.Vt=i||[]}function Sc(s,t){if(xc(s))return kc("Unsupported field value:",t,s),Dc(s,t);if(s instanceof ic)return function(t,e){if(!Tc(e.Tc))throw e.Ec(t.fc+"() can only be used with update() and set()");if(null===e.path)throw e.Ec(t.fc+"() is not currently supported inside arrays");var n=t.Di(e);n&&e.fieldTransforms.push(n)}(s,t),null;if(t.path&&t.Vt.push(t.path),s instanceof Array){if(t.settings.yc&&4!==t.Tc)throw t.Ec("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=Sc(i[r],t.Rc(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return e.serializer.ai(t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Lr.fromDate(t);return{timestampValue:e.serializer.C(n)}}if(t instanceof Lr){var r=new Lr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:e.serializer.C(r)}}if(t instanceof cc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Kh)return{bytesValue:e.serializer.ui(t)};if(t instanceof dl){var i=e.ii,o=t.firestore.Mc;if(!o.isEqual(i))throw e.Ec("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:e.serializer._i(t.Lc.path,t.firestore.Mc)}}throw e.Ec("Unsupported field value: "+Uh(t))}(s,t)}function Dc(t,r){var i={};return ti(t)?r.path&&0<r.path.length&&r.Vt.push(r.path):Zr(t,function(t,e){var n=Sc(e,r.pc(t));null!=n&&(i[t]=n)}),{mapValue:{fields:i}}}function xc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Lr||t instanceof cc||t instanceof Kh||t instanceof dl||t instanceof ic)}function kc(t,e,n){if(!xc(n)||!qh(n)){var r=Uh(n);throw"an object"===r?e.Ec(t+" a custom object"):e.Ec(t+" "+r)}}function Oc(t,e){if(e instanceof Yh)return e.lc;if("string"==typeof e)return Rc(t,e);throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Rc(t,e){try{return function(e){if(0<=e.search(rc))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Yh.bind.apply(Yh,i([void 0],e.split("."))))}catch(t){throw new Dr(Sr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).lc}catch(e){var n=e instanceof Error?e.message:e.toString();throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function Lc(t,e){return t.some(function(t){return t.isEqual(e)})}var Pc,Vc,Mc,Cc=(Xc.prototype.Qc=function(){return 1===this.state||2===this.state||4===this.state},Xc.prototype.Wc=function(){return 2===this.state},Xc.prototype.start=function(){3!==this.state?this.auth():this.jc()},Xc.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Qc()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Xc.prototype.Kc=function(){this.state=0,this.sh.reset()},Xc.prototype.Gc=function(){var t=this;this.Wc()&&null===this.Uc&&(this.Uc=this.vr.Or(this.xc,6e4,function(){return t.zc()}))},Xc.prototype.Hc=function(t){this.Yc(),this.stream.send(t)},Xc.prototype.zc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.Wc()?[2,this.close(0)]:[2]})})},Xc.prototype.Yc=function(){this.Uc&&(this.Uc.cancel(),this.Uc=null)},Xc.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Yc(),this.sh.cancel(),this.qc++,3!==e?this.sh.reset():n&&n.code===Sr.RESOURCE_EXHAUSTED?(Xs(n.toString()),Xs("Using maximum backoff delay to prevent overloading the backend."),this.sh.Mr()):n&&n.code===Sr.UNAUTHENTICATED&&this.Bc._(),null!==this.stream&&(this.Jc(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Xc(n)];case 1:return t.sent(),[2]}})})},Xc.prototype.Jc=function(){},Xc.prototype.auth=function(){var n=this;this.state=1;var t=this.Zc(this.qc),e=this.qc;this.Bc.getToken().then(function(t){n.qc===e&&n.t_(t)},function(e){t(function(){var t=new Dr(Sr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.e_(t)})})},Xc.prototype.t_=function(t){var e=this,n=this.Zc(this.qc);this.stream=this.s_(t),this.stream.i_(function(){n(function(){return e.state=2,e.listener.i_()})}),this.stream.Xc(function(t){n(function(){return e.e_(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Xc.prototype.jc=function(){var t=this;this.state=4,this.sh.Lr(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},Xc.prototype.e_=function(t){return Ys("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Xc.prototype.Zc=function(e){var n=this;return function(t){n.vr.zr(function(){return n.qc===e?t():(Ys("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Xc),qc=(n(Yc,Mc=Cc),Yc.prototype.s_=function(t){return this.Oc.n_("Listen",t)},Yc.prototype.onMessage=function(t){this.sh.reset();var e=this.serializer.pi(t),n=this.serializer.bi(t);return this.listener.r_(e,n)},Yc.prototype.h_=function(t){var e={};e.database=this.serializer.wi,e.addTarget=this.serializer.ee(t);var n=this.serializer.zi(t);n&&(e.labels=n),this.Hc(e)},Yc.prototype.o_=function(t){var e={};e.database=this.serializer.wi,e.removeTarget=t,this.Hc(e)},Yc),Uc=(n(Kc,Vc=Cc),Object.defineProperty(Kc.prototype,"u_",{get:function(){return this.a_},enumerable:!0,configurable:!0}),Kc.prototype.start=function(){this.a_=!1,Vc.prototype.start.call(this)},Kc.prototype.Jc=function(){this.a_&&this.c_([])},Kc.prototype.s_=function(t){return this.Oc.n_("Write",t)},Kc.prototype.onMessage=function(t){if(Zs(!!t.streamToken),this.lastStreamToken=this.serializer.ci(t.streamToken),this.a_){this.sh.reset();var e=this.serializer.Li(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.__(n,e)}return Zs(!t.writeResults||0===t.writeResults.length),this.a_=!0,this.listener.l_()},Kc.prototype.d_=function(){var t={};t.database=this.serializer.wi,this.Hc(t)},Kc.prototype.c_=function(t){var e=this,n={streamToken:this.serializer.ui(this.lastStreamToken),writes:t.map(function(t){return e.serializer.vi(t)})};this.Hc(n)},Kc),jc=(n(Wc,Pc=function(){this.f_=void 0}),Wc.prototype.T_=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.Oc.T_(e,n,t)}).catch(function(t){throw t.code===Sr.UNAUTHENTICATED&&r.credentials._(),t})},Wc.prototype.E_=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.Oc.E_(e,n,t)}).catch(function(t){throw t.code===Sr.UNAUTHENTICATED&&r.credentials._(),t})},Wc),Bc=(Qc.prototype.P_=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.V_(),0<this.mutations.length)throw new Dr(Sr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return y(this,void 0,void 0,function(){var n,e,r,i,o;return v(this,function(t){switch(t.label){case 0:return n=tu(s),e={database:n.serializer.wi,documents:u.map(function(t){return n.serializer.fi(t)})},[4,n.E_("BatchGetDocuments",e)];case 1:return r=t.sent(),i=new Map,r.forEach(function(t){var e=n.serializer.gi(t);i.set(e.key.toString(),e)}),o=[],[2,(u.forEach(function(t){var e=i.get(t.toString());Zs(!!e),o.push(e)}),o)]}})})}(this.I_,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof Io||t instanceof To?n.g_(t):$s()}),e)]}})})},Qc.prototype.set=function(t,e){this.write(e.Vc(t,this.Rt(t))),this.A_.add(t)},Qc.prototype.update=function(t,e){try{this.write(e.Vc(t,this.p_(t)))}catch(t){this.m_=t}this.A_.add(t)},Qc.prototype.delete=function(t){this.write([new Qi(t,this.Rt(t))]),this.A_.add(t)},Qc.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.V_(),this.m_)throw this.m_;return e=this.w_,this.mutations.forEach(function(t){e=e.remove(t.key)}),e.forEach(function(t,e){n.mutations.push(new Wi(t,n.Rt(t)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return e=tu(i),n={database:e.serializer.wi,writes:o.map(function(t){return e.serializer.vi(t)})},[4,e.T_("Commit",n)];case 1:return r=t.sent(),[2,e.serializer.Li(r.writeResults,r.commitTime)]}})})}(this.I_,this.mutations)];case 1:return t.sent(),this.R_=!0,[2]}})})},Qc.prototype.g_=function(t){var e;if(t instanceof To)e=t.version;else{if(!(t instanceof Io))throw $s();e=Pr.min()}var n=this.w_.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Dr(Sr.ABORTED,"Document version changed between two reads.")}else this.w_=this.w_.me(t.key,e)},Qc.prototype.Rt=function(t){var e=this.w_.get(t);return!this.A_.has(t)&&e?Bi.updateTime(e):Bi.ft()},Qc.prototype.p_=function(t){var e=this.w_.get(t);if(this.A_.has(t)||!e)return Bi.exists(!0);if(e.isEqual(Pr.min()))throw new Dr(Sr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Bi.updateTime(e)},Qc.prototype.write=function(t){this.V_(),this.mutations=this.mutations.concat(t)},Qc.prototype.V_=function(){},Qc),Fc=(Hc.prototype.D_=function(){var t=this;0===this.b_&&(this.C_("Unknown"),this.v_=this.Br.Or("online_state_timeout",1e4,function(){return t.v_=null,t.F_("Backend didn't respond within 10 seconds."),t.C_("Offline"),Promise.resolve()}))},Hc.prototype.N_=function(t){"Online"===this.state?this.C_("Unknown"):(this.b_++,1<=this.b_&&(this.k_(),this.F_("Connection failed 1 times. Most recent error: "+t.toString()),this.C_("Offline")))},Hc.prototype.set=function(t){this.k_(),this.b_=0,"Online"===t&&(this.S_=!1),this.C_(t)},Hc.prototype.C_=function(t){t!==this.state&&(this.state=t,this.y_(t))},Hc.prototype.F_=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.S_?(Xs(e),this.S_=!1):Ys("OnlineStateTracker",e)},Hc.prototype.k_=function(){null!==this.v_&&(this.v_.cancel(),this.v_=null)},Hc),zc=(Gc.prototype.start=function(){return this.enableNetwork()},Gc.prototype.enableNetwork=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.U_()?(e=this.H_,[4,this.M_.bo()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.Z_()?this.tl():this.W_.set("Unknown"),[4,this.el()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Gc.prototype.disableNetwork=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.sl()];case 1:return t.sent(),this.W_.set("Offline"),[2]}})})},Gc.prototype.sl=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.H_.stop()];case 1:return t.sent(),[4,this.j_.stop()];case 2:return t.sent(),0<this.L_.length&&(Ys("RemoteStore","Stopping write stream with "+this.L_.length+" pending writes"),this.L_=[]),this.il(),[2]}})})},Gc.prototype.Eu=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Ys("RemoteStore","RemoteStore shutting down."),this.networkEnabled=!1,[4,this.sl()];case 1:return t.sent(),this.B_.Eu(),this.W_.set("Unknown"),[2]}})})},Gc.prototype.listen=function(t){this.x_.has(t.targetId)||(this.x_.set(t.targetId,t),this.Z_()?this.tl():this.j_.Wc()&&this.nl(t))},Gc.prototype.rl=function(t){this.x_.delete(t),this.j_.Wc()&&this.hl(t),0===this.x_.size&&(this.j_.Wc()?this.j_.Gc():this.U_()&&this.W_.set("Unknown"))},Gc.prototype.si=function(t){return this.x_.get(t)||null},Gc.prototype.ei=function(t){return this.ol.ei(t)},Gc.prototype.nl=function(t){this.O_.Ns(t.targetId),this.j_.h_(t)},Gc.prototype.hl=function(t){this.O_.Ns(t),this.j_.o_(t)},Gc.prototype.tl=function(){this.O_=new xs(this),this.j_.start(),this.W_.D_()},Gc.prototype.Z_=function(){return this.U_()&&!this.j_.Qc()&&0<this.x_.size},Gc.prototype.U_=function(){return this.isPrimary&&this.networkEnabled},Gc.prototype.il=function(){this.O_=null},Gc.prototype.K_=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){return this.x_.forEach(function(t,e){n.nl(t)}),[2]})})},Gc.prototype.G_=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return this.il(),this.Z_()?(this.W_.N_(e),this.tl()):this.W_.set("Unknown"),[2]})})},Gc.prototype.z_=function(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.W_.set("Online"),n instanceof Ts&&2===n.state&&n.cause?[2,this.al(n)]:(n instanceof bs?this.O_.qs(n):n instanceof Es?this.O_.Hs(n):this.O_.Ws(n),r.isEqual(Pr.min())?[3,4]:[4,this.M_.Yo()]);case 1:return e=t.sent(),0<=r.S(e)?[4,this.ul(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:t.label=4;case 4:return[2]}})})},Gc.prototype.ul=function(r){var i=this,t=this.O_.Xs(r);return t.as.forEach(function(t,e){if(0<t.resumeToken.rt()){var n=i.x_.get(e);n&&i.x_.set(e,n.we(t.resumeToken,r))}}),t.us.forEach(function(t){var e=i.x_.get(t);if(e){i.x_.set(t,e.we(ei.ht,e.Ee)),i.hl(t);var n=new Vo(e.target,t,1,e.sequenceNumber);i.nl(n)}}),this.ol.Hu(t)},Gc.prototype.al=function(t){var n=this,r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return y(n,void 0,void 0,function(){return v(this,function(t){return this.x_.has(e)?[2,(this.x_.delete(e),this.O_.removeTarget(e),this.ol.cl(e,r))]:[2]})})})}),i},Gc.prototype.el=function(){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this._l()?(e=0<this.L_.length?this.L_[this.L_.length-1].batchId:-1,[4,this.M_.Zu(e)]):[3,5];case 1:return null!==(n=t.sent())?[3,2]:(0===this.L_.length&&this.H_.Gc(),[3,4]);case 2:return this.ll(n),[4,this.el()];case 3:t.sent(),t.label=4;case 4:t.label=5;case 5:return this.dl()&&this.fl(),[2]}})})},Gc.prototype._l=function(){return this.U_()&&this.L_.length<10},Gc.prototype.Tl=function(){return this.L_.length},Gc.prototype.ll=function(t){this.L_.push(t),this.H_.Wc()&&this.H_.u_&&this.H_.c_(t.mutations)},Gc.prototype.dl=function(){return this.U_()&&!this.H_.Qc()&&0<this.L_.length},Gc.prototype.fl=function(){this.H_.start()},Gc.prototype.Y_=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.H_.d_(),[2]})})},Gc.prototype.X_=function(){var r=this;return this.M_.vo(this.H_.lastStreamToken).then(function(){for(var t=0,e=r.L_;t<e.length;t++){var n=e[t];r.H_.c_(n.mutations)}}).catch(Sh)},Gc.prototype.__=function(t,e){var n=this,r=this.L_.shift(),i=cu.from(r,t,e,this.H_.lastStreamToken);return this.ol.El(i).then(function(){return n.el()})},Gc.prototype.J_=function(n){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){return n&&0<this.L_.length?[2,(this.H_.u_?this.Il(n):this.wl(n)).then(function(){e.dl()&&e.fl()})]:[2]})})},Gc.prototype.wl=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return Xo(e.code)?[2,(Ys("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",this.H_.lastStreamToken),this.H_.lastStreamToken=ei.ht,this.M_.vo(ei.ht).catch(Sh))]:[2]})})},Gc.prototype.Il=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return Xo(n=i.code)&&n!==Sr.ABORTED?(e=this.L_.shift(),[2,(this.H_.Kc(),this.ol.Rl(e.batchId,i).then(function(){return r.el()}))]):[2]})})},Gc.prototype.ml=function(){return new Bc(this.I_)},Gc.prototype.Q_=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.sl()];case 1:return t.sent(),this.W_.set("Unknown"),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},Gc.prototype.Al=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.U_()?(Ys("RemoteStore","RemoteStore restarting streams for new credential"),[4,this.Q_()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Gc.prototype.Pl=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,5];case 2:return e?[3,4]:[4,this.sl()];case 3:t.sent(),this.W_.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})},Gc);function Gc(t,e,n,r,i){var o,s,u,a,h,c,f,l,p=this;this.M_=t,this.I_=e,this.L_=[],this.x_=new Map,this.O_=null,this.networkEnabled=!1,this.isPrimary=!1,this.B_=i,this.B_.q_(function(t){n.zr(function(){return y(p,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.U_()?(Ys("RemoteStore","Restarting streams for network reachability change."),[4,this.Q_()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.W_=new Fc(n,r),this.j_=(h=this.I_,c=n,f={i_:this.K_.bind(this),Xc:this.G_.bind(this),r_:this.z_.bind(this)},l=tu(h),new qc(c,l.Oc,l.credentials,l.serializer,f)),this.H_=(o=this.I_,s=n,u={i_:this.Y_.bind(this),Xc:this.J_.bind(this),l_:this.X_.bind(this),__:this.__.bind(this)},a=tu(o),new Uc(s,a.Oc,a.credentials,a.serializer,u))}function Hc(t,e){this.Br=t,this.y_=e,this.state="Unknown",this.b_=0,this.v_=null,this.S_=!0}function Qc(t){this.I_=t,this.w_=ys(),this.mutations=[],this.R_=!1,this.m_=null,this.A_=new Set}function Wc(t,e,n){var r=this;return(r=Pc.call(this)||this).Oc=t,r.credentials=e,r.serializer=n,r}function Kc(t,e,n,r,i){var o=this;return(o=Vc.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.a_=!1,o.lastStreamToken=ei.ht,o}function Yc(t,e,n,r,i){var o=this;return(o=Mc.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function Xc(t,e,n,r,i,o){this.vr=t,this.xc=n,this.Oc=r,this.Bc=i,this.listener=o,this.state=0,this.qc=0,this.Uc=null,this.stream=null,this.sh=new Lu(t,e)}function Jc(t,e){return"firestore_clients_"+t+"_"+e}function $c(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.t()&&(r+="_"+e.uid),r}function Zc(t,e){return"firestore_targets_"+t+"_"+e}function tf(t){this.key=t}function ef(t){this.key=t}function nf(t,e,n){this.query=t,this.targetId=e,this.view=n}function rf(t){this.key=t,this.Bd=!1}function of(){this.Pf=void 0,this.Vf=[]}var sf,uf,af=(Uf.Vl=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Dr(r.error.code,r.error.message)),i?new Uf(t,e,r.state,o):(Xs("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Uf.prototype.gl=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Uf),hf=(qf.Vl=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Dr(n.error.code,n.error.message)),r?new qf(t,n.state,i):(Xs("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},qf.prototype.gl=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},qf),cf=(Cf.Vl=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ws(),o=0;r&&o<n.activeTargetIds.length;++o)r=oi(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Cf(t,i):(Xs("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},Cf),ff=(Mf.Vl=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Mf(e.clientId,e.onlineState):(Xs("SharedClientState","Failed to parse online state: "+t),null)},Mf),lf=(Vf.prototype.pl=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Vf.prototype.yl=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Vf.prototype.gl=function(){var t={activeTargetIds:this.activeTargetIds.W(),updateTimeMs:Date.now()};return JSON.stringify(t)},Vf),pf=(Pf.eo=function(t){return!(!t.window||null==t.window.localStorage)},Pf.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l=this;return v(this,function(t){switch(t.label){case 0:return[4,this.ol.Au()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.bl&&(o=this.getItem(Jc(this.persistenceKey,i)))&&(s=cf.Vl(i,o))&&(this.Dl=this.Dl.me(s.clientId,s));for(this.xl(),(u=this.storage.getItem(this.Ll))&&(a=this.Ol(u))&&this.Bl(a),h=0,c=this.Cl;h<c.length;h++)f=c[h],this.Sl(f);return this.Cl=[],this.platform.window.addEventListener("unload",function(){return l.Eu()}),this.qh=!0,[2]}})})},Pf.prototype.yr=function(t){this.setItem(this.Nl,JSON.stringify(t))},Pf.prototype.ql=function(){return this.Ul(this.Dl)},Pf.prototype.Ql=function(n){var r=!1;return this.Dl.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},Pf.prototype.Wl=function(t){this.jl(t,"pending")},Pf.prototype.Kl=function(t,e,n){this.jl(t,e,n),this.Gl(t)},Pf.prototype.zl=function(t){var e="not-current";if(this.Ql(t)){var n=this.storage.getItem(Zc(this.persistenceKey,t));if(n){var r=hf.Vl(t,n);r&&(e=r.state)}}return this.Hl.pl(t),this.xl(),e},Pf.prototype.Yl=function(t){this.Hl.yl(t),this.xl()},Pf.prototype.Jl=function(t){return this.Hl.activeTargetIds.has(t)},Pf.prototype.Xl=function(t){this.removeItem(Zc(this.persistenceKey,t))},Pf.prototype.Zl=function(t,e,n){this.td(t,e,n)},Pf.prototype.Uu=function(t,e,n){var r=this;e.forEach(function(t){r.Gl(t)}),this.currentUser=t,n.forEach(function(t){r.Wl(t)})},Pf.prototype.ed=function(t){this.sd(t)},Pf.prototype.Eu=function(){this.qh&&(this.platform.window.removeEventListener("storage",this.vl),this.removeItem(this.Fl),this.qh=!1)},Pf.prototype.getItem=function(t){var e=this.storage.getItem(t);return Ys("SharedClientState","READ",t,e),e},Pf.prototype.setItem=function(t,e){Ys("SharedClientState","SET",t,e),this.storage.setItem(t,e)},Pf.prototype.removeItem=function(t){Ys("SharedClientState","REMOVE",t),this.storage.removeItem(t)},Pf.prototype.Sl=function(u){var t=this;if(u.storageArea===this.storage){if(Ys("SharedClientState","EVENT",u.key,u.newValue),u.key===this.Fl)return void Xs("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.vr.lh(function(){return y(t,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){if(this.qh){if(null!==u.key)if(this.kl.test(u.key)){if(null==u.newValue)return e=this.nd(u.key),[2,this.rd(e,null)];if(n=this.hd(u.key,u.newValue))return[2,this.rd(n.clientId,n)]}else if(this.$l.test(u.key)){if(null!==u.newValue&&(r=this.od(u.key,u.newValue)))return[2,this.ad(r)]}else if(this.Ml.test(u.key)){if(null!==u.newValue&&(i=this.ud(u.key,u.newValue)))return[2,this._d(i)]}else if(u.key===this.Ll){if(null!==u.newValue&&(o=this.Ol(u.newValue)))return[2,this.Bl(o)]}else u.key===this.Nl&&(s=function(t){var e=wu.br;if(null!=t)try{var n=JSON.parse(t);Zs("number"==typeof n),e=n}catch(t){Xs("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(u.newValue))!==wu.br&&this.Vr(s)}else this.Cl.push(u);return[2]})})})}},Object.defineProperty(Pf.prototype,"Hl",{get:function(){return this.Dl.get(this.bl)},enumerable:!0,configurable:!0}),Pf.prototype.xl=function(){this.setItem(this.Fl,this.Hl.gl())},Pf.prototype.jl=function(t,e,n){var r=new af(this.currentUser,t,e,n),i=$c(this.persistenceKey,this.currentUser,t);this.setItem(i,r.gl())},Pf.prototype.Gl=function(t){var e=$c(this.persistenceKey,this.currentUser,t);this.removeItem(e)},Pf.prototype.sd=function(t){var e={clientId:this.bl,onlineState:t};this.storage.setItem(this.Ll,JSON.stringify(e))},Pf.prototype.td=function(t,e,n){var r=Zc(this.persistenceKey,t),i=new hf(t,e,n);this.setItem(r,i.gl())},Pf.prototype.nd=function(t){var e=this.kl.exec(t);return e?e[1]:null},Pf.prototype.hd=function(t,e){var n=this.nd(t);return cf.Vl(n,e)},Pf.prototype.od=function(t,e){var n=this.$l.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return af.Vl(new Tr(i),r,e)},Pf.prototype.ud=function(t,e){var n=this.Ml.exec(t),r=Number(n[1]);return hf.Vl(r,e)},Pf.prototype.Ol=function(t){return ff.Vl(t)},Pf.prototype.ad=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.ol.ld(e.batchId,e.state,e.error)]:(Ys("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},Pf.prototype._d=function(t){return this.ol.dd(t.targetId,t.state,t.error)},Pf.prototype.rd=function(t,e){var n=this,r=e?this.Dl.me(t,e):this.Dl.remove(t),i=this.Ul(this.Dl),o=this.Ul(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.ol.fd(s,u).then(function(){n.Dl=r})},Pf.prototype.Bl=function(t){this.Dl.get(t.clientId)&&this.y_(t.onlineState)},Pf.prototype.Ul=function(t){var n=ws();return t.forEach(function(t,e){n=n.He(e.activeTargetIds)}),n},Pf),df=(Lf.prototype.Wl=function(t){},Lf.prototype.Kl=function(t,e,n){},Lf.prototype.zl=function(t){return this.Td.pl(t),this.Ed[t]||"not-current"},Lf.prototype.Zl=function(t,e,n){this.Ed[t]=e},Lf.prototype.Yl=function(t){this.Td.yl(t)},Lf.prototype.Jl=function(t){return this.Td.activeTargetIds.has(t)},Lf.prototype.Xl=function(t){delete this.Ed[t]},Lf.prototype.ql=function(){return this.Td.activeTargetIds},Lf.prototype.Ql=function(t){return this.Td.activeTargetIds.has(t)},Lf.prototype.start=function(){return this.Td=new lf,Promise.resolve()},Lf.prototype.Uu=function(t,e,n){},Lf.prototype.ed=function(t){},Lf.prototype.Eu=function(){},Lf.prototype.yr=function(t){},Lf),yf=(Object.defineProperty(Rf.prototype,"Ad",{get:function(){return this.Id},enumerable:!0,configurable:!0}),Rf.prototype.Pd=function(t,e){var u=this,a=e?e.Vd:new Ns,h=e?e.md:this.md,c=e?e.ns:this.ns,f=h,l=!1,p=this.query.oe()&&h.size===this.query.limit?h.last():null,d=this.query.ae()&&h.size===this.query.limit?h.first():null;if(t.pe(function(t,e){var n=h.get(t),r=e instanceof To?e:null;r=r&&(u.query.matches(r)?r:null);var i=!!n&&u.ns.has(n.key),o=!!r&&(r.At||u.ns.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),s=!0):u.gd(n,r)||(a.track({type:2,doc:r}),s=!0,(p&&0<u.query.se(r,p)||d&&u.query.se(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),s=!0):n&&!r&&(a.track({type:1,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(c=r?(f=f.add(r),o?c.add(t):c.delete(t)):(f=f.delete(t),c.delete(t)))}),this.query.oe()||this.query.ae())for(;f.size>this.query.limit;){var n=this.query.oe()?f.last():f.first();f=f.delete(n.key),c=c.delete(n.key),a.track({type:1,doc:n})}return{md:f,Vd:a,pd:l,ns:c}},Rf.prototype.gd=function(t,e){return t.At&&e.hasCommittedMutations&&!e.At},Rf.prototype.Xn=function(t,e,n){var o=this,r=this.md;this.md=t.md,this.ns=t.ns;var i=t.Vd.es();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.query.se(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $s()}}var r,i}),this.yd(n);var s=e?this.bd():[],u=0===this.Rd.size&&this.fs?1:0,a=u!==this.wd;return this.wd=u,0!==i.length||a?{snapshot:new _s(this.query,t.md,r,i,t.ns,0==u,a,!1),vd:s}:{vd:s}},Rf.prototype.Sd=function(t){return this.fs&&"Offline"===t?(this.fs=!1,this.Xn({md:this.md,Vd:new Ns,ns:this.ns,pd:!1},!1)):{vd:[]}},Rf.prototype.Dd=function(t){return!this.Id.has(t)&&!!this.md.has(t)&&!this.md.get(t).At},Rf.prototype.yd=function(t){var e=this;t&&(t.Ts.forEach(function(t){return e.Id=e.Id.add(t)}),t.Es.forEach(function(t){}),t.Is.forEach(function(t){return e.Id=e.Id.delete(t)}),this.fs=t.fs)},Rf.prototype.bd=function(){var e=this;if(!this.fs)return[];var n=this.Rd;this.Rd=ms(),this.md.forEach(function(t){e.Dd(t.key)&&(e.Rd=e.Rd.add(t.key))});var r=[];return n.forEach(function(t){e.Rd.has(t)||r.push(new ef(t))}),this.Rd.forEach(function(t){n.has(t)||r.push(new tf(t))}),r},Rf.prototype.Cd=function(t){this.Id=t.nc,this.Rd=ms();var e=this.Pd(t.documents);return this.Xn(e,!0)},Rf.prototype.Fd=function(){return _s.os(this.query,this.md,this.ns,0===this.wd)},Rf),vf=(Of.prototype.$d=function(){this.Md()},Of.prototype.Md=function(){var t=this;this.sh.Lr(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=this.Nd.ml(),(n=this.Ld(e))&&n.then(function(t){r.Br.zr(function(){return e.commit().then(function(){r.Qr.resolve(t)}).catch(function(t){r.xd(t)})})}).catch(function(t){r.xd(t)}),[2]})})})},Of.prototype.Ld=function(t){try{var e=this.updateFunction(t);return!ri(e)&&e.catch&&e.then?e:(this.Qr.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Qr.reject(t),null}},Of.prototype.xd=function(t){var e=this;0<this.kd&&this.Od(t)?(--this.kd,this.Br.zr(function(){return e.Md(),Promise.resolve()})):this.Qr.reject(t)},Of.prototype.Od=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Xo(e)},Of),mf=(Object.defineProperty(kf.prototype,"Zd",{get:function(){return!0},enumerable:!0,configurable:!0}),kf.prototype.subscribe=function(t){this.Qd=t},kf.prototype.listen=function(s){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return this.tf("listen()"),(r=this.Wd.get(s))?(e=r.targetId,this.qd.zl(e),n=r.view.Fd(),[3,4]):[3,1];case 1:return[4,this.M_.ec(s.ee())];case 2:return i=t.sent(),o=this.qd.zl(i.targetId),e=i.targetId,[4,this.ef(s,e,"current"===o)];case 3:n=t.sent(),this.Zd&&this.Nd.listen(i),t.label=4;case 4:return[2,n]}})})},kf.prototype.ef=function(u,a,h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:return[4,this.M_.ic(u,!0)];case 1:return e=t.sent(),n=new yf(u,e.nc),r=n.Pd(e.documents),i=Ss.ds(a,h&&"Offline"!==this.onlineState),o=n.Xn(r,this.Zd,i),this.sf(a,o.vd),s=new nf(u,a,n),[2,(this.Wd.set(u,s),this.jd.has(a)?this.jd.get(a).push(u):this.jd.set(a,[u]),o.snapshot)]}})})},kf.prototype.rl=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return this.tf("unlisten()"),e=this.Wd.get(i),1<(n=this.jd.get(e.targetId)).length?[2,(this.jd.set(e.targetId,n.filter(function(t){return!t.isEqual(i)})),void this.Wd.delete(i))]:this.Zd?(this.qd.Yl(e.targetId),this.qd.Ql(e.targetId)?[3,2]:[4,this.M_.sc(e.targetId,!1).then(function(){r.qd.Xl(e.targetId),r.Nd.rl(e.targetId),r.if(e.targetId)}).catch(Sh)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.if(e.targetId),[4,this.M_.sc(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},kf.prototype.write=function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:this.tf("write()"),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.M_.Ku(r)];case 2:return e=t.sent(),[3,4];case 3:if("IndexedDbTransactionError"===(n=t.sent()).name)return[2,(Xs("SyncEngine","Dropping write that cannot be persisted: "+n),void i.reject(new Dr(Sr.UNAVAILABLE,"Failed to persist write: "+n)))];throw n;case 4:return this.qd.Wl(e.batchId),this.nf(e.batchId,i),[4,this.rf(e.Qn)];case 5:return t.sent(),[4,this.Nd.el()];case 6:return t.sent(),[2]}})})},kf.prototype.runTransaction=function(t,e,n){new vf(t,this.Nd,e,n).$d()},kf.prototype.Hu=function(n){return y(this,void 0,void 0,function(){var e,r=this;return v(this,function(t){switch(t.label){case 0:this.tf("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.M_.Hu(n)];case 2:return e=t.sent(),n.as.forEach(function(t,e){var n=r.zd.get(e);n&&(Zs(t.Ts.size+t.Es.size+t.Is.size<=1),0<t.Ts.size?n.Bd=!0:0<t.Es.size?Zs(n.Bd):0<t.Is.size&&(Zs(n.Bd),n.Bd=!1))}),[4,this.rf(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,Sh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},kf.prototype.Sd=function(r,t){this.tf("applyOnlineStateChange()");var i=[];this.Wd.forEach(function(t,e){var n=e.view.Sd(r);n.snapshot&&i.push(n.snapshot)}),this.Qd.hf(r),this.Qd.r_(i),this.onlineState=r},kf.prototype.cl=function(u,a){return y(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return v(this,function(t){switch(t.label){case 0:return this.tf("rejectListens()"),this.qd.Zl(u,"rejected",a),e=this.zd.get(u),(n=e&&e.key)?(this.Gd=this.Gd.remove(n),this.zd.delete(u),this.af(),r=(r=new $o(Xr.N)).me(n,new Io(n,Pr.min())),i=ms().add(n),o=new As(Pr.min(),new Map,new os(ru),r,i),[2,this.Hu(o)]):[4,this.M_.sc(u,!1).then(function(){return s.if(u,a)}).catch(Sh)];case 1:return t.sent(),[2]}})})},kf.prototype.El=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:this.tf("applySuccessfulWrite()"),e=r.batch.batchId,this.uf(e,null),this.cf(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.M_.po(r)];case 2:return n=t.sent(),this.qd.Kl(e,"acknowledged"),[4,this.rf(n)];case 3:return t.sent(),[3,6];case 4:return[4,Sh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},kf.prototype.Rl=function(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.tf("rejectFailedWrite()"),this.uf(n,r),this.cf(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.M_.zu(n)];case 2:return e=t.sent(),this.qd.Kl(n,"rejected",r),[4,this.rf(e)];case 3:return t.sent(),[3,6];case 4:return[4,Sh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},kf.prototype._f=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.Nd.U_()||Ys("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.M_.Mo()];case 1:return-1===(e=t.sent())?[2,void r.resolve()]:((n=this.Jd.get(e)||[]).push(r),this.Jd.set(e,n),[2])}})})},kf.prototype.cf=function(t){(this.Jd.get(t)||[]).forEach(function(t){t.resolve()}),this.Jd.delete(t)},kf.prototype.lf=function(e){this.Jd.forEach(function(t){t.forEach(function(t){t.reject(new Dr(Sr.CANCELLED,e))})}),this.Jd.clear()},kf.prototype.nf=function(t,e){var n=this.Yd[this.currentUser.s()];n=(n=n||new $o(ru)).me(t,e),this.Yd[this.currentUser.s()]=n},kf.prototype.uf=function(t,e){var n=this.Yd[this.currentUser.s()];if(n){var r=n.get(t);r&&(e?r.reject(e):r.resolve(),n=n.remove(t)),this.Yd[this.currentUser.s()]=n}},kf.prototype.if=function(t,e){var n=this;void 0===e&&(e=null),this.qd.Yl(t);for(var r=0,i=this.jd.get(t);r<i.length;r++){var o=i[r];this.Wd.delete(o),e&&this.Qd.df(o,e)}if(this.jd.delete(t),this.Zd){var s=this.Hd.Dn(t);this.Hd.vn(t),s.forEach(function(t){n.Hd.Cn(t)||n.ff(t)})}},kf.prototype.ff=function(t){var e=this.Gd.get(t);null!==e&&(this.Nd.rl(e),this.Gd=this.Gd.remove(t),this.zd.delete(e),this.af())},kf.prototype.sf=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof tf?(this.Hd.Vn(i.key,t),this.Tf(i)):i instanceof ef?(Ys("SyncEngine","Document no longer in limbo: "+i.key),this.Hd.pn(i.key,t),this.Hd.Cn(i.key)||this.ff(i.key)):$s()}},kf.prototype.Tf=function(t){var e=t.key;this.Gd.get(e)||(Ys("SyncEngine","New document in limbo: "+e),this.Kd.push(e),this.af())},kf.prototype.af=function(){for(;0<this.Kd.length&&this.Gd.size<this.Ud;){var t=this.Kd.shift(),e=this.Xd.next();this.zd.set(e,new rf(t)),this.Gd=this.Gd.me(t,e),this.Nd.listen(new Vo(Ao.Wt(t.path).ee(),e,2,wu.br))}},kf.prototype.Ef=function(){return this.Gd},kf.prototype.If=function(){return this.Kd},kf.prototype.rf=function(r,a){return y(this,void 0,void 0,function(){var o,s,e,u=this;return v(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.Wd.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.Pd(r);return n.pd?u.M_.ic(i.query,!1).then(function(t){var e=t.documents;return i.view.Pd(e,n)}):n}).then(function(t){var e=a&&a.as.get(i.targetId),n=i.view.Xn(t,u.Zd,e);if(u.sf(i.targetId,n.vd),n.snapshot){u.Zd&&u.qd.Zl(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=gu.Pr(i.targetId,n.snapshot);s.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.Qd.r_(o),[4,this.M_.Xu(s)];case 2:return t.sent(),[2]}})})},kf.prototype.tf=function(t){},kf.prototype.Al=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?(this.lf("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.M_.Uu(r)]):[3,3];case 1:return n=t.sent(),this.qd.Uu(r,n.Wu,n.ju),[4,this.rf(n.Qu)];case 2:t.sent(),t.label=3;case 3:return[4,this.Nd.Al()];case 4:return t.sent(),[2]}})})},kf.prototype.enableNetwork=function(){return this.Nd.enableNetwork()},kf.prototype.disableNetwork=function(){return this.Nd.disableNetwork()},kf.prototype.ei=function(t){var e=this.zd.get(t);if(e&&e.Bd)return ms().add(e.key);var n=ms(),r=this.jd.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],u=this.Wd.get(s);n=n.He(u.view.Ad)}return n},kf),gf=(n(xf,sf=mf),Object.defineProperty(xf.prototype,"Zd",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),xf.prototype.enableNetwork=function(){return this.M_.nu(!0),sf.prototype.enableNetwork.call(this)},xf.prototype.disableNetwork=function(){return this.M_.nu(!1),sf.prototype.disableNetwork.call(this)},xf.prototype.wf=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,this.M_.ic(r.query,!0)];case 1:return e=t.sent(),n=r.view.Cd(e),[2,(this.isPrimary&&this.sf(r.targetId,n.vd),n)]}})})},xf.prototype.Sd=function(t,e){this.Zd&&0===e&&(sf.prototype.Sd.call(this,t,e),this.qd.ed(t)),this.Zd||1!==e||sf.prototype.Sd.call(this,t,e)},xf.prototype.ld=function(n,r,i){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.tf("applyBatchState()"),[4,this.M_.oc(n)];case 1:return null===(e=t.sent())?[3,6]:"pending"!==r?[3,3]:[4,this.Nd.el()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.uf(n,i||null),this.M_.ac(n)):$s(),t.label=4;case 4:return[4,this.rf(e)];case 5:return t.sent(),[3,7];case 6:Ys("SyncEngine","Cannot apply mutation batch with id: "+n),t.label=7;case 7:return[2]}})})},xf.prototype.Pl=function(h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a=this;return v(this,function(t){switch(t.label){case 0:return!0!==h||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.Nd.Pl(!0)]);case 1:return t.sent(),e=this.qd.ql(),[4,this.Rf(e.W())];case 2:for(n=t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.Nd.listen(o);return[3,7];case 3:return!1!==h||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,s=[],u=Promise.resolve(),this.jd.forEach(function(t,e){a.qd.Jl(e)?s.push(e):u=u.then(function(){return a.if(e),a.M_.sc(e,!0)}),a.Nd.rl(e)}),[4,u]);case 4:return t.sent(),[4,this.Rf(s)];case 5:return t.sent(),this.mf(),[4,this.Nd.Pl(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},xf.prototype.mf=function(){var n=this;this.zd.forEach(function(t,e){n.Nd.rl(e)}),this.Hd.Sn(),this.zd=new Map,this.Gd=new $o(Xr.N)},xf.prototype.Rf=function(d){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l,p;return v(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(u=this.jd.get(o))&&0!==u.length?[4,this.M_.sc(o,!0)]:[3,8]):[3,14];case 2:return t.sent(),[4,this.M_.ec(u[0].ee())];case 3:s=t.sent(),a=0,h=u,t.label=4;case 4:return a<h.length?(c=h[a],f=this.Wd.get(c),[4,this.wf(f)]):[3,7];case 5:(l=t.sent()).snapshot&&n.push(l.snapshot),t.label=6;case 6:return a++,[3,4];case 7:return[3,12];case 8:return[4,this.M_.uc(o)];case 9:return p=t.sent(),[4,this.M_.ec(p)];case 10:return s=t.sent(),[4,this.ef(this.Af(p),o,!1)];case 11:t.sent(),t.label=12;case 12:e.push(s),t.label=13;case 13:return r++,[3,1];case 14:return[2,(this.Qd.r_(n),e)]}})})},xf.prototype.Af=function(t){return new Ao(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)},xf.prototype.Au=function(){return this.M_.Au()},xf.prototype.dd=function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.isPrimary?(Ys("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!this.jd.has(r))return[3,8];switch(i){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,this.M_.Pa()];case 3:return e=t.sent(),n=As.ls(r,"current"===i),[4,this.rf(e,n)];case 4:return t.sent(),[3,8];case 5:return[4,this.M_.sc(r,!0)];case 6:return t.sent(),this.if(r,o),[3,8];case 7:$s(),t.label=8;case 8:return[2]}})})},xf.prototype.fd=function(l,p){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f=this;return v(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[3,10];e=0,n=l,t.label=1;case 1:return e<n.length?(r=n[e],this.jd.has(r)?(Ys("SyncEngine","Adding an already active target "+r),[3,5]):[4,this.M_.uc(r)]):[3,6];case 2:return i=t.sent(),[4,this.M_.ec(i)];case 3:return o=t.sent(),[4,this.ef(this.Af(i),o.targetId,!1)];case 4:t.sent(),this.Nd.listen(o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return u.jd.has(e)?[4,u.M_.sc(e,!1).then(function(){f.Nd.rl(e),f.if(e)}).catch(Sh)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=this,a=0,h=p,t.label=7;case 7:return a<h.length?(c=h[a],[5,s(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})},xf),wf=(Df.prototype.listen=function(u){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:if(e=u.query,n=!1,(r=this.gf.get(e))||(n=!0,r=new of),!n)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),i=r,[4,this.ol.listen(e)];case 2:return i.Pf=t.sent(),[3,4];case 3:if(o=t.sent(),Xs("EventManager",s="Initialization of query '"+e+"' failed: "+o),"IndexedDbTransactionError"!==o.name)throw o;return[2,void u.onError(new Dr(Sr.UNAVAILABLE,s))];case 4:return this.gf.set(e,r),r.Vf.push(u),u.Sd(this.onlineState),r.Pf&&u.yf(r.Pf)&&this.bf(),[2]}})})},Df.prototype.rl=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){return e=o.query,n=!1,(r=this.gf.get(e))&&0<=(i=r.Vf.indexOf(o))&&(r.Vf.splice(i,1),n=0===r.Vf.length),n?[2,(this.gf.delete(e),this.ol.rl(e))]:[2]})})},Df.prototype.r_=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.gf.get(o);if(s){for(var u=0,a=s.Vf;u<a.length;u++)a[u].yf(i)&&(e=!0);s.Pf=i}}e&&this.bf()},Df.prototype.df=function(t,e){var n=this.gf.get(t);if(n)for(var r=0,i=n.Vf;r<i.length;r++)i[r].onError(e);this.gf.delete(t)},Df.prototype.hf=function(i){this.onlineState=i;var o=!1;this.gf.forEach(function(t,e){for(var n=0,r=e.Vf;n<r.length;n++)r[n].Sd(i)&&(o=!0)}),o&&this.bf()},Df.prototype.vf=function(t){this.pf.add(t),t.next()},Df.prototype.Sf=function(t){this.pf.delete(t)},Df.prototype.bf=function(){this.pf.forEach(function(t){t.next()})},Df),bf=(Sf.prototype.yf=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new _s(t.query,t.docs,t.ss,e,t.ns,t.fromCache,t.rs,!0)}var o=!1;return this.Cf?this.Nf(t)&&(this.Df.next(t),o=!0):this.kf(t,this.onlineState)&&(this.$f(t),o=!0),this.Ff=t,o},Sf.prototype.onError=function(t){this.Df.error(t)},Sf.prototype.Sd=function(t){this.onlineState=t;var e=!1;return this.Ff&&!this.Cf&&this.kf(this.Ff,t)&&(this.$f(this.Ff),e=!0),e},Sf.prototype.kf=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Mf&&n||t.docs.B()&&"Offline"!==e)},Sf.prototype.Nf=function(t){if(0<t.docChanges.length)return!0;var e=this.Ff&&this.Ff.hasPendingWrites!==t.hasPendingWrites;return!(!t.rs&&!e)&&!0===this.options.includeMetadataChanges},Sf.prototype.$f=function(t){t=_s.os(t.query,t.docs,t.ns,t.fromCache),this.Cf=!0,this.Df.next(t)},Sf),Ef=(Af.prototype.qu=function(t){this.Lf=t},Af.prototype.lr=function(e,r,i,o){var s=this;return r.te()||i.isEqual(Pr.min())?this.xf(e,r):this.Lf.ur(e,o).next(function(t){var n=s.Of(r,t);return(r.oe()||r.ae())&&s.pd(r.Bt,n,o,i)?s.xf(e,r):(Ws()<=l.DEBUG&&Ys("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),r.toString()),s.Lf.lr(e,r,i).next(function(e){return n.forEach(function(t){e=e.me(t.key,t)}),e}))})},Af.prototype.Of=function(n,t){var r=new os(function(t,e){return n.se(t,e)});return t.forEach(function(t,e){e instanceof To&&n.matches(e)&&(r=r.add(e))}),r},Af.prototype.pd=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.S(r))},Af.prototype.xf=function(t,e){return Ws()<=l.DEBUG&&Ys("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.Lf.lr(t,e,Pr.min())},Af),Tf=(_f.prototype.Vo=function(t){return pu.resolve(0===this.ir.length)},_f.prototype.po=function(t,e,n){var r=e.batchId,i=this.Uf(r,"acknowledged");return Zs(0===i),this.ir[i],this.lastStreamToken=n,pu.resolve()},_f.prototype.bo=function(t){return pu.resolve(this.lastStreamToken)},_f.prototype.vo=function(t,e){return this.lastStreamToken=e,pu.resolve()},_f.prototype.So=function(t,e,n,r){var i=this.Bf;this.Bf++,0<this.ir.length&&this.ir[this.ir.length-1];var o=new hu(i,e,n,r);this.ir.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.qf=this.qf.add(new lu(a.key,i)),this.nr.Co(t,a.key.path.M())}return pu.resolve(o)},_f.prototype.Fo=function(t,e){return pu.resolve(this.Qf(e))},_f.prototype.$o=function(t,e){var n=e+1,r=this.Wf(n),i=r<0?0:r;return pu.resolve(this.ir.length>i?this.ir[i]:null)},_f.prototype.Mo=function(){return pu.resolve(0===this.ir.length?-1:this.Bf-1)},_f.prototype.Lo=function(t){return pu.resolve(this.ir.slice())},_f.prototype.hr=function(t,e){var n=this,r=new lu(e,0),i=new lu(e,Number.POSITIVE_INFINITY),o=[];return this.qf.Ke([r,i],function(t){var e=n.Qf(t.Fn);o.push(e)}),pu.resolve(o)},_f.prototype._r=function(t,e){var r=this,i=new os(ru);return e.forEach(function(t){var e=new lu(t,0),n=new lu(t,Number.POSITIVE_INFINITY);r.qf.Ke([e,n],function(t){i=i.add(t.Fn)})}),pu.resolve(this.jf(i))},_f.prototype.wr=function(t,e){var n=e.path,r=n.length+1,i=n;Xr.et(i)||(i=i.child(""));var o=new lu(new Xr(i),0),s=new os(ru);return this.qf.Ge(function(t){var e=t.key.path;return!!n.q(e)&&(e.length===r&&(s=s.add(t.Fn)),!0)},o),pu.resolve(this.jf(s))},_f.prototype.jf=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.Qf(t);null!==e&&r.push(e)}),r},_f.prototype.Oo=function(n,r){var i=this;Zs(0===this.Uf(r.batchId,"removed")),this.ir.shift();var o=this.qf;return pu.forEach(r.mutations,function(t){var e=new lu(t.key,r.batchId);return o=o.delete(e),i.mo.Uo(n,t.key)}).next(function(){i.qf=o})},_f.prototype.qo=function(t){},_f.prototype.Cn=function(t,e){var n=new lu(e,0),r=this.qf.ze(n);return pu.resolve(e.isEqual(r&&r.key))},_f.prototype.Qo=function(t){return this.ir.length,pu.resolve()},_f.prototype.Uf=function(t,e){return this.Wf(t)},_f.prototype.Wf=function(t){return 0===this.ir.length?0:t-this.ir[0].batchId},_f.prototype.Qf=function(t){var e=this.Wf(t);return e<0||e>=this.ir.length?null:this.ir[e]},_f),If=(Nf.prototype.Kn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.Kf(e);return this.docs=this.docs.me(r,{Ta:e,size:s,readTime:n}),this.size+=s-o,this.nr.Co(t,r.path.M())},Nf.prototype.zn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Nf.prototype.Hn=function(t,e){var n=this.docs.get(e);return pu.resolve(n?n.Ta:null)},Nf.prototype.getEntries=function(t,e){var n=this,r=fs();return e.forEach(function(t){var e=n.docs.get(t);r=r.me(t,e?e.Ta:null)}),pu.resolve(r)},Nf.prototype.lr=function(t,e,n){for(var r=ps(),i=new Xr(e.path.child("")),o=this.docs.ve(i);o.ke();){var s=o.Ne(),u=s.key,a=s.value,h=a.Ta,c=a.readTime;if(!e.path.q(u.path))break;c.S(n)<=0||h instanceof To&&e.matches(h)&&(r=r.me(h.key,h))}return pu.resolve(r)},Nf.prototype.Gf=function(t,e){return pu.forEach(this.docs,function(t){return e(t)})},Nf.prototype.ya=function(t){return new Nf.ba(this)},Nf.prototype.Sa=function(t){return pu.resolve(this.size)},Nf);function Nf(t,e){this.nr=t,this.Kf=e,this.docs=new $o(Xr.N),this.size=0}function _f(t,e){this.nr=t,this.mo=e,this.ir=[],this.Bf=1,this.lastStreamToken=ei.ht,this.qf=new os(lu.mn)}function Af(){}function Sf(t,e,n){this.query=t,this.Df=e,this.Cf=!1,this.Ff=null,this.onlineState="Unknown",this.options=n||{}}function Df(t){this.ol=t,this.gf=new au(function(t){return t.canonicalId()}),this.onlineState="Unknown",this.pf=new Set,this.ol.subscribe(this)}function xf(t,e,n,r,i){var o=this;return(o=sf.call(this,t,e,n,r,i)||this).M_=t,o.isPrimary=void 0,o}function kf(t,e,n,r,i){this.M_=t,this.Nd=e,this.qd=n,this.currentUser=r,this.Ud=i,this.Qd=null,this.Wd=new au(function(t){return t.canonicalId()}),this.jd=new Map,this.Kd=[],this.Gd=new $o(Xr.N),this.zd=new Map,this.Hd=new fu,this.Yd={},this.Jd=new Map,this.Xd=ba.Ko(),this.onlineState="Unknown"}function Of(t,e,n,r){this.Br=t,this.Nd=e,this.updateFunction=n,this.Qr=r,this.kd=5,this.sh=new Lu(this.Br,"transaction_retry")}function Rf(t,e){this.query=t,this.Id=e,this.wd=null,this.fs=!1,this.Rd=ms(),this.ns=ms(),this.md=new Is(t.se.bind(t))}function Lf(){this.Td=new lf,this.Ed={},this.ol=null,this.y_=null,this.Vr=null}function Pf(t,e,n,r,i){if(this.vr=t,this.platform=e,this.persistenceKey=n,this.bl=r,this.ol=null,this.y_=null,this.Vr=null,this.vl=this.Sl.bind(this),this.Dl=new $o(ru),this.qh=!1,this.Cl=[],!Pf.eo(this.platform))throw new Dr(Sr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.Fl=Jc(this.persistenceKey,this.bl),this.Nl="firestore_sequence_number_"+this.persistenceKey,this.Dl=this.Dl.me(this.bl,new lf),this.kl=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.$l=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Ml=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Ll="firestore_online_state_"+this.persistenceKey,this.platform.window.addEventListener("storage",this.vl)}function Vf(){this.activeTargetIds=ws()}function Mf(t,e){this.clientId=t,this.onlineState=e}function Cf(t,e){this.clientId=t,this.activeTargetIds=e}function qf(t,e,n){this.targetId=t,this.state=e,this.error=n}function Uf(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function jf(t){var e=this;return(e=uf.call(this)||this).Da=t,e}If.ba=(n(jf,uf=du),jf.prototype.Xn=function(n){var r=this,i=[];return this.Qn.forEach(function(t,e){e?i.push(r.Da.Kn(n,e,r.readTime)):r.Da.zn(t)}),pu.qn(i)},jf.prototype.Yn=function(t,e){return this.Da.Hn(t,e)},jf.prototype.Jn=function(t,e){return this.Da.getEntries(t,e)},jf);var Bf,Ff,zf=(il.prototype.js=function(t,n){return this.zf.forEach(function(t,e){return n(e)}),pu.resolve()},il.prototype.Yo=function(t){return pu.resolve(this.lastRemoteSnapshotVersion)},il.prototype.Jo=function(t){return pu.resolve(this.Hf)},il.prototype.Go=function(t){return this.highestTargetId=this.Jf.next(),pu.resolve(this.highestTargetId)},il.prototype.Xo=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Hf&&(this.Hf=e),pu.resolve()},il.prototype.ta=function(t){this.zf.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Jf=new ba(e),this.highestTargetId=e),t.sequenceNumber>this.Hf&&(this.Hf=t.sequenceNumber)},il.prototype.Zo=function(t,e){return this.ta(e),this.targetCount+=1,pu.resolve()},il.prototype.sa=function(t,e){return this.ta(e),pu.resolve()},il.prototype.ia=function(t,e){return this.zf.delete(e.target),this.Yf.vn(e.targetId),--this.targetCount,pu.resolve()},il.prototype.zh=function(n,r,i){var o=this,s=0,u=[];return this.zf.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.zf.delete(t),u.push(o.na(n,e.targetId)),s++)}),pu.qn(u).next(function(){return s})},il.prototype.oa=function(t){return pu.resolve(this.targetCount)},il.prototype.aa=function(t,e){var n=this.zf.get(e)||null;return pu.resolve(n)},il.prototype.ua=function(e,t,n){this.Yf.gn(t,n);var r=this.persistence.mo,i=[];return r&&t.forEach(function(t){i.push(r.Vn(e,t))}),pu.qn(i)},il.prototype.ca=function(e,t,n){this.Yf.bn(t,n);var r=this.persistence.mo,i=[];return r&&t.forEach(function(t){i.push(r.pn(e,t))}),pu.qn(i)},il.prototype.na=function(t,e){return this.Yf.vn(e),pu.resolve()},il.prototype._a=function(t,e){var n=this.Yf.Dn(e);return pu.resolve(n)},il.prototype.Cn=function(t,e){return pu.resolve(this.Yf.Cn(e))},il),Gf=(rl.prototype.start=function(){return Promise.resolve()},rl.prototype.Eu=function(){return this.Ba=!1,Promise.resolve()},Object.defineProperty(rl.prototype,"qh",{get:function(){return this.Ba},enumerable:!0,configurable:!0}),rl.prototype.iu=function(){},rl.prototype.pu=function(){return this.nr},rl.prototype.Pu=function(t){var e=this.Xf[t.s()];return e||(e=new Tf(this.nr,this.mo),this.Xf[t.s()]=e),e},rl.prototype.Vu=function(){return this.za},rl.prototype.gu=function(){return this.sr},rl.prototype.runTransaction=function(t,e,n){var r=this;Ys("MemoryPersistence","Starting transaction:",t);var i=new Hf(this.eu.next());return this.mo.tT(),n(i).next(function(t){return r.mo.eT(i).next(function(){return t})}).On().then(function(t){return i.er(),t})},rl.prototype.sT=function(e,n){return pu.Un(Object.values(this.Xf).map(function(t){return function(){return t.Cn(e,n)}}))},rl),Hf=(n(nl,Ff=vu),nl),Qf=(el.nT=function(t){return new el(t)},Object.defineProperty(el.prototype,"rT",{get:function(){if(this.iT)return this.iT;throw $s()},enumerable:!0,configurable:!0}),el.prototype.Cu=function(t){this.vu=t},el.prototype.Vn=function(t,e){return this.rT.delete(e),pu.resolve()},el.prototype.pn=function(t,e){return this.rT.add(e),pu.resolve()},el.prototype.Uo=function(t,e){return this.rT.add(e),pu.resolve()},el.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.Vu();return r._a(t,e.targetId).next(function(t){t.forEach(function(t){return n.rT.add(t)})}).next(function(){return r.ia(t,e)})},el.prototype.tT=function(){this.iT=new Set},el.prototype.eT=function(t){var n=this,r=this.persistence.gu().ya();return pu.forEach(this.rT,function(e){return n.hT(t,e).next(function(t){t||r.zn(e)})}).next(function(){return n.iT=null,r.apply(t)})},el.prototype.Nu=function(t,e){var n=this;return this.hT(t,e).next(function(t){t?n.rT.delete(e):n.rT.add(e)})},el.prototype.Zf=function(t){return 0},el.prototype.hT=function(t,e){var n=this;return pu.Un([function(){return n.persistence.Vu().Cn(t,e)},function(){return n.persistence.sT(t,e)},function(){return pu.resolve(n.vu.Cn(e))}])},el),Wf=(tl.prototype.initialize=function(n){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.qd=this.oT(n),this.persistence=this.aT(n),[4,this.persistence.start()];case 1:return t.sent(),this.uT=this.cT(n),this.M_=this._T(n),this.Nd=this.lT(n),this.ol=this.dT(n),this.fT=this.TT(n),this.qd.y_=function(t){return e.ol.Sd(t,1)},this.Nd.ol=this.ol,[4,this.M_.start()];case 2:return t.sent(),[4,this.qd.start()];case 3:return t.sent(),[4,this.Nd.start()];case 4:return t.sent(),[4,this.Nd.Pl(this.ol.Zd)];case 5:return t.sent(),[2]}})})},tl.prototype.TT=function(t){return new wf(this.ol)},tl.prototype.cT=function(t){return null},tl.prototype._T=function(t){return new Th(this.persistence,new Ef,t.ET)},tl.prototype.aT=function(t){return new Gf(Qf.nT)},tl.prototype.lT=function(t){var e=this;return new zc(this.M_,t.I_,t.Br,function(t){return e.ol.Sd(t,0)},t.platform.IT())},tl.prototype.oT=function(t){return new df},tl.prototype.dT=function(t){return new mf(this.M_,this.Nd,this.qd,t.ET,t.Ud)},tl.prototype.clearPersistence=function(t){throw new Dr(Sr.FAILED_PRECONDITION,"You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.")},tl),Kf=(n(Zf,Bf=Wf),Zf.prototype.initialize=function(e){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){switch(t.label){case 0:return[4,Bf.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,this.persistence.su(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.ol.Pl(e)];case 1:return t.sent(),this.uT&&(e&&!this.uT.qh?this.uT.start(this.M_):e||this.uT.stop()),[2]}})})})];case 2:return t.sent(),[2]}})})},Zf.prototype._T=function(t){return new _h(this.persistence,new Ef,t.ET)},Zf.prototype.dT=function(t){var e=new gf(this.M_,this.Nd,this.qd,t.ET,t.Ud);return this.qd instanceof pf&&(this.qd.ol=e),e},Zf.prototype.cT=function(t){var e=this.persistence.mo.Mh;return new Hu(e,t.Br)},Zf.prototype.aT=function(t){var e=ph.bu(t.wT),n=t.platform.Sc(t.wT.ii);return new ph(t.RT.synchronizeTabs,e,t.clientId,t.platform,Fu.Sh(t.RT.cacheSizeBytes),t.Br,n,this.qd,t.RT.mT)},Zf.prototype.oT=function(t){if(t.RT.AT&&t.RT.synchronizeTabs){if(!pf.eo(t.platform))throw new Dr(Sr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var e=ph.bu(t.wT);return new pf(t.Br,t.platform,e,t.clientId,t.ET)}return new df},Zf.prototype.clearPersistence=function(t){var e=ph.bu(t);return ph.clearPersistence(e)},Zf),Yf=($f.prototype.start=function(e,n){var r=this;this.PT();var i=new Ru,o=new Ru,s=!1;return this.credentials.l(function(t){if(!s)return s=!0,Ys("FirestoreClient","Initializing. user=",t.uid),r.VT(e,n,t,o).then(i.resolve,i.reject);r.Br.zr(function(){return r.Al(t)})}),this.Br.zr(function(){return i.promise}),o.promise},$f.prototype.enableNetwork=function(){var t=this;return this.PT(),this.Br.enqueue(function(){return t.ol.enableNetwork()})},$f.prototype.VT=function(a,h,c,f){return y(this,void 0,void 0,function(){var r,i,o,s,u=this;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,this.platform.gT(this.wT)];case 1:return r=t.sent(),i=this.platform.Sc(this.wT.ii),e=r,n=this.credentials,o=new jc(e,n,i),[4,a.initialize({Br:this.Br,wT:this.wT,platform:this.platform,I_:o,clientId:this.clientId,ET:c,Ud:100,RT:h})];case 2:return t.sent(),this.persistence=a.persistence,this.qd=a.qd,this.M_=a.M_,this.Nd=a.Nd,this.ol=a.ol,this.uT=a.uT,this.pT=a.fT,this.persistence.iu(function(){return y(u,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),f.resolve(),[3,4];case 3:if(s=t.sent(),f.reject(s),!this.yT(s))throw s;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+s),this.VT(new Wf,{AT:!1},c,f))];case 4:return[2]}var e,n})})},$f.prototype.yT=function(t){return"FirebaseError"===t.name?t.code===Sr.FAILED_PRECONDITION||t.code===Sr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},$f.prototype.PT=function(){if(this.Br.rh)throw new Dr(Sr.FAILED_PRECONDITION,"The client has already been terminated.")},$f.prototype.Al=function(t){return this.Br.fh(),Ys("FirestoreClient","Credential Changed. Current user: "+t.uid),this.ol.Al(t)},$f.prototype.disableNetwork=function(){var t=this;return this.PT(),this.Br.enqueue(function(){return t.ol.disableNetwork()})},$f.prototype.terminate=function(){var t=this;return this.Br._h(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.uT&&this.uT.stop(),[4,this.Nd.Eu()];case 1:return t.sent(),[4,this.qd.Eu()];case 2:return t.sent(),[4,this.persistence.Eu()];case 3:return t.sent(),this.credentials.T(),[2]}})})})},$f.prototype.waitForPendingWrites=function(){var t=this;this.PT();var e=new Ru;return this.Br.zr(function(){return t.ol._f(e)}),e.promise},$f.prototype.listen=function(t,e,n){var r=this;this.PT();var i=new bf(t,e,n);return this.Br.zr(function(){return r.pT.listen(i)}),i},$f.prototype.rl=function(t){var e=this;this.bT||this.Br.zr(function(){return e.pT.rl(t)})},$f.prototype.vT=function(t){var e=this;return this.PT(),this.Br.enqueue(function(){return e.M_.tc(t)}).then(function(t){if(t instanceof To)return t;if(t instanceof Io)return null;throw new Dr(Sr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},$f.prototype.ST=function(i){var t=this;return this.PT(),this.Br.enqueue(function(){return y(t,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return[4,this.M_.ic(i,!0)];case 1:return e=t.sent(),n=new yf(i,e.nc),r=n.Pd(e.documents),[2,n.Xn(r,!1).snapshot]}})})})},$f.prototype.write=function(t){var e=this;this.PT();var n=new Ru;return this.Br.zr(function(){return e.ol.write(t,n)}),n.promise},$f.prototype.ii=function(){return this.wT.ii},$f.prototype.vf=function(t){var e=this;this.PT(),this.Br.zr(function(){return e.pT.vf(t),Promise.resolve()})},$f.prototype.Sf=function(t){this.bT||this.pT.Sf(t)},Object.defineProperty($f.prototype,"bT",{get:function(){return this.Br.rh},enumerable:!0,configurable:!0}),$f.prototype.transaction=function(t){var e=this;this.PT();var n=new Ru;return this.Br.zr(function(){return e.ol.runTransaction(e.Br,t,n),Promise.resolve()}),n.promise},$f),Xf=(Jf.prototype.next=function(t){this.DT(this.observer.next,t)},Jf.prototype.error=function(t){this.DT(this.observer.error,t)},Jf.prototype.CT=function(){this.muted=!0},Jf.prototype.DT=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Jf);function Jf(t){this.observer=t,this.muted=!1}function $f(t,e,n,r){this.platform=t,this.wT=e,this.credentials=n,this.Br=r,this.clientId=eu.cn()}function Zf(){return null!==Bf&&Bf.apply(this,arguments)||this}function tl(){}function el(t){this.persistence=t,this.vu=null,this.iT=null}function nl(t){var e=this;return(e=Ff.call(this)||this).xa=t,e}function rl(t){var e=this;this.Xf={},this.eu=new wu(0),this.Ba=!1,this.Ba=!0,this.mo=t(this),this.za=new zf(this),this.nr=new Ca,this.sr=new If(this.nr,function(t){return e.mo.Zf(t)})}function il(t){this.persistence=t,this.zf=new au(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Pr.min(),this.highestTargetId=0,this.Hf=0,this.Yf=new fu,this.targetCount=0,this.Jf=ba.jo()}function ol(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var sl,ul,al=(Rl.prototype.NT=function(t){switch(hi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return vi(t.integerValue||t.doubleValue);case 3:return this.kT(t.timestampValue);case 4:return this.$T(t);case 5:return t.stringValue;case 6:return new Kh(mi(t.bytesValue));case 7:return this.MT(t.referenceValue);case 8:return this.LT(t.geoPointValue);case 9:return this.xT(t.arrayValue);case 10:return this.OT(t.mapValue);default:throw $s()}},Rl.prototype.OT=function(t){var n=this,r={};return Zr(t.fields||{},function(t,e){r[t]=n.NT(e)}),r},Rl.prototype.LT=function(t){return new cc(vi(t.latitude),vi(t.longitude))},Rl.prototype.xT=function(t){var e=this;return(t.values||[]).map(function(t){return e.NT(t)})},Rl.prototype.$T=function(t){switch(this.FT){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return si(n)?t(n):n}(t);return null==e?null:this.NT(e);case"estimate":return this.kT(ui(t));default:return null}},Rl.prototype.kT=function(t){var e=yi(t),n=new Lr(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},Rl.prototype.MT=function(t){var e=Mr.K(t);Zs(zs(e));var n=new uu(e.get(1),e.get(3)),r=new Xr(e.$(5));return n.isEqual(this.firestore.Mc)||Xs("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.firestore.Mc.projectId+"/"+this.firestore.Mc.database+") instead."),new dl(r,this.firestore,this.converter)},Rl),hl=Fu.Fh,cl=(Ol.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},Ol),fl=(kl.prototype.settings=function(t){xh("Firestore.settings",arguments,1),Rh("Firestore.settings","object",1,t);var e=new cl(t);if(this.QT&&!this.zT.isEqual(e))throw new Dr(Sr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.zT=e).credentials&&(this.KT=function(t){if(!t)return new xr;switch(t.type){case"gapi":var e=t.YT;return Zs(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Rr(e,t.V||"0");case"provider":return t.YT;default:throw new Dr(Sr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},kl.prototype.enableNetwork=function(){return this.UT(),this.QT.enableNetwork()},kl.prototype.disableNetwork=function(){return this.UT(),this.QT.disableNetwork()},kl.prototype.enablePersistence=function(t){var e,n;if(this.QT)throw new Dr(Sr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Xs("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab),this.JT(this.GT,{AT:!0,cacheSizeBytes:this.zT.cacheSizeBytes,synchronizeTabs:r,mT:i})},kl.prototype.clearPersistence=function(){return y(this,void 0,void 0,function(){var r,e=this;return v(this,function(t){if(void 0!==this.QT&&!this.QT.bT)throw new Dr(Sr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return r=new Ru,[2,(this.qT.hh(function(){return y(e,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),e=this.XT(),[4,this.GT.clearPersistence(e)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return n=t.sent(),r.reject(n),[3,3];case 3:return[2]}})})}),r.promise)]})})},kl.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(kl.prototype,"ZT",{get:function(){return this.UT(),this.QT.bT},enumerable:!0,configurable:!0}),kl.prototype.waitForPendingWrites=function(){return this.UT(),this.QT.waitForPendingWrites()},kl.prototype.onSnapshotsInSync=function(t){if(this.UT(),ol(t))return this.tE(t);Rh("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.tE(e)},kl.prototype.tE=function(t){var e=this,n=new Xf({next:function(){t.next&&t.next()},error:function(t){throw $s()}});return this.QT.vf(n),function(){n.CT(),e.QT.Sf(n)}},kl.prototype.UT=function(){return this.QT||this.JT(new Wf,{AT:!1}),this.QT},kl.prototype.XT=function(){return new su(this.Mc,this.jT,this.zT.host,this.zT.ssl,this.zT.forceLongPolling)},kl.prototype.JT=function(t,e){var n=this.XT();return this.QT=new Yf(Gs.nt(),n,this.KT,this.qT),this.QT.start(t,e)},kl.WT=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new Dr(Sr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new Dr(Sr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new uu(n)},Object.defineProperty(kl.prototype,"app",{get:function(){if(!this.BT)throw new Dr(Sr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.BT},enumerable:!0,configurable:!0}),kl.prototype.collection=function(t){return xh("Firestore.collection",arguments,1),Rh("Firestore.collection","non-empty string",1,t),this.UT(),new bl(Mr.K(t),this)},kl.prototype.doc=function(t){return xh("Firestore.doc",arguments,1),Rh("Firestore.doc","non-empty string",1,t),this.UT(),dl.eE(Mr.K(t),this)},kl.prototype.collectionGroup=function(t){if(xh("Firestore.collectionGroup",arguments,1),Rh("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.UT(),new gl(new Ao(Mr.G,t),this)},kl.prototype.runTransaction=function(e){var n=this;return xh("Firestore.runTransaction",arguments,1),Rh("Firestore.runTransaction","function",1,e),this.UT().transaction(function(t){return e(new ll(n,t))})},kl.prototype.batch=function(){return this.UT(),new pl(this)},Object.defineProperty(kl,"logLevel",{get:function(){switch(Ws()){case l.DEBUG:return"debug";case l.SILENT:return"silent";default:return"error"}},enumerable:!0,configurable:!0}),kl.setLogLevel=function(t){switch(xh("Firestore.setLogLevel",arguments,1),Rh("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Ks(l.DEBUG);break;case"error":Ks(l.ERROR);break;case"silent":Ks(l.SILENT);break;default:throw new Dr(Sr.INVALID_ARGUMENT,"Invalid log level: "+t)}},kl.prototype.sE=function(){return this.zT.timestampsInSnapshots},kl),ll=(xl.prototype.get=function(t){var n=this;xh("Transaction.get",arguments,1);var r=Ml("Transaction.get",t,this.iE);return this.nE.P_([r.Lc]).then(function(t){if(!t||1!==t.length)return $s();var e=t[0];if(e instanceof Io)return new vl(n.iE,r.Lc,null,!1,!1,r.rE);if(e instanceof To)return new vl(n.iE,r.Lc,e,!1,!1,r.rE);throw $s()})},xl.prototype.set=function(t,e,n){Oh("Transaction.set",arguments,2,3);var r=Ml("Transaction.set",t,this.iE);n=Ll("Transaction.set",n);var i=Cl(r.rE,e,"Transaction.set"),o=i[0],s=i[1],u=n.merge||n.mergeFields?this.iE.HT.Fc(s,o,n.mergeFields):this.iE.HT.Dc(s,o);return this.nE.set(r.Lc,u),this},xl.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof Yh?(kh("Transaction.update",arguments,3),r=Ml("Transaction.update",t,this.iE),this.iE.HT.kc("Transaction.update",e,n,o)):(xh("Transaction.update",arguments,2),r=Ml("Transaction.update",t,this.iE),this.iE.HT.Nc("Transaction.update",e)),this.nE.update(r.Lc,i),this},xl.prototype.delete=function(t){xh("Transaction.delete",arguments,1);var e=Ml("Transaction.delete",t,this.iE);return this.nE.delete(e.Lc),this},xl),pl=(Dl.prototype.set=function(t,e,n){Oh("WriteBatch.set",arguments,2,3),this.aE();var r=Ml("WriteBatch.set",t,this.iE);n=Ll("WriteBatch.set",n);var i=Cl(r.rE,e,"WriteBatch.set"),o=i[0],s=i[1],u=n.merge||n.mergeFields?this.iE.HT.Fc(s,o,n.mergeFields):this.iE.HT.Dc(s,o);return this.hE=this.hE.concat(u.Vc(r.Lc,Bi.ft())),this},Dl.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.aE(),i="string"==typeof e||e instanceof Yh?(kh("WriteBatch.update",arguments,3),r=Ml("WriteBatch.update",t,this.iE),this.iE.HT.kc("WriteBatch.update",e,n,o)):(xh("WriteBatch.update",arguments,2),r=Ml("WriteBatch.update",t,this.iE),this.iE.HT.Nc("WriteBatch.update",e)),this.hE=this.hE.concat(i.Vc(r.Lc,Bi.exists(!0))),this},Dl.prototype.delete=function(t){xh("WriteBatch.delete",arguments,1),this.aE();var e=Ml("WriteBatch.delete",t,this.iE);return this.hE=this.hE.concat(new Qi(e.Lc,Bi.ft())),this},Dl.prototype.commit=function(){return this.aE(),this.oE=!0,0<this.hE.length?this.iE.UT().write(this.hE):Promise.resolve()},Dl.prototype.aE=function(){if(this.oE)throw new Dr(Sr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},Dl),dl=(Sl.eE=function(t,e,n){if(t.length%2!=0)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.j()+" has "+t.length);return new Sl(new Xr(t),e,n)},Object.defineProperty(Sl.prototype,"id",{get:function(){return this.Lc.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(Sl.prototype,"parent",{get:function(){return new bl(this.Lc.path.M(),this.firestore,this.rE)},enumerable:!0,configurable:!0}),Object.defineProperty(Sl.prototype,"path",{get:function(){return this.Lc.path.j()},enumerable:!0,configurable:!0}),Sl.prototype.collection=function(t){if(xh("DocumentReference.collection",arguments,1),Rh("DocumentReference.collection","non-empty string",1,t),!t)throw new Dr(Sr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Mr.K(t);return new bl(this.Lc.path.child(e),this.firestore)},Sl.prototype.isEqual=function(t){if(!(t instanceof Sl))throw Fh("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.Lc.isEqual(t.Lc)&&this.rE===t.rE},Sl.prototype.set=function(t,e){Oh("DocumentReference.set",arguments,1,2),e=Ll("DocumentReference.set",e);var n=Cl(this.rE,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore.HT.Fc(i,r,e.mergeFields):this.firestore.HT.Dc(i,r);return this.QT.write(o.Vc(this.Lc,Bi.ft()))},Sl.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof Yh?(kh("DocumentReference.update",arguments,2),this.firestore.HT.kc("DocumentReference.update",t,e,r)):(xh("DocumentReference.update",arguments,1),this.firestore.HT.Nc("DocumentReference.update",t)),this.QT.write(n.Vc(this.Lc,Bi.exists(!0)))},Sl.prototype.delete=function(){return xh("DocumentReference.delete",arguments,0),this.QT.write([new Qi(this.Lc,Bi.ft())])},Sl.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Oh("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||ol(t[i])||(Bh("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),Vh("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=ol(t[i])?t[i]:(Rh("DocumentReference.onSnapshot","function",i,t[i]),Lh("DocumentReference.onSnapshot","function",i+1,t[i+1]),Lh("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.uE(o,n)},Sl.prototype.uE=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new Xf({next:function(t){if(n.next){var e=t.docs.get(r.Lc);n.next(new vl(r.firestore,r.Lc,e,t.fromCache,t.hasPendingWrites,r.rE))}},error:e}),o=this.QT.listen(Ao.Wt(this.Lc.path),i,t);return function(){i.CT(),r.QT.rl(o)}},Sl.prototype.get=function(n){var r=this;return Oh("DocumentReference.get",arguments,0,1),Vl("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.UT().vT(r.Lc).then(function(t){e(new vl(r.firestore,r.Lc,t,!0,t instanceof To&&t.At,r.rE))},t):r.cE(e,t,n)})},Sl.prototype.cE=function(e,n,r){var i=this.uE({includeMetadataChanges:!0,Mf:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new Dr(Sr.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new Dr(Sr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},Sl.prototype.withConverter=function(t){return new Sl(this.Lc,this.firestore,t)},Sl),yl=(Al.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},Al),vl=(_l.prototype.data=function(t){if(Oh("DocumentSnapshot.data",arguments,0,1),t=Pl("DocumentSnapshot.data",t),this._E){if(this.rE){var e=new ml(this.iE,this.Lc,this._E,this.lE,this.dE);return this.rE.fromFirestore(e,t)}return new al(this.iE,this.iE.sE(),t.serverTimestamps,void 0).NT(this._E.Mt())}},_l.prototype.get=function(t,e){if(Oh("DocumentSnapshot.get",arguments,1,2),e=Pl("DocumentSnapshot.get",e),this._E){var n=this._E.data().field(Oc("DocumentSnapshot.get",t));if(null!==n)return new al(this.iE,this.iE.sE(),e.serverTimestamps,this.rE).NT(n)}},Object.defineProperty(_l.prototype,"id",{get:function(){return this.Lc.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(_l.prototype,"ref",{get:function(){return new dl(this.Lc,this.iE,this.rE)},enumerable:!0,configurable:!0}),Object.defineProperty(_l.prototype,"exists",{get:function(){return null!==this._E},enumerable:!0,configurable:!0}),Object.defineProperty(_l.prototype,"metadata",{get:function(){return new yl(this.dE,this.lE)},enumerable:!0,configurable:!0}),_l.prototype.isEqual=function(t){if(!(t instanceof _l))throw Fh("isEqual","DocumentSnapshot",1,t);return this.iE===t.iE&&this.lE===t.lE&&this.Lc.isEqual(t.Lc)&&(null===this._E?null===t._E:this._E.isEqual(t._E))&&this.rE===t.rE},_l),ml=(n(Nl,ul=vl),Nl.prototype.data=function(t){return ul.prototype.data.call(this,t)},Nl),gl=(Il.prototype.where=function(t,e,n){xh("Query.where",arguments,3),jh("Query.where",3,n);var r,i=function(t,e){if(!t.some(function(t){return t===e}))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid value "+Uh(e)+" provided to function Query.where() for its "+Gh(2)+" argument. Acceptable values: "+t.join(", "));return e}(["<","<=","==",">=",">","array-contains","in","array-contains-any"],e),o=Oc("Query.where",t);if(o.Y()){if("array-contains"===i||"array-contains-any"===i)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i){this.TE(n,i);for(var s=[],u=0,a=n;u<a.length;u++){var h=a[u];s.push(this.EE(h))}r={arrayValue:{values:s}}}else r=this.EE(n)}else"in"!==i&&"array-contains-any"!==i||this.TE(n,i),r=this.firestore.HT.$c("Query.where",n,"in"===i);var c=So.create(o,i,r);return this.IE(c),new Il(this.fE.Gt(c),this.firestore,this.rE)},Il.prototype.orderBy=function(t,e){var n;if(Oh("Query.orderBy",arguments,1,2),Lh("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new Dr(Sr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}if(null!==this.fE.startAt)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.fE.endAt)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=Oc("Query.orderBy",t),i=new Po(r,n);return this.wE(i),new Il(this.fE.zt(i),this.firestore,this.rE)},Il.prototype.limit=function(t){return xh("Query.limit",arguments,1),Rh("Query.limit","number",1,t),zh("Query.limit",1,t),new Il(this.fE.Ht(t),this.firestore,this.rE)},Il.prototype.limitToLast=function(t){return xh("Query.limitToLast",arguments,1),Rh("Query.limitToLast","number",1,t),zh("Query.limitToLast",1,t),new Il(this.fE.Yt(t),this.firestore,this.rE)},Il.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];kh("Query.startAt",arguments,1);var r=this.RE("Query.startAt",t,e,!0);return new Il(this.fE.Jt(r),this.firestore,this.rE)},Il.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];kh("Query.startAfter",arguments,1);var r=this.RE("Query.startAfter",t,e,!1);return new Il(this.fE.Jt(r),this.firestore,this.rE)},Il.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];kh("Query.endBefore",arguments,1);var r=this.RE("Query.endBefore",t,e,!0);return new Il(this.fE.Xt(r),this.firestore,this.rE)},Il.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];kh("Query.endAt",arguments,1);var r=this.RE("Query.endAt",t,e,!1);return new Il(this.fE.Xt(r),this.firestore,this.rE)},Il.prototype.isEqual=function(t){if(!(t instanceof Il))throw Fh("isEqual","Query",1,t);return this.firestore===t.firestore&&this.fE.isEqual(t.fE)},Il.prototype.withConverter=function(t){return new Il(this.fE,this.firestore,t)},Il.prototype.RE=function(t,e,n,r){if(jh(t,1,e),e instanceof vl){if(0<n.length)throw new Dr(Sr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Dr(Sr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.mE(i._E,r)}var o=[e].concat(n);return this.AE(t,o,r)},Il.prototype.mE=function(t,e){for(var n=[],r=0,i=this.fE.orderBy;r<i.length;r++){var o=i[r];if(o.field.Y())n.push(gi(this.firestore.Mc,t.key));else{var s=t.field(o.field);if(si(s))throw new Dr(Sr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=o.field.j();throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}n.push(s)}}return new Lo(n,e)},Il.prototype.AE=function(t,e,n){var r=this.fE.Ot;if(e.length>r.length)throw new Dr(Sr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.Y()){if("string"!=typeof s)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.fE._e()&&-1!==s.indexOf("/"))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var u=this.fE.path.child(Mr.K(s));if(!Xr.et(u))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+u+"' is not because it contains an odd number of segments.");var a=new Xr(u);i.push(gi(this.firestore.Mc,a))}else{var h=this.firestore.HT.$c(t,s);i.push(h)}}return new Lo(i,n)},Il.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Oh("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||ol(t[i])||(Bh("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Vh("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=ol(t[i])?t[i]:(Rh("Query.onSnapshot","function",i,t[i]),Lh("Query.onSnapshot","function",i+1,t[i+1]),Lh("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.PE(this.fE),this.uE(r,n)},Il.prototype.uE=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Xf({next:function(t){e.next&&e.next(new wl(n.firestore,n.fE,t,n.rE))},error:r}),o=this.firestore.UT(),s=o.listen(this.fE,i,t);return function(){i.CT(),o.rl(s)}},Il.prototype.PE=function(t){if(t.ae()&&0===t.Ot.length)throw new Dr(Sr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},Il.prototype.get=function(n){var r=this;return Oh("Query.get",arguments,0,1),Vl("Query.get",n),this.PE(this.fE),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.UT().ST(r.fE).then(function(t){e(new wl(r.firestore,r.fE,t,r.rE))},t):r.cE(e,t,n)})},Il.prototype.cE=function(e,n,r){var i=this.uE({includeMetadataChanges:!0,Mf:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new Dr(Sr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},Il.prototype.EE=function(t){if("string"==typeof t){if(""===t)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.fE._e()&&-1!==t.indexOf("/"))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.fE.path.child(Mr.K(t));if(!Xr.et(e))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return gi(this.firestore.Mc,new Xr(e))}if(t instanceof dl){var n=t;return gi(this.firestore.Mc,n.Lc)}throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Uh(t)+".")},Il.prototype.TE=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},Il.prototype.IE=function(t){if(t instanceof So){var e=["array-contains","array-contains-any"],n=["in","array-contains-any"],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.ue()){var o=this.fE.jt();if(null!==o&&!o.isEqual(t.field))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.fE.Kt();null!==s&&this.VE(t.field,s)}else if(i||r){var u=null;if(i&&(u=this.fE.ce(n)),null===u&&r&&(u=this.fE.ce(e)),null!=u)throw u===t.op?new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+u.toString()+"' filters.")}}},Il.prototype.wE=function(t){if(null===this.fE.Kt()){var e=this.fE.jt();null!==e&&this.VE(e,t.field)}},Il.prototype.VE=function(t,e){if(!e.isEqual(t))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},Il),wl=(Object.defineProperty(Tl.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(Tl.prototype,"empty",{get:function(){return this.pE.docs.B()},enumerable:!0,configurable:!0}),Object.defineProperty(Tl.prototype,"size",{get:function(){return this.pE.docs.size},enumerable:!0,configurable:!0}),Tl.prototype.forEach=function(e,n){var r=this;Oh("QuerySnapshot.forEach",arguments,1,2),Rh("QuerySnapshot.forEach","function",1,e),this.pE.docs.forEach(function(t){e.call(n,r.vE(t))})},Object.defineProperty(Tl.prototype,"query",{get:function(){return new gl(this.gE,this.iE,this.rE)},enumerable:!0,configurable:!0}),Tl.prototype.docChanges=function(t){t&&(Bh("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Vh("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.pE.hs)throw new Dr(Sr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.yE&&this.bE===e||(this.yE=function(i,e,o,s){if(o.ss.B()){var n=0;return o.docChanges.map(function(t){var e=new ml(i,t.doc.key,t.doc,o.fromCache,o.ns.has(t.doc.key),s);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var u=o.ss;return o.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new ml(i,t.doc.key,t.doc,o.fromCache,o.ns.has(t.doc.key),s),n=-1,r=-1;return 0!==t.type&&(n=u.indexOf(t.doc.key),u=u.delete(t.doc.key)),1!==t.type&&(r=(u=u.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $s()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.iE,e,this.pE,this.rE),this.bE=e),this.yE},Tl.prototype.isEqual=function(t){if(!(t instanceof Tl))throw Fh("isEqual","QuerySnapshot",1,t);return this.iE===t.iE&&this.gE.isEqual(t.gE)&&this.pE.isEqual(t.pE)&&this.rE===t.rE},Tl.prototype.vE=function(t){return new ml(this.iE,t.key,t,this.metadata.fromCache,this.pE.ns.has(t.key),this.rE)},Tl),bl=(n(El,sl=gl),Object.defineProperty(El.prototype,"id",{get:function(){return this.fE.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(El.prototype,"parent",{get:function(){var t=this.fE.path.M();return t.B()?null:new dl(new Xr(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(El.prototype,"path",{get:function(){return this.fE.path.j()},enumerable:!0,configurable:!0}),El.prototype.doc=function(t){if(Oh("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=eu.cn()),Rh("CollectionReference.doc","non-empty string",1,t),""===t)throw new Dr(Sr.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Mr.K(t);return dl.eE(this.fE.path.child(e),this.firestore,this.rE)},El.prototype.add=function(t){xh("CollectionReference.add",arguments,1),Rh("CollectionReference.add","object",1,this.rE?this.rE.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},El.prototype.withConverter=function(t){return new El(this.SE,this.firestore,t)},El);function El(t,e,n){var r=this;if(((r=sl.call(this,Ao.Wt(t),e,n)||this).SE=t).length%2!=1)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.j()+" has "+t.length);return r}function Tl(t,e,n,r){this.iE=t,this.gE=e,this.pE=n,this.rE=r,this.yE=null,this.bE=null,this.metadata=new yl(n.hasPendingWrites,n.fromCache)}function Il(t,e,n){this.fE=t,this.firestore=e,this.rE=n}function Nl(){return null!==ul&&ul.apply(this,arguments)||this}function _l(t,e,n,r,i,o){this.iE=t,this.Lc=e,this._E=n,this.lE=r,this.dE=i,this.rE=o}function Al(t,e){this.hasPendingWrites=t,this.fromCache=e}function Sl(t,e,n){this.Lc=t,this.firestore=e,this.rE=n,this.QT=this.firestore.UT()}function Dl(t){this.iE=t,this.hE=[],this.oE=!1}function xl(t,e){this.iE=t,this.nE=e}function kl(t,e,n){var r=this;if(void 0===n&&(n=new Wf),this.BT=null,this.qT=new Vu,this.INTERNAL={delete:function(){return y(r,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.UT(),[4,this.QT.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var i=t;this.BT=i,this.Mc=kl.WT(i),this.jT=i.name,this.KT=new kr(e)}else{var o=t;if(!o.projectId)throw new Dr(Sr.INVALID_ARGUMENT,"Must provide projectId");this.Mc=new uu(o.projectId,o.database),this.jT="[DEFAULT]",this.KT=new xr}this.GT=n,this.zT=new cl({}),this.HT=new Nc(this.Mc)}function Ol(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Dr(Sr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Ph("settings","non-empty string","host",t.host),this.host=t.host,Vh("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(Bh("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Vh("settings","object","credentials",t.credentials),this.credentials=t.credentials,Vh("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Xs("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&Xs("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,Vh("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Fu.kh;else{if(t.cacheSizeBytes!==hl&&t.cacheSizeBytes<Fu.Nh)throw new Dr(Sr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Fu.Nh);this.cacheSizeBytes=t.cacheSizeBytes}Vh("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}function Rl(t,e,n,r){this.firestore=t,this.timestampsInSnapshots=e,this.FT=n,this.converter=r}function Ll(t,e){if(void 0===e)return{merge:!1};if(Bh(t,e,["merge","mergeFields"]),Vh(t,"boolean","merge",e.merge),n=t,void 0!==(r=e.mergeFields)&&function(t,e,n,r){if(!(n instanceof Array))throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Uh(n));for(var i=0;i<n.length;++i)if(!r(n[i]))throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+Uh(n[i]))}(n,"mergeFields",r,function(t){return"string"==typeof t||t instanceof Yh}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n,r;return e}function Pl(t,e){return void 0===e?{}:(Bh(t,e,["serverTimestamps"]),Mh(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Vl(t,e){Lh(t,"object",1,e),e&&(Bh(t,e,["source"]),Mh(t,0,"source",e.source,["default","server","cache"]))}function Ml(t,e,n){if(e instanceof dl){if(e.firestore!==n)throw new Dr(Sr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Fh(t,"DocumentReference",1,e)}function Cl(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}function ql(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Dr(Sr.INVALID_ARGUMENT,t)}return n.prototype=t.prototype,Object.assign(n,t),n}var Ul,jl=ql(fl,"Use firebase.firestore() instead."),Bl=ql(ll,"Use firebase.firestore().runTransaction() instead."),Fl=ql(pl,"Use firebase.firestore().batch() instead."),zl=ql(dl,"Use firebase.firestore().doc() instead."),Gl=ql(vl),Hl=ql(ml),Ql=ql(gl),Wl=ql(wl),Kl=ql(bl,"Use firebase.firestore().collection() instead."),Yl=ql((ap.delete=function(){return Dh("FieldValue.delete",arguments),new oc},ap.serverTimestamp=function(){return Dh("FieldValue.serverTimestamp",arguments),new sc},ap.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return kh("FieldValue.arrayUnion",arguments,1),new uc(t)},ap.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return kh("FieldValue.arrayRemove",arguments,1),new ac(t)},ap.increment=function(t){return Rh("FieldValue.increment","number",1,t),xh("FieldValue.increment",arguments,1),new hc(t)},ap.prototype.isEqual=function(t){return this===t},ap),"Use FieldValue.<field>() instead."),Xl=ql(Kh,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Jl={Firestore:jl,GeoPoint:cc,Timestamp:Lr,Blob:Xl,Transaction:Bl,WriteBatch:Fl,DocumentReference:zl,DocumentSnapshot:Gl,Query:Ql,QueryDocumentSnapshot:Hl,QuerySnapshot:Wl,CollectionReference:Kl,FieldPath:Yh,FieldValue:Yl,setLogLevel:fl.setLogLevel,CACHE_SIZE_UNLIMITED:hl},$l=(up.prototype.q_=function(t){},up.prototype.Eu=function(){},up),Zl=(sp.prototype.q_=function(t){this.kE.push(t)},sp.prototype.Eu=function(){window.removeEventListener("online",this.DE),window.removeEventListener("offline",this.FE)},sp.prototype.$E=function(){window.addEventListener("online",this.DE),window.addEventListener("offline",this.FE)},sp.prototype.CE=function(){Ys("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.kE;t<e.length;t++)(0,e[t])(0)},sp.prototype.NE=function(){Ys("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.kE;t<e.length;t++)(0,e[t])(1)},sp.eo=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},sp),tp=(op.prototype.i_=function(t){this.xE=t},op.prototype.Xc=function(t){this.OE=t},op.prototype.onMessage=function(t){this.BE=t},op.prototype.close=function(){this.LE()},op.prototype.send=function(t){this.ME(t)},op.prototype.qE=function(){this.xE()},op.prototype.UE=function(t){this.OE(t)},op.prototype.QE=function(t){this.BE(t)},op),ep={BatchGetDocuments:"batchGet",Commit:"commit"},np="gl-js/ fire/"+Er,rp=(ip.prototype.jE=function(t,e){if(e)for(var n in e.o)e.o.hasOwnProperty(n)&&(t[n]=e.o[n]);t["X-Goog-Api-Client"]=np},ip.prototype.T_=function(a,r,i){var h=this,c=this.KE(a);return new Promise(function(o,s){var u=new br;u.listenOnce(gr.COMPLETE,function(){try{switch(u.getLastErrorCode()){case mr.NO_ERROR:var t=u.getResponseJson();Ys("Connection","XHR received:",JSON.stringify(t)),o(t);break;case mr.TIMEOUT:Ys("Connection",'RPC "'+a+'" timed out'),s(new Dr(Sr.DEADLINE_EXCEEDED,"Request time out"));break;case mr.HTTP_ERROR:var e=u.getStatus();if(Ys("Connection",'RPC "'+a+'" failed with status:',e,"response text:",u.getResponseText()),0<e){var n=u.getResponseJson().error;if(n&&n.status&&n.message){var r=(i=n.status.toLowerCase().replace("_","-"),0<=Object.values(Sr).indexOf(i)?i:Sr.UNKNOWN);s(new Dr(r,n.message))}else s(new Dr(Sr.UNKNOWN,"Server responded with status "+u.getStatus()))}else Ys("Connection",'RPC "'+a+'" failed'),s(new Dr(Sr.UNAVAILABLE,"Connection failed."));break;default:$s()}}finally{Ys("Connection",'RPC "'+a+'" completed.')}var i});var t=Object.assign({},r);delete t.database;var e=JSON.stringify(t);Ys("Connection","XHR sending: ",c+" "+e);var n={"Content-Type":"text/plain"};h.jE(n,i),u.send(c,"POST",e,n,15)})},ip.prototype.E_=function(t,e,n){return this.T_(t,e,n)},ip.prototype.n_=function(t,e){var n,r,i=[this.WE,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=vr(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.ii.projectId+"/databases/"+this.ii.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.jE(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=p().indexOf("Electron/")||0<=(r=p()).indexOf("MSIE ")||0<=r.indexOf("Trident/")||0<=p().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");function a(t,e){h.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Ys("Connection","Creating WebChannel: "+u+" "+s);var h=o.createWebChannel(u,s),c=!1,f=!1,l=new tp({ME:function(t){f?Ys("Connection","Not sending because WebChannel is closed:",t):(c||(Ys("Connection","Opening WebChannel transport."),h.open(),c=!0),Ys("Connection","WebChannel sending:",t),h.send(t))},LE:function(){return h.close()}});return a(wr.EventType.OPEN,function(){f||Ys("Connection","WebChannel transport opened.")}),a(wr.EventType.CLOSE,function(){f||(f=!0,Ys("Connection","WebChannel transport closed"),l.UE())}),a(wr.EventType.ERROR,function(t){f||(f=!0,Ys("Connection","WebChannel transport errored:",t),l.UE(new Dr(Sr.UNAVAILABLE,"The operation could not be completed")))}),a(wr.EventType.MESSAGE,function(t){var e;if(!f){var n=t.data[0];Zs(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Ys("Connection","WebChannel received error:",r);var i=r.status,o=function(){var t=co[i];if(void 0!==t)return Jo(t)}(),s=r.message;void 0===o&&(o=Sr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.UE(new Dr(o,s)),h.close()}else Ys("Connection","WebChannel received:",n),l.QE(n)}}),setTimeout(function(){l.qE()},0),l},ip.prototype.KE=function(t){var e=ep[t];return this.WE+"/v1/projects/"+this.ii.projectId+"/databases/"+this.ii.database+"/documents:"+e},ip);function ip(t){this.ii=t.ii;var e=t.ssl?"https":"http";this.WE=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function op(t){this.ME=t.ME,this.LE=t.LE}function sp(){var t=this;this.DE=function(){return t.CE()},this.FE=function(){return t.NE()},this.kE=[],this.$E()}function up(){}function ap(){}function hp(){this.cc="undefined"!=typeof atob}Gs.an((Object.defineProperty(hp.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(hp.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),hp.prototype.gT=function(t){return Promise.resolve(new rp(t))},hp.prototype.IT=function(){return new(Zl.eo()?Zl:$l)},hp.prototype.Sc=function(t){return new Bs(t,{hi:!0})},hp.prototype.un=function(t){return JSON.stringify(t)},hp.prototype.atob=function(t){return atob(t)},hp.prototype.btoa=function(t){return btoa(t)},new hp)),(Ul=cp).INTERNAL.registerComponent(new E("firestore",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),new fl(e,n,new Kf);var e,n},"PUBLIC").setServiceProps(Object.assign({},Jl))),Ul.registerVersion("@firebase/firestore","1.14.2")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map
