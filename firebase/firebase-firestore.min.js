!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(jd){"use strict";try{(function(){jd=jd&&jd.hasOwnProperty("default")?jd.default:jd;var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function t(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o,e,f=function(){return(f=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function p(o,s,a,u){return new(a=a||Promise)(function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(n,r)}i((u=u.apply(o,s||[])).next())})}function v(n,r){var i,o,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}function a(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}(e=o=o||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT";function n(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case o.DEBUG:case o.VERBOSE:console.log.apply(console,a(["["+i+"]  "+t.name+":"],n));break;case o.INFO:console.info.apply(console,a(["["+i+"]  "+t.name+":"],n));break;case o.WARN:console.warn.apply(console,a(["["+i+"]  "+t.name+":"],n));break;case o.ERROR:console.error.apply(console,a(["["+i+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}var i=o.INFO,u=(Object.defineProperty(h.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in o))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),h.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.DEBUG],t))},h.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.VERBOSE],t))},h.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.INFO],t))},h.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.WARN],t))},h.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.ERROR],t))},h);function h(t){this.name=t,this._logLevel=i,this._logHandler=n}function l(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var c,d=(t(y,c=Error),y);function y(t,e){var n=c.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,y.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,m.prototype.create),n}var m=(g.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],s=o?function(t,r){return t.replace(w,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})}(o,r):"Error",a=this.serviceName+": "+s+" ("+i+").",u=new d(i,a),h=0,c=Object.keys(r);h<c.length;h++){var f=c[h];"_"!==f.slice(-1)&&(f in u&&console.warn('Overwriting FirebaseError base field "'+f+'" can cause unexpected behavior.'),u[f]=r[f])}return u},g);function g(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var w=/\{\$([^}]+)}/g,b=(E.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},E.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},E.prototype.setServiceProps=function(t){return this.serviceProps=t,this},E);function E(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var I,T="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},N=N||{},A=T;function S(t){return"string"==typeof t}function D(t){return"number"==typeof t}function R(t,e){t=t.split("."),e=e||A;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function k(){}function _(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function x(t){return"array"==_(t)}function C(t){var e=_(t);return"array"==e||"object"==e&&"number"==typeof t.length}function O(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var P="closure_uid_"+(1e9*Math.random()>>>0),L=0;function M(t,e,n){return t.call.apply(t.bind,arguments)}function U(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function q(t,e,n){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?M:U).apply(null,arguments)}function V(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var F=Date.now||function(){return+new Date};function G(t,o){function e(){}e.prototype=o.prototype,t.N=o.prototype,t.prototype=new e,(t.prototype.constructor=t).xb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function j(){this.j=this.j,this.i=this.i}j.prototype.j=!1,j.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[P]||(this[P]=++L)},j.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var Y=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(S(t))return S(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},B=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=S(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function W(t){return Array.prototype.concat.apply([],arguments)}function z(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function H(t){return/^[\s\xa0]*$/.test(t)}var K,Q=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function X(t,e){return-1!=t.indexOf(e)}function J(t,e){return t<e?-1:e<t?1:0}t:{var $=A.navigator;if($){var Z=$.userAgent;if(Z){K=Z;break t}}K=""}function tt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function et(t){var e,n={};for(e in t)n[e]=t[e];return n}var nt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function rt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<nt.length;o++)n=nt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function it(t){return it[" "](t),t}it[" "]=k;var ot,st,at=X(K,"Opera"),ut=X(K,"Trident")||X(K,"MSIE"),ht=X(K,"Edge"),ct=ht||ut,ft=X(K,"Gecko")&&!(X(K.toLowerCase(),"webkit")&&!X(K,"Edge"))&&!(X(K,"Trident")||X(K,"MSIE"))&&!X(K,"Edge"),lt=X(K.toLowerCase(),"webkit")&&!X(K,"Edge");function pt(){var t=A.document;return t?t.documentMode:void 0}t:{var dt="",vt=(st=K,ft?/rv:([^\);]+)(\)|;)/.exec(st):ht?/Edge\/([\d\.]+)/.exec(st):ut?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(st):lt?/WebKit\/(\S+)/.exec(st):at?/(?:Version)[ \/]?(\S+)/.exec(st):void 0);if(vt&&(dt=vt?vt[1]:""),ut){var yt=pt();if(null!=yt&&yt>parseFloat(dt)){ot=String(yt);break t}}ot=dt}var mt,gt={};function wt(a){return function(t,e){var n=gt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(a,function(){for(var t=0,e=Q(String(ot)).split("."),n=Q(String(a)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=J(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||J(0==o[2].length,0==s[2].length)||J(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t})}var bt=A.document;mt=bt&&ut?pt()||("CSS1Compat"==bt.compatMode?parseInt(ot,10):5):void 0;var Et=!ut||9<=Number(mt),It=ut&&!wt("9"),Tt=function(){if(!A.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{A.addEventListener("test",k,e),A.removeEventListener("test",k,e)}catch(t){}return t}();function Nt(t,e){this.type=t,this.a=this.target=e,this.Ia=!0}function At(t,e){if(Nt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ft){t:{try{it(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=S(t.pointerType)?t.pointerType:St[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Nt.prototype.b=function(){this.Ia=!1},G(At,Nt);var St={2:"touch",3:"pen",4:"mouse"};At.prototype.b=function(){At.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,It)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Dt="closure_listenable_"+(1e6*Math.random()|0),Rt=0;function kt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++Rt,this.X=this.Z=!1}function _t(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function xt(t){this.src=t,this.a={},this.b=0}function Ct(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=Y(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(_t(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Ot(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}xt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Ot(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new kt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Pt="closure_lm_"+(1e6*Math.random()|0),Lt={};function Mt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(x(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Bt(r);return e&&e[Dt]?e.Aa(n,r,O(i)?!!i.capture:!!i,o):Ut(e,n,r,!0,i,o)}(t,e,n,r,i);if(x(e)){for(var o=0;o<e.length;o++)Mt(t,e[o],n,r,i);return null}return n=Bt(n),t&&t[Dt]?t.za(e,n,O(r)?!!r.capture:!!r,i):Ut(t,e,n,!1,r,i)}function Ut(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=O(i)?!!i.capture:!!i;if(s&&!Et)return null;var a=jt(t);if(a||(t[Pt]=a=new xt(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var e=Gt,n=Et?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)Tt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Vt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function qt(t){if(!D(t)&&t&&!t.X){var e=t.src;if(e&&e[Dt])Ct(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Vt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=jt(e))?(Ct(n,t),0==n.b&&(n.src=null,e[Pt]=null)):_t(t)}}}function Vt(t){return t in Lt?Lt[t]:Lt[t]="on"+t}function Ft(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&qt(t),n.call(r,e)}function Gt(t,e){return!!t.X||(Et?Ft(t,new At(e,this)):Ft(t,e=new At(e||R("window.event"),this)))}function jt(t){return(t=t[Pt])instanceof xt?t:null}var Yt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Bt(e){return"function"==_(e)?e:(e[Yt]||(e[Yt]=function(t){return e.handleEvent(t)}),e[Yt])}function Wt(){j.call(this),this.c=new xt(this),(this.J=this).B=null}function zt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.X&&s.capture==n){var a=s.listener,u=s.da||s.src;s.Z&&Ct(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&0!=r.Ia}G(Wt,j),Wt.prototype[Dt]=!0,(I=Wt.prototype).addEventListener=function(t,e,n,r){Mt(this,t,e,n,r)},I.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(x(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=O(i)?!!i.capture:!!i,r=Bt(r),e&&e[Dt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Ot(s=e.a[n],r,i,o))&&(_t(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&jt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Ot(n,r,i,o)),(r=-1<e?n[e]:null)&&qt(r))}(this,t,e,n,r)},I.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(S(t))t=new Nt(t,n);else if(t instanceof Nt)t.target=t.target||n;else{var i=t;rt(t=new Nt(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];i=zt(s,r,!0,t)&&i}if(i=zt(s=t.a=n,r,!0,t)&&i,i=zt(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=zt(s=t.a=e[o],r,!1,t)&&i;return i},I.G=function(){if(Wt.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)_t(n[r]);delete e.a[t],e.b--}}this.B=null},I.za=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},I.Aa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Ht=A.JSON.stringify;function Kt(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Qt(){this.b=this.a=null}Kt.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Xt,Jt=new Kt(function(){return new $t},function(t){t.reset()});function $t(){this.next=this.b=this.a=null}function Zt(t){A.setTimeout(function(){throw t},0)}function te(t,e){Xt||function(){var t=A.Promise.resolve(void 0);Xt=function(){t.then(re)}}(),ee||(Xt(),ee=!0),ne.add(t,e)}Qt.prototype.add=function(t,e){var n=Jt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},$t.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var ee=!($t.prototype.reset=function(){this.next=this.b=this.a=null}),ne=new Qt;function re(){for(var t;r=n=void 0,r=null,(n=ne).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){Zt(t)}var e=Jt;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;ee=!1}function ie(t,e){Wt.call(this),this.b=t||1,this.a=e||A,this.f=q(this.fb,this),this.g=F()}function oe(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function se(t,e,n){if("function"==_(t))n&&(t=q(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=q(t.handleEvent,t)}return 2147483647<Number(e)?-1:A.setTimeout(t,e||0)}function ae(t,e,n){j.call(this),this.f=null!=n?q(t,n):t,this.c=e,this.b=q(this.$a,this),this.a=[]}function ue(t){t.U=se(t.b,t.c),t.f.apply(null,t.a)}function he(t){j.call(this),this.b=t,this.a={}}G(ie,Wt),(I=ie.prototype).ba=!1,I.L=null,I.fb=function(){if(this.ba){var t=F()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(oe(this),this.start()))}},I.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=F())},I.G=function(){ie.N.G.call(this),oe(this),delete this.a},G(ae,j),(I=ae.prototype).ea=!1,I.U=null,I.Ta=function(t){this.a=arguments,this.U?this.ea=!0:ue(this)},I.G=function(){ae.N.G.call(this),this.U&&(A.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},I.$a=function(){this.U=null,this.ea&&(this.ea=!1,ue(this))},G(he,j);var ce=[];function fe(t,e,n,r){x(n)||(n&&(ce[0]=n.toString()),n=ce);for(var i=0;i<n.length;i++){var o=Mt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function le(t){tt(t.a,function(t,e){this.a.hasOwnProperty(e)&&qt(t)},t),t.a={}}function pe(){}he.prototype.G=function(){he.N.G.call(this),le(this)},he.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var de=new Wt;function ve(t){Nt.call(this,"serverreachability",t)}function ye(t){de.dispatchEvent(new ve(de,t))}function me(t){Nt.call(this,"statevent",t)}function ge(t){de.dispatchEvent(new me(de,t))}function we(t){Nt.call(this,"timingevent",t)}function be(t,e){if("function"!=_(t))throw Error("Fn must not be null and must be a function");return A.setTimeout(function(){t()},e)}G(ve,Nt),G(me,Nt),G(we,Nt);var Ee={NO_ERROR:0,gb:1,nb:2,mb:3,jb:4,lb:5,ob:6,La:7,TIMEOUT:8,rb:9},Ie={ib:"complete",vb:"success",Ma:"error",La:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",kb:"downloadprogress",wb:"uploadprogress"};function Te(){}function Ne(t){var e;return(e=t.a)||(e=t.a={}),e}function Ae(){}Te.prototype.a=null;var Se,De={OPEN:"a",hb:"b",Ma:"c",qb:"d"};function Re(){Nt.call(this,"d")}function ke(){Nt.call(this,"c")}function _e(){}function xe(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new he(this),this.O=Ce,t=ct?125:void 0,this.P=new ie(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}G(Re,Nt),G(ke,Nt),G(_e,Te),Se=new _e;var Ce=45e3,Oe={},Pe={};function Le(t,e,n){t.F=1,t.f=an(Ze(e)),t.l=n,t.H=!0,Ue(t,null)}function Me(t,e,n,r){t.F=1,t.f=an(Ze(e)),t.l=null,t.H=n,Ue(t,r)}function Ue(t,e){t.v=F(),Fe(t),t.D=Ze(t.f),sn(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new ae(q(t.Ja,t,t.a),t.J)),fe(t.I,t.a,"readystatechange",t.cb),e=t.h?et(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),ye(1)}function qe(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Ve(t,n);if(i==Pe){4==e&&(t.c=4,ge(14),r=!1);break}if(i==Oe){t.c=4,ge(15),r=!1;break}We(t,i)}4==e&&0==n.length&&(t.c=1,ge(16),r=!1),t.b=t.b&&r,r||(Be(t),Ye(t))}function Ve(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?Pe:(n=Number(e.substring(n,r)),isNaN(n)?Oe:(r+=1)+n>e.length?Pe:(e=e.substr(r,n),t.A=r+n,e))}function Fe(t){t.R=F()+t.O,Ge(t,t.O)}function Ge(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=be(q(t.ab,t),e)}function je(t){t.i&&(A.clearTimeout(t.i),t.i=null)}function Ye(t){t.g.Ca()||t.m||t.g.na(t)}function Be(t){je(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,oe(t.P),le(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function We(t,e){try{t.g.Fa(t,e),ye(4)}catch(t){}}function ze(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(C(t)||S(t))B(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(C(t)||S(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(S(t))return t.split("");if(C(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function He(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof He)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ke(t,e){Xe(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Qe(t))}function Qe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Xe(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Xe(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Xe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(I=xe.prototype).setTimeout=function(t){this.O=t},I.cb=function(t){t=t.target;var e=this.B;e&&3==Zn(t)?e.Ta():this.Ja(t)},I.Ja=function(t){try{if(t==this.a)t:{var e=Zn(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!ct&&!this.a.aa())){this.m||4!=e||7==n||ye(8==n||r<=0?3:2),je(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var s=tr(this.a,"X-HTTP-Initial-Response");if(s&&!H(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.c=3,ge(12),Be(this),Ye(this);break t}this.s=!0,We(this,a)}this.H?(qe(this,e,o),ct&&this.b&&3==e&&(fe(this.I,this.P,"tick",this.bb),this.P.start())):We(this,o),4==e&&Be(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Fe(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,ge(12)):(this.c=0,ge(13)),Be(this),Ye(this)}}}catch(t){}},I.bb=function(){if(this.a){var t=Zn(this.a),e=this.a.aa();this.A<e.length&&(je(this),qe(this,t,e),this.b&&4!=t&&Fe(this))}},I.cancel=function(){this.m=!0,Be(this)},I.ab=function(){this.i=null;var t=F();0<=t-this.R?(2!=this.F&&(ye(3),ge(17)),Be(this),this.c=2,Ye(this)):Ge(this,this.R-t)},(I=He.prototype).C=function(){Qe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},I.K=function(){return Qe(this),this.a.concat()},I.get=function(t,e){return Xe(this.b,t)?this.b[t]:e},I.set=function(t,e){Xe(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},I.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Je=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function $e(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof $e?(this.h=void 0!==e?e:t.h,tn(this,t.f),this.j=t.j,en(this,t.b),nn(this,t.i),this.a=t.a,rn(this,En(t.c)),this.g=t.g):t&&(n=String(t).match(Je))?(this.h=!!e,tn(this,n[1]||"",!0),this.j=un(n[2]||""),en(this,n[3]||"",!0),nn(this,n[4]),this.a=un(n[5]||"",!0),rn(this,n[6]||"",!0),this.g=un(n[7]||"")):(this.h=!!e,this.c=new yn(null,this.h))}function Ze(t){return new $e(t)}function tn(t,e,n){t.f=n?un(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function en(t,e,n){t.b=n?un(e,!0):e}function nn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function rn(t,e,n){e instanceof yn?(t.c=e,function(t,e){e&&!t.f&&(mn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(gn(this,e),bn(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=hn(e,dn)),t.c=new yn(e,t.h))}function on(t,e,n){t.c.set(e,n)}function sn(t,e,n){x(n)||(n=[String(n)]),bn(t.c,e,n)}function an(t){return on(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^F()).toString(36)),t}function un(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function hn(t,e,n){return S(t)?(t=encodeURI(t).replace(e,cn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function cn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}$e.prototype.toString=function(){var t=[],e=this.f;e&&t.push(hn(e,fn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(hn(e,fn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(hn(n,"/"==n.charAt(0)?pn:ln,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",hn(n,vn)),t.join("")},$e.prototype.resolve=function(t){var e=Ze(this),n=!!t.f;n?tn(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?en(e,t.b):n=null!=t.i;var r=t.a;if(n)nn(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(X(i,"./")||X(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],s=0;s<i.length;){var a=i[s++];"."==a?r&&s==i.length&&o.push(""):".."==a?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&s==i.length&&o.push("")):(o.push(a),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?rn(e,En(t.c)):n=!!t.g,n&&(e.g=t.g),e};var fn=/[#\/\?@]/g,ln=/[#\?:]/g,pn=/[#\?]/g,dn=/[#\?@]/g,vn=/#/g;function yn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function mn(n){n.a||(n.a=new He,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function gn(t,e){mn(t),e=In(t,e),Xe(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ke(t.a,e))}function wn(t,e){return mn(t),e=In(t,e),Xe(t.a.b,e)}function bn(t,e,n){gn(t,e),0<n.length&&(t.c=null,t.a.set(In(t,e),z(n)),t.b+=n.length)}function En(t){var e=new yn;return e.c=t.c,t.a&&(e.a=new He(t.a),e.b=t.b),e}function In(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function Tn(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function Nn(t){var e=t.a.F.a;if(null!=e)ge(4),e?(ge(10),lr(t.a,t,!1)):(ge(11),lr(t.a,t,!0));else{t.b=new xe(t,void 0,void 0),t.b.h=t.h,e=mr(e=t.a,e.Y()?t.f:null,t.i),ge(4),sn(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&on(e,n,r),Me(t.b,e,!1,t.f)}}function An(){this.a=this.b=null}function Sn(){this.a=new He}function Dn(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[P]||(t[P]=++L)):e.charAt(0)+t}function Rn(t,e){this.b=t,this.a=e}function kn(t){this.g=t||_n,t=A.PerformanceNavigationTiming?0<(t=A.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(A.ka&&A.ka.Da&&A.ka.Da()&&A.ka.Da().yb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Sn),this.b=null,this.c=[]}(I=yn.prototype).add=function(t,e){mn(this),this.c=null,t=In(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},I.forEach=function(n,r){mn(this),this.a.forEach(function(t,e){B(t,function(t){n.call(r,t,e,this)},this)},this)},I.K=function(){mn(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},I.C=function(t){mn(this);var e=[];if(S(t))wn(this,t)&&(e=W(e,this.a.get(In(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=W(e,t[n])}return e},I.set=function(t,e){return mn(this),this.c=null,wn(this,t=In(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},I.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},I.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")},G(function(){},function(){}),(I=Tn.prototype).M=null,I.$=function(t){return this.a.$(t)},I.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},I.Ca=function(){return!1},I.Fa=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=tr(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=tr(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void vr(e,2)}this.f=r[0]}else(e=this.a).m=this.c,vr(e,2)}else 1==this.M&&(this.g?ge(6):"11111"==e?(ge(5),this.g=!0,(!ut||10<=Number(mt))&&(this.c=200,this.b.cancel(),ge(11),lr(this.a,this,!0))):(ge(7),this.g=!1))},I.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,Nn(this)):1==this.M&&(this.g?(ge(11),lr(this.a,this,!0)):(ge(10),lr(this.a,this,!1)));else{0==this.M?ge(8):1==this.M&&ge(9);var t=this.a;t.m=this.c,vr(t,2)}},I.Y=function(){return this.a.Y()},I.ma=function(){return this.a.ma()},Sn.prototype.add=function(t){this.a.set(Dn(t),t)},Sn.prototype.C=function(){return this.a.C()};var _n=10;function xn(t,e){!t.a&&(X(e,"spdy")||X(e,"quic")||X(e,"h2"))&&(t.f=t.g,t.a=new Sn,t.b&&(Ln(t,t.b),t.b=null))}function Cn(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function On(t){return t.b?1:t.a?t.a.a.c:0}function Pn(t,e){return t=t.b?t.b==e:!!t.a&&(e=Dn(e),Xe(t.a.a.b,e))}function Ln(t,e){t.a?t.a.add(e):t.b=e}function Mn(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=Dn(e),n=Xe(t.a.a.b,n)),n&&Ke(t.a.a,Dn(e)))}function Un(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return z(t.c);var e=t.c;return B(t.a.C(),function(t){e=e.concat(t.j)}),e}function qn(){}function Vn(){this.a=new qn}function Fn(t,r,e){var i=e||"";try{ze(t,function(t,e){var n=t;O(t)&&(n=Ht(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function Gn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}kn.prototype.cancel=function(){this.c=Un(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(B(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},qn.prototype.stringify=function(t){return A.JSON.stringify(t,void 0)},qn.prototype.parse=function(t){return A.JSON.parse(t,void 0)};var jn=A.JSON.parse;function Yn(t){Wt.call(this),this.headers=new He,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Bn,this.D=this.F=!1}G(Yn,Wt);var Bn="",Wn=/^https?$/i,zn=["POST","PUT"];function Hn(t){return"content-type"==t.toLowerCase()}function Kn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Qn(t),Jn(t)}function Qn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Xn(t){if(t.b&&void 0!==N&&(!t.s[1]||4!=Zn(t)||2!=t.T()))if(t.l&&4==Zn(t))se(t.Ea,0,t);else if(t.dispatchEvent("readystatechange"),4==Zn(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Je)[1]||null;if(!o&&A.self&&A.self.location){var s=A.self.location.protocol;o=s.substr(0,s.length-1)}i=!Wn.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var a=2<Zn(t)?t.a.statusText:""}catch(t){a=""}t.f=a+" ["+t.T()+"]",Qn(t)}}finally{Jn(t)}}}function Jn(t,e){if(t.a){$n(t);var n=t.a,r=t.s[0]?k:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function $n(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(A.clearTimeout(t.m),t.m=null)}function Zn(t){return t.a?t.a.readyState:0}function tr(t,e){return t.a?t.a.getResponseHeader(e):null}function er(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var n="";return tt(t,function(t,e){n+=e,n+=":",n+=t,n+="\r\n"}),n}(n),S(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return on(t,e,n),t}function nr(t){this.f=[],this.F=new An,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Qa=this.P=0,this.Oa=!!R("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Na=R("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Ra=R("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Pa=R("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=R("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Ka=t&&t.zb||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new kn(t&&t.concurrentRequestLimit),this.ja=new Vn,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function rr(t){if(ir(t),3==t.u){var e=t.P++,n=Ze(t.B);on(n,"SID",t.H),on(n,"RID",e),on(n,"TYPE","terminate"),ur(t,n),(e=new xe(t,e,void 0)).F=2,e.f=an(Ze(n)),n=!1,A.navigator&&A.navigator.sendBeacon&&(n=A.navigator.sendBeacon(e.f.toString(),"")),!n&&A.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=F(),Fe(e)}yr(t)}function ir(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(A.clearTimeout(t.l),t.l=null),pr(t),t.b.cancel(),t.h&&(D(t.h)&&A.clearTimeout(t.h),t.h=null)}function or(t,e){t.f.push(new Rn(t.Qa++,e)),3==t.u&&sr(t)}function sr(t){Cn(t.b)||t.h||(t.h=!0,te(t.Ha,t),t.A=0)}function ar(t,e){var n;n=e?e.W:t.P++;var r=Ze(t.B);on(r,"SID",t.H),on(r,"RID",n),on(r,"AID",t.O),ur(t,r),t.g&&t.i&&er(r,t.g,t.i),n=new xe(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=hr(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Ln(t.b,n),Le(n,r,e)}function ur(t,n){t.c&&ze({},function(t,e){on(n,e,t)})}function hr(t,e,n){n=Math.min(t.f.length,n);var r=t.c?q(t.c.Sa,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var h=i[u].b,c=i[u].a;if((h-=o)<0)o=Math.max(0,i[u].b-100),a=!1;else try{Fn(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(a){r=s.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function cr(t){t.a||t.l||(t.S=1,te(t.Ga,t),t.v=0)}function fr(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=be(q(t.Ga,t),dr(t,t.v)),t.v++,!0)}function lr(t,e,n){var r=e.l;r&&xn(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=mr(t,null,t.ha),sr(t)}function pr(t){null!=t.s&&(A.clearTimeout(t.s),t.s=null)}function dr(t,e){var n=t.Na+Math.floor(Math.random()*t.Ra);return t.ma()||(n*=2),n*e}function vr(t,e){if(2==e){var n=null;t.c&&(n=null);var r=q(t.eb,t);n||(n=new $e("//www.google.com/images/cleardot.gif"),A.location&&"http"==A.location.protocol||tn(n,"https"),an(n)),function(t,e){var n=new pe;if(A.Image){var r=new Image;r.onload=V(Gn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=V(Gn,n,r,"TestLoadImage: error",!1,e),r.onabort=V(Gn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=V(Gn,n,r,"TestLoadImage: timeout",!1,e),A.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else ge(2);t.u=0,t.c&&t.c.ta(e),yr(t),ir(t)}function yr(t){t.u=0,t.m=-1,t.c&&(0==Un(t.b).length&&0==t.f.length||(t.b.c.length=0,z(t.f),t.f.length=0),t.c.sa())}function mr(t,e,n){var r=function(t){return t instanceof $e?Ze(t):new $e(t,void 0)}(n);if(""!=r.b)e&&en(r,e+"."+r.b),nn(r,r.i);else{var i,o=A.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new $e(null,void 0);return t&&tn(i,t),e&&en(i,e),n&&nn(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&tt(t.V,function(t,e){on(r,e,t)}),e=t.j,n=t.I,e&&n&&on(r,e,n),on(r,"VER",t.wa),ur(t,r),r}function gr(){}function wr(){if(ut&&!(10<=Number(mt)))throw Error("Environmental error: no available transport.")}function br(t,e){Wt.call(this),this.a=new nr(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];if(0==i.lastIndexOf("/",0))e=i;else(r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!H(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!H(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new Tr(this)}function Er(t){Re.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Ir(){ke.call(this),this.status=1}function Tr(t){this.a=t}(I=Yn.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Ne(this.H):Ne(Se),this.a.onreadystatechange=q(this.Ea,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Kn(this,t)}t=n||"";var i=new He(this.headers);r&&ze(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Hn,n=t.length,r=S(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:S(t)?t.charAt(e):t[e]}(i.K()),n=A.FormData&&t instanceof A.FormData,0<=Y(zn,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{$n(this),0<this.o&&((this.D=function(t){return ut&&wt(9)&&D(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=q(this.Ba,this)):this.m=se(this.Ba,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Kn(this,t)}},I.Ba=function(){void 0!==N&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},I.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Jn(this))},I.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Jn(this,!0)),Yn.N.G.call(this)},I.Ea=function(){this.j||(this.w||this.l||this.g?Xn(this):this.Za())},I.Za=function(){Xn(this)},I.T=function(){try{return 2<Zn(this)?this.a.status:-1}catch(t){return-1}},I.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},I.Ua=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),jn(e)}},I.ya=function(){return this.h},I.Xa=function(){return S(this.f)?this.f:String(this.f)},(I=nr.prototype).wa=8,I.u=1,I.Ca=function(){return 0==this.u},I.Ha=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random()),t=this.P++;var e,n=new xe(this,t,void 0),r=this.i;if(this.J&&(r?rt(r=et(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&S(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=hr(this,n,e),on(i=Ze(this.B),"RID",t),on(i,"CVER",22),this.o&&this.j&&on(i,"X-HTTP-Session-Id",this.j),ur(this,i),this.g&&r&&er(i,this.g,r),Ln(this.b,n),this.W?(on(i,"$req",e),on(i,"SID","null"),n.S=!0,Le(n,i,null)):Le(n,i,e),this.u=2}}else 3==this.u&&(t?ar(this,t):0==this.f.length||Cn(this.b)||ar(this))},I.Ga=function(){this.l=null,this.a=new xe(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Ze(this.pa);on(t,"RID","rpc"),on(t,"SID",this.H),on(t,"CI",this.ia?"0":"1"),on(t,"AID",this.O),ur(this,t),on(t,"TYPE","xmlhttp"),this.g&&this.i&&er(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Me(this.a,t,!0,this.ga)},I.Fa=function(t,e){if(0!=this.u&&(this.a==t||Pn(this.b,t)))if(this.m=t.o,!t.s&&Pn(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(x(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;pr(this),this.a.cancel(),this.a=null}fr(this),ge(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=be(q(this.Ya,this),6e3));if(On(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else vr(this,11)}else if(!t.s&&this.a!=t||pr(this),!H(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&D(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=tr(r,"X-Client-Wire-Protocol"))&&xn(this.b,i),this.j&&(r=tr(r,"X-HTTP-Session-Id")))&&(this.I=r,on(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=mr(this,this.Y()?this.ga:null,this.ha),r.s?(Mn(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(je(r),Fe(r)),this.a=r):cr(this),0<this.f.length&&sr(this)}else"stop"!=r[0]&&"close"!=r[0]||vr(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?vr(this,7):rr(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},I.Ya=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,fr(this),ge(19))},I.na=function(t){var e=null;if(this.a==t){pr(this),this.a=null;var n=2}else{if(!Pn(this.b,t))return;e=t.j,Mn(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=F()-t.v,de.dispatchEvent(new we(de,t.l?t.l.length:0,e,this.A)),sr(this)):cr(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(On(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.f=e.j.concat(t.f),!0):!(1==t.u||2==t.u||t.A>=(t.Oa?0:t.Pa))&&(t.h=be(q(t.Ha,t,e),dr(t,t.A)),t.A++,!0))}(this,t)||2==n&&fr(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:vr(this,5);break;case 4:vr(this,10);break;case 3:vr(this,6);break;default:vr(this,2)}}},I.eb=function(t){ge(t?2:1)},I.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Yn(this.Ka)).F=this.R,t},I.ma=function(){return!!this.c&&!0},I.Y=function(){return this.R},(I=gr.prototype).va=function(){},I.ua=function(){},I.ta=function(){},I.sa=function(){},I.Sa=function(){},wr.prototype.a=function(t,e){return new br(t,e)},G(br,Wt),(I=br.prototype).addEventListener=function(t,e,n,r){br.N.addEventListener.call(this,t,e,n,r)},I.removeEventListener=function(t,e,n,r){br.N.removeEventListener.call(this,t,e,n,r)},I.Va=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;ge(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new Tn(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=er(e,t.g,t.i)),(t=t.w).i=n,e=mr(t.a,null,t.i),ge(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,Nn(t)):(sn(e,"MODE","init"),!t.a.o&&t.a.j&&sn(e,"X-HTTP-Session-Id",t.a.j),t.b=new xe(t,void 0,void 0),t.b.h=t.h,Me(t.b,e,!1,null),t.M=0)},I.close=function(){rr(this.a)},I.Wa=function(t){if(S(t)){var e={};e.__data__=t,or(this.a,e)}else this.h?((e={}).__data__=Ht(t),or(this.a,e)):or(this.a,t)},I.G=function(){this.a.c=null,delete this.f,rr(this.a),delete this.a,br.N.G.call(this)},G(Er,Re),G(Ir,ke),G(Tr,gr),Tr.prototype.va=function(){this.a.dispatchEvent("a")},Tr.prototype.ua=function(t){this.a.dispatchEvent(new Er(t))},Tr.prototype.ta=function(t){this.a.dispatchEvent(new Ir(t))},Tr.prototype.sa=function(){this.a.dispatchEvent("b")};var Nr=V(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},wr);wr.prototype.createWebChannel=wr.prototype.a,br.prototype.send=br.prototype.Wa,br.prototype.open=br.prototype.Va,br.prototype.close=br.prototype.close,Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,Ie.COMPLETE="complete",(Ae.EventType=De).OPEN="a",De.CLOSE="b",De.ERROR="c",De.MESSAGE="d",Wt.prototype.listen=Wt.prototype.za,Yn.prototype.listenOnce=Yn.prototype.Aa,Yn.prototype.getLastError=Yn.prototype.Xa,Yn.prototype.getLastErrorCode=Yn.prototype.ya,Yn.prototype.getStatus=Yn.prototype.T,Yn.prototype.getResponseJson=Yn.prototype.Ua,Yn.prototype.getResponseText=Yn.prototype.aa,Yn.prototype.send=Yn.prototype.ca;var Ar,Sr,Dr={createWebChannelTransport:Nr,ErrorCode:Ee,EventType:Ie,WebChannel:Ae,XhrIo:Yn},Rr=Dr.createWebChannelTransport,kr=Dr.ErrorCode,_r=Dr.EventType,xr=Dr.WebChannel,Cr=Dr.XhrIo,Or=jd.SDK_VERSION,Pr=new u("@firebase/firestore");function Lr(){return Pr.logLevel===o.DEBUG?Ar.DEBUG:Pr.logLevel===o.SILENT?Ar.SILENT:Ar.ERROR}function Mr(t){switch(t){case Ar.DEBUG:Pr.logLevel=o.DEBUG;break;case Ar.ERROR:Pr.logLevel=o.ERROR;break;case Ar.SILENT:Pr.logLevel=o.SILENT;break;default:Pr.error("Firestore ("+Or+"): Invalid value passed to `setLogLevel`")}}function Ur(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Pr.logLevel<=o.DEBUG){var i=n.map(Vr);Pr.debug.apply(Pr,s(["Firestore ("+Or+") ["+t+"]: "+e],i))}}function qr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Pr.logLevel<=o.ERROR){var r=e.map(Vr);Pr.error.apply(Pr,s(["Firestore ("+Or+"): "+t],r))}}function Vr(t){if("string"==typeof t)return t;var e=ju.t();try{return e.i(t)}catch(e){return t}}function Fr(t){var e="FIRESTORE ("+Or+") INTERNAL ASSERTION FAILED: "+t;throw qr(e),new Error(e)}function Gr(t,e){t||Fr(e)}(Sr=Ar=Ar||{})[Sr.DEBUG=0]="DEBUG",Sr[Sr.ERROR=1]="ERROR",Sr[Sr.SILENT=2]="SILENT";var jr=(Yr.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Gr(20===e.length,"Invalid auto ID: "+e),e},Yr);function Yr(){}function Br(t,e){return t<e?-1:e<t?1:0}function Wr(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function zr(t){return t+"\0"}function Hr(t,e,n,r,i){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}function Kr(t,e){this.user=e,this.type="OAuth",this.g={},this.g.Authorization="Bearer "+t}var Qr,Xr="(default)",Jr=(Object.defineProperty(fi.prototype,"o",{get:function(){return this.database===Xr},enumerable:!0,configurable:!0}),fi.prototype.isEqual=function(t){return t instanceof fi&&t.projectId===this.projectId&&t.database===this.database},fi.prototype.h=function(t){return Br(this.projectId,t.projectId)||Br(this.database,t.database)},fi),$r=(ci.prototype.l=function(){return null!=this.uid},ci.prototype.v=function(){return this.l()?"uid:"+this.uid:"anonymous-user"},ci.prototype.isEqual=function(t){return t.uid===this.uid},ci.UNAUTHENTICATED=new ci(null),ci.m=new ci("google-credentials-uid"),ci.p=new ci("first-party-uid"),ci),Zr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ti=(t(hi,Qr=Error),hi),ei=(ui.prototype.getToken=function(){return Promise.resolve(null)},ui.prototype.I=function(){},ui.prototype.T=function(t){Gr(!this._,"Can only call setChangeListener() once."),(this._=t)($r.UNAUTHENTICATED)},ui.prototype.R=function(){Gr(null!==this._,"removeChangeListener() when no listener registered"),this._=null},ui),ni=(ai.prototype.getToken=function(){var e=this;Gr(null!=this.A,"getToken cannot be called after listener removed.");var n=this.P,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){if(e.P!==n)throw new ti(Zr.ABORTED,"getToken aborted due to token change.");return t?(Gr("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new Kr(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},ai.prototype.I=function(){this.forceRefresh=!0},ai.prototype.T=function(t){Gr(!this._,"Can only call setChangeListener() once."),this._=t,this.D&&t(this.currentUser)},ai.prototype.R=function(){Gr(null!=this.A,"removeChangeListener() called twice"),Gr(null!==this._,"removeChangeListener() called when no listener registered"),this.auth&&this.auth.removeAuthTokenListener(this.A),this.A=null,this._=null},ai.prototype.S=function(){var t=this.auth&&this.auth.getUid();return Gr(null===t||"string"==typeof t,"Received invalid UID: "+t),new $r(t)},ai),ri=(Object.defineProperty(si.prototype,"g",{get:function(){var t={"X-Goog-AuthUser":this.V},e=this.C.auth.N([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),si),ii=(oi.prototype.getToken=function(){return Promise.resolve(new ri(this.C,this.V))},oi.prototype.T=function(t){t($r.p)},oi.prototype.R=function(){},oi.prototype.I=function(){},oi);function oi(t,e){this.C=t,this.V=e}function si(t,e){this.C=t,this.V=e,this.type="FirstParty",this.user=$r.p}function ai(t){var e=this;this.A=null,this.currentUser=$r.UNAUTHENTICATED,this.D=!1,this.P=0,this._=null,this.forceRefresh=!1,this.A=function(){e.P++,e.currentUser=e.S(),e.D=!0,e._&&e._(e.currentUser)},this.P=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.A):(this.A(null),t.get().then(function(t){e.auth=t,e.A&&e.auth.addAuthTokenListener(e.A)},function(){}))}function ui(){this._=null}function hi(t,e){var n=Qr.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function ci(t){this.uid=t}function fi(t,e){this.projectId=t,this.database=e||Xr}function li(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function pi(t,e){return void 0!==t?t:e}function di(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function vi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function yi(t){for(var e in Gr(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function mi(t,e){if(0!==e.length)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Pi(e.length,"argument")+".")}function gi(t,e,n){if(e.length!==n)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires "+Pi(n,"argument")+", but was called with "+Pi(e.length,"argument")+".")}function wi(t,e,n){if(e.length<n)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Pi(n,"argument")+", but was called with "+Pi(e.length,"argument")+".")}function bi(t,e,n,r){if(e.length<n||e.length>r)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Pi(e.length,"argument")+".")}function Ei(t,e,n,r){Si(t,e,Oi(n)+" argument",r)}function Ii(t,e,n,r){void 0!==r&&Ei(t,e,n,r)}function Ti(t,e,n,r){Si(t,e,n+" option",r)}function Ni(t,e,n,r){void 0!==r&&Ti(t,e,n,r)}function Ai(t,e,n,r,h){void 0!==r&&function(t,e,n,r){for(var i=[],o=0,s=h;o<s.length;o++){var a=s[o];if(a===r)return;i.push(Ri(a))}var u=Ri(r);throw new ti(Zr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+i.join(", "))}(t,0,n,r)}function Si(t,e,n,r){if(!("object"===e?Di(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Ri(r);throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Di(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Ri(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Fr("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function ki(t,e,n){if(void 0===n)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Oi(e)+" argument, but it was undefined.")}function _i(n,t,r){vi(t,function(t,e){if(r.indexOf(t)<0)throw new ti(Zr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function xi(t,e,n,r){var i=Ri(r);return new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Oi(n)+" argument to be a "+e+", but it was: "+i)}function Ci(t,e,n){if(n<=0)throw new ti(Zr.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+Oi(e)+" argument to be a positive number, but it was: "+n+".")}function Oi(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Pi(t,e){return t+" "+e+(1===t?"":"s")}var Li,Mi,Ui=(Object.defineProperty(oo.prototype,"latitude",{get:function(){return this.O},enumerable:!0,configurable:!0}),Object.defineProperty(oo.prototype,"longitude",{get:function(){return this.F},enumerable:!0,configurable:!0}),oo.prototype.isEqual=function(t){return this.O===t.O&&this.F===t.F},oo.prototype.j=function(t){return Br(this.O,t.O)||Br(this.F,t.F)},oo),qi=(io.now=function(){return io.fromMillis(Date.now())},io.fromDate=function(t){return io.fromMillis(t.getTime())},io.fromMillis=function(t){var e=Math.floor(t/1e3);return new io(e,1e6*(t-1e3*e))},io.prototype.toDate=function(){return new Date(this.toMillis())},io.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},io.prototype.j=function(t){return this.seconds===t.seconds?Br(this.nanoseconds,t.nanoseconds):Br(this.seconds,t.seconds)},io.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},io.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},io),Vi=(ro.U=function(t){var e=Math.floor(t/1e6);return new ro(new qi(e,t%1e6*1e3))},ro.L=function(t){return new ro(t)},ro.B=function(){return ro.MIN},ro.prototype.h=function(t){return this.timestamp.j(t.timestamp)},ro.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},ro.prototype.M=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},ro.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},ro.prototype.q=function(){return this.timestamp},ro.MIN=new ro(new qi(0,0)),ro),Fi=(Object.defineProperty(no.prototype,"length",{get:function(){return this.G},enumerable:!0,configurable:!0}),no.prototype.isEqual=function(t){return 0===no.W(this,t)},no.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof no?t.forEach(function(t){e.push(t)}):e.push(t),this.K(e)},no.prototype.limit=function(){return this.offset+this.length},no.prototype.H=function(t){return t=void 0===t?1:t,Gr(this.length>=t,"Can't call popFirst() with less segments"),this.K(this.segments,this.offset+t,this.length-t)},no.prototype.J=function(){return Gr(!this.Y(),"Can't call popLast() on empty path"),this.K(this.segments,this.offset,this.length-1)},no.prototype.X=function(){return Gr(!this.Y(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},no.prototype.$=function(){return this.get(this.length-1)},no.prototype.get=function(t){return Gr(t<this.length,"Index out of range"),this.segments[this.offset+t]},no.prototype.Y=function(){return 0===this.length},no.prototype.Z=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},no.prototype.tt=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},no.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},no.prototype.nt=function(){return this.segments.slice(this.offset,this.limit())},no.W=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},no),Gi=(t(eo,Mi=Fi),eo.prototype.K=function(t,e,n){return new eo(t,e,n)},eo.prototype.it=function(){return this.nt().join("/")},eo.prototype.toString=function(){return this.it()},eo.et=function(t){if(0<=t.indexOf("//"))throw new ti(Zr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new eo(t.split("/").filter(function(t){return 0<t.length}))},eo.rt=new eo([]),eo),ji=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Yi=(t(to,Li=Fi),to.prototype.K=function(t,e,n){return new to(t,e,n)},to.ut=function(t){return ji.test(t)},to.prototype.it=function(){return this.nt().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),to.ut(t)||(t="`"+t+"`"),t}).join(".")},to.prototype.toString=function(){return this.it()},to.prototype.st=function(){return 1===this.length&&"__name__"===this.get(0)},to.ot=function(){return new to(["__name__"])},to.ht=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new ti(Zr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[r+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new ti(Zr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=a,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new ti(Zr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new to(e)},to.rt=new to([]),to),Bi=(Zi.prototype.at=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Zi.prototype.isEqual=function(t){return null!==t&&0===Gi.W(this.path,t.path)},Zi.prototype.toString=function(){return this.path.toString()},Zi.W=function(t,e){return Gi.W(t.path,e.path)},Zi.ct=function(t){return t.length%2==0},Zi.ft=function(t){return new Zi(new Gi(t.slice()))},Zi.lt=function(t){return new Zi(Gi.et(t))},Zi.EMPTY=new Zi(new Gi([])),Zi),Wi=($i.prototype.dt=function(t,e){return new $i(this.W,this.root.dt(t,e,this.W).vt(null,null,Hi.wt,null,null))},$i.prototype.remove=function(t){return new $i(this.W,this.root.remove(t,this.W).vt(null,null,Hi.wt,null,null))},$i.prototype.get=function(t){for(var e=this.root;!e.Y();){var n=this.W(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},$i.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.Y();){var r=this.W(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},$i.prototype.Y=function(){return this.root.Y()},Object.defineProperty($i.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),$i.prototype.pt=function(){return this.root.pt()},$i.prototype.gt=function(){return this.root.gt()},$i.prototype.bt=function(t){return this.root.bt(t)},$i.prototype.forEach=function(n){this.bt(function(t,e){return n(t,e),!1})},$i.prototype.toString=function(){var n=[];return this.bt(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},$i.prototype.yt=function(t){return this.root.yt(t)},$i.prototype._t=function(){return new zi(this.root,null,this.W,!1)},$i.prototype.It=function(t){return new zi(this.root,t,this.W,!1)},$i.prototype.Tt=function(){return new zi(this.root,null,this.W,!0)},$i.prototype.Et=function(t){return new zi(this.root,t,this.W,!0)},$i),zi=(Ji.prototype.Dt=function(){Gr(0<this.At.length,"getNext() called on iterator when hasNext() is false.");var t=this.At.pop(),e={key:t.key,value:t.value};if(this.Rt)for(t=t.left;!t.Y();)this.At.push(t),t=t.right;else for(t=t.right;!t.Y();)this.At.push(t),t=t.left;return e},Ji.prototype.Pt=function(){return 0<this.At.length},Ji.prototype.St=function(){if(0===this.At.length)return null;var t=this.At[this.At.length-1];return{key:t.key,value:t.value}},Ji),Hi=(Xi.prototype.vt=function(t,e,n,r,i){return new Xi(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Xi.prototype.Y=function(){return!1},Xi.prototype.bt=function(t){return this.left.bt(t)||t(this.key,this.value)||this.right.bt(t)},Xi.prototype.yt=function(t){return this.right.yt(t)||t(this.key,this.value)||this.left.yt(t)},Xi.prototype.min=function(){return this.left.Y()?this:this.left.min()},Xi.prototype.pt=function(){return this.min().key},Xi.prototype.gt=function(){return this.right.Y()?this.key:this.right.gt()},Xi.prototype.dt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.vt(null,null,null,r.left.dt(t,e,n),null):0===i?r.vt(null,e,null,null,null):r.vt(null,null,null,null,r.right.dt(t,e,n))).Ct()},Xi.prototype.Vt=function(){if(this.left.Y())return Xi.EMPTY;var t=this;return t.left.Nt()||t.left.left.Nt()||(t=t.kt()),(t=t.vt(null,null,null,t.left.Vt(),null)).Ct()},Xi.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.Y()||r.left.Nt()||r.left.left.Nt()||(r=r.kt()),r=r.vt(null,null,null,r.left.remove(t,e),null);else{if(r.left.Nt()&&(r=r.Ot()),r.right.Y()||r.right.Nt()||r.right.left.Nt()||(r=r.Ft()),0===e(t,r.key)){if(r.right.Y())return Xi.EMPTY;n=r.right.min(),r=r.vt(n.key,n.value,null,null,r.right.Vt())}r=r.vt(null,null,null,null,r.right.remove(t,e))}return r.Ct()},Xi.prototype.Nt=function(){return this.color},Xi.prototype.Ct=function(){var t=this;return t.right.Nt()&&!t.left.Nt()&&(t=t.xt()),t.left.Nt()&&t.left.left.Nt()&&(t=t.Ot()),t.left.Nt()&&t.right.Nt()&&(t=t.jt()),t},Xi.prototype.kt=function(){var t=this.jt();return t.right.left.Nt()&&(t=(t=(t=t.vt(null,null,null,null,t.right.Ot())).xt()).jt()),t},Xi.prototype.Ft=function(){var t=this.jt();return t.left.left.Nt()&&(t=(t=t.Ot()).jt()),t},Xi.prototype.xt=function(){var t=this.vt(null,null,Xi.RED,null,this.right.left);return this.right.vt(null,null,this.color,t,null)},Xi.prototype.Ot=function(){var t=this.vt(null,null,Xi.RED,this.left.right,null);return this.left.vt(null,null,this.color,null,t)},Xi.prototype.jt=function(){var t=this.left.vt(null,null,!this.left.color,null,null),e=this.right.vt(null,null,!this.right.color,null,null);return this.vt(null,null,!this.color,t,e)},Xi.prototype.Ut=function(){var t=this.Lt();return Math.pow(2,t)<=this.size+1},Xi.prototype.Lt=function(){if(this.Nt()&&this.left.Nt())throw Fr("Red node has red child("+this.key+","+this.value+")");if(this.right.Nt())throw Fr("Right child of ("+this.key+","+this.value+") is red");var t=this.left.Lt();if(t!==this.right.Lt())throw Fr("Black depths differ");return t+(this.Nt()?0:1)},Xi.EMPTY=null,Xi.RED=!0,Xi.wt=!1,Xi),Ki=(Object.defineProperty(Qi.prototype,"key",{get:function(){throw Fr("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"value",{get:function(){throw Fr("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"color",{get:function(){throw Fr("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"left",{get:function(){throw Fr("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"right",{get:function(){throw Fr("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),Qi.prototype.vt=function(t,e,n,r,i){return this},Qi.prototype.dt=function(t,e,n){return new Hi(t,e)},Qi.prototype.remove=function(t,e){return this},Qi.prototype.Y=function(){return!0},Qi.prototype.bt=function(t){return!1},Qi.prototype.yt=function(t){return!1},Qi.prototype.pt=function(){return null},Qi.prototype.gt=function(){return null},Qi.prototype.Nt=function(){return!1},Qi.prototype.Ut=function(){return!0},Qi.prototype.Lt=function(){return 0},Qi);function Qi(){this.size=0}function Xi(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Xi.RED,this.left=null!=r?r:Xi.EMPTY,this.right=null!=i?i:Xi.EMPTY,this.size=this.left.size+1+this.right.size}function Ji(t,e,n,r){this.Rt=r,this.At=[];for(var i=1;!t.Y();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Rt?t.left:t.right;else{if(0===i){this.At.push(t);break}this.At.push(t),t=this.Rt?t.right:t.left}}function $i(t,e){this.W=t,this.root=e||Hi.EMPTY}function Zi(t){this.path=t,Gr(Zi.ct(t),"Invalid DocumentKey with an odd number of segments: "+t.nt().join("/"))}function to(){return null!==Li&&Li.apply(this,arguments)||this}function eo(){return null!==Mi&&Mi.apply(this,arguments)||this}function no(t,e,n){void 0===e?e=0:e>t.length&&Fr("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Fr("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.G=n}function ro(t){this.timestamp=t}function io(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function oo(t,e){if(gi("GeoPoint",arguments,2),Ei("GeoPoint","number",1,t),Ei("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new ti(Zr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new ti(Zr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.O=t,this.F=e}Hi.EMPTY=new Ki;var so=(go.Bt=function(t){var e=new go(t.W);return t.forEach(function(t){e=e.add(t)}),e},go.prototype.has=function(t){return null!==this.data.get(t)},go.prototype.first=function(){return this.data.pt()},go.prototype.last=function(){return this.data.gt()},Object.defineProperty(go.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),go.prototype.indexOf=function(t){return this.data.indexOf(t)},go.prototype.forEach=function(n){this.data.bt(function(t,e){return n(t),!1})},go.prototype.Mt=function(t,e){for(var n=this.data.It(t[0]);n.Pt();){var r=n.Dt();if(0<=this.W(r.key,t[1]))return;e(r.key)}},go.prototype.qt=function(t,e){var n;for(n=void 0!==e?this.data.It(e):this.data._t();n.Pt();)if(!t(n.Dt().key))return},go.prototype.Qt=function(t){var e=this.data.It(t);return e.Pt()?e.Dt().key:null},go.prototype._t=function(){return new ao(this.data._t())},go.prototype.It=function(t){return new ao(this.data.It(t))},go.prototype.add=function(t){return this.vt(this.data.remove(t).dt(t,!0))},go.prototype.delete=function(t){return this.has(t)?this.vt(this.data.remove(t)):this},go.prototype.Y=function(){return this.data.Y()},go.prototype.Gt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},go.prototype.isEqual=function(t){if(!(t instanceof go))return!1;if(this.size!==t.size)return!1;for(var e=this.data._t(),n=t.data._t();e.Pt();){var r=e.Dt().key,i=n.Dt().key;if(0!==this.W(r,i))return!1}return!0},go.prototype.nt=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},go.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},go.prototype.vt=function(t){var e=new go(this.W);return e.data=t,e},go),ao=(mo.prototype.Dt=function(){return this.Wt.Dt().key},mo.prototype.Pt=function(){return this.Wt.Pt()},mo),uo=(yo.prototype.zt=function(t,e){return new Ds(e,t)},yo.prototype.Kt=function(t,e){return e},yo.prototype.Ht=function(t){return null},yo.prototype.isEqual=function(t){return t instanceof yo},yo.instance=new yo,yo),ho=(vo.prototype.zt=function(t,e){return this.apply(t)},vo.prototype.Kt=function(t,e){return this.apply(t)},vo.prototype.apply=function(t){for(var n=wo(t),e=function(e){n.find(function(t){return t.isEqual(e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Cs(n)},vo.prototype.Ht=function(t){return null},vo.prototype.isEqual=function(t){return t instanceof vo&&Wr(t.elements,this.elements)},vo),co=(po.prototype.zt=function(t,e){return this.apply(t)},po.prototype.Kt=function(t,e){return this.apply(t)},po.prototype.apply=function(t){for(var n=wo(t),e=function(e){n=n.filter(function(t){return!t.isEqual(e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Cs(n)},po.prototype.Ht=function(t){return null},po.prototype.isEqual=function(t){return t instanceof po&&Wr(t.elements,this.elements)},po),fo=(lo.prototype.zt=function(t,e){var n=this.Ht(t);if(n instanceof Ts&&this.Jt instanceof Ts){var r=n.Yt+this.Jt.Yt;return new Ts(r)}return r=n.Yt+this.Jt.Yt,new Ns(r)},lo.prototype.Kt=function(t,e){return Gr(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},lo.prototype.Ht=function(t){return t instanceof rs?t:new Ts(0)},lo.prototype.isEqual=function(t){return t instanceof lo&&this.Jt.isEqual(t.Jt)},lo);function lo(t){this.Jt=t}function po(t){this.elements=t}function vo(t){this.elements=t}function yo(){}function mo(t){this.Wt=t}function go(t){this.W=t,this.data=new Wi(this.W)}function wo(t){return t instanceof Cs?t.Yt.slice():[]}function bo(t,e){this.version=t,this.transformResults=e}var Eo,Io,To=(So.Xt=function(t){return new So(t)},So.$t=function(t){var e=new so(Yi.W);return t.forEach(function(t){return e=e.add(t)}),new So(e)},So.prototype.Zt=function(e){var n=!1;return this.fields.forEach(function(t){t.Z(e)&&(n=!0)}),n},So.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},So),No=(Ao.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},Ao);function Ao(t,e){this.field=t,this.transform=e}function So(t){this.fields=t}(Io=Eo=Eo||{})[Io.Set=0]="Set",Io[Io.tn=1]="__PRIVATE_Patch",Io[Io.nn=2]="__PRIVATE_Transform",Io[Io.in=3]="__PRIVATE_Delete",Io[Io.en=4]="__PRIVATE_Verify";var Do,Ro,ko,_o,xo,Co,Oo,Po,Lo,Mo=(Qo.exists=function(t){return new Qo(void 0,t)},Qo.updateTime=function(t){return new Qo(t)},Object.defineProperty(Qo.prototype,"rn",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),Qo.prototype.un=function(t){return void 0!==this.updateTime?t instanceof Ps&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Ps:(Gr(this.rn,"Precondition should be empty"),!0)},Qo.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,(null!=e?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},Qo.NONE=new Qo,Qo),Uo=(Ko.prototype.sn=function(t){null!=t&&Gr(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},Ko.on=function(t){return t instanceof Ps?t.version:Vi.MIN},Ko),qo=(t(Ho,Lo=Uo),Ho.prototype.Kt=function(t,e){this.sn(t),Gr(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Ps(this.key,n,{hasCommittedMutations:!0},this.value)},Ho.prototype.zt=function(t,e,n){if(this.sn(t),!this.hn.un(t))return t;var r=Uo.on(t);return new Ps(this.key,r,{cn:!0},this.value)},Ho.prototype.an=function(t){return null},Ho.prototype.isEqual=function(t){return t instanceof Ho&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.hn.isEqual(t.hn)},Ho),Vo=(t(zo,Po=Uo),zo.prototype.Kt=function(t,e){if(this.sn(t),Gr(null==e.transformResults,"Transform results received by PatchMutation."),!this.hn.un(t))return new Ms(this.key,e.version);var n=this.ln(t);return new Ps(this.key,e.version,{hasCommittedMutations:!0},n)},zo.prototype.zt=function(t,e,n){if(this.sn(t),!this.hn.un(t))return t;var r=Uo.on(t),i=this.ln(t);return new Ps(this.key,r,{cn:!0},i)},zo.prototype.an=function(t){return null},zo.prototype.isEqual=function(t){return t instanceof zo&&this.key.isEqual(t.key)&&this.fn.isEqual(t.fn)&&this.hn.isEqual(t.hn)},zo.prototype.ln=function(t){var e;return e=t instanceof Ps?t.data():xs.EMPTY,this.dn(e)},zo.prototype.dn=function(n){var r=this;return this.fn.fields.forEach(function(t){if(!t.Y()){var e=r.data.field(t);n=null!==e?n.set(t,e):n.delete(t)}}),n},zo),Fo=(t(Wo,Oo=Uo),Wo.prototype.Kt=function(t,e){if(this.sn(t),Gr(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.hn.un(t))return new Ms(this.key,e.version);var n=this.vn(t),r=this.wn(t,e.transformResults),i=e.version,o=this.mn(n.data(),r);return new Ps(this.key,i,{hasCommittedMutations:!0},o)},Wo.prototype.zt=function(t,e,n){if(this.sn(t),!this.hn.un(t))return t;var r=this.vn(t),i=this.pn(n,t,e),o=this.mn(r.data(),i);return new Ps(this.key,r.version,{cn:!0},o)},Wo.prototype.an=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Ps?t.field(i.field):void 0,s=i.transform.Ht(o||null);null!=s&&(e=null==e?xs.EMPTY.set(i.field,s):e.set(i.field,s))}return e},Wo.prototype.isEqual=function(t){return t instanceof Wo&&this.key.isEqual(t.key)&&Wr(this.fieldTransforms,t.fieldTransforms)&&this.hn.isEqual(t.hn)},Wo.prototype.vn=function(t){return Gr(t instanceof Ps,"Unknown MaybeDocument type "+t),Gr(t.key.isEqual(this.key),"Can only transform a document with the same key"),t},Wo.prototype.wn=function(t,e){var n=[];Gr(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof Ps&&(s=t.field(i.field)),n.push(o.Kt(s,e[r]))}return n},Wo.prototype.pn=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var s=o[i],a=s.transform,u=null;e instanceof Ps&&(u=e.field(s.field)),null===u&&n instanceof Ps&&(u=n.field(s.field)),r.push(a.zt(u,t))}return r},Wo.prototype.mn=function(t,e){Gr(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},Wo),Go=(t(Bo,Co=Uo),Bo.prototype.Kt=function(t,e){return this.sn(t),Gr(null==e.transformResults,"Transform results received by DeleteMutation."),new Ls(this.key,e.version,{hasCommittedMutations:!0})},Bo.prototype.zt=function(t,e,n){return this.sn(t),this.hn.un(t)?(t&&Gr(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new Ls(this.key,Vi.B())):t},Bo.prototype.an=function(t){return null},Bo.prototype.isEqual=function(t){return t instanceof Bo&&this.key.isEqual(t.key)&&this.hn.isEqual(t.hn)},Bo),jo=(t(Yo,xo=Uo),Yo.prototype.Kt=function(t,e){Fr("VerifyMutation should only be used in Transactions.")},Yo.prototype.zt=function(t,e,n){Fr("VerifyMutation should only be used in Transactions.")},Yo.prototype.an=function(t){Fr("VerifyMutation should only be used in Transactions.")},Yo.prototype.isEqual=function(t){return t instanceof Yo&&this.key.isEqual(t.key)&&this.hn.isEqual(t.hn)},Yo);function Yo(t,e){var n=xo.call(this)||this;return n.key=t,n.hn=e,n.type=Eo.en,n}function Bo(t,e){var n=Co.call(this)||this;return n.key=t,n.hn=e,n.type=Eo.in,n}function Wo(t,e){var n=Oo.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=Eo.nn,n.hn=Mo.exists(!0),n}function zo(t,e,n,r){var i=Po.call(this)||this;return i.key=t,i.data=e,i.fn=n,i.hn=r,i.type=Eo.tn,i}function Ho(t,e,n){var r=Lo.call(this)||this;return r.key=t,r.value=e,r.hn=n,r.type=Eo.Set,r}function Ko(){}function Qo(t,e){this.updateTime=t,this.exists=e,Gr(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}(Ro=Do=Do||{})[Ro.gn=0]="__PRIVATE_NullValue",Ro[Ro.bn=1]="__PRIVATE_BooleanValue",Ro[Ro.yn=2]="__PRIVATE_NumberValue",Ro[Ro._n=3]="__PRIVATE_TimestampValue",Ro[Ro.In=4]="__PRIVATE_StringValue",Ro[Ro.Tn=5]="__PRIVATE_BlobValue",Ro[Ro.En=6]="__PRIVATE_RefValue",Ro[Ro.Rn=7]="__PRIVATE_GeoPointValue",Ro[Ro.ArrayValue=8]="ArrayValue",Ro[Ro.An=9]="__PRIVATE_ObjectValue",(_o=ko=ko||{})[_o.Dn=0]="__PRIVATE_Default",_o[_o.Pn=1]="__PRIVATE_Estimate",_o[_o.Sn=2]="__PRIVATE_Previous";var Xo,Jo,$o,Zo=(us.Vn=function(t,e){switch(t.serverTimestamps){case"estimate":return new us(ko.Pn,e);case"previous":return new us(ko.Sn,e);case"none":case void 0:return new us(ko.Dn,e);default:return Fr("fromSnapshotOptions() called with invalid options.")}},us),ts=(as.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},as.prototype.Nn=function(t){return Gr(this.kn!==t.kn,"Default compareTo should not be used for values of same type."),Br(this.kn,t.kn)},as),es=(t(ss,$o=ts),ss.prototype.value=function(t){return null},ss.prototype.isEqual=function(t){return t instanceof ss},ss.prototype.h=function(t){return t instanceof ss?0:this.Nn(t)},ss.prototype.On=function(){return 4},ss.Fn=new ss,ss),ns=(t(os,Jo=ts),os.prototype.value=function(t){return this.Yt},os.prototype.isEqual=function(t){return t instanceof os&&this.Yt===t.Yt},os.prototype.h=function(t){return t instanceof os?Br(this,t):this.Nn(t)},os.prototype.On=function(){return 4},os.of=function(t){return t?os.xn:os.jn},os.xn=new os(!0),os.jn=new os(!1),os),rs=(t(is,Xo=ts),is.prototype.value=function(t){return this.Yt},is.prototype.h=function(t){return t instanceof is?(e=this.Yt)<(n=t.Yt)?-1:n<e?1:e===n?0:isNaN(e)?isNaN(n)?0:-1:1:this.Nn(t);var e,n},is.prototype.On=function(){return 8},is);function is(t){var e=Xo.call(this)||this;return e.Yt=t,e.kn=Do.yn,e}function os(t){var e=Jo.call(this)||this;return e.Yt=t,e.kn=Do.bn,e}function ss(){var t=$o.call(this)||this;return t.kn=Do.gn,t.Yt=null,t}function as(){}function us(t,e){this.Cn=t,this.timestampsInSnapshots=e}function hs(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var cs,fs,ls,ps,ds,vs,ys,ms,gs,ws,bs,Es,Is,Ts=(t(ta,Is=rs),ta.prototype.isEqual=function(t){return t instanceof ta&&hs(this.Yt,t.Yt)},ta),Ns=(t(Zs,Es=rs),Zs.prototype.isEqual=function(t){return t instanceof Zs&&hs(this.Yt,t.Yt)},Zs.Un=new Zs(NaN),Zs.POSITIVE_INFINITY=new Zs(1/0),Zs.NEGATIVE_INFINITY=new Zs(-1/0),Zs),As=(t($s,bs=ts),$s.prototype.value=function(t){return this.Yt},$s.prototype.isEqual=function(t){return t instanceof $s&&this.Yt===t.Yt},$s.prototype.h=function(t){return t instanceof $s?Br(this.Yt,t.Yt):this.Nn(t)},$s.prototype.On=function(){return 2*this.Yt.length},$s),Ss=(t(Js,ws=ts),Js.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.Yt:this.Yt.toDate()},Js.prototype.isEqual=function(t){return t instanceof Js&&this.Yt.isEqual(t.Yt)},Js.prototype.h=function(t){return t instanceof Js?this.Yt.j(t.Yt):t instanceof Ds?-1:this.Nn(t)},Js.prototype.On=function(){return 16},Js),Ds=(t(Xs,gs=ts),Xs.prototype.value=function(t){return t&&t.Cn===ko.Pn?new Ss(this.Ln).value(t):t&&t.Cn===ko.Sn&&this.previousValue?this.previousValue.value(t):null},Xs.prototype.isEqual=function(t){return t instanceof Xs&&this.Ln.isEqual(t.Ln)},Xs.prototype.h=function(t){return t instanceof Xs?this.Ln.j(t.Ln):t instanceof Ss?1:this.Nn(t)},Xs.prototype.toString=function(){return"<ServerTimestamp localTime="+this.Ln.toString()+">"},Xs.prototype.On=function(){return 16+(this.previousValue?this.previousValue.On():0)},Xs),Rs=(t(Qs,ms=ts),Qs.prototype.value=function(t){return this.Yt},Qs.prototype.isEqual=function(t){return t instanceof Qs&&this.Yt.isEqual(t.Yt)},Qs.prototype.h=function(t){return t instanceof Qs?this.Yt.j(t.Yt):this.Nn(t)},Qs.prototype.On=function(){return this.Yt.Bn()},Qs),ks=(t(Ks,ys=ts),Ks.prototype.value=function(t){return this.key},Ks.prototype.isEqual=function(t){return t instanceof Ks&&this.key.isEqual(t.key)&&this.s.isEqual(t.s)},Ks.prototype.h=function(t){if(t instanceof Ks){var e=this.s.h(t.s);return 0!==e?e:Bi.W(this.key,t.key)}return this.Nn(t)},Ks.prototype.On=function(){return this.s.projectId.length+this.s.database.length+this.key.toString().length},Ks),_s=(t(Hs,vs=ts),Hs.prototype.value=function(t){return this.Yt},Hs.prototype.isEqual=function(t){return t instanceof Hs&&this.Yt.isEqual(t.Yt)},Hs.prototype.h=function(t){return t instanceof Hs?this.Yt.j(t.Yt):this.Nn(t)},Hs.prototype.On=function(){return 16},Hs),xs=(t(zs,ds=ts),zs.prototype.value=function(n){var r={};return this.Yt.bt(function(t,e){r[t]=e.value(n)}),r},zs.prototype.forEach=function(t){this.Yt.bt(t)},zs.prototype.isEqual=function(t){if(t instanceof zs){for(var e=this.Yt._t(),n=t.Yt._t();e.Pt()&&n.Pt();){var r=e.Dt(),i=n.Dt();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.Pt()&&!n.Pt()}return!1},zs.prototype.h=function(t){if(t instanceof zs){for(var e=this.Yt._t(),n=t.Yt._t();e.Pt()&&n.Pt();){var r=e.Dt(),i=n.Dt(),o=Br(r.key,i.key)||r.value.h(i.value);if(o)return o}return Br(e.Pt(),n.Pt())}return this.Nn(t)},zs.prototype.set=function(t,e){if(Gr(!t.Y(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.Mn(t.X(),e);var n=this.child(t.X());n instanceof zs||(n=zs.EMPTY);var r=n.set(t.H(),e);return this.Mn(t.X(),r)},zs.prototype.delete=function(t){if(Gr(!t.Y(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new zs(this.Yt.remove(t.X()));var e=this.child(t.X());if(e instanceof zs){var n=e.delete(t.H());return new zs(this.Yt.dt(t.X(),n))}return this},zs.prototype.contains=function(t){return null!==this.field(t)},zs.prototype.field=function(t){Gr(!t.Y(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof zs?e.Yt.get(t):null}),e},zs.prototype.fn=function(){var i=new so(Yi.W);return this.Yt.forEach(function(t,e){var n=new Yi([t]);if(e instanceof zs){var r=e.fn().fields;r.Y()?i=i.add(n):r.forEach(function(t){i=i.add(n.child(t))})}else i=i.add(n)}),To.Xt(i)},zs.prototype.On=function(){var n=0;return this.Yt.bt(function(t,e){n+=t.length+e.On()}),n},zs.prototype.toString=function(){return this.Yt.toString()},zs.prototype.child=function(t){return this.Yt.get(t)||void 0},zs.prototype.Mn=function(t,e){return new zs(this.Yt.dt(t,e))},zs.EMPTY=new zs(new Wi(Br)),zs),Cs=(t(Ws,ps=ts),Ws.prototype.value=function(e){return this.Yt.map(function(t){return t.value(e)})},Ws.prototype.contains=function(t){for(var e=0,n=this.Yt;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},Ws.prototype.forEach=function(t){this.Yt.forEach(t)},Ws.prototype.isEqual=function(t){if(t instanceof Ws){if(this.Yt.length!==t.Yt.length)return!1;for(var e=0;e<this.Yt.length;e++)if(!this.Yt[e].isEqual(t.Yt[e]))return!1;return!0}return!1},Ws.prototype.h=function(t){if(t instanceof Ws){for(var e=Math.min(this.Yt.length,t.Yt.length),n=0;n<e;n++){var r=this.Yt[n].h(t.Yt[n]);if(r)return r}return Br(this.Yt.length,t.Yt.length)}return this.Nn(t)},Ws.prototype.On=function(){return this.Yt.reduce(function(t,e){return t+e.On()},0)},Ws.prototype.toString=function(){return"["+this.Yt.map(function(t){return t.toString()}).join(",")+"]"},Ws),Os=(Bs.qn=function(t,e){return Bi.W(t.key,e.key)},Bs),Ps=(t(Ys,ls=Os),Ys.prototype.field=function(t){if(this.Qn)return this.Qn.field(t);this.Gn||(this.Gn=new Map);var e=t.it(),n=this.Gn.get(e);if(void 0===n){var r=this.Wn(t);n=void 0===r?null:this.converter(r),this.Gn.set(e,n)}return n},Ys.prototype.data=function(){var n=this;if(!this.Qn){var r=xs.EMPTY;vi(this.proto.fields||{},function(t,e){r=r.set(new Yi([t]),n.converter(e))}),this.Qn=r,this.Gn=void 0}return this.Qn},Ys.prototype.value=function(){return this.data().value()},Ys.prototype.isEqual=function(t){return t instanceof Ys&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.cn===t.cn&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},Ys.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.cn+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Ys.prototype,"hasPendingWrites",{get:function(){return this.cn||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Ys.prototype.Wn=function(t){Gr(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields?this.proto.fields[t.X()]:void 0,n=1;n<t.length;++n){if(!e||!e.mapValue||!e.mapValue.fields)return;e=e.mapValue.fields[t.get(n)]}return e},Ys.zn=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.h(i):Fr("Trying to compare documents on fields that don't exist")},Ys),Ls=(t(js,fs=Os),js.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(js.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),js.prototype.isEqual=function(t){return t instanceof js&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},js),Ms=(t(Gs,cs=Os),Gs.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Gs.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),Gs.prototype.isEqual=function(t){return t instanceof Gs&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Gs),Us=Number,qs=Us.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),Vs=Us.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Fs=Us.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function Gs(){return null!==cs&&cs.apply(this,arguments)||this}function js(t,e,n){var r=fs.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Ys(t,e,n,r,i,o){var s=ls.call(this,t,e)||this;return s.Qn=r,s.proto=i,s.converter=o,Gr(void 0!==s.Qn||void 0!==s.proto&&void 0!==s.converter,"If objectValue is not defined, proto and converter need to be set."),s.cn=!!n.cn,s.hasCommittedMutations=!!n.hasCommittedMutations,s}function Bs(t,e){this.key=t,this.version=e}function Ws(t){var e=ps.call(this)||this;return e.Yt=t,e.kn=Do.ArrayValue,e}function zs(t){var e=ds.call(this)||this;return e.Yt=t,e.kn=Do.An,e}function Hs(t){var e=vs.call(this)||this;return e.Yt=t,e.kn=Do.Rn,e}function Ks(t,e){var n=ys.call(this)||this;return n.s=t,n.key=e,n.kn=Do.En,n}function Qs(t){var e=ms.call(this)||this;return e.Yt=t,e.kn=Do.Tn,e}function Xs(t,e){var n=gs.call(this)||this;return n.Ln=t,n.previousValue=e,n.kn=Do._n,n}function Js(t){var e=ws.call(this)||this;return e.Yt=t,e.kn=Do._n,e}function $s(t){var e=bs.call(this)||this;return e.Yt=t,e.kn=Do.In,e}function Zs(){return null!==Es&&Es.apply(this,arguments)||this}function ta(){return null!==Is&&Is.apply(this,arguments)||this}function ea(t){return null==t}function na(t){return Fs(t)&&t<=Vs&&qs<=t}var ra,ia,oa=(sa.prototype.canonicalId=function(){if(null===this.Kn){var t=this.path.it();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";ea(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.Kn=t}return this.Kn},sa.prototype.toString=function(){var t=this.path.it();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),ea(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},sa.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},sa.prototype.Hn=function(){return Bi.ct(this.path)&&null===this.collectionGroup&&0===this.filters.length},sa);function sa(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Kn=null}(ia=ra=ra||{}).Jn="F",ia.Yn="L";var aa,ua,ha,ca,fa,la,pa,da,va,ya,ma,ga,wa=(ja.ii=function(t){return new ja(t)},Object.defineProperty(ja.prototype,"orderBy",{get:function(){if(null===this.Zn){var t=this.ei(),e=this.ri();if(null!==t&&null===e)t.st()?this.Zn=[_a]:this.Zn=[new ka(t),_a];else{Gr(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.Zn=[]),r=0,i=this.Xn;r<i.length;r++){var o=i[r];this.Zn.push(o),o.field.st()&&(n=!0)}if(!n){var s=0<this.Xn.length?this.Xn[this.Xn.length-1].dir:Da.ASCENDING;this.Zn.push(s===Da.ASCENDING?_a:xa)}}}return this.Zn},enumerable:!0,configurable:!0}),ja.prototype.ui=function(t){Gr(null==this.ei()||!(t instanceof Ea)||!t.si()||t.field.isEqual(this.ei()),"Query must only have one inequality field."),Gr(!this.Hn(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new ja(this.path,this.collectionGroup,this.Xn.slice(),e,this.limit,this.$n,this.startAt,this.endAt)},ja.prototype.oi=function(t){Gr(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.Xn.concat([t]);return new ja(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.$n,this.startAt,this.endAt)},ja.prototype.hi=function(t){return new ja(this.path,this.collectionGroup,this.Xn.slice(),this.filters.slice(),t,ra.Jn,this.startAt,this.endAt)},ja.prototype.ci=function(t){return new ja(this.path,this.collectionGroup,this.Xn.slice(),this.filters.slice(),t,ra.Yn,this.startAt,this.endAt)},ja.prototype.ai=function(t){return new ja(this.path,this.collectionGroup,this.Xn.slice(),this.filters.slice(),this.limit,this.$n,t,this.endAt)},ja.prototype.fi=function(t){return new ja(this.path,this.collectionGroup,this.Xn.slice(),this.filters.slice(),this.limit,this.$n,this.startAt,t)},ja.prototype.li=function(t){return new ja(t,null,this.Xn.slice(),this.filters.slice(),this.limit,this.$n,this.startAt,this.endAt)},ja.prototype.di=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.Xn.length||1===this.Xn.length&&this.Xn[0].field.st())},ja.prototype.canonicalId=function(){return this.vi().canonicalId()+"|lt:"+this.$n},ja.prototype.toString=function(){return"Query(target="+this.vi().toString()+"; limitType="+this.$n+")"},ja.prototype.isEqual=function(t){return this.vi().isEqual(t.vi())&&this.$n===t.$n},ja.prototype.wi=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.st()}return Gr(n,"orderBy used that doesn't compare on key field"),0},ja.prototype.matches=function(t){return this.mi(t)&&this.pi(t)&&this.gi(t)&&this.bi(t)},ja.prototype.yi=function(){return!ea(this.limit)&&this.$n===ra.Jn},ja.prototype._i=function(){return!ea(this.limit)&&this.$n===ra.Yn},ja.prototype.ri=function(){return 0<this.Xn.length?this.Xn[0].field:null},ja.prototype.ei=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof Ea&&n.si())return n.field}return null},ja.prototype.Ii=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof Ea&&0<=t.indexOf(r.op))return r.op}return null},ja.prototype.Hn=function(){return this.vi().Hn()},ja.prototype.Ti=function(){return null!==this.collectionGroup},ja.prototype.vi=function(){if(!this.ti)if(this.$n===ra.Jn)this.ti=new oa(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i=r.dir===Da.DESCENDING?Da.ASCENDING:Da.DESCENDING;t.push(new ka(r.field,i))}var o=this.endAt?new Ra(this.endAt.position,!this.endAt.before):null,s=this.startAt?new Ra(this.startAt.position,!this.startAt.before):null;this.ti=new oa(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.ti},ja.prototype.mi=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.at(this.collectionGroup)&&this.path.Z(e):Bi.ct(this.path)?this.path.isEqual(e):this.path.tt(e)},ja.prototype.pi=function(t){for(var e=0,n=this.Xn;e<n.length;e++){var r=n[e];if(!r.field.st()&&null===t.field(r.field))return!1}return!0},ja.prototype.gi=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},ja.prototype.bi=function(t){return!(this.startAt&&!this.startAt.Ei(this.orderBy,t)||this.endAt&&this.endAt.Ei(this.orderBy,t))},ja.prototype.ni=function(t){Gr(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},ja),ba=(Ga.et=function(t){switch(t){case"<":return Ga.LESS_THAN;case"<=":return Ga.LESS_THAN_OR_EQUAL;case"==":return Ga.EQUAL;case">=":return Ga.GREATER_THAN_OR_EQUAL;case">":return Ga.GREATER_THAN;case"array-contains":return Ga.ARRAY_CONTAINS;case"in":return Ga.IN;case"array-contains-any":return Ga.ARRAY_CONTAINS_ANY;default:return Fr("Unknown FieldFilter operator: "+t)}},Ga.prototype.toString=function(){return this.name},Ga.prototype.isEqual=function(t){return this.name===t.name},Ga.LESS_THAN=new Ga("<"),Ga.LESS_THAN_OR_EQUAL=new Ga("<="),Ga.EQUAL=new Ga("=="),Ga.GREATER_THAN=new Ga(">"),Ga.GREATER_THAN_OR_EQUAL=new Ga(">="),Ga.ARRAY_CONTAINS=new Ga("array-contains"),Ga.IN=new Ga("in"),Ga.ARRAY_CONTAINS_ANY=new Ga("array-contains-any"),Ga),Ea=(t(Fa,ga=function(){}),Fa.create=function(t,e,n){if(t.st())return e===ba.IN?(Gr(n instanceof Cs,"Comparing on key with IN, but filter value not an ArrayValue"),Gr(n.Yt.every(function(t){return t instanceof ks}),"Comparing on key with IN, but an array value was not a RefValue"),new Ta(t,n)):(Gr(n instanceof ks,"Comparing on key, but filter value not a RefValue"),Gr(e!==ba.ARRAY_CONTAINS&&e!==ba.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new Ia(t,e,n));if(n.isEqual(es.Fn)){if(e!==ba.EQUAL)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Fa(t,e,n)}if(n.isEqual(Ns.Un)){if(e!==ba.EQUAL)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Fa(t,e,n)}return e===ba.ARRAY_CONTAINS?new Na(t,n):e===ba.IN?(Gr(n instanceof Cs,"IN filter has invalid value: "+n.toString()),new Aa(t,n)):e===ba.ARRAY_CONTAINS_ANY?(Gr(n instanceof Cs,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new Sa(t,n)):new Fa(t,e,n)},Fa.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.kn===e.kn&&this.Ri(e.h(this.value))},Fa.prototype.Ri=function(t){switch(this.op){case ba.LESS_THAN:return t<0;case ba.LESS_THAN_OR_EQUAL:return t<=0;case ba.EQUAL:return 0===t;case ba.GREATER_THAN:return 0<t;case ba.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Fr("Unknown FieldFilter operator: "+this.op)}},Fa.prototype.si=function(){return 0<=[ba.LESS_THAN,ba.LESS_THAN_OR_EQUAL,ba.GREATER_THAN,ba.GREATER_THAN_OR_EQUAL].indexOf(this.op)},Fa.prototype.canonicalId=function(){return this.field.it()+this.op.toString()+this.value.toString()},Fa.prototype.isEqual=function(t){return t instanceof Fa&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},Fa.prototype.toString=function(){return this.field.it()+" "+this.op+" "+this.value.value()},Fa),Ia=(t(Va,ma=Ea),Va.prototype.matches=function(t){var e=this.value,n=Bi.W(t.key,e.key);return this.Ri(n)},Va),Ta=(t(qa,ya=Ea),qa.prototype.matches=function(e){return this.value.Yt.some(function(t){return e.key.isEqual(t.key)})},qa),Na=(t(Ua,va=Ea),Ua.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Cs&&e.contains(this.value)},Ua),Aa=(t(Ma,da=Ea),Ma.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},Ma),Sa=(t(La,pa=Ea),La.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Cs&&n.Yt.some(function(t){return e.value.contains(t)})},La),Da=(Pa.prototype.toString=function(){return this.name},Pa.ASCENDING=new Pa("asc"),Pa.DESCENDING=new Pa("desc"),Pa),Ra=(Oa.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},Oa.prototype.Ei=function(t,e){Gr(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.st())Gr(o instanceof ks,"Bound has a non-key value where the key path is being used."),n=Bi.W(o.key,e.key);else{var s=e.field(i.field);Gr(null!==s,"Field should exist since document matched the orderBy already."),n=o.h(s)}if(i.dir===Da.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},Oa.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},Oa),ka=(Ca.prototype.compare=function(t,e){var n=this.Ai?Ps.qn(t,e):Ps.zn(this.field,t,e);switch(this.dir){case Da.ASCENDING:return n;case Da.DESCENDING:return-1*n;default:return Fr("Unknown direction: "+this.dir)}},Ca.prototype.canonicalId=function(){return this.field.it()+this.dir.toString()},Ca.prototype.toString=function(){return this.field.it()+" ("+this.dir+")"},Ca.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},Ca),_a=new ka(Yi.ot(),Da.ASCENDING),xa=new ka(Yi.ot(),Da.DESCENDING);function Ca(t,e){this.field=t,void 0===e&&(e=Da.ASCENDING),this.dir=e,this.Ai=t.st()}function Oa(t,e){this.position=t,this.before=e}function Pa(t){this.name=t}function La(t,e){var n=pa.call(this,t,ba.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}function Ma(t,e){var n=da.call(this,t,ba.IN,e)||this;return n.value=e,n}function Ua(t,e){return va.call(this,t,ba.ARRAY_CONTAINS,e)||this}function qa(t,e){var n=ya.call(this,t,ba.IN,e)||this;return n.value=e,n}function Va(){return null!==ma&&ma.apply(this,arguments)||this}function Fa(t,e,n){var r=ga.call(this)||this;return r.field=t,r.op=e,r.value=n,r}function Ga(t){this.name=t}function ja(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=ra.Jn),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.Xn=n,this.filters=r,this.limit=i,this.$n=o,this.startAt=s,this.endAt=a,this.Zn=null,this.ti=null,this.startAt&&this.ni(this.startAt),this.endAt&&this.ni(this.endAt)}function Ya(){return Ju.fromBase64String("")}(ua=aa=aa||{})[ua.Di=0]="__PRIVATE_Unknown",ua[ua.Pi=1]="__PRIVATE_Online",ua[ua.Si=2]="__PRIVATE_Offline",(ca=ha=ha||{})[ca.Ci=0]="__PRIVATE_RemoteStore",ca[ca.Vi=1]="__PRIVATE_SharedClientState",(la=fa=fa||{})[la.Ni=0]="__PRIVATE_Listen",la[la.ki=1]="__PRIVATE_ExistenceFilterMismatch",la[la.Oi=2]="__PRIVATE_LimboResolution";var Ba,Wa,za=(Qa.prototype.ji=function(t){return new Qa(this.target,this.targetId,this.Fi,t,this.xi,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Qa.prototype.Ui=function(t,e){return new Qa(this.target,this.targetId,this.Fi,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Qa.prototype.Li=function(t){return new Qa(this.target,this.targetId,this.Fi,this.sequenceNumber,this.xi,t,this.resumeToken)},Qa.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.Fi===t.Fi&&this.sequenceNumber===t.sequenceNumber&&this.xi.isEqual(t.xi)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken.isEqual(t.resumeToken)&&this.target.isEqual(t.target)},Qa),Ha=(Ka.prototype.isEqual=function(t){return t&&t.count===this.count},Ka);function Ka(t){this.count=t}function Qa(t,e,n,r,i,o,s){void 0===i&&(i=Vi.MIN),void 0===o&&(o=Vi.MIN),void 0===s&&(s=Ya()),this.target=t,this.targetId=e,this.Fi=n,this.sequenceNumber=r,this.xi=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Xa(t){switch(t){case Zr.OK:return Fr("Treated status OK as error");case Zr.CANCELLED:case Zr.UNKNOWN:case Zr.DEADLINE_EXCEEDED:case Zr.RESOURCE_EXHAUSTED:case Zr.INTERNAL:case Zr.UNAVAILABLE:case Zr.UNAUTHENTICATED:return!1;case Zr.INVALID_ARGUMENT:case Zr.NOT_FOUND:case Zr.ALREADY_EXISTS:case Zr.PERMISSION_DENIED:case Zr.FAILED_PRECONDITION:case Zr.ABORTED:case Zr.OUT_OF_RANGE:case Zr.UNIMPLEMENTED:case Zr.DATA_LOSS:return!0;default:return Fr("Unknown status code: "+t)}}function Ja(t){if(void 0===t)return qr("GRPC error has no .code"),Zr.UNKNOWN;switch(t){case Ba.OK:return Zr.OK;case Ba.CANCELLED:return Zr.CANCELLED;case Ba.UNKNOWN:return Zr.UNKNOWN;case Ba.DEADLINE_EXCEEDED:return Zr.DEADLINE_EXCEEDED;case Ba.RESOURCE_EXHAUSTED:return Zr.RESOURCE_EXHAUSTED;case Ba.INTERNAL:return Zr.INTERNAL;case Ba.UNAVAILABLE:return Zr.UNAVAILABLE;case Ba.UNAUTHENTICATED:return Zr.UNAUTHENTICATED;case Ba.INVALID_ARGUMENT:return Zr.INVALID_ARGUMENT;case Ba.NOT_FOUND:return Zr.NOT_FOUND;case Ba.ALREADY_EXISTS:return Zr.ALREADY_EXISTS;case Ba.PERMISSION_DENIED:return Zr.PERMISSION_DENIED;case Ba.FAILED_PRECONDITION:return Zr.FAILED_PRECONDITION;case Ba.ABORTED:return Zr.ABORTED;case Ba.OUT_OF_RANGE:return Zr.OUT_OF_RANGE;case Ba.UNIMPLEMENTED:return Zr.UNIMPLEMENTED;case Ba.DATA_LOSS:return Zr.DATA_LOSS;default:return Fr("Unknown status code: "+t)}}(Wa=Ba=Ba||{})[Wa.OK=0]="OK",Wa[Wa.CANCELLED=1]="CANCELLED",Wa[Wa.UNKNOWN=2]="UNKNOWN",Wa[Wa.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Wa[Wa.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Wa[Wa.NOT_FOUND=5]="NOT_FOUND",Wa[Wa.ALREADY_EXISTS=6]="ALREADY_EXISTS",Wa[Wa.PERMISSION_DENIED=7]="PERMISSION_DENIED",Wa[Wa.UNAUTHENTICATED=16]="UNAUTHENTICATED",Wa[Wa.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Wa[Wa.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Wa[Wa.ABORTED=10]="ABORTED",Wa[Wa.OUT_OF_RANGE=11]="OUT_OF_RANGE",Wa[Wa.UNIMPLEMENTED=12]="UNIMPLEMENTED",Wa[Wa.INTERNAL=13]="INTERNAL",Wa[Wa.UNAVAILABLE=14]="UNAVAILABLE",Wa[Wa.DATA_LOSS=15]="DATA_LOSS";var $a=new Wi(Bi.W);function Za(){return $a}function tu(){return Za()}var eu=new Wi(Bi.W);function nu(){return eu}var ru=new Wi(Bi.W);function iu(){return ru}var ou=new so(Bi.W);function su(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=ou,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var au=new so(Br);function uu(){return au}var hu,cu,fu,lu,pu=(du.qi=function(t){return new du(t.W)},du.prototype.has=function(t){return null!=this.Bi.get(t)},du.prototype.get=function(t){return this.Bi.get(t)},du.prototype.first=function(){return this.Mi.pt()},du.prototype.last=function(){return this.Mi.gt()},du.prototype.Y=function(){return this.Mi.Y()},du.prototype.indexOf=function(t){var e=this.Bi.get(t);return e?this.Mi.indexOf(e):-1},Object.defineProperty(du.prototype,"size",{get:function(){return this.Mi.size},enumerable:!0,configurable:!0}),du.prototype.forEach=function(n){this.Mi.bt(function(t,e){return n(t),!1})},du.prototype.add=function(t){var e=this.delete(t.key);return e.vt(e.Bi.dt(t.key,t),e.Mi.dt(t,null))},du.prototype.delete=function(t){var e=this.get(t);return e?this.vt(this.Bi.remove(t),this.Mi.remove(e)):this},du.prototype.isEqual=function(t){if(!(t instanceof du))return!1;if(this.size!==t.size)return!1;for(var e=this.Mi._t(),n=t.Mi._t();e.Pt();){var r=e.Dt().key,i=n.Dt().key;if(!r.isEqual(i))return!1}return!0},du.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},du.prototype.vt=function(t,e){var n=new du;return n.W=this.W,n.Bi=t,n.Mi=e,n},du);function du(n){this.W=n?function(t,e){return n(t,e)||Bi.W(t.key,e.key)}:function(t,e){return Bi.W(t.key,e.key)},this.Bi=nu(),this.Mi=new Wi(this.W)}(cu=hu=hu||{})[cu.Qi=0]="__PRIVATE_Added",cu[cu.Gi=1]="__PRIVATE_Removed",cu[cu.Wi=2]="__PRIVATE_Modified",cu[cu.zi=3]="__PRIVATE_Metadata",(lu=fu=fu||{})[lu.Ki=0]="__PRIVATE_Local",lu[lu.Hi=1]="__PRIVATE_Synced";function vu(t,e,n,r){this.le=t,this.removedTargetIds=e,this.key=n,this.de=r}function yu(t,e){this.targetId=t,this.ve=e}var mu,gu,wu=(Su.prototype.track=function(t){var e=t.doc.key,n=this.Ji.get(e);n?t.type!==hu.Qi&&n.type===hu.zi?this.Ji=this.Ji.dt(e,t):t.type===hu.zi&&n.type!==hu.Gi?this.Ji=this.Ji.dt(e,{type:n.type,doc:t.doc}):t.type===hu.Wi&&n.type===hu.Wi?this.Ji=this.Ji.dt(e,{type:hu.Wi,doc:t.doc}):t.type===hu.Wi&&n.type===hu.Qi?this.Ji=this.Ji.dt(e,{type:hu.Qi,doc:t.doc}):t.type===hu.Gi&&n.type===hu.Qi?this.Ji=this.Ji.remove(e):t.type===hu.Gi&&n.type===hu.Wi?this.Ji=this.Ji.dt(e,{type:hu.Gi,doc:n.doc}):t.type===hu.Qi&&n.type===hu.Gi?this.Ji=this.Ji.dt(e,{type:hu.Wi,doc:t.doc}):Fr("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.Ji=this.Ji.dt(e,t)},Su.prototype.Yi=function(){var n=[];return this.Ji.bt(function(t,e){n.push(e)}),n},Su),bu=(Au.ne=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:hu.Qi,doc:t})}),new Au(t,e,pu.qi(e),i,n,r,!0,!1)},Object.defineProperty(Au.prototype,"hasPendingWrites",{get:function(){return!this.$i.Y()},enumerable:!0,configurable:!0}),Au.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Zi===t.Zi&&this.$i.isEqual(t.$i)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.Xi.isEqual(t.Xi)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Au),Eu=(Nu.se=function(t,e){var n,r=((n={})[t]=Iu.oe(t,e),n);return new Nu(Vi.MIN,r,uu(),Za(),su())},Nu),Iu=(Tu.oe=function(t,e){return new Tu(Ya(),e,su(),su(),su())},Tu);function Tu(t,e,n,r,i){this.resumeToken=t,this.he=e,this.ce=n,this.ae=r,this.fe=i}function Nu(t,e,n,r,i){this.xi=t,this.ie=e,this.ee=n,this.re=r,this.ue=i}function Au(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.Xi=n,this.docChanges=r,this.$i=i,this.fromCache=o,this.Zi=s,this.te=a}function Su(){this.Ji=new Wi(Bi.W)}(gu=mu=mu||{})[gu.we=0]="__PRIVATE_NoChange",gu[gu.Qi=1]="__PRIVATE_Added",gu[gu.Gi=2]="__PRIVATE_Removed",gu[gu.me=3]="__PRIVATE_Current",gu[gu.pe=4]="__PRIVATE_Reset";function Du(t,e,n,r){void 0===n&&(n=Ya()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var Ru=(Object.defineProperty(xu.prototype,"he",{get:function(){return this._e},enumerable:!0,configurable:!0}),Object.defineProperty(xu.prototype,"resumeToken",{get:function(){return this.ye},enumerable:!0,configurable:!0}),Object.defineProperty(xu.prototype,"Te",{get:function(){return 0!==this.ge},enumerable:!0,configurable:!0}),Object.defineProperty(xu.prototype,"Ee",{get:function(){return this.Ie},enumerable:!0,configurable:!0}),xu.prototype.Re=function(t){0<t.Bn()&&(this.Ie=!0,this.ye=t)},xu.prototype.Ae=function(){var n=su(),r=su(),i=su();return this.be.forEach(function(t,e){switch(e){case hu.Qi:n=n.add(t);break;case hu.Wi:r=r.add(t);break;case hu.Gi:i=i.add(t);break;default:Fr("Encountered invalid change type: "+e)}}),new Iu(this.ye,this._e,n,r,i)},xu.prototype.De=function(){this.Ie=!1,this.be=Ou()},xu.prototype.Pe=function(t,e){this.Ie=!0,this.be=this.be.dt(t,e)},xu.prototype.Se=function(t){this.Ie=!0,this.be=this.be.remove(t)},xu.prototype.Ce=function(){this.ge+=1},xu.prototype.Ve=function(){this.ge-=1},xu.prototype.Ne=function(){this.Ie=!0,this._e=!0},xu),ku=(_u.prototype.Ue=function(t){for(var e=0,n=t.le;e<n.length;e++){var r=n[e];t.de instanceof Ps?this.Le(r,t.de):t.de instanceof Ls&&this.Be(r,t.key,t.de)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.Be(r,t.key,t.de)},_u.prototype.Me=function(n){var r=this;this.qe(n,function(t){var e=r.Qe(t);switch(n.state){case mu.we:r.Ge(t)&&e.Re(n.resumeToken);break;case mu.Qi:e.Ve(),e.Te||e.De(),e.Re(n.resumeToken);break;case mu.Gi:e.Ve(),e.Te||r.removeTarget(t),Gr(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case mu.me:r.Ge(t)&&(e.Ne(),e.Re(n.resumeToken));break;case mu.pe:r.Ge(t)&&(r.We(t),e.Re(n.resumeToken));break;default:Fr("Unknown target watch change state: "+n.state)}})},_u.prototype.qe=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):di(this.Oe,e)},_u.prototype.ze=function(t){var e=t.targetId,n=t.ve.count,r=this.Ke(e);if(r){var i=r.target;if(i.Hn())if(0===n){var o=new Bi(i.path);this.Be(e,o,new Ls(o,Vi.B()))}else Gr(1===n,"Single document existence filter with count: "+n);else this.He(e)!==n&&(this.We(e),this.je=this.je.add(e))}},_u.prototype.Je=function(i){var o=this,s={};di(this.Oe,function(t,e){var n=o.Ke(t);if(n){if(e.he&&n.target.Hn()){var r=new Bi(n.target.path);null!==o.Fe.get(r)||o.Ye(t,r)||o.Be(t,r,new Ls(r,i))}e.Ee&&(s[t]=e.Ae(),e.De())}});var r=su();this.xe.forEach(function(t,e){var n=!0;e.qt(function(t){var e=o.Ke(t);return!e||e.Fi===fa.Oi||(n=!1)}),n&&(r=r.add(t))});var t=new Eu(i,s,this.je,this.Fe,r);return this.Fe=Za(),this.xe=Cu(),this.je=new so(Br),t},_u.prototype.Le=function(t,e){if(this.Ge(t)){var n=this.Ye(t,e.key)?hu.Wi:hu.Qi;this.Qe(t).Pe(e.key,n),this.Fe=this.Fe.dt(e.key,e),this.xe=this.xe.dt(e.key,this.Xe(e.key).add(t))}},_u.prototype.Be=function(t,e,n){if(this.Ge(t)){var r=this.Qe(t);this.Ye(t,e)?r.Pe(e,hu.Gi):r.Se(e),this.xe=this.xe.dt(e,this.Xe(e).delete(t)),n&&(this.Fe=this.Fe.dt(e,n))}},_u.prototype.removeTarget=function(t){delete this.Oe[t]},_u.prototype.He=function(t){var e=this.Qe(t).Ae();return this.ke.$e(t).size+e.ce.size-e.fe.size},_u.prototype.Ce=function(t){this.Qe(t).Ce()},_u.prototype.Qe=function(t){return this.Oe[t]||(this.Oe[t]=new Ru),this.Oe[t]},_u.prototype.Xe=function(t){var e=this.xe.get(t);return e||(e=new so(Br),this.xe=this.xe.dt(t,e)),e},_u.prototype.Ge=function(t){var e=null!==this.Ke(t);return e||Ur("WatchChangeAggregator","Detected inactive target",t),e},_u.prototype.Ke=function(t){var e=this.Oe[t];return e&&e.Te?null:this.ke.Ze(t)},_u.prototype.We=function(e){var n=this;Gr(!this.Oe[e].Te,"Should only reset active targets"),this.Oe[e]=new Ru,this.ke.$e(e).forEach(function(t){n.Be(e,t,null)})},_u.prototype.Ye=function(t,e){return this.ke.$e(t).has(e)},_u);function _u(t){this.ke=t,this.Oe={},this.Fe=Za(),this.xe=Cu(),this.je=new so(Br)}function xu(){this.ge=0,this.be=Ou(),this.ye=Ya(),this._e=!1,this.Ie=!0}function Cu(){return new Wi(Bi.W)}function Ou(){return new Wi(Bi.W)}var Pu,Lu,Mu=((Pu={})[Da.ASCENDING.name]="ASCENDING",Pu[Da.DESCENDING.name]="DESCENDING",Pu),Uu=((Lu={})[ba.LESS_THAN.name]="LESS_THAN",Lu[ba.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",Lu[ba.GREATER_THAN.name]="GREATER_THAN",Lu[ba.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",Lu[ba.EQUAL.name]="EQUAL",Lu[ba.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",Lu[ba.IN.name]="IN",Lu[ba.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",Lu),qu=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Vu(t,e){Gr(!ea(t),e+" is missing")}function Fu(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Fr("can't parse "+t)}var Gu=(Bu.prototype.tr=function(t){var e=void 0===t.code?Zr.UNKNOWN:Ja(t.code);return new ti(e,t.message||"")},Bu.prototype.nr=function(t){return this.options.ir||ea(t)?t:{value:t}},Bu.prototype.er=function(t){var e;return ea(e="object"==typeof t?t.value:t)?null:e},Bu.prototype.q=function(t){return this.options.ir?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},Bu.prototype.L=function(t){if("string"==typeof t)return this.rr(t);Gr(!!t,"Cannot deserialize null or undefined timestamp.");var e=Fu(t.seconds||"0"),n=t.nanos||0;return new qi(e,n)},Bu.prototype.rr=function(t){var e=0,n=qu.exec(t);if(Gr(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new qi(o,e)},Bu.prototype.ur=function(t){return this.options.ir?t.toBase64():t.toUint8Array()},Bu.prototype.sr=function(t){return this.options.ir?Ju.fromBase64String(t||""):Ju.fromUint8Array(t||new Uint8Array)},Bu.prototype.or=function(t){return"string"==typeof t?(Gr(this.options.ir,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Ju.fromBase64String(t)):(Gr(!this.options.ir,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Ju.fromUint8Array(t))},Bu.prototype.toVersion=function(t){return this.q(t.q())},Bu.prototype.fromVersion=function(t){return Gr(!!t,"Trying to deserialize version that isn't set"),Vi.L(this.L(t))},Bu.prototype.hr=function(t,e){return this.cr(t).child("documents").child(e).it()},Bu.prototype.ar=function(t){var e=Gi.et(t);return Gr(this.lr(e),"Tried to deserialize invalid key "+e.toString()),e},Bu.prototype.dr=function(t){return this.hr(this.s,t.path)},Bu.prototype.vr=function(t){var e=this.ar(t);return Gr(e.get(1)===this.s.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.s.projectId),Gr(!e.get(3)&&!this.s.database||e.get(3)===this.s.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.s.database),new Bi(this.wr(e))},Bu.prototype.mr=function(t){return this.hr(this.s,t)},Bu.prototype.pr=function(t){var e=this.ar(t);return 4===e.length?Gi.rt:this.wr(e)},Object.defineProperty(Bu.prototype,"gr",{get:function(){return new Gi(["projects",this.s.projectId,"databases",this.s.database]).it()},enumerable:!0,configurable:!0}),Bu.prototype.cr=function(t){return new Gi(["projects",t.projectId,"databases",t.database])},Bu.prototype.wr=function(t){return Gr(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.H(5)},Bu.prototype.lr=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},Bu.prototype.br=function(t){if(t instanceof es)return{nullValue:"NULL_VALUE"};if(t instanceof ns)return{booleanValue:t.value()};if(t instanceof Ts)return{integerValue:""+t.value()};if(t instanceof Ns){var e=t.value();if(this.options.ir){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof As?{stringValue:t.value()}:t instanceof xs?{mapValue:this.yr(t)}:t instanceof Cs?{arrayValue:this._r(t)}:t instanceof Ss?{timestampValue:this.q(t.Yt)}:t instanceof _s?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Rs?{bytesValue:this.ur(t.value())}:t instanceof ks?{referenceValue:this.hr(t.s,t.key.path)}:Fr("Unknown FieldValue "+JSON.stringify(t))},Bu.prototype.Ir=function(t){var e=this;if("nullValue"in t)return es.Fn;if("booleanValue"in t)return ns.of(t.booleanValue);if("integerValue"in t)return new Ts(Fu(t.integerValue));if("doubleValue"in t){if(this.options.ir){if("NaN"===t.doubleValue)return Ns.Un;if("Infinity"===t.doubleValue)return Ns.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return Ns.NEGATIVE_INFINITY}return new Ns(t.doubleValue)}if("stringValue"in t)return new As(t.stringValue);if("mapValue"in t)return this.Tr(t.mapValue.fields||{});if("arrayValue"in t){Vu(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Cs(n.map(function(t){return e.Ir(t)}))}if("timestampValue"in t)return Vu(t.timestampValue,"timestampValue"),new Ss(this.L(t.timestampValue));if("geoPointValue"in t){Vu(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new _s(new Ui(r,i))}if("bytesValue"in t){Vu(t.bytesValue,"bytesValue");var o=this.or(t.bytesValue);return new Rs(o)}if("referenceValue"in t){Vu(t.referenceValue,"referenceValue");var s=this.ar(t.referenceValue),a=new Jr(s.get(1),s.get(3)),u=new Bi(this.wr(s));return new ks(a,u)}return Fr("Unknown Value proto "+JSON.stringify(t))},Bu.prototype.Er=function(t,e){return{name:this.dr(t),fields:this.Rr(e)}},Bu.prototype.Ar=function(t){return Gr(!t.cn,"Can't serialize documents with mutations."),{name:this.dr(t.key),fields:this.Rr(t.data()),updateTime:this.q(t.version.q())}},Bu.prototype.Dr=function(t,e){var n=this,r=this.vr(t.name),i=this.fromVersion(t.updateTime);return new Ps(r,i,{hasCommittedMutations:!!e},void 0,t,function(t){return n.Ir(t)})},Bu.prototype.Rr=function(t){var n=this,r={};return t.forEach(function(t,e){r[t]=n.br(e)}),r},Bu.prototype.Tr=function(t){var n=this,e=t,r=xs.EMPTY;return vi(e,function(t,e){r=r.set(new Yi([t]),n.Ir(e))}),r},Bu.prototype.yr=function(t){return{fields:this.Rr(t)}},Bu.prototype._r=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.br(t))}),{values:n}},Bu.prototype.Pr=function(t){var e=this;Gr(!!t.found,"Tried to deserialize a found document from a missing document."),Vu(t.found.name,"doc.found.name"),Vu(t.found.updateTime,"doc.found.updateTime");var n=this.vr(t.found.name),r=this.fromVersion(t.found.updateTime);return new Ps(n,r,{},void 0,t.found,function(t){return e.Ir(t)})},Bu.prototype.Sr=function(t){Gr(!!t.missing,"Tried to deserialize a missing document from a found document."),Gr(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.vr(t.missing),n=this.fromVersion(t.readTime);return new Ls(e,n)},Bu.prototype.Cr=function(t){return"found"in t?this.Pr(t):"missing"in t?this.Sr(t):Fr("invalid batch get response: "+JSON.stringify(t))},Bu.prototype.Vr=function(t){switch(t){case mu.Qi:return"ADD";case mu.me:return"CURRENT";case mu.we:return"NO_CHANGE";case mu.Gi:return"REMOVE";case mu.pe:return"RESET";default:return Fr("Unknown WatchTargetChangeState: "+t)}},Bu.prototype.Nr=function(t){if(t instanceof yu)return{filter:{count:t.ve.count,targetId:t.targetId}};if(t instanceof vu){if(t.de instanceof Ps){var e=t.de;return{documentChange:{document:{name:this.dr(e.key),fields:this.Rr(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.le,removedTargetIds:t.removedTargetIds}}}if(t.de instanceof Ls)return e=t.de,{documentDelete:{document:this.dr(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.de)return{documentRemove:{document:this.dr(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof Du){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return Ba.OK;switch(t){case Zr.OK:return Ba.OK;case Zr.CANCELLED:return Ba.CANCELLED;case Zr.UNKNOWN:return Ba.UNKNOWN;case Zr.DEADLINE_EXCEEDED:return Ba.DEADLINE_EXCEEDED;case Zr.RESOURCE_EXHAUSTED:return Ba.RESOURCE_EXHAUSTED;case Zr.INTERNAL:return Ba.INTERNAL;case Zr.UNAVAILABLE:return Ba.UNAVAILABLE;case Zr.UNAUTHENTICATED:return Ba.UNAUTHENTICATED;case Zr.INVALID_ARGUMENT:return Ba.INVALID_ARGUMENT;case Zr.NOT_FOUND:return Ba.NOT_FOUND;case Zr.ALREADY_EXISTS:return Ba.ALREADY_EXISTS;case Zr.PERMISSION_DENIED:return Ba.PERMISSION_DENIED;case Zr.FAILED_PRECONDITION:return Ba.FAILED_PRECONDITION;case Zr.ABORTED:return Ba.ABORTED;case Zr.OUT_OF_RANGE:return Ba.OUT_OF_RANGE;case Zr.UNIMPLEMENTED:return Ba.UNIMPLEMENTED;case Zr.DATA_LOSS:return Ba.DATA_LOSS;default:return Fr("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.Vr(t.state),targetIds:t.targetIds,resumeToken:this.ur(t.resumeToken),cause:n}}}return Fr("Unrecognized watch change: "+JSON.stringify(t))},Bu.prototype.kr=function(t){var e,n=this;if("targetChange"in t){Vu(t.targetChange,"targetChange");var r=this.Or(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=this.sr(t.targetChange.resumeToken),s=t.targetChange.cause,a=s&&this.tr(s);e=new Du(r,i,o,a||null)}else if("documentChange"in t){Vu(t.documentChange,"documentChange");var u=t.documentChange;Vu(u.document,"documentChange.name"),Vu(u.document.name,"documentChange.document.name"),Vu(u.document.updateTime,"documentChange.document.updateTime");var h=this.vr(u.document.name),c=this.fromVersion(u.document.updateTime),f=new Ps(h,c,{},void 0,u.document,function(t){return n.Ir(t)}),l=u.targetIds||[],p=u.removedTargetIds||[];e=new vu(l,p,f.key,f)}else if("documentDelete"in t){Vu(t.documentDelete,"documentDelete");var d=t.documentDelete;Vu(d.document,"documentDelete.document"),h=this.vr(d.document),c=d.readTime?this.fromVersion(d.readTime):Vi.B(),f=new Ls(h,c),p=d.removedTargetIds||[],e=new vu([],p,f.key,f)}else if("documentRemove"in t){Vu(t.documentRemove,"documentRemove");var v=t.documentRemove;Vu(v.document,"documentRemove"),h=this.vr(v.document),p=v.removedTargetIds||[],e=new vu([],p,h,null)}else{if(!("filter"in t))return Fr("Unknown change type "+JSON.stringify(t));Vu(t.filter,"filter");var y=t.filter;Vu(y.targetId,"filter.targetId");var m=y.count||0,g=new Ha(m),w=y.targetId;e=new yu(w,g)}return e},Bu.prototype.Or=function(t){return"NO_CHANGE"===t?mu.we:"ADD"===t?mu.Qi:"REMOVE"===t?mu.Gi:"CURRENT"===t?mu.me:"RESET"===t?mu.pe:Fr("Got unexpected TargetChange.state: "+t)},Bu.prototype.Fr=function(t){if(!("targetChange"in t))return Vi.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Vi.MIN:e.readTime?this.fromVersion(e.readTime):Vi.MIN},Bu.prototype.xr=function(t){var e,n=this;if(t instanceof qo)e={update:this.Er(t.key,t.value)};else if(t instanceof Go)e={delete:this.dr(t.key)};else if(t instanceof Vo)e={update:this.Er(t.key,t.data),updateMask:this.jr(t.fn)};else if(t instanceof Fo)e={transform:{document:this.dr(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.Ur(t)})}};else{if(!(t instanceof jo))return Fr("Unknown mutation type "+t.type);e={verify:this.dr(t.key)}}return t.hn.rn||(e.currentDocument=this.Lr(t.hn)),e},Bu.prototype.Br=function(t){var e=this,n=t.currentDocument?this.Mr(t.currentDocument):Mo.NONE;if(t.update){Vu(t.update.name,"name");var r=this.vr(t.update.name),i=this.Tr(t.update.fields||{});if(t.updateMask){var o=this.qr(t.updateMask);return new Vo(r,i,o,n)}return new qo(r,i,n)}if(t.delete)return r=this.vr(t.delete),new Go(r,n);if(t.transform){r=this.vr(t.transform.document);var s=t.transform.fieldTransforms.map(function(t){return e.Qr(t)});return Gr(!0===n.exists,'Transforms only support precondition "exists == true"'),new Fo(r,s)}return t.verify?(r=this.vr(t.verify),new jo(r,n)):Fr("unknown mutation proto: "+JSON.stringify(t))},Bu.prototype.Lr=function(t){return Gr(!t.rn,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Fr("Unknown precondition")},Bu.prototype.Mr=function(t){return void 0!==t.updateTime?Mo.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Mo.exists(t.exists):Mo.NONE},Bu.prototype.Gr=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);r.isEqual(Vi.MIN)&&(r=this.fromVersion(e));var i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.Ir(t)})),new bo(r,i)},Bu.prototype.Wr=function(t,e){var n=this;return t&&0<t.length?(Gr(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.Gr(t,e)})):[]},Bu.prototype.Ur=function(t){var e=this,n=t.transform;if(n instanceof uo)return{fieldPath:t.field.it(),setToServerValue:"REQUEST_TIME"};if(n instanceof ho)return{fieldPath:t.field.it(),appendMissingElements:{values:n.elements.map(function(t){return e.br(t)})}};if(n instanceof co)return{fieldPath:t.field.it(),removeAllFromArray:{values:n.elements.map(function(t){return e.br(t)})}};if(n instanceof fo)return{fieldPath:t.field.it(),increment:this.br(n.Jt)};throw Fr("Unknown transform: "+t.transform)},Bu.prototype.Qr=function(t){var e=this,n=null;if("setToServerValue"in t)Gr("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=uo.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new ho(r.map(function(t){return e.Ir(t)}))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new co(r.map(function(t){return e.Ir(t)}));else if("increment"in t){var i=this.Ir(t.increment);Gr(i instanceof rs,"NUMERIC_ADD transform requires a NumberValue"),n=new fo(i)}else Fr("Unknown transform proto: "+JSON.stringify(t));var o=Yi.ht(t.fieldPath);return new No(o,n)},Bu.prototype.zr=function(t){return{documents:[this.mr(t.path)]}},Bu.prototype.Kr=function(t){var e=t.documents.length;Gr(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return wa.ii(this.pr(n)).vi()},Bu.prototype.Hr=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Gr(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.mr(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Gr(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.mr(n.J()),e.structuredQuery.from=[{collectionId:n.$()}]);var r=this.Jr(t.filters);r&&(e.structuredQuery.where=r);var i=this.Yr(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.nr(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.Xr(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.Xr(t.endAt)),e},Bu.prototype.$r=function(t){var e=this.pr(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Gr(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=this.Zr(n.where));var a=[];n.orderBy&&(a=this.tu(n.orderBy));var u=null;n.limit&&(u=this.er(n.limit));var h=null;n.startAt&&(h=this.nu(n.startAt));var c=null;return n.endAt&&(c=this.nu(n.endAt)),new wa(e,i,a,s,u,ra.Jn,h,c).vi()},Bu.prototype.iu=function(t){var e=this.eu(t.Fi);return null==e?null:{"goog-listen-tags":e}},Bu.prototype.eu=function(t){switch(t){case fa.Ni:return null;case fa.ki:return"existence-filter-mismatch";case fa.Oi:return"limbo-document";default:return Fr("Unrecognized query purpose: "+t)}},Bu.prototype.vi=function(t){var e,n=t.target;return(e=n.Hn()?{documents:this.zr(n)}:{query:this.Hr(n)}).targetId=t.targetId,0<t.resumeToken.Bn()&&(e.resumeToken=this.ur(t.resumeToken)),e},Bu.prototype.Jr=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof Ea?e.ru(t):Fr("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},Bu.prototype.Zr=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.uu(t)]:void 0!==t.fieldFilter?[this.su(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.Zr(t)}).reduce(function(t,e){return t.concat(e)}):Fr("Unknown filter: "+JSON.stringify(t)):[]},Bu.prototype.Yr=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.ou(t)})},Bu.prototype.tu=function(t){var e=this;return t.map(function(t){return e.hu(t)})},Bu.prototype.Xr=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.br(t)})}},Bu.prototype.nu=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.Ir(t)});return new Ra(r,n)},Bu.prototype.cu=function(t){return Mu[t.name]},Bu.prototype.au=function(t){switch(t){case"ASCENDING":return Da.ASCENDING;case"DESCENDING":return Da.DESCENDING;default:return}},Bu.prototype.fu=function(t){return Uu[t.name]},Bu.prototype.lu=function(t){switch(t){case"EQUAL":return ba.EQUAL;case"GREATER_THAN":return ba.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return ba.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return ba.LESS_THAN;case"LESS_THAN_OR_EQUAL":return ba.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return ba.ARRAY_CONTAINS;case"IN":return ba.IN;case"ARRAY_CONTAINS_ANY":return ba.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Fr("Unspecified operator");default:return Fr("Unknown operator")}},Bu.prototype.du=function(t){return{fieldPath:t.it()}},Bu.prototype.vu=function(t){return Yi.ht(t.fieldPath)},Bu.prototype.ou=function(t){return{field:this.du(t.field),direction:this.cu(t.dir)}},Bu.prototype.hu=function(t){return new ka(this.vu(t.field),this.au(t.direction))},Bu.prototype.su=function(t){return Ea.create(this.vu(t.fieldFilter.field),this.lu(t.fieldFilter.op),this.Ir(t.fieldFilter.value))},Bu.prototype.ru=function(t){if(t.op===ba.EQUAL){if(t.value.isEqual(Ns.Un))return{unaryFilter:{field:this.du(t.field),op:"IS_NAN"}};if(t.value.isEqual(es.Fn))return{unaryFilter:{field:this.du(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.du(t.field),op:this.fu(t.op),value:this.br(t.value)}}},Bu.prototype.uu=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.vu(t.unaryFilter.field);return Ea.create(e,ba.EQUAL,Ns.Un);case"IS_NULL":var n=this.vu(t.unaryFilter.field);return Ea.create(n,ba.EQUAL,es.Fn);case"OPERATOR_UNSPECIFIED":return Fr("Unspecified filter");default:return Fr("Unknown filter")}},Bu.prototype.jr=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.it())}),{fieldPaths:e}},Bu.prototype.qr=function(t){var e=(t.fieldPaths||[]).map(function(t){return Yi.ht(t)});return To.$t(e)},Bu),ju=(Yu.wu=function(t){Yu.platform&&Fr("Platform already defined"),Yu.platform=t},Yu.t=function(){return Yu.platform||Fr("Platform not set"),Yu.platform},Yu);function Yu(){}function Bu(t,e){this.s=t,this.options=e}function Wu(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new ti(Zr.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function zu(){if("undefined"==typeof Uint8Array)throw new ti(Zr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Hu(){if(!ju.t().mu)throw new ti(Zr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}function Ku(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var Qu,Xu,Ju=(Ih.fromBase64String=function(t){gi("Blob.fromBase64String",arguments,1),Ei("Blob.fromBase64String","string",1,t),Hu();try{return new Ih(ju.t().atob(t))}catch(t){throw new ti(Zr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Ih.fromUint8Array=function(t){if(gi("Blob.fromUint8Array",arguments,1),zu(),!(t instanceof Uint8Array))throw xi("Blob.fromUint8Array","Uint8Array",1,t);return new Ih(Array.prototype.map.call(t,function(t){return String.fromCharCode(t)}).join(""))},Ih.prototype.toBase64=function(){return gi("Blob.toBase64",arguments,0),Hu(),ju.t().btoa(this.pu)},Ih.prototype.toUint8Array=function(){gi("Blob.toUint8Array",arguments,0),zu();for(var t=new Uint8Array(this.pu.length),e=0;e<this.pu.length;e++)t[e]=this.pu.charCodeAt(e);return t},Ih.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Ih.prototype.isEqual=function(t){return this.pu===t.pu},Ih.prototype.Bn=function(){return 2*this.pu.length},Ih.prototype.j=function(t){return Br(this.pu,t.pu)},Ih),$u=Wu(Ju,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Zu=(Eh.prototype.get=function(t){var e=this.gu(t),n=this.bu[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(s.isEqual(t))return a}},Eh.prototype.has=function(t){return void 0!==this.get(t)},Eh.prototype.set=function(t,e){var n=this.gu(t),r=this.bu[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.bu[n]=[[t,e]]},Eh.prototype.delete=function(t){var e=this.gu(t),n=this.bu[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.bu[e]:n.splice(r,1),!0;return!1},Eh.prototype.forEach=function(a){vi(this.bu,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];a(o,s)}})},Eh.prototype.Y=function(){return yi(this.bu)},Eh),th=(bh.prototype.Kt=function(t,e,n){e&&Gr(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.yu;Gr(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var s=r[i];e=o.Kt(e,s)}}return e},bh.prototype.zt=function(t,e){e&&Gr(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(a=r[n]).key.isEqual(t)&&(e=a.zt(e,e,this.Ln));for(var i=e,o=0,s=this.mutations;o<s.length;o++){var a;(a=s[o]).key.isEqual(t)&&(e=a.zt(e,i,this.Ln))}return e},bh.prototype._u=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.zt(t.key,n.get(t.key));e&&(i=i.dt(t.key,e))}),i},bh.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},su())},bh.prototype.isEqual=function(t){return this.batchId===t.batchId&&Wr(this.mutations,t.mutations)&&Wr(this.baseMutations,t.baseMutations)},bh),eh=(wh.from=function(t,e,n,r){Gr(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=iu(),o=t.mutations,s=0;s<o.length;s++)i=i.dt(o[s].key,n[s].version);return new wh(t,e,n,r,i)},wh),nh=(gh.prototype.Y=function(){return this.Eu.Y()},gh.prototype.Du=function(t,e){var n=new rh(t,e);this.Eu=this.Eu.add(n),this.Ru=this.Ru.add(n)},gh.prototype.Pu=function(t,e){var n=this;t.forEach(function(t){return n.Du(t,e)})},gh.prototype.Su=function(t,e){this.Cu(new rh(t,e))},gh.prototype.Vu=function(t,e){var n=this;t.forEach(function(t){return n.Su(t,e)})},gh.prototype.Nu=function(t){var e=this,n=Bi.EMPTY,r=new rh(n,t),i=new rh(n,t+1),o=[];return this.Ru.Mt([r,i],function(t){e.Cu(t),o.push(t.key)}),o},gh.prototype.ku=function(){var e=this;this.Eu.forEach(function(t){return e.Cu(t)})},gh.prototype.Cu=function(t){this.Eu=this.Eu.delete(t),this.Ru=this.Ru.delete(t)},gh.prototype.Ou=function(t){var e=Bi.EMPTY,n=new rh(e,t),r=new rh(e,t+1),i=su();return this.Ru.Mt([n,r],function(t){i=i.add(t.key)}),i},gh.prototype.Fu=function(t){var e=new rh(t,0),n=this.Eu.Qt(e);return null!==n&&t.isEqual(n.key)},gh),rh=(mh.qn=function(t,e){return Bi.W(t.key,e.key)||Br(t.xu,e.xu)},mh.Au=function(t,e){return Br(t.xu,e.xu)||Bi.W(t.key,e.key)},mh),ih=(yh.prototype.catch=function(t){return this.next(void 0,t)},yh.prototype.next=function(r,i){var o=this;return this.Bu&&Fr("Called next() or catch() twice for PersistencePromise"),this.Bu=!0,this.Lu?this.error?this.Mu(i,this.error):this.qu(r,this.result):new yh(function(e,n){o.ju=function(t){o.qu(r,t).next(e,n)},o.Uu=function(t){o.Mu(i,t).next(e,n)}})},yh.prototype.Qu=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},yh.prototype.Gu=function(t){try{var e=t();return e instanceof yh?e:yh.resolve(e)}catch(t){return yh.reject(t)}},yh.prototype.qu=function(t,e){return t?this.Gu(function(){return t(e)}):yh.resolve(e)},yh.prototype.Mu=function(t,e){return t?this.Gu(function(){return t(e)}):yh.reject(e)},yh.resolve=function(n){return new yh(function(t,e){t(n)})},yh.reject=function(n){return new yh(function(t,e){e(n)})},yh.Wu=function(t){return new yh(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},yh.zu=function(t){for(var n=yh.resolve(!1),e=function(e){n=n.next(function(t){return t?yh.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},yh.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.Wu(i)},yh),oh=(Object.defineProperty(vh.prototype,"readTime",{get:function(){return Gr(void 0!==this.Ju,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this.Ju},set:function(t){Gr(void 0===this.Ju||this.Ju.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this.Ju=t},enumerable:!0,configurable:!0}),vh.prototype.Yu=function(t,e){this.Xu(),this.readTime=e,this.Ku.set(t.key,t)},vh.prototype.$u=function(t,e){this.Xu(),e&&(this.readTime=e),this.Ku.set(t,null)},vh.prototype.Zu=function(t,e){this.Xu();var n=this.Ku.get(e);return void 0!==n?ih.resolve(n):this.ts(t,e)},vh.prototype.getEntries=function(t,e){return this.ns(t,e)},vh.prototype.apply=function(t){return this.Xu(),this.Hu=!0,this.es(t)},vh.prototype.Xu=function(){Gr(!this.Hu,"Changes have already been applied.")},vh),sh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ah=(dh.prototype.us=function(t){this.rs.push(t)},dh.prototype.ss=function(){this.rs.forEach(function(t){return t()})},dh),uh=(ph.prototype.as=function(e,n){var r=this;return this.hs.fs(e,n).next(function(t){return r.ls(e,n,t)})},ph.prototype.ls=function(t,r,i){return this.os.Zu(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].zt(r,t);return t})},ph.prototype.ds=function(t,e,i){var o=tu();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].zt(t,e);o=o.dt(t,e)}),o},ph.prototype.vs=function(e,t){var n=this;return this.os.getEntries(e,t).next(function(t){return n.ws(e,t)})},ph.prototype.ws=function(r,i){var o=this;return this.hs.ms(r,i).next(function(t){var e=o.ds(r,i,t),n=Za();return e.forEach(function(t,e){e=e||new Ls(t,Vi.B()),n=n.dt(t,e)}),n})},ph.prototype.ps=function(t,e,n){return e.Hn()?this.gs(t,e.path):e.Ti()?this.bs(t,e,n):this.ys(t,e,n)},ph.prototype.gs=function(t,e){return this.as(t,new Bi(e)).next(function(t){var e=nu();return t instanceof Ps&&(e=e.dt(t.key,t)),e})},ph.prototype.bs=function(n,r,i){var o=this;Gr(r.path.Y(),"Currently we only support collection group queries at the root.");var s=r.collectionGroup,a=nu();return this.cs._s(n,s).next(function(t){return ih.forEach(t,function(t){var e=r.li(t.child(s));return o.ys(n,e,i).next(function(t){t.forEach(function(t,e){a=a.dt(t,e)})})}).next(function(){return a})})},ph.prototype.ys=function(e,n,t){var c,f,r=this;return this.os.ps(e,n,t).next(function(t){return c=t,r.hs.Is(e,n)}).next(function(t){return f=t,r.Ts(e,f,c).next(function(t){c=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],a=s.key,u=c.get(a),h=s.zt(u,u,r.Ln);c=h instanceof Ps?c.dt(a,h):c.remove(a)}})}).next(function(){return c.forEach(function(t,e){n.matches(e)||(c=c.remove(t))}),c})},ph.prototype.Ts=function(t,e,n){for(var r=su(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Vo&&null===n.get(u.key)&&(r=r.add(u.key))}var h=n;return this.os.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Ps&&(h=h.dt(t,e))}),h})},ph),hh=(lh.As=function(t,e){for(var n=su(),r=su(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case hu.Qi:n=n.add(s.doc.key);break;case hu.Gi:r=r.add(s.doc.key)}}return new lh(t,e.fromCache,n,r)},lh),ch=(fh.prototype.Ps=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},fh.prototype.next=function(){var t=++this.previousValue;return this.Ss&&this.Ss(t),t},fh.Vs=-1,fh);function fh(t,e){var n=this;this.previousValue=t,e&&(e.Ds=function(t){return n.Ps(t)},this.Ss=function(t){return e.Cs(t)})}function lh(t,e,n,r){this.targetId=t,this.fromCache=e,this.Es=n,this.Rs=r}function ph(t,e,n){this.os=t,this.hs=e,this.cs=n}function dh(){this.rs=[]}function vh(){this.Ku=new Zu(function(t){return t.toString()}),this.Hu=!1}function yh(t){var e=this;this.ju=null,this.Uu=null,this.result=void 0,this.error=void 0,this.Lu=!1,this.Bu=!1,t(function(t){e.Lu=!0,e.result=t,e.ju&&e.ju(t)},function(t){e.Lu=!0,e.error=t,e.Uu&&e.Uu(t)})}function mh(t,e){this.key=t,this.xu=e}function gh(){this.Eu=new so(rh.qn),this.Ru=new so(rh.Au)}function wh(t,e,n,r,i){this.batch=t,this.Iu=e,this.yu=n,this.streamToken=r,this.Tu=i}function bh(t,e,n,r){this.batchId=t,this.Ln=e,this.baseMutations=n,Gr(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}function Eh(t){this.gu=t,this.bu={}}function Ih(t){Hu(),this.pu=t}(Xu=Qu=Qu||{}).Ns="all",Xu.ks="listen_stream_idle",Xu.Os="listen_stream_connection_backoff",Xu.Fs="write_stream_idle",Xu.xs="write_stream_connection_backoff",Xu.js="online_state_timeout",Xu.Us="client_metadata_refresh",Xu.Ls="lru_garbage_collection",Xu.Bs="retry_transaction";var Th=(Sh.zs=function(t,e,n,r,i){var o=new Sh(t,e,Date.now()+n,r,i);return o.start(n),o},Sh.prototype.start=function(t){var e=this;this.Ks=setTimeout(function(){return e.Hs()},t)},Sh.prototype.Js=function(){return this.Hs()},Sh.prototype.cancel=function(t){null!==this.Ks&&(this.clearTimeout(),this.Ws.reject(new ti(Zr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Sh.prototype.Hs=function(){var e=this;this.Ms.Ys(function(){return null!==e.Ks?(e.clearTimeout(),e.op().then(function(t){return e.Ws.resolve(t)})):Promise.resolve()})},Sh.prototype.clearTimeout=function(){null!==this.Ks&&(this.Gs(this),clearTimeout(this.Ks),this.Ks=null)},Sh),Nh=(Object.defineProperty(Ah.prototype,"eo",{get:function(){return this.$s},enumerable:!0,configurable:!0}),Ah.prototype.Ys=function(t){this.enqueue(t)},Ah.prototype.ro=function(t){this.uo(),this.so(t)},Ah.prototype.oo=function(t){return this.uo(),this.so(t)},Ah.prototype.ho=function(e){return p(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.uo(),this.$s?[3,2]:(this.$s=!0,[4,this.oo(e)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Ah.prototype.enqueue=function(t){return this.uo(),this.$s?new Promise(function(t){}):this.so(t)},Ah.prototype.so=function(t){var n=this,e=this.Xs.then(function(){return n.no=!0,t().catch(function(t){n.to=t,n.no=!1;var e=t.stack||t.message||"";throw qr("INTERNAL UNHANDLED ERROR: ",e),e.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return n.no=!1,t})});return this.Xs=e},Ah.prototype.co=function(t,e,n){var r=this;this.uo(),Gr(0<=e,"Attempted to schedule an operation with a negative delay of "+e),-1<this.io.indexOf(t)&&(e=0);var i=Th.zs(this,t,e,n,function(t){return r.ao(t)});return this.Zs.push(i),i},Ah.prototype.uo=function(){this.to&&Fr("AsyncQueue is already failed: "+(this.to.stack||this.to.message))},Ah.prototype.fo=function(){Gr(this.no,"verifyOpInProgress() called when no op in progress on this queue.")},Ah.prototype.lo=function(){return this.oo(function(){return Promise.resolve()})},Ah.prototype.do=function(t){for(var e=0,n=this.Zs;e<n.length;e++)if(n[e].qs===t)return!0;return!1},Ah.prototype.vo=function(r){var i=this;return this.lo().then(function(){Gr(r===Qu.Ns||i.do(r),"Attempted to drain to missing operation "+r),i.Zs.sort(function(t,e){return t.Qs-e.Qs});for(var t=0,e=i.Zs;t<e.length;t++){var n=e[t];if(n.Js(),r!==Qu.Ns&&n.qs===r)break}return i.lo()})},Ah.prototype.wo=function(t){this.io.push(t)},Ah.prototype.ao=function(t){var e=this.Zs.indexOf(t);Gr(0<=e,"Delayed operation not found."),this.Zs.splice(e,1)},Ah);function Ah(){this.Xs=Promise.resolve(),this.$s=!1,this.Zs=[],this.to=null,this.no=!1,this.io=[]}function Sh(t,e,n,r,i){this.Ms=t,this.qs=e,this.Qs=n,this.op=r,this.Gs=i,this.Ws=new Ku,this.then=this.Ws.promise.then.bind(this.Ws.promise),this.catch=this.Ws.promise.catch.bind(this.Ws.promise),this.Ws.promise.catch(function(t){})}function Dh(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Br(n,i);return 0===s?Br(r,o):s}var Rh=(Vh.prototype.bo=function(){return++this.po},Vh.prototype.yo=function(t){var e=[t,this.bo()];if(this.buffer.size<this.mo)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Dh(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(Vh.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),Vh),kh={_o:!1,Io:0,To:0,Eo:0},_h=(qh.Po=function(t){return new qh(t,qh.So,qh.Co)},qh.Vo=-1,qh.No=1048576,qh.Oo=new qh(qh.ko=41943040,qh.So=10,qh.Co=1e3),qh.DISABLED=new qh(qh.Vo,0,0),qh),xh=(Uh.prototype.start=function(){Gr(null===this.Uo,"Cannot start an already started LruScheduler"),this.Fo.Lo.Ro!==_h.Vo&&this.Bo()},Uh.prototype.stop=function(){this.Uo&&(this.Uo.cancel(),this.Uo=null)},Object.defineProperty(Uh.prototype,"Mo",{get:function(){return null!==this.Uo},enumerable:!0,configurable:!0}),Uh.prototype.Bo=function(){var t=this;Gr(null===this.Uo,"Cannot schedule GC while a task is pending");var e=this.jo?3e5:6e4;Ur("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.Uo=this.Ms.co(Qu.Ls,e,function(){return t.Uo=null,t.jo=!0,t.xo.qo(t.Fo).then(function(){return t.Bo()}).catch(Fh)})},Uh),Ch=(Mh.prototype.Go=function(t,e){return this.Qo.Wo(t).next(function(t){return Math.floor(e/100*t)})},Mh.prototype.zo=function(t,e){var n=this;if(0===e)return ih.resolve(ch.Vs);var r=new Rh(e);return this.Qo.qe(t,function(t){return r.yo(t.sequenceNumber)}).next(function(){return n.Qo.Ko(t,function(t){return r.yo(t)})}).next(function(){return r.maxValue})},Mh.prototype.Ho=function(t,e,n){return this.Qo.Ho(t,e,n)},Mh.prototype.Jo=function(t,e){return this.Qo.Jo(t,e)},Mh.prototype.Yo=function(e,n){var r=this;return this.Lo.Ro===_h.Vo?(Ur("LruGarbageCollector","Garbage collection skipped; disabled"),ih.resolve(kh)):this.Xo(e).next(function(t){return t<r.Lo.Ro?(Ur("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.Lo.Ro),kh):r.$o(e,n)})},Mh.prototype.Xo=function(t){return this.Qo.Xo(t)},Mh.prototype.$o=function(e,n){var r,i,o,s,a,u,h,c=this,f=Date.now();return this.Go(e,this.Lo.Ao).next(function(t){return i=t>c.Lo.Do?(Ur("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.Lo.Do+" from "+t),c.Lo.Do):t,s=Date.now(),c.zo(e,i)}).next(function(t){return r=t,a=Date.now(),c.Ho(e,r,n)}).next(function(t){return o=t,u=Date.now(),c.Jo(e,r)}).next(function(t){return h=Date.now(),Lr()<=Ar.DEBUG&&Ur("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(a-s)+"ms\n\tRemoved "+o+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(h-u)+"ms\nTotal Duration: "+(h-f)+"ms"),ih.resolve({_o:!0,Io:i,To:o,Eo:t})})},Mh),Oh="LocalStore",Ph=(Lh.prototype.start=function(){return this.wh()},Lh.prototype.mh=function(i){return p(this,void 0,void 0,function(){var e,y,n,r=this;return v(this,function(t){switch(t.label){case 0:return e=this.hs,y=this.lh,[4,this.persistence.runTransaction("Handle user change","readonly-idempotent",function(d){var v;return r.hs.ph(d).next(function(t){return v=t,e=r.persistence.sh(i),y=new uh(r.oh,e,r.persistence.dh()),e.ph(d)}).next(function(t){for(var e=[],n=[],r=su(),i=0,o=v;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var a=0,u=s.mutations;a<u.length;a++){var h=u[a];r=r.add(h.key)}}for(var c=0,f=t;c<f.length;c++){s=f[c],n.push(s.batchId);for(var l=0,p=s.mutations;l<p.length;l++)h=p[l],r=r.add(h.key)}return y.vs(d,r).next(function(t){return{gh:t,bh:e,yh:n}})})})];case 1:return n=t.sent(),this.hs=e,this.lh=y,this.Zo.vh(this.lh),[2,n]}})})},Lh.prototype._h=function(a){var u,h=this,c=qi.now(),t=a.reduce(function(t,e){return t.add(e.key)},su());return this.persistence.runTransaction("Locally write mutations","readwrite-idempotent",function(s){return h.lh.vs(s,t).next(function(t){u=t;for(var e=[],n=0,r=a;n<r.length;n++){var i=r[n],o=i.an(u.get(i.key));null!=o&&e.push(new Vo(i.key,o,o.fn(),Mo.exists(!0)))}return h.hs.Ih(s,c,e,a)})}).then(function(t){var e=t._u(u);return{batchId:t.batchId,Ku:e}})},Lh.prototype.Th=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly-idempotent",function(e){return n.hs.Eh(e,t).next(function(t){return t?n.lh.vs(e,t):ih.resolve(null)})})},Lh.prototype.Rh=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary-idempotent",function(t){var e=r.batch.keys(),n=i.oh.Ah({Dh:!0});return i.hs.Rh(t,r.batch,r.streamToken).next(function(){return i.Ph(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.hs.Sh(t)}).next(function(){return i.lh.vs(t,e)})})},Lh.prototype.Ch=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary-idempotent",function(e){var n;return r.hs.Vh(e,t).next(function(t){return Gr(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),r.hs.Nh(e,t)}).next(function(){return r.hs.Sh(e)}).next(function(){return r.lh.vs(e,n)})})},Lh.prototype.kh=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly-idempotent",function(t){return e.hs.kh(t)})},Lh.prototype.Oh=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly-idempotent",function(t){return e.hs.Oh(t)})},Lh.prototype.Fh=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary-idempotent",function(t){return n.hs.Fh(t,e)})},Lh.prototype.xh=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly-idempotent",function(t){return e.ah.xh(t)})},Lh.prototype.jh=function(u){var h=this,c=u.xi,f=this.nh;return this.persistence.runTransaction("Apply remote event","readwrite-primary-idempotent",function(o){var i=h.oh.Ah({Dh:!0});f=h.nh;var s=[];di(u.ie,function(t,e){var n=f.get(t);if(n){s.push(h.ah.Uh(o,e.fe,t).next(function(){return h.ah.Lh(o,e.ce,t)}));var r=e.resumeToken;if(0<r.Bn()){var i=n.Ui(r,c).ji(o.Bh);f=f.dt(t,i),Lh.Mh(n,i,e)&&s.push(h.ah.qh(o,i))}}});var a=Za(),n=su();if(u.re.forEach(function(t,e){n=n.add(t)}),s.push(i.getEntries(o,n).next(function(r){u.re.forEach(function(t,e){var n=r.get(t);e instanceof Ls&&e.version.isEqual(Vi.MIN)?(i.$u(t,c),a=a.dt(t,e)):null==n||0<e.version.h(n.version)||0===e.version.h(n.version)&&n.hasPendingWrites?(Gr(!Vi.MIN.isEqual(c),"Cannot add a document when the remote version is zero"),i.Yu(e,c),a=a.dt(t,e)):Ur(Oh,"Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),u.ue.has(t)&&s.push(h.persistence.uh.Qh(o,t))})})),!c.isEqual(Vi.MIN)){var t=h.ah.xh(o).next(function(t){return Gr(0<=c.h(t),"Watch stream reverted to previous snapshot?? "+c+" < "+t),h.ah.Gh(o,o.Bh,c)});s.push(t)}return ih.Wu(s).next(function(){return i.apply(o)}).next(function(){return h.lh.ws(o,a)})}).then(function(t){return h.nh=f,t})},Lh.Mh=function(t,e,n){return Gr(0<e.resumeToken.Bn(),"Attempted to persist target data with no resume token"),0===t.resumeToken.Bn()||e.xi.M()-t.xi.M()>=this.Wh||0<n.ce.size+n.ae.size+n.fe.size},Lh.prototype.zh=function(t){for(var n=this,e=0,r=t;e<r.length;e++){var i=r[e],o=i.targetId;if(this.th.Pu(i.Es,o),this.th.Vu(i.Rs,o),!i.fromCache){var s=this.nh.get(o);Gr(null!==s,"Can't set limbo-free snapshot version for unknown target: "+o);var a=s.xi,u=s.Li(a);this.nh=this.nh.dt(o,u)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite-idempotent",function(e){return ih.forEach(t,function(t){return ih.forEach(t.Rs,function(t){return n.persistence.uh.Su(e,t)})})})},Lh.prototype.Kh=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly-idempotent",function(t){return void 0===e&&(e=-1),n.hs.Hh(t,e)})},Lh.prototype.Jh=function(e){var n=this;return this.persistence.runTransaction("read document","readonly-idempotent",function(t){return n.lh.as(t,e)})},Lh.prototype.Yh=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite-idempotent",function(e){var n;return i.ah.Xh(e,r).next(function(t){return t?(n=t,ih.resolve(n)):i.ah.$h(e).next(function(t){return n=new za(r,t,fa.Ni,e.Bh),i.ah.Zh(e,n).next(function(){return n})})})}).then(function(t){return null===i.nh.get(t.targetId)&&(i.nh=i.nh.dt(t.targetId,t),i.ih.set(r,t.targetId)),t})},Lh.prototype.Xh=function(t,e){var n=this.ih.get(e);return void 0!==n?ih.resolve(this.nh.get(n)):this.ah.Xh(t,e)},Lh.prototype.tc=function(n,r){var i=this,o=this.nh.get(n);Gr(null!==o,"Tried to release nonexistent target: "+n);var t=r?"readwrite-idempotent":"readwrite-primary-idempotent";return this.persistence.runTransaction("Release target",t,function(e){var t=i.th.Nu(n);return r?ih.resolve():ih.forEach(t,function(t){return i.persistence.uh.Su(e,t)}).next(function(){i.persistence.uh.removeTarget(e,o)})}).then(function(){i.nh=i.nh.remove(n),i.ih.delete(o.target)})},Lh.prototype.nc=function(t,n){var r=this,i=Vi.MIN,o=su();return this.persistence.runTransaction("Execute query","readonly-idempotent",function(e){return r.Xh(e,t.vi()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.ah.ic(e,t.targetId).next(function(t){o=t})}).next(function(){return r.Zo.ps(e,t,n?i:Vi.MIN,n?o:su())}).next(function(t){return{documents:t,ec:o}})})},Lh.prototype.rc=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly-idempotent",function(t){return n.ah.ic(t,e)})},Lh.prototype.uc=function(){return this.persistence.uc()},Lh.prototype.sc=function(t){this.hs.oc(t)},Lh.prototype.hc=function(t){this.persistence.hc(t)},Lh.prototype.Ph=function(t,i,o){var e=this,s=i.batch,n=s.keys(),a=ih.resolve();return n.forEach(function(r){a=a.next(function(){return o.Zu(t,r)}).next(function(t){var e=t,n=i.Tu.get(r);Gr(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.h(n)<0)&&((e=s.Kt(r,e,i))?o.Yu(e,i.Iu):Gr(!t,"Mutation batch "+s+" applied to document "+t+" resulted in null"))})}),a.next(function(){return e.hs.Nh(t,s)})},Lh.prototype.qo=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary-idempotent",function(t){return e.Yo(t,n.nh)})},Lh.prototype.cc=function(e){var n=this,t=this.nh.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly-idempotent",function(t){return n.ah.Ze(t,e).next(function(t){return t?t.target:null})})},Lh.prototype.ac=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly-idempotent",function(t){return r.oh.ac(t,r.eh)}).then(function(t){var e=t.fc,n=t.readTime;return r.eh=n,e})},Lh.prototype.wh=function(){return p(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,(e=this).persistence.runTransaction("Synchronize last document change read time","readonly-idempotent",function(t){return n.oh.lc(t)})];case 1:return e.eh=t.sent(),[2]}})})},Lh.Wh=3e8,Lh);function Lh(t,e,n){this.persistence=t,this.Zo=e,this.th=new nh,this.nh=new Wi(Br),this.ih=new Zu(function(t){return t.canonicalId()}),this.eh=Vi.MIN,Gr(t.Mo,"LocalStore was passed an unstarted persistence implementation"),this.persistence.uh.rh(this.th),this.hs=t.sh(n),this.oh=t.hh(),this.ah=t.fh(),this.lh=new uh(this.oh,this.hs,this.persistence.dh()),this.Zo.vh(this.lh)}function Mh(t,e){this.Qo=t,this.Lo=e}function Uh(t,e,n){this.Fo=t,this.Ms=e,this.xo=n,this.jo=!1,this.Uo=null}function qh(t,e,n){this.Ro=t,this.Ao=e,this.Do=n}function Vh(t){this.mo=t,this.buffer=new so(Dh),this.po=0}function Fh(e){return p(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==Zr.FAILED_PRECONDITION||e.message!==sh)throw e;return Ur(Oh,"Unexpectedly lost primary lease"),[2]})})}var Gh=(Yh.documentId=function(){return Yh.vc},Yh.prototype.isEqual=function(t){if(!(t instanceof Yh))throw xi("isEqual","FieldPath",1,t);return this.dc.isEqual(t.dc)},Yh.vc=new Yh(Yi.ot().it()),Yh),jh=new RegExp("[~\\*/\\[\\]]");function Yh(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(){if(!(t instanceof Array)||t.length<1)throw new ti(Zr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+Pi(1,"element")+".")}();for(var n=0;n<t.length;++n)if(Ei("FieldPath","string",n,t[n]),0===t[n].length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.dc=new Yi(t)}var Bh,Wh,zh,Hh,Kh,Qh,Xh,Jh=(dc.delete=function(){return mi("FieldValue.delete",arguments),$h.instance},dc.serverTimestamp=function(){return mi("FieldValue.serverTimestamp",arguments),Zh.instance},dc.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return wi("FieldValue.arrayUnion",arguments,1),new tc(t)},dc.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return wi("FieldValue.arrayRemove",arguments,1),new ec(t)},dc.increment=function(t){return Ei("FieldValue.increment","number",1,t),gi("FieldValue.increment",arguments,1),new nc(t)},dc.prototype.isEqual=function(t){return this===t},dc),$h=(t(pc,Xh=Jh),pc.instance=new pc,pc),Zh=(t(lc,Qh=Jh),lc.instance=new lc,lc),tc=(t(fc,Kh=Jh),fc),ec=(t(cc,Hh=Jh),cc),nc=(t(hc,zh=Jh),hc),rc=Wu(Jh,"Use FieldValue.<field>() instead."),ic=/^__.*__$/,oc=(uc.prototype.gc=function(t,e){var n=[];return null!==this.fn?n.push(new Vo(t,this.data,this.fn,e)):n.push(new qo(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Fo(t,this.fieldTransforms)),n},uc),sc=(ac.prototype.gc=function(t,e){var n=[new Vo(t,this.data,this.fn,e)];return 0<this.fieldTransforms.length&&n.push(new Fo(t,this.fieldTransforms)),n},ac);function ac(t,e,n){this.data=t,this.fn=e,this.fieldTransforms=n}function uc(t,e,n){this.data=t,this.fn=e,this.fieldTransforms=n}function hc(t){var e=zh.call(this,"FieldValue.increment")||this;return e.pc=t,e}function cc(t){var e=Hh.call(this,"FieldValue.arrayRemove")||this;return e.mc=t,e}function fc(t){var e=Kh.call(this,"FieldValue.arrayUnion")||this;return e.mc=t,e}function lc(){return Qh.call(this,"FieldValue.serverTimestamp")||this}function pc(){return Xh.call(this,"FieldValue.delete")||this}function dc(t){this.wc=t}function vc(t){switch(t){case Bh.Set:case Bh.bc:case Bh.yc:return!0;case Bh._c:case Bh.Ic:return!1;default:throw Fr("Unexpected case for UserDataSource: "+t)}}(Wh=Bh=Bh||{})[Wh.Set=0]="Set",Wh[Wh.yc=1]="__PRIVATE_Update",Wh[Wh.bc=2]="__PRIVATE_MergeSet",Wh[Wh._c=3]="__PRIVATE_Argument",Wh[Wh.Ic=4]="__PRIVATE_ArrayArgument";var yc=(bc.prototype.Ac=function(t){var e=null==this.path?null:this.path.child(t),n=new bc(this.Tc,this.methodName,e,!1,this.fieldTransforms,this.fn);return n.Dc(t),n},bc.prototype.Pc=function(t){var e=null==this.path?null:this.path.child(t),n=new bc(this.Tc,this.methodName,e,!1,this.fieldTransforms,this.fn);return n.Rc(),n},bc.prototype.Sc=function(t){return new bc(this.Tc,this.methodName,null,!0,this.fieldTransforms,this.fn)},bc.prototype.Cc=function(t){var e=null===this.path||this.path.Y()?"":" (found in field "+this.path.toString()+")";return new ti(Zr.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},bc.prototype.contains=function(e){return void 0!==this.fn.find(function(t){return e.Z(t)})||void 0!==this.fieldTransforms.find(function(t){return e.Z(t.field)})},bc.prototype.Rc=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.Dc(this.path.get(t))},bc.prototype.Dc=function(t){if(0===t.length)throw this.Cc("Document fields must not be empty");if(vc(this.Tc)&&ic.test(t))throw this.Cc('Document fields cannot begin and end with "__"')},bc),mc=function(t,e){this.s=t,this.key=e},gc=(wc.prototype.Nc=function(t,e){var n=new yc(Bh.Set,t,Yi.rt);Ic("Data must be an object, but it was:",n,e);var r=this.kc(e,n);return new oc(r,null,n.fieldTransforms)},wc.prototype.Oc=function(t,e,n){var r=new yc(Bh.bc,t,Yi.rt);Ic("Data must be an object, but it was:",r,e);var i,o,s=this.kc(e,r);if(n){for(var a=new so(Yi.W),u=0,h=n;u<h.length;u++){var c=h[u],f=void 0;if(c instanceof Gh)f=c.dc;else{if("string"!=typeof c)throw Fr("Expected stringOrFieldPath to be a string or a FieldPath");f=Nc(t,c)}if(!r.contains(f))throw new ti(Zr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");a=a.add(f)}i=To.Xt(a),o=r.fieldTransforms.filter(function(t){return i.Zt(t.field)})}else i=To.$t(r.fn),o=r.fieldTransforms;return new oc(s,i,o)},wc.prototype.Fc=function(o,t){var s=this,a=new yc(Bh.yc,o,Yi.rt);Ic("Data must be an object, but it was:",a,t);var u=new so(Yi.W),h=xs.EMPTY;vi(t,function(t,e){var n=Nc(o,t),r=a.Pc(n);if((e=s.xc(e,r))instanceof $h)u=u.add(n);else{var i=s.kc(e,r);null!=i&&(u=u.add(n),h=h.set(n,i))}});var e=To.Xt(u);return new sc(h,e,a.fieldTransforms)},wc.prototype.jc=function(t,e,n,r){var i=new yc(Bh.yc,t,Yi.rt),o=[Tc(t,e)],s=[n];if(r.length%2!=0)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var a=0;a<r.length;a+=2)o.push(Tc(t,r[a])),s.push(r[a+1]);var u=new so(Yi.W),h=xs.EMPTY;for(a=0;a<o.length;++a){var c=o[a],f=i.Pc(c),l=this.xc(s[a],f);if(l instanceof $h)u=u.add(c);else{var p=this.kc(l,f);null!=p&&(u=u.add(c),h=h.set(c,p))}}var d=To.Xt(u);return new sc(h,d,i.fieldTransforms)},wc.prototype.Uc=function(t,e,n){void 0===n&&(n=!1);var r=new yc(n?Bh.Ic:Bh._c,t,Yi.rt),i=this.kc(e,r);return Gr(null!=i,"Parsed data should not be null."),Gr(0===r.fieldTransforms.length,"Field transforms should have been disallowed."),i},wc.prototype.xc=function(t,e){try{return this.Vc(t)}catch(t){var n=Ac(t);throw e.Cc(n)}},wc.prototype.kc=function(t,e){if(Ec(t=this.xc(t,e)))return Ic("Unsupported field value:",e,t),this.Lc(t,e);if(t instanceof Jh)return this.Bc(t,e),null;if(e.path&&e.fn.push(e.path),t instanceof Array){if(e.Ec&&e.Tc!==Bh.Ic)throw e.Cc("Nested arrays are not supported");return this.Mc(t,e)}return this.qc(t,e)},wc.prototype.Lc=function(t,r){var i=this,o=new Wi(Br);return yi(t)?r.path&&0<r.path.length&&r.fn.push(r.path):vi(t,function(t,e){var n=i.kc(e,r.Ac(t));null!=n&&(o=o.dt(t,n))}),new xs(o)},wc.prototype.Mc=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=o[i],a=this.kc(s,e.Sc(r));null==a&&(a=es.Fn),n.push(a),r++}return new Cs(n)},wc.prototype.Bc=function(t,e){if(!vc(e.Tc))throw e.Cc(t.wc+"() can only be used with update() and set()");if(null===e.path)throw e.Cc(t.wc+"() is not currently supported inside arrays");if(t instanceof $h){if(e.Tc!==Bh.bc)throw e.Tc===Bh.yc?(Gr(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.Cc("FieldValue.delete() can only appear at the top level of your update data")):e.Cc("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fn.push(e.path)}else if(t instanceof Zh)e.fieldTransforms.push(new No(e.path,uo.instance));else if(t instanceof tc){var n=this.Qc(t.wc,t.mc),r=new ho(n);e.fieldTransforms.push(new No(e.path,r))}else if(t instanceof ec){n=this.Qc(t.wc,t.mc);var i=new co(n);e.fieldTransforms.push(new No(e.path,i))}else if(t instanceof nc){var o=this.Uc("FieldValue.increment",t.pc),s=new fo(o);e.fieldTransforms.push(new No(e.path,s))}else Fr("Unknown FieldValue type: "+t)},wc.prototype.qc=function(t,e){if(null===t)return es.Fn;if("number"==typeof t)return na(t)?new Ts(t):new Ns(t);if("boolean"==typeof t)return ns.of(t);if("string"==typeof t)return new As(t);if(t instanceof Date)return new Ss(qi.fromDate(t));if(t instanceof qi)return new Ss(new qi(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof Ui)return new _s(t);if(t instanceof Ju)return new Rs(t);if(t instanceof mc)return new ks(t.s,t.key);throw e.Cc("Unsupported field value: "+Ri(t))},wc.prototype.Qc=function(r,t){var i=this;return t.map(function(t,e){var n=new yc(Bh._c,r,Yi.rt);return i.kc(t,n.Sc(e))})},wc);function wc(t){this.Vc=t}function bc(t,e,n,r,i,o){this.Tc=t,this.methodName=e,this.path=n,this.Ec=r,void 0===i&&this.Rc(),this.Ec=void 0!==r&&r,this.fieldTransforms=i||[],this.fn=o||[]}function Ec(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof qi||t instanceof Ui||t instanceof Ju||t instanceof mc||t instanceof Jh)}function Ic(t,e,n){if(!Ec(n)||!Di(n)){var r=Ri(n);throw"an object"===r?e.Cc(t+" a custom object"):e.Cc(t+" "+r)}}function Tc(t,e){if(e instanceof Gh)return e.dc;if("string"==typeof e)return Nc(t,e);throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Nc(e,t){try{return function(e){if(0<=e.search(jh))throw new ti(Zr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Gh.bind.apply(Gh,s([void 0],e.split("."))))}catch(t){throw new ti(Zr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(t).dc}catch(t){var n=Ac(t);throw new ti(Zr.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function Ac(t){return t instanceof Error?t.message:t.toString()}var Sc,Dc,Rc=(kc.prototype.reset=function(){this.Hc=0},kc.prototype.Xc=function(){this.Hc=this.Kc},kc.prototype.$c=function(t){var e=this;this.cancel();var n=Math.floor(this.Hc+this.Zc()),r=Math.max(0,Date.now()-this.Yc),i=Math.max(0,n-r);0<this.Hc&&Ur("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Hc+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Jc=this.Gc.co(this.qs,i,function(){return e.Yc=Date.now(),t()}),this.Hc*=this.zc,this.Hc<this.Wc&&(this.Hc=this.Wc),this.Hc>this.Kc&&(this.Hc=this.Kc)},kc.prototype.cancel=function(){null!==this.Jc&&(this.Jc.cancel(),this.Jc=null)},kc.prototype.Zc=function(){return(Math.random()-.5)*this.Hc},kc);function kc(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Gc=t,this.qs=e,this.Wc=n,this.zc=r,this.Kc=i,this.Hc=0,this.Jc=null,this.Yc=Date.now(),this.reset()}(Dc=Sc=Sc||{})[Dc.ta=0]="__PRIVATE_Initial",Dc[Dc.na=1]="__PRIVATE_Starting",Dc[Dc.ia=2]="__PRIVATE_Open",Dc[Dc.Error=3]="Error",Dc[Dc.ea=4]="__PRIVATE_Backoff";var _c,xc,Cc=(Hc.prototype.aa=function(){return this.state===Sc.na||this.state===Sc.ia||this.state===Sc.ea},Hc.prototype.fa=function(){return this.state===Sc.ia},Hc.prototype.start=function(){this.state!==Sc.Error?(Gr(this.state===Sc.ta,"Already started"),this.auth()):this.la()},Hc.prototype.stop=function(){return p(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.aa()?[4,this.close(Sc.ta)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Hc.prototype.da=function(){Gr(!this.aa(),"Can only inhibit backoff in a stopped state"),this.state=Sc.ta,this.ca.reset()},Hc.prototype.va=function(){var t=this;this.fa()&&null===this.ha&&(this.ha=this.Gc.co(this.ra,6e4,function(){return t.wa()}))},Hc.prototype.ma=function(t){this.pa(),this.stream.send(t)},Hc.prototype.wa=function(){return p(this,void 0,void 0,function(){return v(this,function(t){return this.fa()?[2,this.close(Sc.ta)]:[2]})})},Hc.prototype.pa=function(){this.ha&&(this.ha.cancel(),this.ha=null)},Hc.prototype.close=function(e,n){return p(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Gr(this.aa(),"Only started streams should be closed."),Gr(e===Sc.Error||ea(n),"Can't provide an error when not in an error state."),this.pa(),this.ca.cancel(),this.oa++,e!==Sc.Error?this.ca.reset():n&&n.code===Zr.RESOURCE_EXHAUSTED?(qr(n.toString()),qr("Using maximum backoff delay to prevent overloading the backend."),this.ca.Xc()):n&&n.code===Zr.UNAUTHENTICATED&&this.sa.I(),null!==this.stream&&(this.ga(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.ba(n)];case 1:return t.sent(),[2]}})})},Hc.prototype.ga=function(){},Hc.prototype.auth=function(){var n=this;Gr(this.state===Sc.ta,"Must be in initial state to auth"),this.state=Sc.na;var t=this.ya(this.oa),e=this.oa;this.sa.getToken().then(function(t){n.oa===e&&n._a(t)},function(e){t(function(){var t=new ti(Zr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.Ia(t)})})},Hc.prototype._a=function(t){var e=this;Gr(this.state===Sc.na,"Trying to start stream in a non-starting state");var n=this.ya(this.oa);this.stream=this.Ta(t),this.stream.Ea(function(){n(function(){return Gr(e.state===Sc.na,"Expected stream to be in state Starting, but was "+e.state),e.state=Sc.ia,e.listener.Ea()})}),this.stream.ba(function(t){n(function(){return e.Ia(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Hc.prototype.la=function(){var t=this;Gr(this.state===Sc.Error,"Should only perform backoff when in Error state"),this.state=Sc.ea,this.ca.$c(function(){return p(t,void 0,void 0,function(){return v(this,function(t){return Gr(this.state===Sc.ea,"Backoff elapsed but state is now: "+this.state),this.state=Sc.ta,this.start(),Gr(this.aa(),"PersistentStream should have started"),[2]})})})},Hc.prototype.Ia=function(t){return Gr(this.aa(),"Can't handle server close on non-started stream"),Ur("PersistentStream","close with error: "+t),this.stream=null,this.close(Sc.Error,t)},Hc.prototype.ya=function(e){var n=this;return function(t){n.Gc.Ys(function(){return n.oa===e?t():(Ur("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Hc),Oc=(t(zc,xc=Cc),zc.prototype.Ta=function(t){return this.ua.Ra("Listen",t)},zc.prototype.onMessage=function(t){this.ca.reset();var e=this.serializer.kr(t),n=this.serializer.Fr(t);return this.listener.Aa(e,n)},zc.prototype.Da=function(t){var e={};e.database=this.serializer.gr,e.addTarget=this.serializer.vi(t);var n=this.serializer.iu(t);n&&(e.labels=n),this.ma(e)},zc.prototype.Pa=function(t){var e={};e.database=this.serializer.gr,e.removeTarget=t,this.ma(e)},zc),Pc=(t(Wc,_c=Cc),Object.defineProperty(Wc.prototype,"Ca",{get:function(){return this.Sa},enumerable:!0,configurable:!0}),Wc.prototype.start=function(){this.Sa=!1,_c.prototype.start.call(this)},Wc.prototype.ga=function(){this.Sa&&this.Va([])},Wc.prototype.Ta=function(t){return this.ua.Ra("Write",t)},Wc.prototype.onMessage=function(t){if(Gr(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=this.serializer.sr(t.streamToken),this.Sa){this.ca.reset();var e=this.serializer.Wr(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.Na(n,e)}return Gr(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.Sa=!0,this.listener.ka()},Wc.prototype.Oa=function(){Gr(this.fa(),"Writing handshake requires an opened stream"),Gr(!this.Sa,"Handshake already completed");var t={};t.database=this.serializer.gr,this.ma(t)},Wc.prototype.Va=function(t){var e=this;Gr(this.fa(),"Writing mutations requires an opened stream"),Gr(this.Sa,"Handshake must be complete before writing mutations"),Gr(0<this.lastStreamToken.Bn(),"Trying to write mutation without a token");var n={streamToken:this.serializer.ur(this.lastStreamToken),writes:t.map(function(t){return e.serializer.xr(t)})};this.ma(n)},Wc),Lc=(Bc.prototype.Fa=function(t){return new Pc(this.Gc,this.ua,this.credentials,this.serializer,t)},Bc.prototype.xa=function(t){return new Oc(this.Gc,this.ua,this.credentials,this.serializer,t)},Bc.prototype.commit=function(t){var e=this,n={database:this.serializer.gr,writes:t.map(function(t){return e.serializer.xr(t)})};return this.ja("Commit",n).then(function(t){return e.serializer.Wr(t.writeResults,t.commitTime)})},Bc.prototype.Ua=function(e){var i=this,t={database:this.serializer.gr,documents:e.map(function(t){return i.serializer.dr(t)})};return this.La("BatchGetDocuments",t).then(function(t){var n=Za();t.forEach(function(t){var e=i.serializer.Cr(t);n=n.dt(e.key,e)});var r=[];return e.forEach(function(t){var e=n.get(t);Gr(!!e,"Missing entity in write response for "+t),r.push(e)}),r})},Bc.prototype.ja=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.ua.ja(e,n,t)}).catch(function(t){throw t.code===Zr.UNAUTHENTICATED&&r.credentials.I(),t})},Bc.prototype.La=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.ua.La(e,n,t)}).catch(function(t){throw t.code===Zr.UNAUTHENTICATED&&r.credentials.I(),t})},Bc),Mc=(Yc.prototype.Ua=function(r){return p(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.Wa(),0<this.mutations.length)throw new ti(Zr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.Ba.Ua(r)];case 1:return(e=t.sent()).forEach(function(t){t instanceof Ls||t instanceof Ps?n.za(t):Fr("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},Yc.prototype.set=function(t,e){this.write(e.gc(t,this.hn(t))),this.Ga.add(t)},Yc.prototype.update=function(t,e){try{this.write(e.gc(t,this.Ka(t)))}catch(t){this.Qa=t}this.Ga.add(t)},Yc.prototype.delete=function(t){this.write([new Go(t,this.hn(t))]),this.Ga.add(t)},Yc.prototype.commit=function(){return p(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.Wa(),this.Qa)throw this.Qa;return e=this.Ma,this.mutations.forEach(function(t){e=e.remove(t.key)}),e.forEach(function(t,e){n.mutations.push(new jo(t,n.hn(t)))}),[4,this.Ba.commit(this.mutations)];case 1:return t.sent(),this.qa=!0,[2]}})})},Yc.prototype.za=function(t){var e;if(t instanceof Ps)e=t.version;else{if(!(t instanceof Ls))throw Fr("Document in a transaction was a "+t.constructor.name);e=Vi.B()}var n=this.Ma.get(t.key);if(null!==n){if(!e.isEqual(n))throw new ti(Zr.ABORTED,"Document version changed between two reads.")}else this.Ma=this.Ma.dt(t.key,e)},Yc.prototype.hn=function(t){var e=this.Ma.get(t);return!this.Ga.has(t)&&e?Mo.updateTime(e):Mo.NONE},Yc.prototype.Ka=function(t){var e=this.Ma.get(t);if(this.Ga.has(t)||!e)return Mo.exists(!0);if(e.isEqual(Vi.B()))throw new ti(Zr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Mo.updateTime(e)},Yc.prototype.write=function(t){this.Wa(),this.mutations=this.mutations.concat(t)},Yc.prototype.Wa=function(){Gr(!this.qa,"A transaction object cannot be used after its update callback has been invoked.")},Yc),Uc=(jc.prototype.$a=function(){var t=this;0===this.Ja&&(this.Za(aa.Di),Gr(null===this.Ya,"onlineStateTimer shouldn't be started yet"),this.Ya=this.Ms.co(Qu.js,1e4,function(){return t.Ya=null,Gr(t.state===aa.Di,"Timer should be canceled if we transitioned to a different state."),t.tf("Backend didn't respond within 10 seconds."),t.Za(aa.Si),Promise.resolve()}))},jc.prototype.nf=function(t){this.state===aa.Pi?(this.Za(aa.Di),Gr(0===this.Ja,"watchStreamFailures must be 0"),Gr(null===this.Ya,"onlineStateTimer must be null")):(this.Ja++,1<=this.Ja&&(this.if(),this.tf("Connection failed 1 times. Most recent error: "+t.toString()),this.Za(aa.Si)))},jc.prototype.set=function(t){this.if(),this.Ja=0,t===aa.Pi&&(this.Xa=!1),this.Za(t)},jc.prototype.Za=function(t){t!==this.state&&(this.state=t,this.Ha(t))},jc.prototype.tf=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Xa?(qr(e),this.Xa=!1):Ur("OnlineStateTracker",e)},jc.prototype.if=function(){null!==this.Ya&&(this.Ya.cancel(),this.Ya=null)},jc),qc="RemoteStore",Vc=(Gc.prototype.start=function(){return this.enableNetwork()},Gc.prototype.enableNetwork=function(){return p(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.cf()?(e=this.mf,[4,this.xo.Oh()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.yf()?this._f():this.ff.set(aa.Di),[4,this.If()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Gc.prototype.disableNetwork=function(){return p(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.Tf()];case 1:return t.sent(),this.ff.set(aa.Si),[2]}})})},Gc.prototype.Tf=function(){return p(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.mf.stop()];case 1:return t.sent(),[4,this.lf.stop()];case 2:return t.sent(),0<this.ef.length&&(Ur(qc,"Stopping write stream with "+this.ef.length+" pending writes"),this.ef=[]),this.Ef(),[2]}})})},Gc.prototype.Rf=function(){return p(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Ur(qc,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.Tf()];case 1:return t.sent(),this.sf.Rf(),this.ff.set(aa.Di),[2]}})})},Gc.prototype.listen=function(t){li(this.rf,t.targetId)||(this.rf[t.targetId]=t,this.yf()?this._f():this.lf.fa()&&this.Af(t))},Gc.prototype.Df=function(t){Gr(li(this.rf,t),"unlisten called on target no currently watched: "+t),delete this.rf[t],this.lf.fa()&&this.Pf(t),yi(this.rf)&&(this.lf.fa()?this.lf.va():this.cf()&&this.ff.set(aa.Di))},Gc.prototype.Ze=function(t){return this.rf[t]||null},Gc.prototype.$e=function(t){return this.Sf.$e(t)},Gc.prototype.Af=function(t){this.uf.Ce(t.targetId),this.lf.Da(t)},Gc.prototype.Pf=function(t){this.uf.Ce(t),this.lf.Pa(t)},Gc.prototype._f=function(){Gr(this.yf(),"startWatchStream() called when shouldStartWatchStream() is false."),this.uf=new ku(this),this.lf.start(),this.ff.$a()},Gc.prototype.yf=function(){return this.cf()&&!this.lf.aa()&&!yi(this.rf)},Gc.prototype.cf=function(){return this.isPrimary&&this.networkEnabled},Gc.prototype.Ef=function(){this.uf=null},Gc.prototype.df=function(){return p(this,void 0,void 0,function(){var n=this;return v(this,function(t){return di(this.rf,function(t,e){n.Af(e)}),[2]})})},Gc.prototype.vf=function(e){return p(this,void 0,void 0,function(){return v(this,function(t){return void 0===e&&Gr(!this.yf(),"Watch stream was stopped gracefully while still needed."),this.Ef(),this.yf()?(this.ff.nf(e),this._f()):this.ff.set(aa.Di),[2]})})},Gc.prototype.wf=function(n,r){return p(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.ff.set(aa.Pi),n instanceof Du&&n.state===mu.Gi&&n.cause?[2,this.Cf(n)]:(n instanceof vu?this.uf.Ue(n):n instanceof yu?this.uf.ze(n):(Gr(n instanceof Du,"Expected watchChange to be an instance of WatchTargetChange"),this.uf.Me(n)),r.isEqual(Vi.MIN)?[3,3]:[4,this.xo.xh()]);case 1:return e=t.sent(),0<=r.h(e)?[4,this.Vf(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Gc.prototype.Vf=function(r){var i=this;Gr(!r.isEqual(Vi.MIN),"Can't raise event for unknown SnapshotVersion");var t=this.uf.Je(r);return di(t.ie,function(t,e){if(0<e.resumeToken.Bn()){var n=i.rf[t];n&&(i.rf[t]=n.Ui(e.resumeToken,r))}}),t.ee.forEach(function(t){var e=i.rf[t];if(e){i.rf[t]=e.Ui(Ya(),e.xi),i.Pf(t);var n=new za(e.target,t,fa.ki,e.sequenceNumber);i.Af(n)}}),this.Sf.jh(t)},Gc.prototype.Cf=function(t){var n=this;Gr(!!t.cause,"Handling target error without a cause");var r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return p(n,void 0,void 0,function(){return v(this,function(t){return li(this.rf,e)?(delete this.rf[e],this.uf.removeTarget(e),[2,this.Sf.Nf(e,r)]):[2]})})})}),i},Gc.prototype.If=function(){return p(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.kf()?(e=0<this.ef.length?this.ef[this.ef.length-1].batchId:-1,[4,this.xo.Kh(e)]):[3,4];case 1:return null!==(n=t.sent())?[3,2]:(0===this.ef.length&&this.mf.va(),[3,4]);case 2:return this.Of(n),[4,this.If()];case 3:t.sent(),t.label=4;case 4:return this.Ff()&&this.xf(),[2]}})})},Gc.prototype.kf=function(){return this.cf()&&this.ef.length<10},Gc.prototype.jf=function(){return this.ef.length},Gc.prototype.Of=function(t){Gr(this.kf(),"addToWritePipeline called when pipeline is full"),this.ef.push(t),this.mf.fa()&&this.mf.Ca&&this.mf.Va(t.mutations)},Gc.prototype.Ff=function(){return this.cf()&&!this.mf.aa()&&0<this.ef.length},Gc.prototype.xf=function(){Gr(this.Ff(),"startWriteStream() called when shouldStartWriteStream() is false."),this.mf.start()},Gc.prototype.pf=function(){return p(this,void 0,void 0,function(){return v(this,function(t){return this.mf.Oa(),[2]})})},Gc.prototype.bf=function(){var r=this;return this.xo.Fh(this.mf.lastStreamToken).then(function(){for(var t=0,e=r.ef;t<e.length;t++){var n=e[t];r.mf.Va(n.mutations)}}).catch(Fh)},Gc.prototype.Na=function(t,e){var n=this;Gr(0<this.ef.length,"Got result for empty write pipeline");var r=this.ef.shift(),i=eh.from(r,t,e,this.mf.lastStreamToken);return this.Sf.Uf(i).then(function(){return n.If()})},Gc.prototype.gf=function(n){return p(this,void 0,void 0,function(){var e=this;return v(this,function(t){return void 0===n&&Gr(!this.Ff(),"Write stream was stopped gracefully while still needed."),n&&0<this.ef.length?[2,(this.mf.Ca?this.Lf(n):this.Bf(n)).then(function(){e.Ff()&&e.xf()})]:[2]})})},Gc.prototype.Bf=function(e){return p(this,void 0,void 0,function(){return v(this,function(t){return Xa(e.code)?(Ur(qc,"RemoteStore error before completed handshake; resetting stream token: ",this.mf.lastStreamToken),this.mf.lastStreamToken=Ya(),[2,this.xo.Fh(Ya()).catch(Fh)]):[2]})})},Gc.prototype.Lf=function(i){return p(this,void 0,void 0,function(){var n,r=this;return v(this,function(t){return Xa(e=i.code)&&e!==Zr.ABORTED?(n=this.ef.shift(),this.mf.da(),[2,this.Sf.Mf(n.batchId,i).then(function(){return r.If()})]):[2];var e})})},Gc.prototype.qf=function(){return new Mc(this.Ba)},Gc.prototype.af=function(){return p(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.Tf()];case 1:return t.sent(),this.ff.set(aa.Di),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},Gc.prototype.Qf=function(){return p(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.cf()?(Ur(qc,"RemoteStore restarting streams for new credential"),[4,this.af()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Gc.prototype.Gf=function(e){return p(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,4];case 2:return e?[3,4]:[4,this.Tf()];case 3:t.sent(),this.ff.set(aa.Di),t.label=4;case 4:return[2]}})})},Gc),Fc="firestore_clients";function Gc(t,e,n,r,i){var o=this;this.xo=t,this.Ba=e,this.ef=[],this.rf={},this.uf=null,this.networkEnabled=!1,this.isPrimary=!1,this.sf=i,this.sf.hf(function(t){n.Ys(function(){return p(o,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.cf()?(Ur(qc,"Restarting streams for network reachability change."),[4,this.af()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.ff=new Uc(n,r),this.lf=this.Ba.xa({Ea:this.df.bind(this),ba:this.vf.bind(this),Aa:this.wf.bind(this)}),this.mf=this.Ba.Fa({Ea:this.pf.bind(this),ba:this.gf.bind(this),ka:this.bf.bind(this),Na:this.Na.bind(this)})}function jc(t,e){this.Ms=t,this.Ha=e,this.state=aa.Di,this.Ja=0,this.Ya=null,this.Xa=!0}function Yc(t){this.Ba=t,this.Ma=iu(),this.mutations=[],this.qa=!1,this.Qa=null,this.Ga=new Set}function Bc(t,e,n,r){this.Gc=t,this.ua=e,this.credentials=n,this.serializer=r}function Wc(t,e,n,r,i){var o=_c.call(this,t,Qu.xs,Qu.Fs,e,n,i)||this;return o.serializer=r,o.Sa=!1,o.lastStreamToken=Ya(),o}function zc(t,e,n,r,i){var o=xc.call(this,t,Qu.Os,Qu.ks,e,n,i)||this;return o.serializer=r,o}function Hc(t,e,n,r,i,o){this.Gc=t,this.ra=n,this.ua=r,this.sa=i,this.listener=o,this.state=Sc.ta,this.oa=0,this.ha=null,this.stream=null,this.ca=new Rc(t,e)}function Kc(t,e){return Gr(-1===e.indexOf("_"),"Client key cannot contain '_', but was '"+e+"'"),Fc+"_"+t+"_"+e}var Qc="firestore_mutations";function Xc(t,e,n){var r=Qc+"_"+t+"_"+n;return e.l()&&(r+="_"+e.uid),r}var Jc="firestore_targets";function $c(t,e){return Jc+"_"+t+"_"+e}var Zc="SharedClientState",tf=(lf.Wf=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new ti(r.error.code,r.error.message)),i?new lf(t,e,r.state,o):(qr(Zc,"Failed to parse mutation state for ID '"+e+"': "+n),null)},lf.prototype.zf=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},lf),ef=(ff.Wf=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new ti(n.error.code,n.error.message)),r?new ff(t,n.state,i):(qr(Zc,"Failed to parse target state for ID '"+t+"': "+e),null)},ff.prototype.zf=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},ff),nf=(cf.Wf=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=uu(),o=0;r&&o<n.activeTargetIds.length;++o)r=na(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new cf(t,i):(qr(Zc,"Failed to parse client data for instance '"+t+"': "+e),null)},cf),rf=(hf.Wf=function(t){var e=JSON.parse(t);return"object"==typeof e&&e.onlineState in aa&&"string"==typeof e.clientId?new hf(e.clientId,aa[e.onlineState]):(qr(Zc,"Failed to parse online state: "+t),null)},hf),of=(uf.prototype.Kf=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},uf.prototype.Hf=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},uf.prototype.zf=function(){var t={activeTargetIds:this.activeTargetIds.nt(),updateTimeMs:Date.now()};return JSON.stringify(t)},uf),sf=(af.tl=function(t){return!(!t.window||null==t.window.localStorage)},af.prototype.start=function(){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,h,c,f,l=this;return v(this,function(t){switch(t.label){case 0:return Gr(!this.Mo,"WebStorageSharedClientState already started"),Gr(null!==this.Sf,"syncEngine property must be set before calling start()"),Gr(null!==this.Ha,"onlineStateHandler property must be set before calling start()"),[4,this.Sf.uc()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.Jf&&(o=this.getItem(Kc(this.persistenceKey,i)))&&(s=nf.Wf(i,o))&&(this.Yf[s.clientId]=s);for(this.ol(),(a=this.storage.getItem(this.sl))&&(u=this.hl(a))&&this.cl(u),h=0,c=this.Zf;h<c.length;h++)f=c[h],this.$f(f);return this.Zf=[],this.platform.window.addEventListener("unload",function(){return l.Rf()}),this.Mo=!0,[2]}})})},af.prototype.Cs=function(t){this.setItem(this.il,JSON.stringify(t))},af.prototype.al=function(){var n=uu();return vi(this.Yf,function(t,e){n=n.Gt(e.activeTargetIds)}),n},af.prototype.fl=function(t){for(var e in this.Yf)if(this.Yf.hasOwnProperty(e)&&this.Yf[e].activeTargetIds.has(t))return!0;return!1},af.prototype.ll=function(t){this.dl(t,"pending")},af.prototype.vl=function(t,e,n){this.dl(t,e,n),this.wl(t)},af.prototype.ml=function(t){var e="not-current";if(this.fl(t)){var n=this.storage.getItem($c(this.persistenceKey,t));if(n){var r=ef.Wf(t,n);r&&(e=r.state)}}return this.pl.Kf(t),this.ol(),e},af.prototype.gl=function(t){this.pl.Hf(t),this.ol()},af.prototype.bl=function(t){return this.pl.activeTargetIds.has(t)},af.prototype.yl=function(t){this.removeItem($c(this.persistenceKey,t))},af.prototype._l=function(t,e,n){this.Il(t,e,n)},af.prototype.mh=function(t,e,n){var r=this;e.forEach(function(t){r.wl(t)}),this.currentUser=t,n.forEach(function(t){r.ll(t)})},af.prototype.Tl=function(t){this.El(t)},af.prototype.Rf=function(){this.Mo&&(this.platform.window.removeEventListener("storage",this.Xf),this.removeItem(this.nl),this.Mo=!1)},af.prototype.getItem=function(t){var e=this.storage.getItem(t);return Ur(Zc,"READ",t,e),e},af.prototype.setItem=function(t,e){Ur(Zc,"SET",t,e),this.storage.setItem(t,e)},af.prototype.removeItem=function(t){Ur(Zc,"REMOVE",t),this.storage.removeItem(t)},af.prototype.$f=function(a){var t=this;if(a.storageArea===this.storage){if(Ur(Zc,"EVENT",a.key,a.newValue),a.key===this.nl)return void qr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Gc.Ys(function(){return p(t,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){if(!this.Mo)return this.Zf.push(a),[2];if(null===a.key)return[2];if(this.el.test(a.key)){if(null==a.newValue)return n=this.Rl(a.key),[2,this.Al(n,null)];if(e=this.Dl(a.key,a.newValue))return[2,this.Al(e.clientId,e)]}else if(this.rl.test(a.key)){if(null!==a.newValue&&(r=this.Pl(a.key,a.newValue)))return[2,this.Sl(r)]}else if(this.ul.test(a.key)){if(null!==a.newValue&&(i=this.Cl(a.key,a.newValue)))return[2,this.Vl(i)]}else if(a.key===this.sl){if(null!==a.newValue&&(o=this.hl(a.newValue)))return[2,this.cl(o)]}else a.key===this.il&&(Gr(!!this.Ds,"Missing sequenceNumberHandler"),(s=function(t){var e=ch.Vs;if(null!=t)try{var n=JSON.parse(t);Gr("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){qr(Zc,"Failed to read sequence number from WebStorage",t)}return e}(a.newValue))!==ch.Vs&&this.Ds(s));return[2]})})})}},Object.defineProperty(af.prototype,"pl",{get:function(){return this.Yf[this.Jf]},enumerable:!0,configurable:!0}),af.prototype.ol=function(){this.setItem(this.nl,this.pl.zf())},af.prototype.dl=function(t,e,n){var r=new tf(this.currentUser,t,e,n),i=Xc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.zf())},af.prototype.wl=function(t){var e=Xc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},af.prototype.El=function(t){var e={clientId:this.Jf,onlineState:aa[t]};this.storage.setItem(this.sl,JSON.stringify(e))},af.prototype.Il=function(t,e,n){var r=$c(this.persistenceKey,t),i=new ef(t,e,n);this.setItem(r,i.zf())},af.prototype.Rl=function(t){var e=this.el.exec(t);return e?e[1]:null},af.prototype.Dl=function(t,e){var n=this.Rl(t);return Gr(null!==n,"Cannot parse client state key '"+t+"'"),nf.Wf(n,e)},af.prototype.Pl=function(t,e){var n=this.rl.exec(t);Gr(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return tf.Wf(new $r(i),r,e)},af.prototype.Cl=function(t,e){var n=this.ul.exec(t);Gr(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return ef.Wf(r,e)},af.prototype.hl=function(t){return rf.Wf(t)},af.prototype.Sl=function(e){return p(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid!==this.currentUser.uid?(Ur(Zc,"Ignoring mutation for non-active user "+e.user.uid),[2]):[2,this.Sf.Nl(e.batchId,e.state,e.error)]})})},af.prototype.Vl=function(t){return this.Sf.kl(t.targetId,t.state,t.error)},af.prototype.Al=function(t,e){var n=this,r=this.al();e?this.Yf[t]=e:delete this.Yf[t];var i=this.al(),o=[],s=[];return i.forEach(function(e){return p(n,void 0,void 0,function(){return v(this,function(t){return r.has(e)||o.push(e),[2]})})}),r.forEach(function(e){return p(n,void 0,void 0,function(){return v(this,function(t){return i.has(e)||s.push(e),[2]})})}),this.Sf.Ol(o,s)},af.prototype.cl=function(t){this.Yf[t.clientId]&&this.Ha(t.onlineState)},af);function af(t,e,n,r,i){if(this.Gc=t,this.platform=e,this.persistenceKey=n,this.Jf=r,this.Sf=null,this.Ha=null,this.Ds=null,this.Yf={},this.Xf=this.$f.bind(this),this.Mo=!1,this.Zf=[],!af.tl(this.platform))throw new ti(Zr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.nl=Kc(this.persistenceKey,this.Jf),this.il="firestore_sequence_number_"+this.persistenceKey,this.Yf[this.Jf]=new of,this.el=new RegExp("^"+Fc+"_"+o+"_([^_]*)$"),this.rl=new RegExp("^"+Qc+"_"+o+"_(\\d+)(?:_(.*))?$"),this.ul=new RegExp("^"+Jc+"_"+o+"_(\\d+)$"),this.sl="firestore_online_state_"+this.persistenceKey,this.platform.window.addEventListener("storage",this.Xf)}function uf(){this.activeTargetIds=uu()}function hf(t,e){this.clientId=t,this.onlineState=e}function cf(t,e){this.clientId=t,this.activeTargetIds=e}function ff(t,e,n){this.targetId=t,this.state=e,Gr(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}function lf(t,e,n,r){this.user=t,this.batchId=e,this.state=n,Gr(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}var pf,df,vf=(yf.prototype.ll=function(t){},yf.prototype.vl=function(t,e,n){},yf.prototype.ml=function(t){return this.Fl.Kf(t),this.xl[t]||"not-current"},yf.prototype._l=function(t,e,n){this.xl[t]=e},yf.prototype.gl=function(t){this.Fl.Hf(t)},yf.prototype.bl=function(t){return this.Fl.activeTargetIds.has(t)},yf.prototype.yl=function(t){delete this.xl[t]},yf.prototype.al=function(){return this.Fl.activeTargetIds},yf.prototype.fl=function(t){return this.Fl.activeTargetIds.has(t)},yf.prototype.start=function(){return this.Fl=new of,Promise.resolve()},yf.prototype.mh=function(t,e,n){},yf.prototype.Tl=function(t){},yf.prototype.Rf=function(){},yf.prototype.Cs=function(t){},yf);function yf(){this.Fl=new of,this.xl={},this.Sf=null,this.Ha=null,this.Ds=null}(df=pf=pf||{})[df.jl=0]="__PRIVATE_QueryCache",df[df.Ul=1]="__PRIVATE_SyncEngine";function mf(t){this.key=t}function gf(t){this.key=t}var wf=(If.prototype.next=function(){var t=this.Ml;return this.Ml+=2,t},If.prototype.after=function(t){return this.Bl(t+2),this.next()},If.prototype.Bl=function(t){Gr((1&t)===this.Ll,"Cannot supply target ID from different generator ID"),this.Ml=t},If.ql=function(){return new If(pf.jl,2)},If.Ql=function(){return new If(pf.Ul)},If),bf=(Object.defineProperty(Ef.prototype,"Hl",{get:function(){return this.Gl},enumerable:!0,configurable:!0}),Ef.prototype.Jl=function(t,e){var a=this,u=e?e.Yl:new wu,h=e?e.Kl:this.Kl,c=e?e.$i:this.$i,f=h,l=!1,p=this.query.yi()&&h.size===this.query.limit?h.last():null,d=this.query._i()&&h.size===this.query.limit?h.first():null;if(t.bt(function(t,e){var n=h.get(t),r=e instanceof Ps?e:null;r&&(Gr(t.isEqual(r.key),"Mismatching keys found in document changes: "+t+" != "+r.key),r=a.query.matches(r)?r:null);var i=!!n&&a.$i.has(n.key),o=!!r&&(r.cn||a.$i.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:hu.zi,doc:r}),s=!0):a.Xl(n,r)||(u.track({type:hu.Wi,doc:r}),s=!0,(p&&0<a.query.wi(r,p)||d&&a.query.wi(r,d)<0)&&(l=!0)):!n&&r?(u.track({type:hu.Qi,doc:r}),s=!0):n&&!r&&(u.track({type:hu.Gi,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(c=r?(f=f.add(r),o?c.add(t):c.delete(t)):(f=f.delete(t),c.delete(t)))}),this.query.yi()||this.query._i())for(;f.size>this.query.limit;){var n=this.query.yi()?f.last():f.first();f=f.delete(n.key),c=c.delete(n.key),u.track({type:hu.Gi,doc:n})}return Gr(!l||!e,"View was refilled using docs that themselves needed refilling."),{Kl:f,Yl:u,$l:l,$i:c}},Ef.prototype.Xl=function(t,e){return t.cn&&e.hasCommittedMutations&&!e.cn},Ef.prototype.es=function(t,e,n){var o=this;Gr(!t.$l,"Cannot apply changes that need a refill");var r=this.Kl;this.Kl=t.Kl,this.$i=t.$i;var i=t.Yl.Yi();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.query.wi(t.doc,e.doc);function n(t){switch(t){case hu.Qi:return 1;case hu.Wi:case hu.zi:return 2;case hu.Gi:return 0;default:return Fr("Unknown ChangeType: "+t)}}var r,i}),this.Zl(n);var s=e?this.td():[],a=0===this.zl.size&&this.he?fu.Hi:fu.Ki,u=a!==this.Wl;return this.Wl=a,0!==i.length||u?{snapshot:new bu(this.query,t.Kl,r,i,t.$i,a===fu.Ki,u,!1),nd:s}:{nd:s}},Ef.prototype.ed=function(t){return this.he&&t===aa.Si?(this.he=!1,this.es({Kl:this.Kl,Yl:new wu,$i:this.$i,$l:!1},!1)):{nd:[]}},Ef.prototype.rd=function(t){return!this.Gl.has(t)&&!!this.Kl.has(t)&&!this.Kl.get(t).cn},Ef.prototype.Zl=function(t){var e=this;t&&(t.ce.forEach(function(t){return e.Gl=e.Gl.add(t)}),t.ae.forEach(function(t){return Gr(e.Gl.has(t),"Modified document "+t+" not found in view.")}),t.fe.forEach(function(t){return e.Gl=e.Gl.delete(t)}),this.he=t.he)},Ef.prototype.td=function(){var e=this;if(!this.he)return[];var n=this.zl;this.zl=su(),this.Kl.forEach(function(t){e.rd(t.key)&&(e.zl=e.zl.add(t.key))});var r=[];return n.forEach(function(t){e.zl.has(t)||r.push(new gf(t))}),this.zl.forEach(function(t){n.has(t)||r.push(new mf(t))}),r},Ef.prototype.ud=function(t){this.Gl=t.ec,this.zl=su();var e=this.Jl(t.documents);return this.es(e,!0)},Ef.prototype.sd=function(){return bu.ne(this.query,this.Kl,this.$i,this.Wl===fu.Ki)},Ef);function Ef(t,e){this.query=t,this.Gl=e,this.Wl=null,this.he=!1,this.zl=su(),this.$i=su(),this.Kl=new pu(t.wi.bind(t))}function If(t,e){Gr((1&(this.Ll=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.Bl(void 0!==e?e:this.Ll)}function Tf(t,e,n){this.query=t,this.targetId=e,this.view=n}function Nf(t){this.key=t,this.wd=!1}function Af(){this.zd=null,this.targetId=0,this.Kd=[]}var Sf=(Uf.prototype.ad=function(){this.fd()},Uf.prototype.fd=function(){var t=this;this.ca.$c(function(){return p(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=this.od.qf(),(n=this.ld(e))&&n.then(function(t){r.Ms.Ys(function(){return e.commit().then(function(){r.Ws.resolve(t)}).catch(function(t){r.dd(t)})})}).catch(function(t){r.dd(t)}),[2]})})})},Uf.prototype.ld=function(t){try{var e=this.updateFunction(t);return!ea(e)&&e.catch&&e.then?e:(this.Ws.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Ws.reject(t),null}},Uf.prototype.dd=function(t){var e=this;0<this.hd&&this.vd(t)?(this.hd-=1,this.Ms.Ys(function(){return e.fd(),Promise.resolve()})):this.Ws.reject(t)},Uf.prototype.vd=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Xa(e)},Uf),Df=(Object.defineProperty(Mf.prototype,"Ad",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),Mf.prototype.subscribe=function(t){Gr(null!==t,"SyncEngine listener cannot be null"),Gr(null===this.pd,"SyncEngine already has a subscriber."),this.pd=t},Mf.prototype.listen=function(s){return p(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return this.Dd("listen()"),(r=this.gd.get(s))?(e=r.targetId,this.md.ml(e),n=r.view.sd(),[3,4]):[3,1];case 1:return[4,this.xo.Yh(s.vi())];case 2:return i=t.sent(),o=this.md.ml(i.targetId),e=i.targetId,[4,this.Pd(s,e,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this.od.listen(i),t.label=4;case 4:return this.pd.Aa([n]),[2,e]}})})},Mf.prototype.Pd=function(a,u,h){return p(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:return[4,this.xo.nc(a,!0)];case 1:return e=t.sent(),n=new bf(a,e.ec),r=n.Jl(e.documents),i=Iu.oe(u,h&&this.onlineState!==aa.Si),Gr(0===(o=n.es(r,!0===this.isPrimary,i)).nd.length,"View returned limbo docs before target ack from the server."),Gr(!!o.snapshot,"applyChanges for new view should always return a snapshot"),s=new Tf(a,u,n),this.gd.set(a,s),this.bd[u]||(this.bd[u]=[]),this.bd[u].push(a),[2,o.snapshot]}})})},Mf.prototype.Sd=function(r){return p(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,this.xo.nc(r.query,!0)];case 1:return e=t.sent(),n=r.view.ud(e),this.isPrimary&&this.Cd(r.targetId,n.nd),[2,n]}})})},Mf.prototype.Df=function(i){return p(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return this.Dd("unlisten()"),Gr(!!(e=this.gd.get(i)),"Trying to unlisten on query not found:"+i),1<(n=this.bd[e.targetId]).length?(this.bd[e.targetId]=n.filter(function(t){return!t.isEqual(i)}),this.gd.delete(i),[2]):this.isPrimary?(this.md.gl(e.targetId),this.md.fl(e.targetId)?[3,2]:[4,this.xo.tc(e.targetId,!1).then(function(){r.md.yl(e.targetId),r.od.Df(e.targetId),r.Vd(e.targetId)}).catch(Fh)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.Vd(e.targetId),[4,this.xo.tc(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},Mf.prototype.write=function(n,r){return p(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.Dd("write()"),[4,this.xo._h(n)];case 1:return e=t.sent(),this.md.ll(e.batchId),this.Nd(e.batchId,r),[4,this.kd(e.Ku)];case 2:return t.sent(),[4,this.od.If()];case 3:return t.sent(),[2]}})})},Mf.prototype.runTransaction=function(t,e,n){new Sf(t,this.od,e,n).ad()},Mf.prototype.jh=function(n){return p(this,void 0,void 0,function(){var e,r=this;return v(this,function(t){switch(t.label){case 0:this.Dd("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.xo.jh(n)];case 2:return e=t.sent(),vi(n.ie,function(t,e){var n=r._d[Number(t)];n&&(Gr(e.ce.size+e.ae.size+e.fe.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.ce.size?n.wd=!0:0<e.ae.size?Gr(n.wd,"Received change for limbo target document without add."):0<e.fe.size&&(Gr(n.wd,"Received remove for limbo target document without add."),n.wd=!1))}),[4,this.kd(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,Fh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Mf.prototype.ed=function(r,t){if(this.isPrimary&&t===ha.Ci||!this.isPrimary&&t===ha.Vi){this.Dd("applyOnlineStateChange()");var i=[];this.gd.forEach(function(t,e){var n=e.view.ed(r);Gr(0===n.nd.length,"OnlineState should not affect limbo documents."),n.snapshot&&i.push(n.snapshot)}),this.pd.Od(r),this.pd.Aa(i),this.onlineState=r,this.isPrimary&&this.md.Tl(r)}},Mf.prototype.Nf=function(a,u){return p(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return v(this,function(t){switch(t.label){case 0:return this.Dd("rejectListens()"),this.md._l(a,"rejected",u),e=this._d[a],(n=e&&e.key)?(this.yd=this.yd.remove(n),delete this._d[a],r=(r=new Wi(Bi.W)).dt(n,new Ls(n,Vi.B())),i=su().add(n),o=new Eu(Vi.MIN,{},new so(Br),r,i),[2,this.jh(o)]):[3,1];case 1:return[4,this.xo.tc(a,!1).then(function(){return s.Vd(a,u)}).catch(Fh)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Mf.prototype.Nl=function(n,r,i){return p(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.Dd("applyBatchState()"),[4,this.xo.Th(n)];case 1:return null===(e=t.sent())?(Ur("SyncEngine","Cannot apply mutation batch with id: "+n),[2]):"pending"!==r?[3,3]:[4,this.od.If()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.Fd(n,i||null),this.xo.sc(n)):Fr("Unknown batchState: "+r),t.label=4;case 4:return[4,this.kd(e)];case 5:return t.sent(),[2]}})})},Mf.prototype.Uf=function(r){return p(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:this.Dd("applySuccessfulWrite()"),e=r.batch.batchId,this.Fd(e,null),this.xd(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.xo.Rh(r)];case 2:return n=t.sent(),this.md.vl(e,"acknowledged"),[4,this.kd(n)];case 3:return t.sent(),[3,6];case 4:return[4,Fh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Mf.prototype.Mf=function(n,r){return p(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.Dd("rejectFailedWrite()"),this.Fd(n,r),this.xd(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.xo.Ch(n)];case 2:return e=t.sent(),this.md.vl(n,"rejected",r),[4,this.kd(e)];case 3:return t.sent(),[3,6];case 4:return[4,Fh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Mf.prototype.jd=function(r){return p(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.od.cf()||Ur("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.xo.kh()];case 1:return-1===(e=t.sent())?r.resolve():((n=this.Ed.get(e)||[]).push(r),this.Ed.set(e,n)),[2]}})})},Mf.prototype.xd=function(t){(this.Ed.get(t)||[]).forEach(function(t){t.resolve()}),this.Ed.delete(t)},Mf.prototype.Ud=function(e){this.Ed.forEach(function(t){t.forEach(function(t){t.reject(new ti(Zr.CANCELLED,e))})}),this.Ed.clear()},Mf.prototype.Nd=function(t,e){var n=this.Td[this.currentUser.v()];n=(n=n||new Wi(Br)).dt(t,e),this.Td[this.currentUser.v()]=n},Mf.prototype.Fd=function(t,e){var n=this.Td[this.currentUser.v()];if(n){var r=n.get(t);r&&(Gr(t===n.pt(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.Td[this.currentUser.v()]=n}},Mf.prototype.Vd=function(t,e){var n=this;void 0===e&&(e=null),this.md.gl(t),Gr(this.bd[t]&&0!==this.bd[t].length,"There are no queries mapped to target id "+t);for(var r=0,i=this.bd[t];r<i.length;r++){var o=i[r];this.gd.delete(o),e&&this.pd.Ld(o,e)}if(delete this.bd[t],this.isPrimary){var s=this.Id.Ou(t);this.Id.Nu(t),s.forEach(function(t){n.Id.Fu(t)||n.Bd(t)})}},Mf.prototype.Bd=function(t){var e=this.yd.get(t);null!==e&&(this.od.Df(e),this.yd=this.yd.remove(t),delete this._d[e])},Mf.prototype.Cd=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof mf?(this.Id.Du(i.key,t),this.Md(i)):i instanceof gf?(Ur("SyncEngine","Document no longer in limbo: "+i.key),this.Id.Su(i.key,t),this.Id.Fu(i.key)||this.Bd(i.key)):Fr("Unknown limbo change: "+JSON.stringify(i))}},Mf.prototype.Md=function(t){var e=t.key;if(!this.yd.get(e)){Ur("SyncEngine","New document in limbo: "+e);var n=this.Rd.next(),r=wa.ii(e.path);this._d[n]=new Nf(e),this.od.listen(new za(r.vi(),n,fa.Oi,ch.Vs)),this.yd=this.yd.dt(e,n)}},Mf.prototype.qd=function(){return this.yd},Mf.prototype.kd=function(r,u){return p(this,void 0,void 0,function(){var o,s,e,a=this;return v(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.gd.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.Jl(r);return n.$l?a.xo.nc(i.query,!1).then(function(t){var e=t.documents;return i.view.Jl(e,n)}):n}).then(function(t){var e=u&&u.ie[i.targetId],n=i.view.es(t,!0===a.isPrimary,e);if(a.Cd(i.targetId,n.nd),n.snapshot){a.isPrimary&&a.md._l(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=hh.As(i.targetId,n.snapshot);s.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.pd.Aa(o),[4,this.xo.zh(s)];case 2:return t.sent(),[2]}})})},Mf.prototype.Dd=function(t){Gr(null!==this.pd,"Trying to call "+t+" before calling subscribe().")},Mf.prototype.Qf=function(r){return p(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?(this.Ud("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.xo.mh(r)]):[3,3];case 1:return n=t.sent(),this.md.mh(r,n.bh,n.yh),[4,this.kd(n.gh)];case 2:t.sent(),t.label=3;case 3:return[4,this.od.Qf()];case 4:return t.sent(),[2]}})})},Mf.prototype.Gf=function(u){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a=this;return v(this,function(t){switch(t.label){case 0:return!0!==u||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.od.Gf(!0)]);case 1:return t.sent(),o=this.md.al(),[4,this.Qd(o.nt())];case 2:for(e=t.sent(),n=0,r=e;n<r.length;n++)i=r[n],this.od.listen(i);return[3,7];case 3:return!1!==u||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,o=[],s=Promise.resolve(),di(this.bd,function(t,e){a.md.bl(t)?o.push(t):s=s.then(function(){return a.Vd(t),a.xo.tc(t,!0)}),a.od.Df(t)}),[4,s]);case 4:return t.sent(),[4,this.Qd(o)];case 5:return t.sent(),this.Gd(),[4,this.od.Gf(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},Mf.prototype.Gd=function(){var e=this;di(this._d,function(t){e.od.Df(t)}),this.Id.ku(),this._d=[],this.yd=new Wi(Bi.W)},Mf.prototype.Qd=function(d){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,h,c,f,l,p;return v(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(a=this.bd[o])&&0!==a.length?[4,this.xo.tc(o,!0)]:[3,8]):[3,14];case 2:return t.sent(),[4,this.xo.Yh(a[0].vi())];case 3:s=t.sent(),u=0,h=a,t.label=4;case 4:return u<h.length?(c=h[u],Gr(!!(f=this.gd.get(c)),"No query view found for "+c),[4,this.Sd(f)]):[3,7];case 5:(l=t.sent()).snapshot&&n.push(l.snapshot),t.label=6;case 6:return u++,[3,4];case 7:return[3,12];case 8:return Gr(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.xo.cc(o)];case 9:return Gr(!!(p=t.sent()),"Target for id "+o+" not found"),[4,this.xo.Yh(p)];case 10:return s=t.sent(),[4,this.Pd(this.Wd(p),o,!1)];case 11:t.sent(),t.label=12;case 12:e.push(s),t.label=13;case 13:return r++,[3,1];case 14:return this.pd.Aa(n),[2,e]}})})},Mf.prototype.Wd=function(t){return new wa(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,ra.Jn,t.startAt,t.endAt)},Mf.prototype.uc=function(){return this.xo.uc()},Mf.prototype.kl=function(r,i,o){return p(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:if(this.isPrimary)return Ur("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.bd[r])return[3,7];switch(i){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.xo.ac()];case 2:return e=t.sent(),n=Eu.se(r,"current"===i),[4,this.kd(e,n)];case 3:return t.sent(),[3,7];case 4:return[4,this.xo.tc(r,!0)];case 5:return t.sent(),this.Vd(r,o),[3,7];case 6:Fr("Unexpected target state: "+i),t.label=7;case 7:return[2]}})})},Mf.prototype.Ol=function(f,l){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,h,c=this;return v(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[2];e=0,n=f,t.label=1;case 1:return e<n.length?(h=n[e],Gr(!this.bd[h],"Trying to add an already active target"),[4,this.xo.cc(h)]):[3,6];case 2:return Gr(!!(r=t.sent()),"Query data for active target "+h+" not found"),[4,this.xo.Yh(r)];case 3:return i=t.sent(),[4,this.Pd(this.Wd(r),i.targetId,!1)];case 4:t.sent(),this.od.listen(i),t.label=5;case 5:return e++,[3,1];case 6:o=function(e){return v(this,function(t){switch(t.label){case 0:return s.bd[e]?[4,s.xo.tc(e,!1).then(function(){c.od.Df(e),c.Vd(e)}).catch(Fh)]:[2,"continue"];case 1:return t.sent(),[2]}})},s=this,a=0,u=l,t.label=7;case 7:return a<u.length?(h=u[a],[5,o(h)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})},Mf.prototype.enableNetwork=function(){return this.xo.hc(!0),this.od.enableNetwork()},Mf.prototype.disableNetwork=function(){return this.xo.hc(!1),this.od.disableNetwork()},Mf.prototype.$e=function(t){var e=this._d[t];if(e&&e.wd)return su().add(e.key);var n=su(),r=this.bd[t];if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],a=this.gd.get(s);Gr(!!a,"No query view found for "+s),n=n.Gt(a.view.Hl)}return n},Mf),Rf=(Lf.prototype.listen=function(t){var e=t.query,n=!1,r=this.Hd.get(e);return r||(n=!0,r=new Af,this.Hd.set(e,r)),r.Kd.push(t),Gr(!t.ed(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),r.zd&&t.Yd(r.zd)&&this.Xd(),n?this.Sf.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},Lf.prototype.Df=function(o){return p(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){return e=o.query,n=!1,(r=this.Hd.get(e))&&0<=(i=r.Kd.indexOf(o))&&(r.Kd.splice(i,1),n=0===r.Kd.length),n?(this.Hd.delete(e),[2,this.Sf.Df(e)]):[2]})})},Lf.prototype.Aa=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.Hd.get(o);if(s){for(var a=0,u=s.Kd;a<u.length;a++)u[a].Yd(i)&&(e=!0);s.zd=i}}e&&this.Xd()},Lf.prototype.Ld=function(t,e){var n=this.Hd.get(t);if(n)for(var r=0,i=n.Kd;r<i.length;r++)i[r].onError(e);this.Hd.delete(t)},Lf.prototype.Od=function(i){this.onlineState=i;var o=!1;this.Hd.forEach(function(t,e){for(var n=0,r=e.Kd;n<r.length;n++)r[n].ed(i)&&(o=!0)}),o&&this.Xd()},Lf.prototype.$d=function(t){this.Jd.add(t),t.next()},Lf.prototype.Zd=function(t){this.Jd.delete(t)},Lf.prototype.Xd=function(){this.Jd.forEach(function(t){t.next()})},Lf),kf=(Pf.prototype.Yd=function(t){if(Gr(0<t.docChanges.length||t.Zi,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==hu.zi&&e.push(i)}t=new bu(t.query,t.docs,t.Xi,e,t.$i,t.fromCache,t.Zi,!0)}var o=!1;return this.nv?this.ev(t)&&(this.tv.next(t),o=!0):this.rv(t,this.onlineState)&&(this.uv(t),o=!0),this.iv=t,o},Pf.prototype.onError=function(t){this.tv.error(t)},Pf.prototype.ed=function(t){this.onlineState=t;var e=!1;return this.iv&&!this.nv&&this.rv(this.iv,t)&&(this.uv(this.iv),e=!0),e},Pf.prototype.rv=function(t,e){if(Gr(!this.nv,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==aa.Si;return this.options.sv&&n?(Gr(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.Y()||e===aa.Si},Pf.prototype.ev=function(t){if(0<t.docChanges.length)return!0;var e=this.iv&&this.iv.hasPendingWrites!==t.hasPendingWrites;return!(!t.Zi&&!e)&&!0===this.options.includeMetadataChanges},Pf.prototype.uv=function(t){Gr(!this.nv,"Trying to raise initial events for second time"),t=bu.ne(t.query,t.docs,t.$i,t.fromCache),this.nv=!0,this.tv.next(t)},Pf),_f="",xf="",Cf="",Of="";function Pf(t,e,n){this.query=t,this.tv=e,this.nv=!1,this.iv=null,this.onlineState=aa.Di,this.options=n||{}}function Lf(t){this.Sf=t,this.Hd=new Zu(function(t){return t.canonicalId()}),this.onlineState=aa.Di,this.Jd=new Set,this.Sf.subscribe(this)}function Mf(t,e,n,r){this.xo=t,this.od=e,this.md=n,this.currentUser=r,this.pd=null,this.gd=new Zu(function(t){return t.canonicalId()}),this.bd={},this.yd=new Wi(Bi.W),this._d={},this.Id=new nh,this.Td={},this.Ed=new Map,this.Rd=wf.Ql(),this.isPrimary=void 0,this.onlineState=aa.Di}function Uf(t,e,n,r){this.Ms=t,this.od=e,this.updateFunction=n,this.Ws=r,this.hd=5,this.ca=new Rc(this.Ms,Qu.Bs)}function qf(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Ff(e)),e=Vf(t.get(n),e);return Ff(e)}function Vf(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=_f+Cf;break;case _f:n+=_f+Of;break;default:n+=o}}return n}function Ff(t){return t+_f+xf}function Gf(t){var e=t.length;if(Gr(2<=e,"Invalid path "+t),2===e)return Gr(t.charAt(0)===_f&&t.charAt(1)===xf,"Non-empty path "+t+" had length 2"),Gi.rt;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf(_f,o);switch((s<0||n<s)&&Fr('Invalid encoded resource path: "'+t+'"'),t.charAt(s+1)){case xf:var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case Cf:i+=t.substring(o,s),i+="\0";break;case Of:i+=t.substring(o,s+1);break;default:Fr('Invalid encoded resource path: "'+t+'"')}o=s+2}return new Gi(r)}var jf=(Qf.hv=function(o,t,s){return Gr(Qf.tl(),"IndexedDB not supported in current environment."),Ur("SimpleDb","Opening database:",o),new ih(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new Qf(e))},i.onblocked=function(){r(new ti(Zr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new ti(Zr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Ur("SimpleDb",'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;s.createOrUpgrade(e,i.transaction,t.oldVersion,Il).next(function(){Ur("SimpleDb","Database upgrade to version "+Il+" complete")})}}).Qu()},Qf.delete=function(t){return Ur("SimpleDb","Removing database:",t),Xf(window.indexedDB.deleteDatabase(t)).Qu()},Qf.tl=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(Qf.cv())return!0;if(void 0===window.navigator)return!1;var t=l(),e=Qf.ov(t),n=0<e&&e<10,r=Qf.av(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Qf.cv=function(){var t;return"undefined"!=typeof __PRIVATE_process&&"YES"===(null===(t=__PRIVATE_process.__PRIVATE_env)||void 0===t?void 0:t.fv)},Qf.lv=function(t,e){return t.store(e)},Qf.ov=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Qf.av=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Qf.prototype.dv=function(e){this.db.onversionchange=function(t){return e(t)}},Qf.prototype.runTransaction=function(r,h,c){return p(this,void 0,void 0,function(){var o,s,a,e,u,n;return v(this,function(t){switch(t.label){case 0:o=r.startsWith("readonly"),s=r.endsWith("idempotent"),a=0,e=function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:++a,e=Bf.open(u.db,o?"readonly":"readwrite",h),t.label=1;case 1:return t.trys.push([1,3,,4]),(n=c(e).catch(function(t){return e.abort(t),ih.reject(t)}).Qu()).catch(function(){}),[4,e.vv];case 2:return t.sent(),[2,{value:n}];case 3:return r=t.sent(),i=s&&"FirebaseError"!==r.name&&a<3,Ur("SimpleDb","Transaction failed with error: %s. Retrying: %s.",r.message,i),i?[3,4]:[2,{value:Promise.reject(r)}];case 4:return[2]}})},u=this,t.label=1;case 1:return[5,e()];case 2:return"object"==typeof(n=t.sent())?[2,n.value]:[3,1];case 3:return[2]}})})},Qf.prototype.close=function(){this.db.close()},Qf),Yf=(Object.defineProperty(Kf.prototype,"Lu",{get:function(){return this.mv},enumerable:!0,configurable:!0}),Object.defineProperty(Kf.prototype,"gv",{get:function(){return this.pv},enumerable:!0,configurable:!0}),Object.defineProperty(Kf.prototype,"cursor",{set:function(t){this.wv=t},enumerable:!0,configurable:!0}),Kf.prototype.done=function(){this.mv=!0},Kf.prototype.bv=function(t){this.pv=t},Kf.prototype.delete=function(){return Xf(this.wv.delete())},Kf),Bf=(Hf.open=function(t,e,n){return new Hf(t.transaction(n,e))},Object.defineProperty(Hf.prototype,"vv",{get:function(){return this.yv.promise},enumerable:!0,configurable:!0}),Hf.prototype.abort=function(t){t&&this.yv.reject(t),this.aborted||(Ur("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Hf.prototype.store=function(t){var e=this.transaction.objectStore(t);return Gr(!!e,"Object store not part of transaction: "+t),new Wf(e)},Hf),Wf=(zf.prototype.put=function(t,e){return Xf(void 0!==e?(Ur("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Ur("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},zf.prototype.add=function(t){return Ur("SimpleDb","ADD",this.store.name,t,t),Xf(this.store.add(t))},zf.prototype.get=function(e){var n=this;return Xf(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Ur("SimpleDb","GET",n.store.name,e,t),t})},zf.prototype.delete=function(t){return Ur("SimpleDb","DELETE",this.store.name,t),Xf(this.store.delete(t))},zf.prototype.count=function(){return Ur("SimpleDb","COUNT",this.store.name),Xf(this.store.count())},zf.prototype._v=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.Iv(n,function(t,e){r.push(e)}).next(function(){return r})},zf.prototype.Tv=function(t,e){Ur("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Ev=!1;var r=this.cursor(n);return this.Iv(r,function(t,e,n){return n.delete()})},zf.prototype.Rv=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.Iv(r,e)},zf.prototype.Av=function(i){var t=this.cursor({});return new ih(function(n,r){t.onerror=function(t){var e=$f(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},zf.prototype.Iv=function(t,s){var a=[];return new ih(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new Yf(e),r=s(e.primaryKey,e.value,n);if(r instanceof ih){var i=r.catch(function(t){return n.done(),ih.reject(t)});a.push(i)}n.Lu?o():null===n.gv?e.continue():e.continue(n.gv)}else o()}}).next(function(){return ih.Wu(a)})},zf.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Gr(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},zf.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Ev?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},zf);function zf(t){this.store=t}function Hf(t){var n=this;this.transaction=t,this.aborted=!1,this.yv=new Ku,this.transaction.oncomplete=function(){n.yv.resolve()},this.transaction.onabort=function(){t.error?n.yv.reject(t.error):n.yv.resolve()},this.transaction.onerror=function(t){var e=$f(t.target.error);n.yv.reject(e)}}function Kf(t){this.wv=t,this.mv=!1,this.pv=null}function Qf(t){this.db=t,12.2===Qf.ov(l())&&qr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Xf(t){return new ih(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=$f(t.target.error);r(e)}})}var Jf=!1;function $f(t){var e=jf.ov(l());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new ti("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Jf||(Jf=!0,setTimeout(function(){throw r},0)),r}}return t}var Zf=(tl.Pv=function(t,e,n,r){return Gr(""!==t.uid,"UserID must not be an empty string."),new tl(t.l()?t.uid:"",e,n,r)},tl.prototype.Sv=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return rl(t).Rv({index:xl.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},tl.prototype.Rh=function(e,t,n){return this.Cv(e).next(function(t){return t.lastStreamToken=n.toBase64(),ol(e).put(t)})},tl.prototype.Oh=function(t){return this.Cv(t).next(function(t){return Ju.fromBase64String(t.lastStreamToken)})},tl.prototype.Fh=function(e,n){return this.Cv(e).next(function(t){return t.lastStreamToken=n.toBase64(),ol(e).put(t)})},tl.prototype.Ih=function(h,c,f,l){var p=this,d=il(h),v=rl(h);return v.add({}).next(function(t){Gr("number"==typeof t,"Auto-generated key is not a number");for(var e=new th(t,c,f,l),n=p.serializer.Vv(p.userId,e),r=[],i=new so(function(t,e){return Br(t.it(),e.it())}),o=0,s=l;o<s.length;o++){var a=s[o],u=Pl.key(p.userId,a.key.path,t);i=i.add(a.key.path.J()),r.push(v.put(n)),r.push(d.put(u,Pl.PLACEHOLDER))}return i.forEach(function(t){r.push(p.cs.Nv(h,t))}),h.us(function(){p.Dv[t]=e.keys()}),ih.Wu(r).next(function(){return e})})},tl.prototype.Vh=function(t,e){var n=this;return rl(t).get(e).next(function(t){return t?(Gr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.kv(t)):null})},tl.prototype.Eh=function(t,n){var r=this;return this.Dv[n]?ih.resolve(this.Dv[n]):this.Vh(t,n).next(function(t){if(t){var e=t.keys();return r.Dv[n]=e}return null})},tl.prototype.Hh=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return rl(t).Rv({index:xl.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Gr(e.batchId>=i,"Should have found mutation after "+i),o=r.serializer.kv(e)),n.done()}).next(function(){return o})},tl.prototype.kh=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return rl(t).Rv({index:xl.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},tl.prototype.ph=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return rl(t)._v(xl.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.kv(t)})})},tl.prototype.fs=function(a,u){var h=this,t=Pl.prefixForPath(this.userId,u.path),e=IDBKeyRange.lowerBound(t),c=[];return il(a).Rv({range:e},function(e,t,n){var r=e[0],i=e[1],o=e[2],s=Gf(i);if(r===h.userId&&u.path.isEqual(s))return rl(a).get(o).next(function(t){if(!t)throw Fr("Dangling document-mutation reference found: "+e+" which points to "+o);Gr(t.userId===h.userId,"Unexpected user '"+t.userId+"' for mutation batch "+o),c.push(h.serializer.kv(t))});n.done()}).next(function(){return c})},tl.prototype.ms=function(r,t){var u=this,h=new so(Br),i=[];return t.forEach(function(a){var t=Pl.prefixForPath(u.userId,a.path),e=IDBKeyRange.lowerBound(t),n=il(r).Rv({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Gf(i);r===u.userId&&a.path.isEqual(s)?h=h.add(o):n.done()});i.push(n)}),ih.Wu(i).next(function(){return u.Ov(r,h)})},tl.prototype.Is=function(t,e){var a=this;Gr(!e.Hn(),"Document queries shouldn't go down this path"),Gr(!e.Ti(),"CollectionGroup queries should be handled in LocalDocumentsView");var u=e.path,h=u.length+1,n=Pl.prefixForPath(this.userId,u),r=IDBKeyRange.lowerBound(n),c=new so(Br);return il(t).Rv({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Gf(i);r===a.userId&&u.Z(s)?s.length===h&&(c=c.add(o)):n.done()}).next(function(){return a.Ov(t,c)})},tl.prototype.Ov=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(rl(t).get(e).next(function(t){if(null===t)throw Fr("Dangling document-mutation reference found, which points to "+e);Gr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.kv(t))}))}),ih.Wu(i).next(function(){return r})},tl.prototype.Nh=function(e,n){var r=this;return nl(e.Fv,this.userId,n).next(function(t){return e.us(function(){r.oc(n.batchId)}),ih.forEach(t,function(t){return r.uh.xv(e,t)})})},tl.prototype.oc=function(t){delete this.Dv[t]},tl.prototype.Sh=function(n){var o=this;return this.Sv(n).next(function(t){if(!t)return ih.resolve();var e=IDBKeyRange.lowerBound(Pl.prefixForUser(o.userId)),i=[];return il(n).Rv({range:e},function(t,e,n){if(t[0]===o.userId){var r=Gf(t[1]);i.push(r)}else n.done()}).next(function(){Gr(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.it()}))})})},tl.prototype.Fu=function(t,e){return el(t,this.userId,e)},tl.prototype.Cv=function(t){var e=this;return ol(t).get(this.userId).next(function(t){return t||new _l(e.userId,-1,"")})},tl);function tl(t,e,n,r){this.userId=t,this.serializer=e,this.cs=n,this.uh=r,this.Dv={}}function el(t,o,e){var n=Pl.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),a=!1;return il(t).Rv({range:r,Ev:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(a=!0),n.done()}).next(function(){return a})}function nl(t,e,n){var r=t.store(xl.store),i=t.store(Pl.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.Rv({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){Gr(1===a,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=Pl.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return ih.Wu(o).next(function(){return h})}function rl(t){return up.lv(t,xl.store)}function il(t){return up.lv(t,Pl.store)}function ol(t){return up.lv(t,_l.store)}var sl=(al.prototype.$h=function(e){var n=this;return this.Uv(e).next(function(t){return t.highestTargetId=n.jv.after(t.highestTargetId),n.Lv(e,t).next(function(){return t.highestTargetId})})},al.prototype.xh=function(t){return this.Uv(t).next(function(t){return Vi.L(new qi(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},al.prototype.Bv=function(t){return cl(t.Fv)},al.prototype.Gh=function(e,n,r){var i=this;return this.Uv(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.q()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Lv(e,t)})},al.prototype.Zh=function(e,n){var r=this;return this.Mv(e,n).next(function(){return r.Uv(e).next(function(t){return t.targetCount+=1,r.qv(n,t),r.Lv(e,t)})})},al.prototype.qh=function(t,e){return this.Mv(t,e)},al.prototype.Qv=function(e,t){var n=this;return this.Gv(e,t.targetId).next(function(){return ul(e).delete(t.targetId)}).next(function(){return n.Uv(e)}).next(function(t){return Gr(0<t.targetCount,"Removing from an empty target cache"),t.targetCount-=1,n.Lv(e,t)})},al.prototype.Ho=function(r,i,o){var s=this,a=0,u=[];return ul(r).Rv(function(t,e){var n=s.serializer.Wv(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(a++,u.push(s.Qv(r,n)))}).next(function(){return ih.Wu(u)}).next(function(){return a})},al.prototype.qe=function(t,r){var i=this;return ul(t).Rv(function(t,e){var n=i.serializer.Wv(e);r(n)})},al.prototype.Uv=function(t){return hl(t.Fv)},al.prototype.Lv=function(t,e){return(n=t,up.lv(n,Bl.store)).put(Bl.key,e);var n},al.prototype.Mv=function(t,e){return ul(t).put(this.serializer.zv(e))},al.prototype.qv=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},al.prototype.Kv=function(t){return this.Uv(t).next(function(t){return t.targetCount})},al.prototype.Xh=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),s=null;return ul(t).Rv({range:n,index:jl.queryTargetsIndexName},function(t,e,n){var r=o.serializer.Wv(e);i.isEqual(r.target)&&(s=r,n.done())}).next(function(){return s})},al.prototype.Lh=function(n,t,r){var i=this,o=[],s=fl(n);return t.forEach(function(t){var e=qf(t.path);o.push(s.put(new Yl(r,e))),o.push(i.uh.Du(n,t))}),ih.Wu(o)},al.prototype.Uh=function(n,t,r){var i=this,o=fl(n);return ih.forEach(t,function(t){var e=qf(t.path);return ih.Wu([o.delete([r,e]),i.uh.Su(n,t)])})},al.prototype.Gv=function(t,e){var n=fl(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},al.prototype.ic=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=fl(t),o=su();return r.Rv({range:n,Ev:!0},function(t,e,n){var r=Gf(t[1]),i=new Bi(r);o=o.add(i)}).next(function(){return o})},al.prototype.Fu=function(t,e){var n=qf(e.path),r=IDBKeyRange.bound([n],[zr(n)],!1,!0),i=0;return fl(t).Rv({index:Yl.documentTargetsIndex,Ev:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},al.prototype.Ze=function(t,e){var n=this;return ul(t).get(e).next(function(t){return t?n.serializer.Wv(t):null})},al);function al(t,e){this.uh=t,this.serializer=e,this.jv=wf.ql()}function ul(t){return up.lv(t,jl.store)}function hl(t){return jf.lv(t,Bl.store).get(Bl.key).next(function(t){return Gr(null!==t,"Missing metadata row."),t})}function cl(t){return hl(t).next(function(t){return t.highestListenSequenceNumber})}function fl(t){return up.lv(t,Yl.store)}var ll,pl=(dl.prototype.Yu=function(t,e,n){return ml(t).put(gl(e),n)},dl.prototype.$u=function(t,e){var n=ml(t),r=gl(e);return n.delete(r)},dl.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.Hv(e,t)})},dl.prototype.Zu=function(t,e){var n=this;return ml(t).get(gl(e)).next(function(t){return n.Jv(t)})},dl.prototype.Yv=function(t,e){var n=this;return ml(t).get(gl(e)).next(function(t){var e=n.Jv(t);return e?{Xv:e,size:wl(t)}:null})},dl.prototype.getEntries=function(t,e){var r=this,i=tu();return this.$v(t,e,function(t,e){var n=r.Jv(e);i=i.dt(t,n)}).next(function(){return i})},dl.prototype.Zv=function(t,e){var r=this,i=tu(),o=new Wi(Bi.W);return this.$v(t,e,function(t,e){var n=r.Jv(e);o=n?(i=i.dt(t,n),o.dt(t,wl(e))):(i=i.dt(t,null),o.dt(t,0))}).next(function(){return{tw:i,nw:o}})},dl.prototype.$v=function(t,e,i){if(e.Y())return ih.resolve();var n=IDBKeyRange.bound(e.first().path.nt(),e.last().path.nt()),o=e._t(),s=o.Dt();return ml(t).Rv({range:n},function(t,e,n){for(var r=Bi.ft(t);s&&Bi.W(s,r)<0;)i(s,null),s=o.Dt();s&&s.isEqual(r)&&(i(s,e),s=o.Pt()?o.Dt():null),s?n.bv(s.path.nt()):n.done()}).next(function(){for(;s;)i(s,null),s=o.Pt()?o.Dt():null})},dl.prototype.ps=function(t,i,e){var o=this;Gr(!i.Ti(),"CollectionGroup queries should be handled in LocalDocumentsView");var s=nu(),a=i.path.length+1,n={};if(e.isEqual(Vi.MIN)){var r=i.path.nt();n.range=IDBKeyRange.lowerBound(r)}else{var u=i.path.nt(),h=this.serializer.iw(e);n.range=IDBKeyRange.lowerBound([u,h],!0),n.index=ql.collectionReadTimeIndex}return ml(t).Rv(n,function(t,e,n){if(t.length===a){var r=o.serializer.ew(e);i.path.Z(r.key.path)?r instanceof Ps&&i.matches(r)&&(s=s.dt(r.key,r)):n.done()}}).next(function(){return s})},dl.prototype.ac=function(t,e){var r=this,i=Za(),o=this.serializer.iw(e),n=ml(t),s=IDBKeyRange.lowerBound(o,!0);return n.Rv({index:ql.readTimeIndex,range:s},function(t,e){var n=r.serializer.ew(e);i=i.dt(n.key,n),o=e.readTime}).next(function(){return{fc:i,readTime:r.serializer.rw(o)}})},dl.prototype.lc=function(t){var r=this,e=ml(t),i=Vi.MIN;return e.Rv({index:ql.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(i=r.serializer.rw(e.readTime)),n.done()}).next(function(){return i})},dl.prototype.Ah=function(t){return new dl.uw(this,!!t&&t.Dh)},dl.prototype.sw=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},dl.prototype.getMetadata=function(t){return yl(t).get(Vl.key).next(function(t){return Gr(!!t,"Missing document cache metadata"),t})},dl.prototype.Hv=function(t,e){return yl(t).put(Vl.key,e)},dl.prototype.Jv=function(t){if(t){var e=this.serializer.ew(t);return e instanceof Ls&&e.version.isEqual(Vi.B())?null:e}return null},dl.uw=(t(vl,ll=oh),vl.prototype.es=function(s){var a=this,u=[],h=0,c=new so(function(t,e){return Br(t.it(),e.it())});return this.Ku.forEach(function(t,e){var n=a.hw.get(t);if(Gr(void 0!==n,"Cannot modify a document that wasn't read (for "+t+")"),e){Gr(!a.readTime.isEqual(Vi.MIN),"Cannot add a document with a read time of zero");var r=a.ow.serializer.cw(e,a.readTime);c=c.add(t.path.J());var i=wl(r);h+=i-n,u.push(a.ow.Yu(s,t,r))}else if(h-=n,a.Dh){var o=a.ow.serializer.cw(new Ls(t,Vi.B()),a.readTime);u.push(a.ow.Yu(s,t,o))}else u.push(a.ow.$u(s,t))}),c.forEach(function(t){u.push(a.ow.cs.Nv(s,t))}),u.push(this.ow.updateMetadata(s,h)),ih.Wu(u)},vl.prototype.ts=function(t,e){var n=this;return this.ow.Yv(t,e).next(function(t){return null===t?(n.hw.set(e,0),null):(n.hw.set(e,t.size),t.Xv)})},vl.prototype.ns=function(t,e){var n=this;return this.ow.Zv(t,e).next(function(t){var e=t.tw;return t.nw.forEach(function(t,e){n.hw.set(t,e)}),e})},vl),dl);function dl(t,e){this.serializer=t,this.cs=e}function vl(t,e){var n=ll.call(this)||this;return n.ow=t,n.Dh=e,n.hw=new Zu(function(t){return t.toString()}),n}function yl(t){return up.lv(t,Vl.store)}function ml(t){return up.lv(t,ql.store)}function gl(t){return t.path.nt()}function wl(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Fr("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var bl=(Sl.prototype.Nv=function(t,e){return this.aw.add(e),ih.resolve()},Sl.prototype._s=function(t,e){return ih.resolve(this.aw.getEntries(e))},Sl),El=(Al.prototype.add=function(t){Gr(t.length%2==1,"Expected a collection path.");var e=t.$(),n=t.J(),r=this.index[e]||new so(Gi.W),i=!r.has(n);return this.index[e]=r.add(n),i},Al.prototype.has=function(t){var e=t.$(),n=t.J(),r=this.index[e];return r&&r.has(n)},Al.prototype.getEntries=function(t){return(this.index[t]||new so(Gi.W)).nt()},Al),Il=9,Tl=(Nl.prototype.createOrUpgrade=function(n,r,t,e){var i=this;Gr(t<e&&0<=t&&e<=Il,"Unexpected schema upgrade from v"+t+" to v{toVersion}.");var o,s=new Bf(r);t<1&&1<=e&&(n.createObjectStore(Rl.store),(o=n).createObjectStore(_l.store,{keyPath:_l.keyPath}),o.createObjectStore(xl.store,{keyPath:xl.keyPath,autoIncrement:!0}).createIndex(xl.userMutationsIndex,xl.userMutationsKeyPath,{unique:!0}),o.createObjectStore(Pl.store),Xl(n),n.createObjectStore(ql.store));var a,u=ih.resolve();return t<3&&3<=e&&(0!==t&&((a=n).deleteObjectStore(Yl.store),a.deleteObjectStore(jl.store),a.deleteObjectStore(Bl.store),Xl(n)),u=u.next(function(){return t=s.store(Bl.store),e=new Bl(0,0,Vi.MIN.q(),0),t.put(Bl.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(u=u.next(function(){return r=n,(i=s).store(xl.store)._v().next(function(t){r.deleteObjectStore(xl.store),r.createObjectStore(xl.store,{keyPath:xl.keyPath,autoIncrement:!0}).createIndex(xl.userMutationsIndex,xl.userMutationsKeyPath,{unique:!0});var e=i.store(xl.store),n=t.map(function(t){return e.put(t)});return ih.Wu(n)});var r,i})),u=u.next(function(){n.createObjectStore(Jl.store,{keyPath:Jl.keyPath})})),t<5&&5<=e&&(u=u.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(u=u.next(function(){return n.createObjectStore(Vl.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(u=u.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(u=u.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(u=u.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(ql.store)).createIndex(ql.readTimeIndex,ql.readTimeIndexPath,{unique:!1}),t.createIndex(ql.collectionReadTimeIndex,ql.collectionReadTimeIndexPath,{unique:!1})})),u},Nl.prototype.addDocumentGlobal=function(e){var n=0;return e.store(ql.store).Rv(function(t,e){n+=wl(e)}).next(function(){var t=new Vl(n);return e.store(Vl.store).put(Vl.key,t)})},Nl.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(_l.store),e=r.store(xl.store);return t._v().next(function(t){return ih.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e._v(xl.userMutationsIndex,t).next(function(t){return ih.forEach(t,function(t){Gr(t.userId===n.userId,"Cannot process batch "+t.batchId+" from unexpected user");var e=i.serializer.kv(t);return nl(r,n.userId,e).next(function(){})})})})})},Nl.prototype.ensureSequenceNumbers=function(t){var s=t.store(Yl.store),e=t.store(ql.store);return cl(t).next(function(i){var o=[];return e.Rv(function(t,e){var n=new Gi(t),r=[0,qf(n)];o.push(s.get(r).next(function(t){return t?ih.resolve():(e=n,s.put(new Yl(0,qf(e),i)));var e}))}).next(function(){return ih.Wu(o)})})},Nl.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.$(),n=t.J();return r.put({collectionId:e,parent:qf(n)})}}t.createObjectStore(Wl.store,{keyPath:Wl.keyPath});var r=e.store(Wl.store),o=new El;return e.store(ql.store).Rv({Ev:!0},function(t,e){var n=new Gi(t);return i(n.J())}).next(function(){return e.store(Pl.store).Rv({Ev:!0},function(t,e){t[0];var n=t[1],r=(t[2],Gf(n));return i(r.J())})})},Nl);function Nl(t){this.serializer=t}function Al(){this.index={}}function Sl(){this.aw=new El}function Dl(t,e){this.seconds=t,this.nanoseconds=e}var Rl=(kl.store="owner",kl.key="owner",kl);function kl(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var _l=(Ol.store="mutationQueues",Ol.keyPath="userId",Ol),xl=(Cl.store="mutations",Cl.keyPath="batchId",Cl.userMutationsIndex="userMutationsIndex",Cl.userMutationsKeyPath=["userId","batchId"],Cl);function Cl(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}function Ol(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var Pl=(Ll.prefixForUser=function(t){return[t]},Ll.prefixForPath=function(t,e){return[t,qf(e)]},Ll.key=function(t,e,n){return[t,qf(e),n]},Ll.store="documentMutations",Ll.PLACEHOLDER=new Ll,Ll);function Ll(){}function Ml(t,e){this.path=t,this.readTime=e}function Ul(t,e){this.path=t,this.version=e}var ql=(Gl.store="remoteDocuments",Gl.readTimeIndex="readTimeIndex",Gl.readTimeIndexPath="readTime",Gl.collectionReadTimeIndex="collectionReadTimeIndex",Gl.collectionReadTimeIndexPath=["parentPath","readTime"],Gl),Vl=(Fl.store="remoteDocumentGlobal",Fl.key="remoteDocumentGlobalKey",Fl);function Fl(t){this.byteSize=t}function Gl(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}var jl=(Ql.store="targets",Ql.keyPath="targetId",Ql.queryTargetsIndexName="queryTargetsIndex",Ql.queryTargetsKeyPath=["canonicalId","targetId"],Ql),Yl=(Kl.store="targetDocuments",Kl.keyPath=["targetId","path"],Kl.documentTargetsIndex="documentTargetsIndex",Kl.documentTargetsKeyPath=["path","targetId"],Kl),Bl=(Hl.key="targetGlobalKey",Hl.store="targetGlobal",Hl),Wl=(zl.store="collectionParents",zl.keyPath=["collectionId","parent"],zl);function zl(t,e){this.collectionId=t,this.parent=e}function Hl(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}function Kl(t,e,n){this.targetId=t,this.path=e,Gr(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}function Ql(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}function Xl(t){t.createObjectStore(Yl.store,{keyPath:Yl.keyPath}).createIndex(Yl.documentTargetsIndex,Yl.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(jl.store,{keyPath:jl.keyPath}).createIndex(jl.queryTargetsIndexName,jl.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Bl.store)}var Jl=($l.store="clientMetadata",$l.keyPath="clientId",$l);function $l(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}var Zl=s(s(s([_l.store,xl.store,Pl.store,ql.store,jl.store,Rl.store,Bl.store,Yl.store],[Jl.store]),[Vl.store]),[Wl.store]),tp=(ep.prototype.Nv=function(t,e){var n=this;if(Gr(e.length%2==1,"Expected a collection path."),this.fw.has(e))return ih.resolve();var r=e.$(),i=e.J();t.us(function(){n.fw.add(e)});var o={collectionId:r,parent:qf(i)};return np(t).put(o)},ep.prototype._s=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[zr(i),""],!1,!0);return np(t)._v(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Gf(r.parent))}return o})},ep);function ep(){this.fw=new El}function np(t){return up.lv(t,Wl.store)}var rp=(ip.prototype.ew=function(t){if(t.document)return this.lw.Dr(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Bi.ft(t.noDocument.path),n=this.dw(t.noDocument.readTime);return new Ls(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=Bi.ft(t.unknownDocument.path),n=this.dw(t.unknownDocument.version),new Ms(e,n)):Fr("Unexpected DbRemoteDocument")},ip.prototype.cw=function(t,e){var n=this.iw(e),r=t.key.path.J().nt();if(t instanceof Ps){var i=t.proto?t.proto:this.lw.Ar(t),o=t.hasCommittedMutations;return new ql(null,null,i,o,n,r)}if(t instanceof Ls){var s=t.key.path.nt(),a=this.vw(t.version);return o=t.hasCommittedMutations,new ql(null,new Ml(s,a),null,o,n,r)}if(t instanceof Ms){s=t.key.path.nt();var u=this.vw(t.version);return new ql(new Ul(s,u),null,null,!0,n,r)}return Fr("Unexpected MaybeDocument")},ip.prototype.iw=function(t){var e=t.q();return[e.seconds,e.nanoseconds]},ip.prototype.rw=function(t){var e=new qi(t[0],t[1]);return Vi.L(e)},ip.prototype.vw=function(t){var e=t.q();return new Dl(e.seconds,e.nanoseconds)},ip.prototype.dw=function(t){var e=new qi(t.seconds,t.nanoseconds);return Vi.L(e)},ip.prototype.Vv=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.lw.xr(t)}),i=e.mutations.map(function(t){return n.lw.xr(t)});return new xl(t,e.batchId,e.Ln.toMillis(),r,i)},ip.prototype.kv=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.lw.Br(t)}),r=t.mutations.map(function(t){return e.lw.Br(t)}),i=qi.fromMillis(t.localWriteTimeMs);return new th(t.batchId,i,n,r)},ip.prototype.ww=function(t){var e=[];return t.forEach(function(t){e.push(qf(t.path))}),e},ip.prototype.mw=function(t){for(var e=su(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new Bi(Gf(i)))}return e},ip.prototype.Wv=function(t){var e,n=this.dw(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.dw(t.lastLimboFreeSnapshotVersion):Vi.MIN;return e=void 0!==t.query.documents?this.lw.Kr(t.query):this.lw.$r(t.query),new za(e,t.targetId,fa.Ni,t.lastListenSequenceNumber,n,r,Ju.fromBase64String(t.resumeToken))},ip.prototype.zv=function(t){Gr(fa.Ni===t.Fi,"Only queries with purpose "+fa.Ni+" may be stored, got "+t.Fi);var e,n=this.vw(t.xi),r=this.vw(t.lastLimboFreeSnapshotVersion);e=t.target.Hn()?this.lw.zr(t.target):this.lw.Hr(t.target);var i=t.resumeToken.toBase64();return new jl(t.targetId,t.target.canonicalId(),n,i,t.sequenceNumber,r,e)},ip);function ip(t){this.lw=t}var op,sp="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",ap=(t(cp,op=ah),cp),up=(hp.lv=function(t,e){if(t instanceof ap)return jf.lv(t.Fv,e);throw Fr("IndexedDbPersistence must use instances of IndexedDbTransaction")},hp.Dw=function(n){return p(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:if(!hp.tl())throw new ti(Zr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(e=new hp(n.allowTabSynchronization,n.persistenceKey,n.clientId,n.platform,n.Pw,n.Gc,n.serializer,n.pw)).start()];case 1:return t.sent(),[2,e]}})})},hp.prototype.start=function(){var e=this;return Gr(!this.Mo,"IndexedDbPersistence double-started!"),Gr(null!==this.window,"Expected 'window' to be defined"),jf.hv(this.Ew,Il,new Tl(this.serializer)).then(function(t){return e.Sw=t,e.Cw()}).then(function(){return e.Vw(),e.Nw(),e.kw(),e.Sw.runTransaction("readonly-idempotent",[Bl.store],function(t){return cl(t)})}).then(function(t){e.Ow=new ch(t,e.pw)}).then(function(){e.gw=!0}).catch(function(t){return e.Sw&&e.Sw.close(),Promise.reject(t)})},hp.prototype.Fw=function(n){var t=this;return this.Tw=function(e){return p(t,void 0,void 0,function(){return v(this,function(t){return this.Mo?[2,n(e)]:[2]})})},n(this.isPrimary)},hp.prototype.xw=function(n){var t=this;this.Sw.dv(function(e){return p(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null!==e.newVersion?[3,2]:[4,n()];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},hp.prototype.hc=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Gc.Ys(function(){return p(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Mo?[4,this.Cw()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},hp.prototype.Cw=function(){var n=this;return this.Sw.runTransaction("readwrite-idempotent",Zl,function(e){return lp(e).put(new Jl(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.jw(e).next(function(t){t||(n.isPrimary=!1,n.Gc.Ys(function(){return n.Tw(!1)}))})}).next(function(){return n.Uw(e)}).next(function(t){return n.isPrimary&&!t?n.Lw(e).next(function(){return!1}):!!t&&n.Bw(e).next(function(){return!0})})}).catch(function(t){if(!n.allowTabSynchronization)throw t;return Ur("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.Gc.Ys(function(){return n.Tw(t)}),n.isPrimary=t})},hp.prototype.jw=function(t){var e=this;return fp(t).get(Rl.key).next(function(t){return ih.resolve(e.Mw(t))})},hp.prototype.qw=function(t){return lp(t).delete(this.clientId)},hp.prototype.Qw=function(){return p(this,void 0,void 0,function(){var i=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.Gw(this.Iw,18e5)?[3,2]:(this.Iw=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary-idempotent",function(t){var r=hp.lv(t,Jl.store);return r._v().next(function(t){var e=i.Ww(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return ih.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:t.sent().forEach(function(t){i.window.localStorage.removeItem(i.zw(t.clientId))}),t.label=2;case 2:return[2]}})})},hp.prototype.kw=function(){var t=this;this._w=this.Gc.co(Qu.Us,4e3,function(){return t.Cw().then(function(){return t.Qw()}).then(function(){return t.kw()})})},hp.prototype.Mw=function(t){return!!t&&t.ownerId===this.clientId},hp.prototype.Uw=function(e){var i=this;return fp(e).get(Rl.key).next(function(t){if(null!==t&&i.Gw(t.leaseTimestampMs,5e3)&&!i.Kw(t.ownerId)){if(i.Mw(t)&&i.networkEnabled)return!0;if(!i.Mw(t)){if(!t.allowTabSynchronization)throw new ti(Zr.FAILED_PRECONDITION,sp);return!1}}return!(!i.networkEnabled||!i.inForeground)||lp(e)._v().next(function(t){return void 0===i.Ww(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Ur("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},hp.prototype.Rf=function(){return p(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.gw=!1,this.Hw(),this._w&&(this._w.cancel(),this._w=null),this.Jw(),this.Yw(),[4,this.Sw.runTransaction("readwrite-idempotent",[Rl.store,Jl.store],function(t){return e.Lw(t).next(function(){return e.qw(t)})})];case 1:return t.sent(),this.Sw.close(),this.Xw(),[2]}})})},hp.prototype.Ww=function(t,e){var n=this;return t.filter(function(t){return n.Gw(t.updateTimeMs,e)&&!n.Kw(t.clientId)})},hp.prototype.uc=function(){var e=this;return this.Sw.runTransaction("readonly-idempotent",[Jl.store],function(t){return lp(t)._v().next(function(t){return e.Ww(t,18e5).map(function(t){return t.clientId})})})},hp.clearPersistence=function(n){return p(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return hp.tl()?(e=n+hp.Rw,[4,jf.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(hp.prototype,"Mo",{get:function(){return this.gw},enumerable:!0,configurable:!0}),hp.prototype.sh=function(t){return Gr(this.Mo,"Cannot initialize MutationQueue before persistence is started."),Zf.Pv(t,this.serializer,this.cs,this.uh)},hp.prototype.fh=function(){return Gr(this.Mo,"Cannot initialize TargetCache before persistence is started."),this.ah},hp.prototype.hh=function(){return Gr(this.Mo,"Cannot initialize RemoteDocumentCache before persistence is started."),this.os},hp.prototype.dh=function(){return Gr(this.Mo,"Cannot initialize IndexManager before persistence is started."),this.cs},hp.prototype.runTransaction=function(n,t,r){var i=this;Ur("IndexedDbPersistence","Starting transaction:",n);var o,e=t.endsWith("idempotent"),s=t.startsWith("readonly")?e?"readonly-idempotent":"readonly":e?"readwrite-idempotent":"readwrite";return this.Sw.runTransaction(s,Zl,function(e){return o=new ap(e,i.Ow.next()),"readwrite-primary"===t||"readwrite-primary-idempotent"===t?i.jw(e).next(function(t){return!!t||i.Uw(e)}).next(function(t){if(!t)throw qr("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.Gc.Ys(function(){return i.Tw(!1)}),new ti(Zr.FAILED_PRECONDITION,sh);return r(o)}).next(function(t){return i.Bw(e).next(function(){return t})}):i.$w(e).next(function(){return r(o)})}).then(function(t){return o.ss(),t})},hp.prototype.$w=function(t){var e=this;return fp(t).get(Rl.key).next(function(t){if(null!==t&&e.Gw(t.leaseTimestampMs,5e3)&&!e.Kw(t.ownerId)&&!e.Mw(t)&&!t.allowTabSynchronization)throw new ti(Zr.FAILED_PRECONDITION,sp)})},hp.prototype.Bw=function(t){var e=new Rl(this.clientId,this.allowTabSynchronization,Date.now());return fp(t).put(Rl.key,e)},hp.tl=function(){return jf.tl()},hp.Zw=function(t){var e=t.s.projectId;return t.s.o||(e+="."+t.s.database),"firestore/"+t.persistenceKey+"/"+e+"/"},hp.prototype.Lw=function(t){var e=this,n=fp(t);return n.get(Rl.key).next(function(t){return e.Mw(t)?(Ur("IndexedDbPersistence","Releasing primary lease."),n.delete(Rl.key)):ih.resolve()})},hp.prototype.Gw=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(qr("Detected an update time that is in the future: "+t+" > "+n),1))},hp.prototype.Vw=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.yw=function(){t.Gc.Ys(function(){return t.inForeground="visible"===t.document.visibilityState,t.Cw()})},this.document.addEventListener("visibilitychange",this.yw),this.inForeground="visible"===this.document.visibilityState)},hp.prototype.Jw=function(){this.yw&&(Gr(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.yw),this.yw=null)},hp.prototype.Nw=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.bw=function(){t.Hw(),t.Gc.Ys(function(){return t.Rf()})},this.window.addEventListener("unload",this.bw))},hp.prototype.Yw=function(){this.bw&&(Gr("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.bw),this.bw=null)},hp.prototype.Kw=function(t){try{var e=null!==this.Aw.getItem(this.zw(t));return Ur("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return qr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},hp.prototype.Hw=function(){try{this.Aw.setItem(this.zw(this.clientId),String(Date.now()))}catch(t){qr("Failed to set zombie client id.",t)}},hp.prototype.Xw=function(){try{this.Aw.removeItem(this.zw(this.clientId))}catch(t){}},hp.prototype.zw=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},hp.Rw="main",hp);function hp(t,e,n,r,i,o,s,a){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Gc=o,this.pw=a,this.gw=!1,this.isPrimary=!1,this.networkEnabled=!0,this.bw=null,this.inForeground=!1,this.yw=null,this._w=null,this.Iw=Number.NEGATIVE_INFINITY,this.Tw=function(t){return Promise.resolve()},this.uh=new pp(this,i),this.Ew=e+hp.Rw,this.serializer=new rp(s),this.document=r.document,this.ah=new sl(this.uh,this.serializer),this.cs=new tp,this.os=new pl(this.serializer,this.cs),!r.window||!r.window.localStorage)throw new ti(Zr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.Aw=this.window.localStorage}function cp(t,e){var n=op.call(this)||this;return n.Fv=t,n.Bh=e,n}function fp(t){return t.store(Rl.store)}function lp(t){return t.store(Jl.store)}var pp=(dp.prototype.Wo=function(t){var n=this.nm(t);return this.db.fh().Kv(t).next(function(e){return n.next(function(t){return e+t})})},dp.prototype.nm=function(t){var e=0;return this.Ko(t,function(t){e++}).next(function(){return e})},dp.prototype.qe=function(t,e){return this.db.fh().qe(t,e)},dp.prototype.Ko=function(t,n){return this.im(t,function(t,e){return n(e)})},dp.prototype.rh=function(t){this.tm=t},dp.prototype.Du=function(t,e){return vp(t,e)},dp.prototype.Su=function(t,e){return vp(t,e)},dp.prototype.Ho=function(t,e,n){return this.db.fh().Ho(t,e,n)},dp.prototype.xv=function(t,e){return vp(t,e)},dp.prototype.em=function(t,e){return this.tm.Fu(e)?ih.resolve(!0):(r=e,i=!1,ol(n=t).Av(function(t){return el(n,t,r).next(function(t){return t&&(i=!0),ih.resolve(!t)})}).next(function(){return i}));var n,r,i},dp.prototype.Jo=function(r,i){var o=this,s=this.db.hh().Ah(),a=[],u=0;return this.im(r,function(e,t){if(t<=i){var n=o.em(r,e).next(function(t){if(!t)return u++,s.Zu(r,e).next(function(){return s.$u(e),fl(r).delete([0,qf(e.path)])})});a.push(n)}}).next(function(){return ih.Wu(a)}).next(function(){return s.apply(r)}).next(function(){return u})},dp.prototype.removeTarget=function(t,e){var n=e.ji(t.Bh);return this.db.fh().qh(t,n)},dp.prototype.Qh=function(t,e){return vp(t,e)},dp.prototype.im=function(t,o){var s,e=fl(t),a=ch.Vs;return e.Rv({index:Yl.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(a!==ch.Vs&&o(new Bi(Gf(s)),a),a=i,s=r):a=ch.Vs}).next(function(){a!==ch.Vs&&o(new Bi(Gf(s)),a)})},dp.prototype.Xo=function(t){return this.db.hh().sw(t)},dp);function dp(t,e){this.db=t,this.tm=null,this.Fo=new Ch(this,e)}function vp(t,e){return fl(t).put((n=e,r=t.Bh,new Yl(0,qf(n.path),r)));var n,r}var yp=(wp.prototype.vh=function(t){this.rm=t},wp.prototype.ps=function(e,r,i,o){var s=this;return Gr(void 0!==this.rm,"setLocalDocumentsView() not called"),r.di()?this.um(e,r):i.isEqual(Vi.MIN)?this.um(e,r):this.rm.vs(e,o).next(function(t){var n=s.sm(r,t);return(r.yi()||r._i())&&s.$l(r.$n,n,o,i)?s.um(e,r):(Lr()<=Ar.DEBUG&&Ur("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),r.toString()),s.rm.ps(e,r,i).next(function(e){return n.forEach(function(t){e=e.dt(t.key,t)}),e}))})},wp.prototype.sm=function(n,t){var r=new so(function(t,e){return n.wi(t,e)});return t.forEach(function(t,e){e instanceof Ps&&n.matches(e)&&(r=r.add(e))}),r},wp.prototype.$l=function(t,e,n,r){if(n.size!==e.size)return!0;var i=t===ra.Jn?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.h(r))},wp.prototype.um=function(t,e){return Lr()<=Ar.DEBUG&&Ur("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.rm.ps(t,e,Vi.MIN)},wp),mp=(gp.prototype.Sv=function(t){return ih.resolve(0===this.hs.length)},gp.prototype.Rh=function(t,e,n){var r=e.batchId,i=this.cm(r,"acknowledged");Gr(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.hs[i];return Gr(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,ih.resolve()},gp.prototype.Oh=function(t){return ih.resolve(this.lastStreamToken)},gp.prototype.Fh=function(t,e){return this.lastStreamToken=e,ih.resolve()},gp.prototype.Ih=function(t,e,n,r){Gr(0!==r.length,"Mutation batches should not be empty");var i=this.om;this.om++,0<this.hs.length&&Gr(this.hs[this.hs.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new th(i,e,n,r);this.hs.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.hm=this.hm.add(new rh(u.key,i)),this.cs.Nv(t,u.key.path.J())}return ih.resolve(o)},gp.prototype.Vh=function(t,e){return ih.resolve(this.am(e))},gp.prototype.Eh=function(t,e){var n=this.am(e);return Gr(null!=n,"Failed to find local mutation batch."),ih.resolve(n.keys())},gp.prototype.Hh=function(t,e){var n=e+1,r=this.fm(n),i=r<0?0:r;return ih.resolve(this.hs.length>i?this.hs[i]:null)},gp.prototype.kh=function(){return ih.resolve(0===this.hs.length?-1:this.om-1)},gp.prototype.ph=function(t){return ih.resolve(this.hs.slice())},gp.prototype.fs=function(t,n){var r=this,e=new rh(n,0),i=new rh(n,Number.POSITIVE_INFINITY),o=[];return this.hm.Mt([e,i],function(t){Gr(n.isEqual(t.key),"Should only iterate over a single key's batches");var e=r.am(t.xu);Gr(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),ih.resolve(o)},gp.prototype.ms=function(t,e){var r=this,i=new so(Br);return e.forEach(function(e){var t=new rh(e,0),n=new rh(e,Number.POSITIVE_INFINITY);r.hm.Mt([t,n],function(t){Gr(e.isEqual(t.key),"For each key, should only iterate over a single key's batches"),i=i.add(t.xu)})}),ih.resolve(this.lm(i))},gp.prototype.Is=function(t,e){Gr(!e.Ti(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;Bi.ct(i)||(i=i.child(""));var o=new rh(new Bi(i),0),s=new so(Br);return this.hm.qt(function(t){var e=t.key.path;return!!n.Z(e)&&(e.length===r&&(s=s.add(t.xu)),!0)},o),ih.resolve(this.lm(s))},gp.prototype.lm=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.am(t);null!==e&&r.push(e)}),r},gp.prototype.Nh=function(n,r){var i=this;Gr(0===this.cm(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.hs.shift();var o=this.hm;return ih.forEach(r.mutations,function(t){var e=new rh(t.key,r.batchId);return o=o.delete(e),i.uh.xv(n,t.key)}).next(function(){i.hm=o})},gp.prototype.oc=function(t){},gp.prototype.Fu=function(t,e){var n=new rh(e,0),r=this.hm.Qt(n);return ih.resolve(e.isEqual(r&&r.key))},gp.prototype.Sh=function(t){return 0===this.hs.length&&Gr(this.hm.Y(),"Document leak -- detected dangling mutation references when queue is empty."),ih.resolve()},gp.prototype.cm=function(t,e){var n=this.fm(t);return Gr(0<=n&&n<this.hs.length,"Batches must exist to be "+e),n},gp.prototype.fm=function(t){return 0===this.hs.length?0:t-this.hs[0].batchId},gp.prototype.am=function(t){var e=this.fm(t);if(e<0||e>=this.hs.length)return null;var n=this.hs[e];return Gr(n.batchId===t,"If found batch must match"),n},gp);function gp(t,e){this.cs=t,this.uh=e,this.hs=[],this.om=1,this.lastStreamToken=Ya(),this.hm=new so(rh.qn)}function wp(){}function bp(){}var Ep,Ip,Tp=(Fp.prototype.Yu=function(t,e,n){Gr(!n.isEqual(Vi.MIN),"Cannot add a document with a read time of zero");var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.dm(e);return this.docs=this.docs.dt(r,{Xv:e,size:s,readTime:n}),this.size+=s-o,this.cs.Nv(t,r.path.J())},Fp.prototype.$u=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Fp.prototype.Zu=function(t,e){var n=this.docs.get(e);return ih.resolve(n?n.Xv:null)},Fp.prototype.getEntries=function(t,e){var n=this,r=tu();return e.forEach(function(t){var e=n.docs.get(t);r=r.dt(t,e?e.Xv:null)}),ih.resolve(r)},Fp.prototype.ps=function(t,e,n){Gr(!e.Ti(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=nu(),i=new Bi(e.path.child("")),o=this.docs.It(i);o.Pt();){var s=o.Dt(),a=s.key,u=s.value,h=u.Xv,c=u.readTime;if(!e.path.Z(a.path))break;c.h(n)<=0||h instanceof Ps&&e.matches(h)&&(r=r.dt(h.key,h))}return ih.resolve(r)},Fp.prototype.vm=function(t,e){return ih.forEach(this.docs,function(t){return e(t)})},Fp.prototype.ac=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},Fp.prototype.lc=function(t){return ih.resolve(Vi.MIN)},Fp.prototype.Ah=function(t){return new Fp.uw(this)},Fp.prototype.sw=function(t){return ih.resolve(this.size)},Fp.uw=(t(Gp,Ip=oh),Gp.prototype.es=function(n){var r=this,i=[];return this.Ku.forEach(function(t,e){e?i.push(r.ow.Yu(n,e,r.readTime)):r.ow.$u(t)}),ih.Wu(i)},Gp.prototype.ts=function(t,e){return this.ow.Zu(t,e)},Gp.prototype.ns=function(t,e){return this.ow.getEntries(t,e)},Gp),Fp),Np=(Vp.prototype.qe=function(t,n){return this.wm.forEach(function(t,e){return n(e)}),ih.resolve()},Vp.prototype.xh=function(t){return ih.resolve(this.lastRemoteSnapshotVersion)},Vp.prototype.Bv=function(t){return ih.resolve(this.mm)},Vp.prototype.$h=function(t){var e=this.jv.after(this.highestTargetId);return this.highestTargetId=e,ih.resolve(e)},Vp.prototype.Gh=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.mm&&(this.mm=e),ih.resolve()},Vp.prototype.Mv=function(t){this.wm.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.mm&&(this.mm=t.sequenceNumber)},Vp.prototype.Zh=function(t,e){return Gr(!this.wm.has(e.target),"Adding a target that already exists"),this.Mv(e),this.targetCount+=1,ih.resolve()},Vp.prototype.qh=function(t,e){return Gr(this.wm.has(e.target),"Updating a non-existent target"),this.Mv(e),ih.resolve()},Vp.prototype.Qv=function(t,e){return Gr(0<this.targetCount,"Removing a target from an empty cache"),Gr(this.wm.has(e.target),"Removing a non-existent target from the cache"),this.wm.delete(e.target),this.pm.Nu(e.targetId),this.targetCount-=1,ih.resolve()},Vp.prototype.Ho=function(n,r,i){var o=this,s=0,a=[];return this.wm.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.wm.delete(t),a.push(o.Gv(n,e.targetId)),s++)}),ih.Wu(a).next(function(){return s})},Vp.prototype.Kv=function(t){return ih.resolve(this.targetCount)},Vp.prototype.Xh=function(t,e){var n=this.wm.get(e)||null;return ih.resolve(n)},Vp.prototype.Ze=function(t,e){return Fr("Not yet implemented.")},Vp.prototype.Lh=function(e,t,n){this.pm.Pu(t,n);var r=this.persistence.uh,i=[];return r&&t.forEach(function(t){i.push(r.Du(e,t))}),ih.Wu(i)},Vp.prototype.Uh=function(e,t,n){this.pm.Vu(t,n);var r=this.persistence.uh,i=[];return r&&t.forEach(function(t){i.push(r.Su(e,t))}),ih.Wu(i)},Vp.prototype.Gv=function(t,e){return this.pm.Nu(e),ih.resolve()},Vp.prototype.ic=function(t,e){var n=this.pm.Ou(e);return ih.resolve(n)},Vp.prototype.Fu=function(t,e){return ih.resolve(this.pm.Fu(e))},Vp),Ap=(qp.ym=function(t,e){return new qp(t,function(t){return new Rp(t,e)})},qp._m=function(t){return new qp(t,function(t){return new Dp(t)})},qp.prototype.Rf=function(){return this.gw=!1,Promise.resolve()},Object.defineProperty(qp.prototype,"Mo",{get:function(){return this.gw},enumerable:!0,configurable:!0}),qp.prototype.uc=function(){return p(this,void 0,void 0,function(){return v(this,function(t){return[2,[this.clientId]]})})},qp.prototype.Fw=function(t){return t(!0)},qp.prototype.xw=function(){},qp.prototype.hc=function(t){},qp.prototype.dh=function(){return this.cs},qp.prototype.sh=function(t){var e=this.gm[t.v()];return e||(e=new mp(this.cs,this.uh),this.gm[t.v()]=e),e},qp.prototype.fh=function(){return this.ah},qp.prototype.hh=function(){return this.os},qp.prototype.runTransaction=function(t,e,n){var r=this;Ur("MemoryPersistence","Starting transaction:",t);var i=new Sp(this.Ow.next());return this.uh.Im(),n(i).next(function(t){return r.uh.Tm(i).next(function(){return t})}).Qu().then(function(t){return i.ss(),t})},qp.prototype.Em=function(e,n){return ih.zu((t=this.gm,r=[],vi(t,function(t,e){return r.push(e)}),r).map(function(t){return function(){return t.Fu(e,n)}}));var t,r},qp),Sp=(t(Up,Ep=ah),Up),Dp=(Object.defineProperty(Mp.prototype,"Am",{get:function(){if(this.Rm)return this.Rm;throw Fr("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),Mp.prototype.rh=function(t){this.tm=t},Mp.prototype.Du=function(t,e){return this.Am.delete(e),ih.resolve()},Mp.prototype.Su=function(t,e){return this.Am.add(e),ih.resolve()},Mp.prototype.xv=function(t,e){return this.Am.add(e),ih.resolve()},Mp.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.fh();return r.ic(t,e.targetId).next(function(t){t.forEach(function(t){return n.Am.add(t)})}).next(function(){return r.Qv(t,e)})},Mp.prototype.Im=function(){this.Rm=new Set},Mp.prototype.Tm=function(t){var n=this,r=this.persistence.hh().Ah();return ih.forEach(this.Am,function(e){return n.Dm(t,e).next(function(t){t||r.$u(e)})}).next(function(){return n.Rm=null,r.apply(t)})},Mp.prototype.Qh=function(t,e){var n=this;return this.Dm(t,e).next(function(t){t?n.Am.delete(e):n.Am.add(e)})},Mp.prototype.bm=function(t){return 0},Mp.prototype.Dm=function(t,e){var n=this;return ih.zu([function(){return n.persistence.fh().Fu(t,e)},function(){return n.persistence.Em(t,e)},function(){return ih.resolve(n.tm.Fu(e))}])},Mp),Rp=(Lp.prototype.Im=function(){},Lp.prototype.Tm=function(t){return ih.resolve()},Lp.prototype.qe=function(t,e){return this.persistence.fh().qe(t,e)},Lp.prototype.Wo=function(t){var n=this.Sm(t);return this.persistence.fh().Kv(t).next(function(e){return n.next(function(t){return e+t})})},Lp.prototype.Sm=function(t){var e=0;return this.Ko(t,function(t){e++}).next(function(){return e})},Lp.prototype.Ko=function(n,r){var i=this;return ih.forEach(this.Pm,function(t,e){return i.em(n,t,e).next(function(t){return t?ih.resolve():r(e)})})},Lp.prototype.rh=function(t){this.tm=t},Lp.prototype.Ho=function(t,e,n){return this.persistence.fh().Ho(t,e,n)},Lp.prototype.Jo=function(t,n){var r=this,i=0,e=this.persistence.hh(),o=e.Ah();return e.vm(t,function(e){return r.em(t,e,n).next(function(t){t||(i++,o.$u(e))})}).next(function(){return o.apply(t)}).next(function(){return i})},Lp.prototype.xv=function(t,e){return this.Pm.set(e,t.Bh),ih.resolve()},Lp.prototype.removeTarget=function(t,e){var n=e.ji(t.Bh);return this.persistence.fh().qh(t,n)},Lp.prototype.Du=function(t,e){return this.Pm.set(e,t.Bh),ih.resolve()},Lp.prototype.Su=function(t,e){return this.Pm.set(e,t.Bh),ih.resolve()},Lp.prototype.Qh=function(t,e){return this.Pm.set(e,t.Bh),ih.resolve()},Lp.prototype.bm=function(t){var e=t.key.toString().length;return t instanceof Ps&&(e+=t.data().On()),e},Lp.prototype.em=function(t,e,n){var r=this;return ih.zu([function(){return r.persistence.Em(t,e)},function(){return ih.resolve(r.tm.Fu(e))},function(){return r.persistence.fh().Fu(t,e)},function(){var t=r.Pm.get(e);return ih.resolve(void 0!==t&&n<t)}])},Lp.prototype.Xo=function(t){return this.persistence.hh().sw(t)},Lp),kp=(Pp.prototype.Pw=function(){return _h.Po(this.cacheSizeBytes)},Pp),_p=(Op.prototype.start=function(t){var n=this;this.Vm();var r=new Ku,i=new Ku,o=!1;return this.credentials.T(function(e){o?n.Ms.Ys(function(){return n.Qf(e)}):(o=!0,n.Nm(t,i,e).then(function(t){return n.km(e,t)}).then(r.resolve,r.reject))}),this.Ms.Ys(function(){return r.promise}),i.promise},Op.prototype.enableNetwork=function(){var t=this;return this.Vm(),this.Ms.enqueue(function(){return t.Sf.enableNetwork()})},Op.prototype.Nm=function(t,e,n){var r=this;return t instanceof kp?this.Om(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.Fm(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.xm()}):(e.resolve(),this.xm())},Op.prototype.Fm=function(t){return t instanceof ti?t.code===Zr.FAILED_PRECONDITION||t.code===Zr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Op.prototype.Vm=function(){if(this.Ms.eo)throw new ti(Zr.FAILED_PRECONDITION,"The client has already been terminated.")},Op.prototype.Om=function(r,i){var t=this,o=up.Zw(this.Cm),s=new Gu(this.Cm.s,{ir:!0});return Promise.resolve().then(function(){return p(t,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:if(i.synchronizeTabs&&!sf.tl(this.platform))throw new ti(Zr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return e=i.Pw(),this.md=i.synchronizeTabs?new sf(this.Ms,this.platform,o,this.clientId,r):new vf,[4,up.Dw({allowTabSynchronization:i.synchronizeTabs,persistenceKey:o,clientId:this.clientId,platform:this.platform,Gc:this.Ms,serializer:s,Pw:e,pw:this.md})];case 1:return n=t.sent(),[2,(this.persistence=n).uh.Fo]}})})})},Op.prototype.xm=function(){return this.persistence=Ap._m(this.clientId),this.md=new vf,Promise.resolve(null)},Op.prototype.km=function(h,c){var t=this;return Ur("FirestoreClient","Initializing. user=",h.uid),this.platform.jm(this.Cm).then(function(u){return p(t,void 0,void 0,function(){var e,n,r,i,o,s,a=this;return v(this,function(t){switch(t.label){case 0:return e=new yp,this.xo=new Ph(this.persistence,e,h),[4,this.xo.start()];case 1:return t.sent(),c&&(this.Um=new xh(c,this.Ms,this.xo)),n=this.platform.Lm(),r=this.platform.Bm(this.Cm.s),i=new Lc(this.Ms,u,this.credentials,r),o=function(t){return a.Sf.ed(t,ha.Ci)},s=function(t){return a.Sf.ed(t,ha.Vi)},this.od=new Vc(this.xo,i,this.Ms,o,n),this.Sf=new Df(this.xo,this.od,this.md,h),this.md.Ha=s,this.od.Sf=this.Sf,this.md.Sf=this.Sf,this.Mm=new Rf(this.Sf),[4,this.md.start()];case 2:return t.sent(),[4,this.od.start()];case 3:return t.sent(),[4,this.persistence.Fw(function(e){return p(a,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.Sf.Gf(e)];case 1:return t.sent(),this.Um&&(e&&!this.Um.Mo?this.Um.start():e||this.Um.stop()),[2]}})})})];case 4:return t.sent(),[4,this.persistence.xw(function(){return p(a,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})})];case 5:return t.sent(),[2]}})})})},Op.prototype.Qf=function(t){return this.Ms.fo(),Ur("FirestoreClient","Credential Changed. Current user: "+t.uid),this.Sf.Qf(t)},Op.prototype.disableNetwork=function(){var t=this;return this.Vm(),this.Ms.enqueue(function(){return t.Sf.disableNetwork()})},Op.prototype.terminate=function(){var t=this;return this.Ms.ho(function(){return p(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Um&&this.Um.stop(),[4,this.od.Rf()];case 1:return t.sent(),[4,this.md.Rf()];case 2:return t.sent(),[4,this.persistence.Rf()];case 3:return t.sent(),this.credentials.R(),[2]}})})})},Op.prototype.waitForPendingWrites=function(){var t=this;this.Vm();var e=new Ku;return this.Ms.Ys(function(){return t.Sf.jd(e)}),e.promise},Op.prototype.listen=function(t,e,n){var r=this;this.Vm();var i=new kf(t,e,n);return this.Ms.Ys(function(){return r.Mm.listen(i)}),i},Op.prototype.Df=function(t){var e=this;this.qm||this.Ms.Ys(function(){return e.Mm.Df(t)})},Op.prototype.Qm=function(t){var e=this;return this.Vm(),this.Ms.enqueue(function(){return e.xo.Jh(t)}).then(function(t){if(t instanceof Ps)return t;if(t instanceof Ls)return null;throw new ti(Zr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},Op.prototype.Gm=function(i){var t=this;return this.Vm(),this.Ms.enqueue(function(){return p(t,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return[4,this.xo.nc(i,!0)];case 1:return e=t.sent(),n=new bf(i,e.ec),r=n.Jl(e.documents),[2,n.es(r,!1).snapshot]}})})})},Op.prototype.write=function(t){var e=this;this.Vm();var n=new Ku;return this.Ms.Ys(function(){return e.Sf.write(t,n)}),n.promise},Op.prototype.s=function(){return this.Cm.s},Op.prototype.$d=function(t){var e=this;this.Vm(),this.Ms.Ys(function(){return e.Mm.$d(t),Promise.resolve()})},Op.prototype.Zd=function(t){this.qm||this.Mm.Zd(t)},Object.defineProperty(Op.prototype,"qm",{get:function(){return this.Ms.eo},enumerable:!0,configurable:!0}),Op.prototype.transaction=function(t){var e=this;this.Vm();var n=new Ku;return this.Ms.Ys(function(){return e.Sf.runTransaction(e.Ms,t,n),Promise.resolve()}),n.promise},Op),xp=(Cp.prototype.next=function(t){this.Wm(this.observer.next,t)},Cp.prototype.error=function(t){this.Wm(this.observer.error,t)},Cp.prototype.zm=function(){this.muted=!0},Cp.prototype.Wm=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Cp);function Cp(t){this.observer=t,this.muted=!1}function Op(t,e,n,r){this.platform=t,this.Cm=e,this.credentials=n,this.Ms=r,this.clientId=jr.u()}function Pp(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}function Lp(t,e){this.persistence=t,this.tm=null,this.Pm=new Zu(function(t){return qf(t.path)}),this.Fo=new Ch(this,e)}function Mp(t){this.persistence=t,this.tm=null,this.Rm=null}function Up(t){var e=Ep.call(this)||this;return e.Bh=t,e}function qp(t,e){var n=this;this.clientId=t,this.gm={},this.Ow=new ch(0),this.gw=!1,this.gw=!0,this.uh=e(this),this.ah=new Np(this),this.cs=new bl,this.os=new Tp(this.cs,function(t){return n.uh.bm(t)})}function Vp(t){this.persistence=t,this.wm=new Zu(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Vi.MIN,this.highestTargetId=0,this.mm=0,this.pm=new nh,this.targetCount=0,this.jv=wf.ql()}function Fp(t,e){this.cs=t,this.dm=e,this.docs=new Wi(Bi.W),this.size=0}function Gp(t){var e=Ip.call(this)||this;return e.ow=t,e}function jp(i){return function(){if("object"!=typeof i||null===i)return!1;for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return!0}return!1}()}var Yp,Bp=_h.Vo,Wp=(cd.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},cd),zp=(hd.prototype.settings=function(t){if(gi("Firestore.settings",arguments,1),Ei("Firestore.settings","object",1,t),li(t,"persistence"))throw new ti(Zr.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new Wp(t);if(this.Ym&&!this.np.isEqual(e))throw new ti(Zr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.np=e).credentials&&(this.tp=function(t){if(!t)return new ei;switch(t.type){case"gapi":var e=t.k;return Gr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new ii(e,t.V||"0");case"provider":return t.k;default:throw new ti(Zr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},hd.prototype.enableNetwork=function(){return this.Jm(),this.Ym.enableNetwork()},hd.prototype.disableNetwork=function(){return this.Jm(),this.Ym.disableNetwork()},hd.prototype.enablePersistence=function(t){if(this.Ym)throw new ti(Zr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&qr("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=pi(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.rp(new kp(this.np.cacheSizeBytes,e))},hd.prototype.clearPersistence=function(){var t=this,n=up.Zw(this.up()),r=new Ku;return this.Hm.ro(function(){return p(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,,3]),void 0!==this.Ym&&!this.Ym.qm)throw new ti(Zr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,up.clearPersistence(n)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise},hd.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(hd.prototype,"sp",{get:function(){return this.Jm(),this.Ym.qm},enumerable:!0,configurable:!0}),hd.prototype.waitForPendingWrites=function(){return this.Jm(),this.Ym.waitForPendingWrites()},hd.prototype.onSnapshotsInSync=function(t){if(this.Jm(),jp(t))return this.hp(t);Ei("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.hp(e)},hd.prototype.hp=function(t){var e=this,n=new xp({next:function(){t.next&&t.next()},error:function(t){throw Fr("Uncaught Error in onSnapshotsInSync")}});return this.Ym.$d(n),function(){n.zm(),e.Ym.Zd(n)}},hd.prototype.Jm=function(){return this.Ym||this.rp(new bp),this.Ym},hd.prototype.up=function(){return new Hr(this.Xm,this.Zm,this.np.host,this.np.ssl,this.np.forceLongPolling)},hd.prototype.rp=function(t){Gr(!!this.np.host,"FirestoreSettings.host is not set"),Gr(!this.Ym,"configureClient() called multiple times");var e=this.up();return this.Ym=new _p(ju.t(),e,this.tp,this.Hm),this.Ym.start(t)},hd.prototype.ep=function(r){return new gc(function(t){if(t instanceof Qp){var e=r,n=t.firestore.Xm;if(!n.isEqual(e))throw new ti(Zr.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new mc(r,t.cp)}return t})},hd.$m=function(t){var e=t.options;if(!li(e,"projectId"))throw new ti(Zr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new ti(Zr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Jr(n)},Object.defineProperty(hd.prototype,"app",{get:function(){if(!this.Km)throw new ti(Zr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Km},enumerable:!0,configurable:!0}),hd.prototype.collection=function(t){return gi("Firestore.collection",arguments,1),Ei("Firestore.collection","non-empty string",1,t),this.Jm(),new ld(Gi.et(t),this)},hd.prototype.doc=function(t){return gi("Firestore.doc",arguments,1),Ei("Firestore.doc","non-empty string",1,t),this.Jm(),Qp.ap(Gi.et(t),this)},hd.prototype.collectionGroup=function(t){if(gi("Firestore.collectionGroup",arguments,1),Ei("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new ti(Zr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.Jm(),new Zp(new wa(Gi.rt,t),this)},hd.prototype.runTransaction=function(e){var n=this;return gi("Firestore.runTransaction",arguments,1),Ei("Firestore.runTransaction","function",1,e),this.Jm().transaction(function(t){return e(new Hp(n,t))})},hd.prototype.batch=function(){return this.Jm(),new Kp(this)},Object.defineProperty(hd,"logLevel",{get:function(){switch(Lr()){case Ar.DEBUG:return"debug";case Ar.ERROR:return"error";case Ar.SILENT:return"silent";default:return Fr("Unknown log level: "+Lr())}},enumerable:!0,configurable:!0}),hd.setLogLevel=function(t){switch(gi("Firestore.setLogLevel",arguments,1),Ei("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Mr(Ar.DEBUG);break;case"error":Mr(Ar.ERROR);break;case"silent":Mr(Ar.SILENT);break;default:throw new ti(Zr.INVALID_ARGUMENT,"Invalid log level: "+t)}},hd.prototype.fp=function(){return this.np.timestampsInSnapshots},hd),Hp=(ud.prototype.get=function(t){var n=this;gi("Transaction.get",arguments,1);var r=md("Transaction.get",t,this.lp);return this.dp.Ua([r.cp]).then(function(t){if(!t||1!==t.length)return Fr("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof Ls)return new Jp(n.lp,r.cp,null,!1,!1,r.vp);if(e instanceof Ps)return new Jp(n.lp,r.cp,e,!1,!1,r.vp);throw Fr("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},ud.prototype.set=function(t,e,n){bi("Transaction.set",arguments,2,3);var r=md("Transaction.set",t,this.lp);n=dd("Transaction.set",n);var i=gd(r.vp,e,"Transaction.set"),o=i[0],s=i[1],a=n.merge||n.mergeFields?this.lp.ip.Oc(s,o,n.mergeFields):this.lp.ip.Nc(s,o);return this.dp.set(r.cp,a),this},ud.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof Gh?(wi("Transaction.update",arguments,3),r=md("Transaction.update",t,this.lp),this.lp.ip.jc("Transaction.update",e,n,o)):(gi("Transaction.update",arguments,2),r=md("Transaction.update",t,this.lp),this.lp.ip.Fc("Transaction.update",e)),this.dp.update(r.cp,i),this},ud.prototype.delete=function(t){gi("Transaction.delete",arguments,1);var e=md("Transaction.delete",t,this.lp);return this.dp.delete(e.cp),this},ud),Kp=(ad.prototype.set=function(t,e,n){bi("WriteBatch.set",arguments,2,3),this.pp();var r=md("WriteBatch.set",t,this.lp);n=dd("WriteBatch.set",n);var i=gd(r.vp,e,"WriteBatch.set"),o=i[0],s=i[1],a=n.merge||n.mergeFields?this.lp.ip.Oc(s,o,n.mergeFields):this.lp.ip.Nc(s,o);return this.wp=this.wp.concat(a.gc(r.cp,Mo.NONE)),this},ad.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.pp(),i="string"==typeof e||e instanceof Gh?(wi("WriteBatch.update",arguments,3),r=md("WriteBatch.update",t,this.lp),this.lp.ip.jc("WriteBatch.update",e,n,o)):(gi("WriteBatch.update",arguments,2),r=md("WriteBatch.update",t,this.lp),this.lp.ip.Fc("WriteBatch.update",e)),this.wp=this.wp.concat(i.gc(r.cp,Mo.exists(!0))),this},ad.prototype.delete=function(t){gi("WriteBatch.delete",arguments,1),this.pp();var e=md("WriteBatch.delete",t,this.lp);return this.wp=this.wp.concat(new Go(e.cp,Mo.NONE)),this},ad.prototype.commit=function(){return p(this,void 0,void 0,function(){return v(this,function(t){return this.pp(),this.mp=!0,0<this.wp.length?[2,this.lp.Jm().write(this.wp)]:[2]})})},ad.prototype.pp=function(){if(this.mp)throw new ti(Zr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},ad),Qp=(sd.ap=function(t,e,n){if(t.length%2!=0)throw new ti(Zr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.it()+" has "+t.length);return new sd(new Bi(t),e,n)},Object.defineProperty(sd.prototype,"id",{get:function(){return this.cp.path.$()},enumerable:!0,configurable:!0}),Object.defineProperty(sd.prototype,"parent",{get:function(){return new ld(this.cp.path.J(),this.firestore,this.vp)},enumerable:!0,configurable:!0}),Object.defineProperty(sd.prototype,"path",{get:function(){return this.cp.path.it()},enumerable:!0,configurable:!0}),sd.prototype.collection=function(t){if(gi("DocumentReference.collection",arguments,1),Ei("DocumentReference.collection","non-empty string",1,t),!t)throw new ti(Zr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Gi.et(t);return new ld(this.cp.path.child(e),this.firestore)},sd.prototype.isEqual=function(t){if(!(t instanceof sd))throw xi("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.cp.isEqual(t.cp)&&this.vp===t.vp},sd.prototype.set=function(t,e){bi("DocumentReference.set",arguments,1,2),e=dd("DocumentReference.set",e);var n=gd(this.vp,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore.ip.Oc(i,r,e.mergeFields):this.firestore.ip.Nc(i,r);return this.Ym.write(o.gc(this.cp,Mo.NONE))},sd.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof Gh?(wi("DocumentReference.update",arguments,2),this.firestore.ip.jc("DocumentReference.update",t,e,r)):(gi("DocumentReference.update",arguments,1),this.firestore.ip.Fc("DocumentReference.update",t)),this.Ym.write(n.gc(this.cp,Mo.exists(!0)))},sd.prototype.delete=function(){return gi("DocumentReference.delete",arguments,0),this.Ym.write([new Go(this.cp,Mo.NONE)])},sd.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];bi("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||jp(t[i])||(_i("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),Ni("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=jp(t[i])?t[i]:(Ei("DocumentReference.onSnapshot","function",i,t[i]),Ii("DocumentReference.onSnapshot","function",i+1,t[i+1]),Ii("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.gp(o,n)},sd.prototype.gp=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new xp({next:function(t){if(n.next){Gr(t.docs.size<=1,"Too many documents returned on a document query");var e=t.docs.get(r.cp);n.next(new Jp(r.firestore,r.cp,e,t.fromCache,t.hasPendingWrites,r.vp))}},error:e}),o=this.Ym.listen(wa.ii(this.cp.path),i,t);return function(){i.zm(),r.Ym.Df(o)}},sd.prototype.get=function(n){var r=this;return bi("DocumentReference.get",arguments,0,1),yd("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.Jm().Qm(r.cp).then(function(t){e(new Jp(r.firestore,r.cp,t,!0,t instanceof Ps&&t.cn,r.vp))},t):r.bp(e,t,n)})},sd.prototype.bp=function(e,n,r){var i=this.gp({includeMetadataChanges:!0,sv:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new ti(Zr.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new ti(Zr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},sd.prototype.withConverter=function(t){return new sd(this.cp,this.firestore,t)},sd),Xp=(od.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},od),Jp=(id.prototype.data=function(t){if(bi("DocumentSnapshot.data",arguments,0,1),t=vd("DocumentSnapshot.data",t),this.yp){if(this.vp){var e=new $p(this.lp,this.cp,this.yp,this._p,this.Ip);return this.vp.fromFirestore(e,t)}return this.Tp(this.yp.data(),Zo.Vn(t,this.lp.fp()))}},id.prototype.get=function(t,e){if(bi("DocumentSnapshot.get",arguments,1,2),e=vd("DocumentSnapshot.get",e),this.yp){var n=this.yp.data().field(Tc("DocumentSnapshot.get",t));if(null!==n)return this.Ep(n,Zo.Vn(e,this.lp.fp()))}},Object.defineProperty(id.prototype,"id",{get:function(){return this.cp.path.$()},enumerable:!0,configurable:!0}),Object.defineProperty(id.prototype,"ref",{get:function(){return new Qp(this.cp,this.lp,this.vp)},enumerable:!0,configurable:!0}),Object.defineProperty(id.prototype,"exists",{get:function(){return null!==this.yp},enumerable:!0,configurable:!0}),Object.defineProperty(id.prototype,"metadata",{get:function(){return new Xp(this.Ip,this._p)},enumerable:!0,configurable:!0}),id.prototype.isEqual=function(t){if(!(t instanceof id))throw xi("isEqual","DocumentSnapshot",1,t);return this.lp===t.lp&&this._p===t._p&&this.cp.isEqual(t.cp)&&(null===this.yp?null===t.yp:this.yp.isEqual(t.yp))&&this.vp===t.vp},id.prototype.Tp=function(t,n){var r=this,i={};return t.forEach(function(t,e){i[t]=r.Ep(e,n)}),i},id.prototype.Ep=function(t,e){if(t instanceof xs)return this.Tp(t,e);if(t instanceof Cs)return this.Rp(t,e);if(t instanceof ks){var n=t.value(e),r=this.lp.Jm().s();return t.s.isEqual(r)||qr("Document "+this.cp.path+" contains a document reference within a different database ("+t.s.projectId+"/"+t.s.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new Qp(n,this.lp,this.vp)}return t.value(e)},id.prototype.Rp=function(t,e){var n=this;return t.Yt.map(function(t){return n.Ep(t,e)})},id),$p=(t(rd,Yp=Jp),rd.prototype.data=function(t){var e=Yp.prototype.data.call(this,t);return Gr(void 0!==e,"Document in a QueryDocumentSnapshot should exist"),e},rd),Zp=(nd.prototype.where=function(t,e,n){var r;gi("Query.where",arguments,3),ki("Query.where",3,n),function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new ti(Zr.INVALID_ARGUMENT,"Invalid value "+Ri(r)+" provided to function "+t+"() for its "+Oi(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,e);var i=Tc("Query.where",t),o=ba.et(e);if(i.st()){if(o===ba.ARRAY_CONTAINS||o===ba.ARRAY_CONTAINS_ANY)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===ba.IN){this.Dp(n,o);for(var s=[],a=0,u=n;a<u.length;a++){var h=u[a];s.push(this.Pp(h))}r=new Cs(s)}else r=this.Pp(n)}else o!==ba.IN&&o!==ba.ARRAY_CONTAINS_ANY||this.Dp(n,o),r=this.firestore.ip.Uc("Query.where",n,o===ba.IN);var c=Ea.create(i,o,r);return this.Sp(c),new nd(this.Ap.ui(c),this.firestore,this.vp)},nd.prototype.orderBy=function(t,e){var n;if(bi("Query.orderBy",arguments,1,2),Ii("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=Da.ASCENDING;else{if("desc"!==e)throw new ti(Zr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=Da.DESCENDING}if(null!==this.Ap.startAt)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.Ap.endAt)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=Tc("Query.orderBy",t),i=new ka(r,n);return this.Cp(i),new nd(this.Ap.oi(i),this.firestore,this.vp)},nd.prototype.limit=function(t){return gi("Query.limit",arguments,1),Ei("Query.limit","number",1,t),Ci("Query.limit",1,t),new nd(this.Ap.hi(t),this.firestore,this.vp)},nd.prototype.limitToLast=function(t){return gi("Query.limitToLast",arguments,1),Ei("Query.limitToLast","number",1,t),Ci("Query.limitToLast",1,t),new nd(this.Ap.ci(t),this.firestore,this.vp)},nd.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi("Query.startAt",arguments,1);var r=this.Vp("Query.startAt",t,e,!0);return new nd(this.Ap.ai(r),this.firestore,this.vp)},nd.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi("Query.startAfter",arguments,1);var r=this.Vp("Query.startAfter",t,e,!1);return new nd(this.Ap.ai(r),this.firestore,this.vp)},nd.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi("Query.endBefore",arguments,1);var r=this.Vp("Query.endBefore",t,e,!0);return new nd(this.Ap.fi(r),this.firestore,this.vp)},nd.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi("Query.endAt",arguments,1);var r=this.Vp("Query.endAt",t,e,!1);return new nd(this.Ap.fi(r),this.firestore,this.vp)},nd.prototype.isEqual=function(t){if(!(t instanceof nd))throw xi("isEqual","Query",1,t);return this.firestore===t.firestore&&this.Ap.isEqual(t.Ap)},nd.prototype.withConverter=function(t){return new nd(this.Ap,this.firestore,t)},nd.prototype.Vp=function(t,e,n,r){if(ki(t,1,e),e instanceof Jp){if(0<n.length)throw new ti(Zr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new ti(Zr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.Np(t,i.yp,r)}var o=[e].concat(n);return this.kp(t,o,r)},nd.prototype.Np=function(t,e,n){for(var r=[],i=0,o=this.Ap.orderBy;i<o.length;i++){var s=o[i];if(s.field.st())r.push(new ks(this.firestore.Xm,e.key));else{var a=e.field(s.field);if(a instanceof Ds)throw new ti(Zr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a){var u=s.field.it();throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(a)}}return new Ra(r,n)},nd.prototype.kp=function(t,e,n){var r=this.Ap.Xn;if(e.length>r.length)throw new ti(Zr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.st()){if("string"!=typeof s)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.Ap.Ti()&&-1!==s.indexOf("/"))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var a=this.Ap.path.child(Gi.et(s));if(!Bi.ct(a))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+a+"' is not because it contains an odd number of segments.");var u=new Bi(a);i.push(new ks(this.firestore.Xm,u))}else{var h=this.firestore.ip.Uc(t,s);i.push(h)}}return new Ra(i,n)},nd.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];bi("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||jp(t[i])||(_i("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Ni("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=jp(t[i])?t[i]:(Ei("Query.onSnapshot","function",i,t[i]),Ii("Query.onSnapshot","function",i+1,t[i+1]),Ii("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.Op(this.Ap),this.gp(r,n)},nd.prototype.gp=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new xp({next:function(t){e.next&&e.next(new td(n.firestore,n.Ap,t,n.vp))},error:r}),o=this.firestore.Jm(),s=o.listen(this.Ap,i,t);return function(){i.zm(),o.Df(s)}},nd.prototype.Op=function(t){if(t._i()&&0===t.Xn.length)throw new ti(Zr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},nd.prototype.get=function(n){var r=this;return bi("Query.get",arguments,0,1),yd("Query.get",n),this.Op(this.Ap),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.Jm().Gm(r.Ap).then(function(t){e(new td(r.firestore,r.Ap,t,r.vp))},t):r.bp(e,t,n)})},nd.prototype.bp=function(e,n,r){var i=this.gp({includeMetadataChanges:!0,sv:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new ti(Zr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},nd.prototype.Pp=function(t){if("string"==typeof t){if(""===t)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.Ap.Ti()&&-1!==t.indexOf("/"))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.Ap.path.child(Gi.et(t));if(!Bi.ct(e))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new ks(this.firestore.Xm,new Bi(e))}if(t instanceof Qp){var n=t;return new ks(this.firestore.Xm,n.cp)}throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ri(t)+".")},nd.prototype.Dp=function(t,e){if(!Array.isArray(t)||0===t.length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},nd.prototype.Sp=function(t){if(t instanceof Ea){var e=[ba.ARRAY_CONTAINS,ba.ARRAY_CONTAINS_ANY],n=[ba.IN,ba.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.si()){var o=this.Ap.ei();if(null!==o&&!o.isEqual(t.field))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.Ap.ri();null!==s&&this.Fp(t.field,s)}else if(i||r){var a=null;if(i&&(a=this.Ap.Ii(n)),null===a&&r&&(a=this.Ap.Ii(e)),null!=a)throw a===t.op?new ti(Zr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new ti(Zr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+a.toString()+"' filters.")}}},nd.prototype.Cp=function(t){if(null===this.Ap.ri()){var e=this.Ap.ei();null!==e&&this.Fp(e,t.field)}},nd.prototype.Fp=function(t,e){if(!e.isEqual(t))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},nd),td=(Object.defineProperty(ed.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(ed.prototype,"empty",{get:function(){return this.jp.docs.Y()},enumerable:!0,configurable:!0}),Object.defineProperty(ed.prototype,"size",{get:function(){return this.jp.docs.size},enumerable:!0,configurable:!0}),ed.prototype.forEach=function(e,n){var r=this;bi("QuerySnapshot.forEach",arguments,1,2),Ei("QuerySnapshot.forEach","function",1,e),this.jp.docs.forEach(function(t){e.call(n,r.Bp(t))})},Object.defineProperty(ed.prototype,"query",{get:function(){return new Zp(this.xp,this.lp,this.vp)},enumerable:!0,configurable:!0}),ed.prototype.docChanges=function(t){t&&(_i("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Ni("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.jp.te)throw new ti(Zr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Up&&this.Lp===e||(this.Up=function(i,e,o,s){if(o.Xi.Y()){var n,r=0;return o.docChanges.map(function(t){var e=new $p(i,t.doc.key,t.doc,o.fromCache,o.$i.has(t.doc.key),s);return Gr(t.type===hu.Qi,"Invalid event type for first snapshot"),Gr(!n||o.query.wi(n,t.doc)<0,"Got added events in wrong order"),n=t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:r++}})}var a=o.Xi;return o.docChanges.filter(function(t){return e||t.type!==hu.zi}).map(function(t){var e=new $p(i,t.doc.key,t.doc,o.fromCache,o.$i.has(t.doc.key),s),n=-1,r=-1;return t.type!==hu.Qi&&(Gr(0<=(n=a.indexOf(t.doc.key)),"Index for document not found"),a=a.delete(t.doc.key)),t.type!==hu.Gi&&(r=(a=a.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case hu.Qi:return"added";case hu.Wi:case hu.zi:return"modified";case hu.Gi:return"removed";default:return Fr("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.lp,e,this.jp,this.vp),this.Lp=e),this.Up},ed.prototype.isEqual=function(t){if(!(t instanceof ed))throw xi("isEqual","QuerySnapshot",1,t);return this.lp===t.lp&&this.xp.isEqual(t.xp)&&this.jp.isEqual(t.jp)&&this.vp===t.vp},ed.prototype.Bp=function(t){return new $p(this.lp,t.key,t,this.metadata.fromCache,this.jp.$i.has(t.key),this.vp)},ed);function ed(t,e,n,r){this.lp=t,this.xp=e,this.jp=n,this.vp=r,this.Up=null,this.Lp=null,this.metadata=new Xp(n.hasPendingWrites,n.fromCache)}function nd(t,e,n){this.Ap=t,this.firestore=e,this.vp=n}function rd(){return null!==Yp&&Yp.apply(this,arguments)||this}function id(t,e,n,r,i,o){this.lp=t,this.cp=e,this.yp=n,this._p=r,this.Ip=i,this.vp=o}function od(t,e){this.hasPendingWrites=t,this.fromCache=e}function sd(t,e,n){this.cp=t,this.firestore=e,this.vp=n,this.Ym=this.firestore.Jm()}function ad(t){this.lp=t,this.wp=[],this.mp=!1}function ud(t,e){this.lp=t,this.dp=e}function hd(t,e){var n=this;if(this.Km=null,this.Hm=new Nh,this.INTERNAL={delete:function(){return p(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Jm(),[4,this.Ym.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var r=t;this.Km=r,this.Xm=hd.$m(r),this.Zm=r.name,this.tp=new ni(e)}else{var i=t;if(!i.projectId)throw new ti(Zr.INVALID_ARGUMENT,"Must provide projectId");this.Xm=new Jr(i.projectId,i.database),this.Zm="[DEFAULT]",this.tp=new ei}this.np=new Wp({}),this.ip=this.ep(this.Xm)}function cd(t){if(void 0===t.host){if(void 0!==t.ssl)throw new ti(Zr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Ti("settings","non-empty string","host",t.host),this.host=t.host,Ni("settings","boolean","ssl",t.ssl),this.ssl=pi(t.ssl,!0);if(_i("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Ni("settings","object","credentials",t.credentials),this.credentials=t.credentials,Ni("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?qr("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&qr("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=pi(t.timestampsInSnapshots,!0),Ni("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=_h.ko;else{if(t.cacheSizeBytes!==Bp&&t.cacheSizeBytes<_h.No)throw new ti(Zr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+_h.No);this.cacheSizeBytes=t.cacheSizeBytes}Ni("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}s(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(td.prototype.docChanges,t,{get:function(){return function(){throw new ti(Zr.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var fd,ld=(t(pd,fd=Zp),Object.defineProperty(pd.prototype,"id",{get:function(){return this.Ap.path.$()},enumerable:!0,configurable:!0}),Object.defineProperty(pd.prototype,"parent",{get:function(){var t=this.Ap.path.J();return t.Y()?null:new Qp(new Bi(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(pd.prototype,"path",{get:function(){return this.Ap.path.it()},enumerable:!0,configurable:!0}),pd.prototype.doc=function(t){if(bi("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=jr.u()),Ei("CollectionReference.doc","non-empty string",1,t),""===t)throw new ti(Zr.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Gi.et(t);return Qp.ap(this.Ap.path.child(e),this.firestore,this.vp)},pd.prototype.add=function(t){gi("CollectionReference.add",arguments,1),Ei("CollectionReference.add","object",1,this.vp?this.vp.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},pd.prototype.withConverter=function(t){return new pd(this.Mp,this.firestore,t)},pd);function pd(t,e,n){var r=fd.call(this,wa.ii(t),e,n)||this;if((r.Mp=t).length%2!=1)throw new ti(Zr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.it()+" has "+t.length);return r}function dd(t,e){if(void 0===e)return{merge:!1};if(_i(t,e,["merge","mergeFields"]),Ni(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Ri(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+Ri(r[o]))}(t,e,n,r,i)}(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof Gh}),void 0!==e.mergeFields&&void 0!==e.merge)throw new ti(Zr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function vd(t,e){return void 0===e?{}:(_i(t,e,["serverTimestamps"]),Ai(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function yd(t,e){Ii(t,"object",1,e),e&&(_i(t,e,["source"]),Ai(t,0,"source",e.source,["default","server","cache"]))}function md(t,e,n){if(e instanceof Qp){if(e.firestore!==n)throw new ti(Zr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw xi(t,"DocumentReference",1,e)}function gd(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}var wd=Wu(zp,"Use firebase.firestore() instead."),bd=Wu(Hp,"Use firebase.firestore().runTransaction() instead."),Ed=Wu(Kp,"Use firebase.firestore().batch() instead."),Id=Wu(Qp,"Use firebase.firestore().doc() instead."),Td=Wu(Jp),Nd=Wu($p),Ad=Wu(Zp),Sd=Wu(td),Dd=Wu(ld,"Use firebase.firestore().collection() instead."),Rd={Firestore:wd,GeoPoint:Ui,Timestamp:qi,Blob:$u,Transaction:bd,WriteBatch:Ed,DocumentReference:Id,DocumentSnapshot:Td,Query:Ad,QueryDocumentSnapshot:Nd,QuerySnapshot:Sd,CollectionReference:Dd,FieldPath:Gh,FieldValue:rc,setLogLevel:zp.setLogLevel,CACHE_SIZE_UNLIMITED:Bp};var kd=(Fd.prototype.hf=function(t){},Fd.prototype.Rf=function(){},Fd),_d=(Vd.prototype.hf=function(t){this.zp.push(t)},Vd.prototype.Rf=function(){window.removeEventListener("online",this.qp),window.removeEventListener("offline",this.Gp)},Vd.prototype.Kp=function(){window.addEventListener("online",this.qp),window.addEventListener("offline",this.Gp)},Vd.prototype.Qp=function(){Ur("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.zp;t<e.length;t++)(0,e[t])(0)},Vd.prototype.Wp=function(){Ur("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.zp;t<e.length;t++)(0,e[t])(1)},Vd.tl=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Vd),xd=(qd.prototype.Ea=function(t){Gr(!this.Yp,"Called onOpen on stream twice!"),this.Yp=t},qd.prototype.ba=function(t){Gr(!this.Xp,"Called onClose on stream twice!"),this.Xp=t},qd.prototype.onMessage=function(t){Gr(!this.$p,"Called onMessage on stream twice!"),this.$p=t},qd.prototype.close=function(){this.Jp()},qd.prototype.send=function(t){this.Hp(t)},qd.prototype.Zp=function(){Gr(void 0!==this.Yp,"Cannot call onOpen because no callback was set"),this.Yp()},qd.prototype.tg=function(t){Gr(void 0!==this.Xp,"Cannot call onClose because no callback was set"),this.Xp(t)},qd.prototype.ng=function(t){Gr(void 0!==this.$p,"Cannot call onMessage because no callback was set"),this.$p(t)},qd),Cd={BatchGetDocuments:"batchGet",Commit:"commit"},Od="gl-js/ fire/"+Or,Pd=(Ud.prototype.eg=function(t,e){if(e)for(var n in e.g)e.g.hasOwnProperty(n)&&(t[n]=e.g[n]);t["X-Goog-Api-Client"]=Od},Ud.prototype.ja=function(u,r,i){var h=this,c=this.rg(u);return new Promise(function(o,s){var a=new Cr;a.listenOnce(_r.COMPLETE,function(){try{switch(a.getLastErrorCode()){case kr.NO_ERROR:var t=a.getResponseJson();Ur("Connection","XHR received:",JSON.stringify(t)),o(t);break;case kr.TIMEOUT:Ur("Connection",'RPC "'+u+'" timed out'),s(new ti(Zr.DEADLINE_EXCEEDED,"Request time out"));break;case kr.HTTP_ERROR:var e=a.getStatus();if(Ur("Connection",'RPC "'+u+'" failed with status:',e,"response text:",a.getResponseText()),0<e){var n=a.getResponseJson().error;if(n&&n.status&&n.message){var r=(i=n.status.toLowerCase().replace("_","-"),0<=Object.values(Zr).indexOf(i)?i:Zr.UNKNOWN);s(new ti(r,n.message))}else s(new ti(Zr.UNKNOWN,"Server responded with status "+a.getStatus()))}else Ur("Connection",'RPC "'+u+'" failed'),s(new ti(Zr.UNAVAILABLE,"Connection failed."));break;default:Fr('RPC "'+u+'" failed with unanticipated webchannel error '+a.getLastErrorCode()+": "+a.getLastError()+", giving up.")}}finally{Ur("Connection",'RPC "'+u+'" completed.')}var i});var t=f({},r);delete t.database;var e=JSON.stringify(t);Ur("Connection","XHR sending: ",c+" "+e);var n={"Content-Type":"text/plain"};h.eg(n,i),a.send(c,"POST",e,n,15)})},Ud.prototype.La=function(t,e,n){return this.ja(t,e,n)},Ud.prototype.Ra=function(t,e){var n=[this.ig,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Rr(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.s.projectId+"/databases/"+this.s.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.eg(i.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(l())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=l().indexOf("Electron/")||function(){var t=l();return 0<=t.indexOf("MSIE ")||0<=t.indexOf("Trident/")}()||0<=l().indexOf("MSAppHost/")||function(){var t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function s(t,e){u.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Ur("Connection","Creating WebChannel: "+o+" "+i);var u=r.createWebChannel(o,i),a=!1,h=!1,c=new xd({Hp:function(t){h?Ur("Connection","Not sending because WebChannel is closed:",t):(a||(Ur("Connection","Opening WebChannel transport."),u.open(),a=!0),Ur("Connection","WebChannel sending:",t),u.send(t))},Jp:function(){return u.close()}});return s(xr.EventType.OPEN,function(){h||Ur("Connection","WebChannel transport opened.")}),s(xr.EventType.CLOSE,function(){h||(h=!0,Ur("Connection","WebChannel transport closed"),c.tg())}),s(xr.EventType.ERROR,function(t){h||(h=!0,Ur("Connection","WebChannel transport errored:",t),c.tg(new ti(Zr.UNAVAILABLE,"The operation could not be completed")))}),s(xr.EventType.MESSAGE,function(t){var e;if(!h){var n=t.data[0];Gr(!!n,"Got a webchannel message without data.");var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){Ur("Connection","WebChannel received error:",i);var o=i.status,s=function(){var t=Ba[o];if(void 0!==t)return Ja(t)}(),a=i.message;void 0===s&&(s=Zr.INTERNAL,a="Unknown error status: "+o+" with message "+i.message),h=!0,c.tg(new ti(s,a)),u.close()}else Ur("Connection","WebChannel received:",n),c.ng(n)}}),setTimeout(function(){c.Zp()},0),c},Ud.prototype.rg=function(t){var e=Cd[t];return Gr(void 0!==e,"Unknown REST mapping for: "+t),this.ig+"/v1/projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents:"+e},Ud),Ld=(Object.defineProperty(Md.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(Md.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),Md.prototype.jm=function(t){return Promise.resolve(new Pd(t))},Md.prototype.Lm=function(){return _d.tl()?new _d:new kd},Md.prototype.Bm=function(t){return new Gu(t,{ir:!0})},Md.prototype.i=function(t){return JSON.stringify(t)},Md.prototype.atob=function(t){return atob(t)},Md.prototype.btoa=function(t){return btoa(t)},Md);function Md(){this.mu="undefined"!=typeof atob}function Ud(t){this.s=t.s;var e=t.ssl?"https":"http";this.ig=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function qd(t){this.Hp=t.Hp,this.Jp=t.Jp}function Vd(){var t=this;this.qp=function(){return t.Qp()},this.Gp=function(){return t.Wp()},this.zp=[],this.Kp()}function Fd(){}ju.wu(new Ld);var Gd;(Gd=jd).INTERNAL.registerComponent(new b("firestore",function(t){var e=t.getProvider("app").getImmediate();return new zp(e,t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(function(t){Gr(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(Rd))),Gd.registerVersion("@firebase/firestore","1.10.1")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.min.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.min.js.map
